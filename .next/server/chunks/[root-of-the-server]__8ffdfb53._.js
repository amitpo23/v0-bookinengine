module.exports=[918622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},324725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},442315,(e,t,r)=>{"use strict";t.exports=e.r(918622)},347540,(e,t,r)=>{"use strict";t.exports=e.r(442315).vendored["react-rsc"].React},323831,e=>{"use strict";var t=e.i(224389);let r=[],i=null,o="\x1b[0m",s="\x1b[2m",a="\x1b[31m",n="\x1b[32m",l="\x1b[33m";function c(e,t=200){return e?e.length<=t?e:e.substring(0,t)+"...":""}class d{static instance;enabled=!0;constructor(){}static getInstance(){return d.instance||(d.instance=new d),d.instance}setEnabled(e){this.enabled=e}formatLogForConsole(e){var t;let r=new Date(e.timestamp).toLocaleTimeString("he-IL"),i=function(e){switch(e){case"api":return"ðŸŒ";case"medici":return"ðŸ¨";case"booking":return"ðŸ“‹";case"auth":return"ðŸ”";case"system":return"âš™ï¸";default:return"ðŸ“"}}(e.category),c=function(e){switch(e){case"debug":return s;case"info":return"\x1b[36m";case"warn":return l;case"error":return a;default:return"\x1b[37m"}}(e.level),d=`${s}[${r}]${o} ${i} ${c}[${e.level.toUpperCase()}]${o} `;if(d+=`\x1b[1m${e.action}${o}`,e.method&&e.endpoint){let t="GET"===e.method?n:"POST"===e.method?"\x1b[34m":"PUT"===e.method?l:a;d+=` ${t}${e.method}${o} ${e.endpoint}`}if(e.statusCode){let t=e.statusCode<300?n:e.statusCode<400?l:a;d+=` ${t}[${e.statusCode}]${o}`}return e.duration&&(d+=` \x1b[35m(${(t=e.duration)<1e3?`${t}ms`:`${(t/1e3).toFixed(2)}s`})${o}`),d}async log(e){if(!this.enabled)return;let t={...e,timestamp:new Date().toISOString()};console.log(this.formatLogForConsole(t)),"error"===e.level&&e.error&&console.error(`${a}  Error: ${e.error}${o}`),e.requestBody&&("debug"===e.level||"error"===e.level)&&console.log(`${s}  Request: ${c(JSON.stringify(e.requestBody))}${o}`),e.responseBody&&"error"===e.level&&console.log(`${s}  Response: ${c(JSON.stringify(e.responseBody))}${o}`),r.push(t),r.length>1e3&&r.shift(),this.saveToSupabase(t).catch(()=>{})}async saveToSupabase(e){let r=(!i&&process.env.SUPABASE_SERVICE_KEY&&(i=(0,t.createClient)("https://wsmchexmtiijufemzzwu.supabase.co",process.env.SUPABASE_SERVICE_KEY)),i);if(r)try{await r.from("api_logs").insert({timestamp:e.timestamp,level:e.level,category:e.category,action:e.action,method:e.method,endpoint:e.endpoint,request_body:e.requestBody,response_body:e.responseBody,status_code:e.statusCode,duration_ms:e.duration,user_id:e.userId,session_id:e.sessionId,ip_address:e.ip,user_agent:e.userAgent,error_message:e.error,metadata:e.metadata})}catch(e){}}debug(e,t,r){this.log({level:"debug",category:e,action:t,metadata:r})}info(e,t,r){this.log({level:"info",category:e,action:t,metadata:r})}warn(e,t,r){this.log({level:"warn",category:e,action:t,metadata:r})}error(e,t,r,i){this.log({level:"error",category:e,action:t,error:r,metadata:i})}async logApiRequest(e){let t=e.statusCode>=500?"error":e.statusCode>=400?"warn":"info";await this.log({level:t,category:"api",action:"API Request",...e})}async logMediciCall(e){let t=e.statusCode>=500?"error":e.statusCode>=400?"warn":"info";await this.log({level:t,category:"medici",method:"POST",...e})}getRecentLogs(e=100,t){let i=[...r].reverse();return t&&(i=i.filter(e=>(!t.level||e.level===t.level)&&(!t.category||e.category===t.category)&&(!t.action||!!e.action.includes(t.action)))),i.slice(0,e)}clearBuffer(){r.length=0}}let u=d.getInstance();e.s(["apiLogger",0,u])},711897,e=>{"use strict";var t=e.i(323831);let r=[],i=new Map,o=[{id:"booking_failure",name:"Booking Failed",type:"booking_failed",condition:e=>"book"===e.action&&!1===e.success,severity:"high",cooldown:60,actions:["log","webhook"]},{id:"payment_failure",name:"Payment Failed",type:"payment_failed",condition:e=>"payment"===e.action&&!1===e.success,severity:"critical",cooldown:30,actions:["log","email","webhook"]},{id:"price_mismatch",name:"Price Mismatch Detected",type:"price_mismatch",condition:e=>e.originalPrice&&e.currentPrice&&Math.abs(e.originalPrice-e.currentPrice)/e.originalPrice>.05,severity:"medium",cooldown:120,actions:["log"]},{id:"high_error_rate",name:"High Error Rate",type:"api_failure",condition:e=>e.errorRate>.1,severity:"high",cooldown:300,actions:["log","webhook"]},{id:"cancellation_failure",name:"Cancellation Failed",type:"cancellation_issue",condition:e=>"cancel"===e.action&&!1===e.success,severity:"high",cooldown:60,actions:["log","email"]},{id:"medici_timeout",name:"Medici API Timeout",type:"timeout",condition:e=>"medici"===e.category&&e.duration>3e4,severity:"medium",cooldown:120,actions:["log"]},{id:"auth_failure",name:"Authentication Failure",type:"authentication",condition:e=>401===e.statusCode,severity:"high",cooldown:60,actions:["log","webhook"]}];class s{static instance;webhookUrl;emailHandler;constructor(){this.webhookUrl=process.env.ALERT_WEBHOOK_URL}static getInstance(){return s.instance||(s.instance=new s),s.instance}async createAlert(e){let i={...e,id:`alert_${Date.now()}_${Math.random().toString(36).substring(7)}`,timestamp:new Date().toISOString(),resolved:!1};return r.unshift(i),r.length>500&&r.pop(),t.apiLogger.log({level:"critical"===i.severity||"high"===i.severity?"error":"medium"===i.severity?"warn":"info",category:"system",action:`ðŸš¨ ALERT: ${i.title}`,metadata:{alertId:i.id,type:i.type,severity:i.severity,description:i.description,...i.metadata}}),await this.executeActions(i,["log","webhook"]),i}async checkRules(e){let t=[];for(let r of o)try{if(r.condition(e)&&!function(e,t){let r=i.get(e);return!!r&&Date.now()-r<1e3*t}(r.id,r.cooldown)){i.set(r.id,Date.now());let o=await this.createAlert({type:r.type,severity:r.severity,title:r.name,description:`Rule ${r.id} triggered`,source:e.source||"system",metadata:e,requestId:e.requestId,userId:e.userId,bookingId:e.bookingId});t.push(o)}}catch(e){console.error(`Error checking rule ${r.id}:`,e)}return t}async executeActions(e,t){for(let r of t)try{switch(r){case"webhook":await this.sendWebhook(e);break;case"email":await this.sendEmail(e);break;case"slack":await this.sendSlack(e)}}catch(e){console.error(`Failed to execute action ${r}:`,e)}}async sendWebhook(e){if(this.webhookUrl)try{await fetch(this.webhookUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"alert",alert:e,timestamp:new Date().toISOString()})})}catch(e){console.error("Webhook failed:",e)}}async sendEmail(e){this.emailHandler&&await this.emailHandler(e)}async sendSlack(e){let t=process.env.SLACK_WEBHOOK_URL;if(!t)return;let r="critical"===e.severity?"#dc3545":"high"===e.severity?"#fd7e14":"medium"===e.severity?"#ffc107":"#17a2b8";try{await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({attachments:[{color:r,title:`ðŸš¨ ${e.title}`,text:e.description,fields:[{title:"Severity",value:e.severity,short:!0},{title:"Type",value:e.type,short:!0},{title:"Source",value:e.source,short:!0}],ts:Math.floor(new Date(e.timestamp).getTime()/1e3)}]})})}catch(e){console.error("Slack notification failed:",e)}}resolveAlert(e,t){let i=r.find(t=>t.id===e);return!!i&&!i.resolved&&(i.resolved=!0,i.resolvedAt=new Date().toISOString(),i.resolvedBy=t,!0)}getAlerts(e){let t=[...r];return e&&(e.type&&(t=t.filter(t=>t.type===e.type)),e.severity&&(t=t.filter(t=>t.severity===e.severity)),void 0!==e.resolved&&(t=t.filter(t=>t.resolved===e.resolved)),e.from&&(t=t.filter(t=>new Date(t.timestamp)>=e.from)),e.to&&(t=t.filter(t=>new Date(t.timestamp)<=e.to))),t.slice(0,e?.limit||100)}getStats(){let e=Date.now()-864e5;return{total:r.length,unresolved:r.filter(e=>!e.resolved).length,bySeverity:{critical:r.filter(e=>"critical"===e.severity).length,high:r.filter(e=>"high"===e.severity).length,medium:r.filter(e=>"medium"===e.severity).length,low:r.filter(e=>"low"===e.severity).length},byType:r.reduce((e,t)=>(e[t.type]=(e[t.type]||0)+1,e),{}),last24h:r.filter(t=>new Date(t.timestamp).getTime()>e).length}}setEmailHandler(e){this.emailHandler=e}}let a=s.getInstance();async function n(e,t,r,i,o){return a.createAlert({type:e,severity:t,title:r,description:i,source:"manual",metadata:o||{}})}e.s(["alertManager",0,a,"triggerAlert",()=>n])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__8ffdfb53._.js.map