{"version":3,"sources":["../../../node_modules/next/src/server/route-modules/app-page/module.compiled.js","../../../node_modules/next/src/server/route-modules/app-page/vendored/rsc/react.ts","../../../lib/logging/api-logger.ts"],"sourcesContent":["if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/app-page/module.js')\n} else {\n  if (process.env.__NEXT_EXPERIMENTAL_REACT) {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo-experimental.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page-experimental.runtime.prod.js')\n      }\n    }\n  } else {\n    if (process.env.NODE_ENV === 'development') {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.dev.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.dev.js')\n      }\n    } else {\n      if (process.env.TURBOPACK) {\n        module.exports = require('next/dist/compiled/next-server/app-page-turbo.runtime.prod.js')\n      } else {\n        module.exports = require('next/dist/compiled/next-server/app-page.runtime.prod.js')\n      }\n    }\n  }\n}\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-rsc']!.React\n","// Comprehensive API Logging System\r\n// Tracks all API calls, responses, and errors\r\n\r\nimport { createClient } from \"@supabase/supabase-js\"\r\n\r\n// Log levels\r\nexport type LogLevel = \"debug\" | \"info\" | \"warn\" | \"error\"\r\n\r\n// Log entry structure\r\nexport interface ApiLogEntry {\r\n  id?: string\r\n  timestamp: string\r\n  level: LogLevel\r\n  category: \"api\" | \"medici\" | \"booking\" | \"auth\" | \"system\"\r\n  action: string\r\n  method?: string\r\n  endpoint?: string\r\n  requestBody?: any\r\n  responseBody?: any\r\n  statusCode?: number\r\n  duration?: number\r\n  userId?: string\r\n  sessionId?: string\r\n  ip?: string\r\n  userAgent?: string\r\n  error?: string\r\n  metadata?: Record<string, any>\r\n}\r\n\r\n// In-memory buffer for logs (also saved to Supabase if configured)\r\nconst logBuffer: ApiLogEntry[] = []\r\nconst MAX_BUFFER_SIZE = 1000\r\n\r\n// Supabase client for persistent logging\r\nlet supabase: ReturnType<typeof createClient> | null = null\r\n\r\nfunction getSupabase() {\r\n  if (!supabase && process.env.NEXT_PUBLIC_SUPABASE_URL && process.env.SUPABASE_SERVICE_KEY) {\r\n    supabase = createClient(\r\n      process.env.NEXT_PUBLIC_SUPABASE_URL,\r\n      process.env.SUPABASE_SERVICE_KEY\r\n    )\r\n  }\r\n  return supabase\r\n}\r\n\r\n// Color codes for console output\r\nconst colors = {\r\n  reset: \"\\x1b[0m\",\r\n  bright: \"\\x1b[1m\",\r\n  dim: \"\\x1b[2m\",\r\n  red: \"\\x1b[31m\",\r\n  green: \"\\x1b[32m\",\r\n  yellow: \"\\x1b[33m\",\r\n  blue: \"\\x1b[34m\",\r\n  magenta: \"\\x1b[35m\",\r\n  cyan: \"\\x1b[36m\",\r\n  white: \"\\x1b[37m\",\r\n  bgRed: \"\\x1b[41m\",\r\n  bgGreen: \"\\x1b[42m\",\r\n  bgYellow: \"\\x1b[43m\",\r\n  bgBlue: \"\\x1b[44m\",\r\n}\r\n\r\nfunction getLevelColor(level: LogLevel): string {\r\n  switch (level) {\r\n    case \"debug\": return colors.dim\r\n    case \"info\": return colors.cyan\r\n    case \"warn\": return colors.yellow\r\n    case \"error\": return colors.red\r\n    default: return colors.white\r\n  }\r\n}\r\n\r\nfunction getCategoryIcon(category: ApiLogEntry[\"category\"]): string {\r\n  switch (category) {\r\n    case \"api\": return \"üåê\"\r\n    case \"medici\": return \"üè®\"\r\n    case \"booking\": return \"üìã\"\r\n    case \"auth\": return \"üîê\"\r\n    case \"system\": return \"‚öôÔ∏è\"\r\n    default: return \"üìù\"\r\n  }\r\n}\r\n\r\nfunction formatDuration(ms: number): string {\r\n  if (ms < 1000) return `${ms}ms`\r\n  return `${(ms / 1000).toFixed(2)}s`\r\n}\r\n\r\nfunction truncate(str: string, maxLen: number = 200): string {\r\n  if (!str) return \"\"\r\n  if (str.length <= maxLen) return str\r\n  return str.substring(0, maxLen) + \"...\"\r\n}\r\n\r\n// Main logger class\r\nclass ApiLogger {\r\n  private static instance: ApiLogger\r\n  private enabled: boolean = true\r\n\r\n  private constructor() {}\r\n\r\n  static getInstance(): ApiLogger {\r\n    if (!ApiLogger.instance) {\r\n      ApiLogger.instance = new ApiLogger()\r\n    }\r\n    return ApiLogger.instance\r\n  }\r\n\r\n  setEnabled(enabled: boolean) {\r\n    this.enabled = enabled\r\n  }\r\n\r\n  private formatLogForConsole(entry: ApiLogEntry): string {\r\n    const time = new Date(entry.timestamp).toLocaleTimeString(\"he-IL\")\r\n    const icon = getCategoryIcon(entry.category)\r\n    const levelColor = getLevelColor(entry.level)\r\n    \r\n    let output = `${colors.dim}[${time}]${colors.reset} ${icon} ${levelColor}[${entry.level.toUpperCase()}]${colors.reset} `\r\n    output += `${colors.bright}${entry.action}${colors.reset}`\r\n    \r\n    if (entry.method && entry.endpoint) {\r\n      const methodColor = entry.method === \"GET\" ? colors.green : \r\n                         entry.method === \"POST\" ? colors.blue : \r\n                         entry.method === \"PUT\" ? colors.yellow : colors.red\r\n      output += ` ${methodColor}${entry.method}${colors.reset} ${entry.endpoint}`\r\n    }\r\n    \r\n    if (entry.statusCode) {\r\n      const statusColor = entry.statusCode < 300 ? colors.green : \r\n                         entry.statusCode < 400 ? colors.yellow : colors.red\r\n      output += ` ${statusColor}[${entry.statusCode}]${colors.reset}`\r\n    }\r\n    \r\n    if (entry.duration) {\r\n      output += ` ${colors.magenta}(${formatDuration(entry.duration)})${colors.reset}`\r\n    }\r\n    \r\n    return output\r\n  }\r\n\r\n  async log(entry: Omit<ApiLogEntry, \"id\" | \"timestamp\">): Promise<void> {\r\n    if (!this.enabled) return\r\n\r\n    const fullEntry: ApiLogEntry = {\r\n      ...entry,\r\n      timestamp: new Date().toISOString(),\r\n    }\r\n\r\n    // Console output\r\n    console.log(this.formatLogForConsole(fullEntry))\r\n    \r\n    // Additional details for errors or debug\r\n    if (entry.level === \"error\" && entry.error) {\r\n      console.error(`${colors.red}  Error: ${entry.error}${colors.reset}`)\r\n    }\r\n    \r\n    if (entry.requestBody && (entry.level === \"debug\" || entry.level === \"error\")) {\r\n      console.log(`${colors.dim}  Request: ${truncate(JSON.stringify(entry.requestBody))}${colors.reset}`)\r\n    }\r\n    \r\n    if (entry.responseBody && entry.level === \"error\") {\r\n      console.log(`${colors.dim}  Response: ${truncate(JSON.stringify(entry.responseBody))}${colors.reset}`)\r\n    }\r\n\r\n    // Add to buffer\r\n    logBuffer.push(fullEntry)\r\n    if (logBuffer.length > MAX_BUFFER_SIZE) {\r\n      logBuffer.shift()\r\n    }\r\n\r\n    // Save to Supabase (async, non-blocking)\r\n    this.saveToSupabase(fullEntry).catch(() => {})\r\n  }\r\n\r\n  private async saveToSupabase(entry: ApiLogEntry): Promise<void> {\r\n    const db = getSupabase()\r\n    if (!db) return\r\n\r\n    try {\r\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n      await (db.from(\"api_logs\") as any).insert({\r\n        timestamp: entry.timestamp,\r\n        level: entry.level,\r\n        category: entry.category,\r\n        action: entry.action,\r\n        method: entry.method,\r\n        endpoint: entry.endpoint,\r\n        request_body: entry.requestBody,\r\n        response_body: entry.responseBody,\r\n        status_code: entry.statusCode,\r\n        duration_ms: entry.duration,\r\n        user_id: entry.userId,\r\n        session_id: entry.sessionId,\r\n        ip_address: entry.ip,\r\n        user_agent: entry.userAgent,\r\n        error_message: entry.error,\r\n        metadata: entry.metadata,\r\n      })\r\n    } catch (error) {\r\n      // Silent fail - don't let logging break the app\r\n    }\r\n  }\r\n\r\n  // Convenience methods\r\n  debug(category: ApiLogEntry[\"category\"], action: string, metadata?: Record<string, any>) {\r\n    this.log({ level: \"debug\", category, action, metadata })\r\n  }\r\n\r\n  info(category: ApiLogEntry[\"category\"], action: string, metadata?: Record<string, any>) {\r\n    this.log({ level: \"info\", category, action, metadata })\r\n  }\r\n\r\n  warn(category: ApiLogEntry[\"category\"], action: string, metadata?: Record<string, any>) {\r\n    this.log({ level: \"warn\", category, action, metadata })\r\n  }\r\n\r\n  error(category: ApiLogEntry[\"category\"], action: string, error?: string, metadata?: Record<string, any>) {\r\n    this.log({ level: \"error\", category, action, error, metadata })\r\n  }\r\n\r\n  // API request logging\r\n  async logApiRequest(params: {\r\n    method: string\r\n    endpoint: string\r\n    requestBody?: any\r\n    responseBody?: any\r\n    statusCode: number\r\n    duration: number\r\n    userId?: string\r\n    ip?: string\r\n    userAgent?: string\r\n    error?: string\r\n  }) {\r\n    const level: LogLevel = params.statusCode >= 500 ? \"error\" : \r\n                           params.statusCode >= 400 ? \"warn\" : \"info\"\r\n    \r\n    await this.log({\r\n      level,\r\n      category: \"api\",\r\n      action: `API Request`,\r\n      ...params,\r\n    })\r\n  }\r\n\r\n  // Medici API logging\r\n  async logMediciCall(params: {\r\n    action: string\r\n    endpoint: string\r\n    requestBody?: any\r\n    responseBody?: any\r\n    statusCode: number\r\n    duration: number\r\n    error?: string\r\n  }) {\r\n    const level: LogLevel = params.statusCode >= 500 ? \"error\" : \r\n                           params.statusCode >= 400 ? \"warn\" : \"info\"\r\n    \r\n    await this.log({\r\n      level,\r\n      category: \"medici\",\r\n      method: \"POST\",\r\n      ...params,\r\n    })\r\n  }\r\n\r\n  // Get recent logs\r\n  getRecentLogs(count: number = 100, filter?: Partial<ApiLogEntry>): ApiLogEntry[] {\r\n    let logs = [...logBuffer].reverse()\r\n    \r\n    if (filter) {\r\n      logs = logs.filter(log => {\r\n        if (filter.level && log.level !== filter.level) return false\r\n        if (filter.category && log.category !== filter.category) return false\r\n        if (filter.action && !log.action.includes(filter.action)) return false\r\n        return true\r\n      })\r\n    }\r\n    \r\n    return logs.slice(0, count)\r\n  }\r\n\r\n  // Clear buffer\r\n  clearBuffer() {\r\n    logBuffer.length = 0\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const apiLogger = ApiLogger.getInstance()\r\n\r\n// Export helper for timing operations\r\nexport function withTiming<T>(operation: () => Promise<T>): Promise<{ result: T; duration: number }> {\r\n  const start = Date.now()\r\n  return operation().then(result => ({\r\n    result,\r\n    duration: Date.now() - start\r\n  }))\r\n}\r\n"],"names":["process","env","NEXT_RUNTIME","module","exports","require","__NEXT_EXPERIMENTAL_REACT","NODE_ENV","TURBOPACK","vendored","React"],"mappings":"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","ignoreList":[0,1]}