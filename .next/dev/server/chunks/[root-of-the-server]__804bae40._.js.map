{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/97250/Desktop/booking%20engine/v0-bookinengine/lib/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\r\n\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL || ''\r\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || ''\r\n\r\n// Only create client if we have valid credentials\r\nexport const supabase = supabaseUrl && supabaseAnonKey \r\n  ? createClient(supabaseUrl, supabaseAnonKey)\r\n  : null\r\n\r\n// Server-side client with service role key (for admin operations)\r\nexport const supabaseAdmin = supabaseUrl && process.env.SUPABASE_SERVICE_ROLE_KEY\r\n  ? createClient(\r\n      supabaseUrl,\r\n      process.env.SUPABASE_SERVICE_ROLE_KEY,\r\n      {\r\n        auth: {\r\n          autoRefreshToken: false,\r\n          persistSession: false\r\n        }\r\n      }\r\n    )\r\n  : null\r\n\r\n// Types for database tables\r\nexport interface User {\r\n  id: string\r\n  email: string\r\n  name?: string\r\n  image?: string\r\n  phone?: string\r\n  address?: string\r\n  city?: string\r\n  country?: string\r\n  google_id?: string\r\n  created_at: string\r\n  updated_at: string\r\n}\r\n\r\nexport interface Booking {\r\n  id: string\r\n  user_id?: string\r\n  booking_reference: string\r\n  hotel_name: string\r\n  check_in: string\r\n  check_out: string\r\n  guests: any\r\n  total_price: number\r\n  status: string\r\n  booking_data: any\r\n  created_at: string\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,cAAc,gFAAwC;AAC5D,MAAM,kBAAkB,wPAA6C;AAG9D,MAAM,WAAW,uCACpB,IAAA,gMAAY,EAAC,aAAa,mBAC1B;AAGG,MAAM,gBAAgB,eAAe,QAAQ,GAAG,CAAC,yBAAyB,GAC7E,IAAA,gMAAY,EACV,aACA,QAAQ,GAAG,CAAC,yBAAyB,EACrC;IACE,MAAM;QACJ,kBAAkB;QAClB,gBAAgB;IAClB;AACF,KAEF"}},
    {"offset": {"line": 61, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/97250/Desktop/booking%20engine/v0-bookinengine/app/api/admin/chat-conversations/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\r\nimport { supabaseAdmin } from \"@/lib/supabase\"\r\n\r\n// Chat Conversations API - returns real conversations from database\r\nexport async function GET(request: NextRequest) {\r\n  const searchParams = request.nextUrl.searchParams\r\n  const template = searchParams.get(\"template\") || \"scarlet\"\r\n  const limit = parseInt(searchParams.get(\"limit\") || \"50\")\r\n\r\n  // If no Supabase configured, return empty array\r\n  if (!supabaseAdmin) {\r\n    return NextResponse.json({\r\n      success: true,\r\n      conversations: [],\r\n      message: \"Database not configured\"\r\n    })\r\n  }\r\n\r\n  try {\r\n    // Fetch chat sessions with messages\r\n    const { data: sessions, error } = await supabaseAdmin\r\n      .from(\"chat_sessions\")\r\n      .select(`\r\n        id,\r\n        session_id,\r\n        hotel_id,\r\n        guest_name,\r\n        guest_email,\r\n        guest_phone,\r\n        started_at,\r\n        ended_at,\r\n        message_count,\r\n        topics,\r\n        sentiment,\r\n        lead_to_booking,\r\n        booking_id,\r\n        booking_value,\r\n        device,\r\n        source,\r\n        rating,\r\n        feedback,\r\n        created_at,\r\n        chat_messages (\r\n          id,\r\n          role,\r\n          content,\r\n          skill,\r\n          created_at\r\n        )\r\n      `)\r\n      .eq(\"hotel_id\", template)\r\n      .order(\"created_at\", { ascending: false })\r\n      .limit(limit)\r\n\r\n    if (error) {\r\n      console.error(\"Error fetching chat conversations:\", error)\r\n      // Return empty array if table doesn't exist yet\r\n      return NextResponse.json({\r\n        success: true,\r\n        conversations: [],\r\n        message: \"No conversations found or table not set up\"\r\n      })\r\n    }\r\n\r\n    // Transform to expected format\r\n    const conversations = (sessions || []).map(session => ({\r\n      id: session.id,\r\n      sessionId: session.session_id,\r\n      guestName: session.guest_name,\r\n      guestEmail: session.guest_email,\r\n      guestPhone: session.guest_phone,\r\n      startedAt: session.started_at,\r\n      endedAt: session.ended_at,\r\n      messageCount: session.message_count || 0,\r\n      messages: (session.chat_messages || []).map((msg: any) => ({\r\n        id: msg.id,\r\n        role: msg.role,\r\n        content: msg.content,\r\n        timestamp: msg.created_at,\r\n        skill: msg.skill\r\n      })),\r\n      topics: session.topics || [],\r\n      sentiment: session.sentiment || \"neutral\",\r\n      leadToBooking: session.lead_to_booking || false,\r\n      bookingId: session.booking_id,\r\n      bookingValue: session.booking_value,\r\n      device: session.device || \"desktop\",\r\n      source: session.source || \"direct\",\r\n      rating: session.rating,\r\n      feedback: session.feedback\r\n    }))\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      conversations\r\n    })\r\n  } catch (error) {\r\n    console.error(\"Error in chat-conversations API:\", error)\r\n    return NextResponse.json({\r\n      success: true,\r\n      conversations: [],\r\n      message: \"Database not connected\"\r\n    })\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAGO,eAAe,IAAI,OAAoB;IAC5C,MAAM,eAAe,QAAQ,OAAO,CAAC,YAAY;IACjD,MAAM,WAAW,aAAa,GAAG,CAAC,eAAe;IACjD,MAAM,QAAQ,SAAS,aAAa,GAAG,CAAC,YAAY;IAEpD,gDAAgD;IAChD,IAAI,CAAC,kIAAa,EAAE;QAClB,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,eAAe,EAAE;YACjB,SAAS;QACX;IACF;IAEA,IAAI;QACF,oCAAoC;QACpC,MAAM,EAAE,MAAM,QAAQ,EAAE,KAAK,EAAE,GAAG,MAAM,kIAAa,CAClD,IAAI,CAAC,iBACL,MAAM,CAAC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;MA2BT,CAAC,EACA,EAAE,CAAC,YAAY,UACf,KAAK,CAAC,cAAc;YAAE,WAAW;QAAM,GACvC,KAAK,CAAC;QAET,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,sCAAsC;YACpD,gDAAgD;YAChD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,SAAS;gBACT,eAAe,EAAE;gBACjB,SAAS;YACX;QACF;QAEA,+BAA+B;QAC/B,MAAM,gBAAgB,CAAC,YAAY,EAAE,EAAE,GAAG,CAAC,CAAA,UAAW,CAAC;gBACrD,IAAI,QAAQ,EAAE;gBACd,WAAW,QAAQ,UAAU;gBAC7B,WAAW,QAAQ,UAAU;gBAC7B,YAAY,QAAQ,WAAW;gBAC/B,YAAY,QAAQ,WAAW;gBAC/B,WAAW,QAAQ,UAAU;gBAC7B,SAAS,QAAQ,QAAQ;gBACzB,cAAc,QAAQ,aAAa,IAAI;gBACvC,UAAU,CAAC,QAAQ,aAAa,IAAI,EAAE,EAAE,GAAG,CAAC,CAAC,MAAa,CAAC;wBACzD,IAAI,IAAI,EAAE;wBACV,MAAM,IAAI,IAAI;wBACd,SAAS,IAAI,OAAO;wBACpB,WAAW,IAAI,UAAU;wBACzB,OAAO,IAAI,KAAK;oBAClB,CAAC;gBACD,QAAQ,QAAQ,MAAM,IAAI,EAAE;gBAC5B,WAAW,QAAQ,SAAS,IAAI;gBAChC,eAAe,QAAQ,eAAe,IAAI;gBAC1C,WAAW,QAAQ,UAAU;gBAC7B,cAAc,QAAQ,aAAa;gBACnC,QAAQ,QAAQ,MAAM,IAAI;gBAC1B,QAAQ,QAAQ,MAAM,IAAI;gBAC1B,QAAQ,QAAQ,MAAM;gBACtB,UAAU,QAAQ,QAAQ;YAC5B,CAAC;QAED,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,oCAAoC;QAClD,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,eAAe,EAAE;YACjB,SAAS;QACX;IACF;AACF"}}]
}