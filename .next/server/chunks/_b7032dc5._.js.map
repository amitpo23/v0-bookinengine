{"version":3,"sources":["../../../lib/logging/api-logger.ts","../../../lib/api/medici-client.ts","../../../lib/api/medici-types.ts"],"sourcesContent":["// Comprehensive API Logging System\r\n// Tracks all API calls, responses, and errors\r\n\r\nimport { createClient } from \"@supabase/supabase-js\"\r\n\r\n// Log levels\r\nexport type LogLevel = \"debug\" | \"info\" | \"warn\" | \"error\"\r\n\r\n// Log entry structure\r\nexport interface ApiLogEntry {\r\n  id?: string\r\n  timestamp: string\r\n  level: LogLevel\r\n  category: \"api\" | \"medici\" | \"booking\" | \"auth\" | \"system\"\r\n  action: string\r\n  method?: string\r\n  endpoint?: string\r\n  requestBody?: any\r\n  responseBody?: any\r\n  statusCode?: number\r\n  duration?: number\r\n  userId?: string\r\n  sessionId?: string\r\n  ip?: string\r\n  userAgent?: string\r\n  error?: string\r\n  metadata?: Record<string, any>\r\n}\r\n\r\n// In-memory buffer for logs (also saved to Supabase if configured)\r\nconst logBuffer: ApiLogEntry[] = []\r\nconst MAX_BUFFER_SIZE = 1000\r\n\r\n// Supabase client for persistent logging\r\nlet supabase: ReturnType<typeof createClient> | null = null\r\n\r\nfunction getSupabase() {\r\n  if (!supabase && process.env.NEXT_PUBLIC_SUPABASE_URL && process.env.SUPABASE_SERVICE_KEY) {\r\n    supabase = createClient(\r\n      process.env.NEXT_PUBLIC_SUPABASE_URL,\r\n      process.env.SUPABASE_SERVICE_KEY\r\n    )\r\n  }\r\n  return supabase\r\n}\r\n\r\n// Color codes for console output\r\nconst colors = {\r\n  reset: \"\\x1b[0m\",\r\n  bright: \"\\x1b[1m\",\r\n  dim: \"\\x1b[2m\",\r\n  red: \"\\x1b[31m\",\r\n  green: \"\\x1b[32m\",\r\n  yellow: \"\\x1b[33m\",\r\n  blue: \"\\x1b[34m\",\r\n  magenta: \"\\x1b[35m\",\r\n  cyan: \"\\x1b[36m\",\r\n  white: \"\\x1b[37m\",\r\n  bgRed: \"\\x1b[41m\",\r\n  bgGreen: \"\\x1b[42m\",\r\n  bgYellow: \"\\x1b[43m\",\r\n  bgBlue: \"\\x1b[44m\",\r\n}\r\n\r\nfunction getLevelColor(level: LogLevel): string {\r\n  switch (level) {\r\n    case \"debug\": return colors.dim\r\n    case \"info\": return colors.cyan\r\n    case \"warn\": return colors.yellow\r\n    case \"error\": return colors.red\r\n    default: return colors.white\r\n  }\r\n}\r\n\r\nfunction getCategoryIcon(category: ApiLogEntry[\"category\"]): string {\r\n  switch (category) {\r\n    case \"api\": return \"üåê\"\r\n    case \"medici\": return \"üè®\"\r\n    case \"booking\": return \"üìã\"\r\n    case \"auth\": return \"üîê\"\r\n    case \"system\": return \"‚öôÔ∏è\"\r\n    default: return \"üìù\"\r\n  }\r\n}\r\n\r\nfunction formatDuration(ms: number): string {\r\n  if (ms < 1000) return `${ms}ms`\r\n  return `${(ms / 1000).toFixed(2)}s`\r\n}\r\n\r\nfunction truncate(str: string, maxLen: number = 200): string {\r\n  if (!str) return \"\"\r\n  if (str.length <= maxLen) return str\r\n  return str.substring(0, maxLen) + \"...\"\r\n}\r\n\r\n// Main logger class\r\nclass ApiLogger {\r\n  private static instance: ApiLogger\r\n  private enabled: boolean = true\r\n\r\n  private constructor() {}\r\n\r\n  static getInstance(): ApiLogger {\r\n    if (!ApiLogger.instance) {\r\n      ApiLogger.instance = new ApiLogger()\r\n    }\r\n    return ApiLogger.instance\r\n  }\r\n\r\n  setEnabled(enabled: boolean) {\r\n    this.enabled = enabled\r\n  }\r\n\r\n  private formatLogForConsole(entry: ApiLogEntry): string {\r\n    const time = new Date(entry.timestamp).toLocaleTimeString(\"he-IL\")\r\n    const icon = getCategoryIcon(entry.category)\r\n    const levelColor = getLevelColor(entry.level)\r\n    \r\n    let output = `${colors.dim}[${time}]${colors.reset} ${icon} ${levelColor}[${entry.level.toUpperCase()}]${colors.reset} `\r\n    output += `${colors.bright}${entry.action}${colors.reset}`\r\n    \r\n    if (entry.method && entry.endpoint) {\r\n      const methodColor = entry.method === \"GET\" ? colors.green : \r\n                         entry.method === \"POST\" ? colors.blue : \r\n                         entry.method === \"PUT\" ? colors.yellow : colors.red\r\n      output += ` ${methodColor}${entry.method}${colors.reset} ${entry.endpoint}`\r\n    }\r\n    \r\n    if (entry.statusCode) {\r\n      const statusColor = entry.statusCode < 300 ? colors.green : \r\n                         entry.statusCode < 400 ? colors.yellow : colors.red\r\n      output += ` ${statusColor}[${entry.statusCode}]${colors.reset}`\r\n    }\r\n    \r\n    if (entry.duration) {\r\n      output += ` ${colors.magenta}(${formatDuration(entry.duration)})${colors.reset}`\r\n    }\r\n    \r\n    return output\r\n  }\r\n\r\n  async log(entry: Omit<ApiLogEntry, \"id\" | \"timestamp\">): Promise<void> {\r\n    if (!this.enabled) return\r\n\r\n    const fullEntry: ApiLogEntry = {\r\n      ...entry,\r\n      timestamp: new Date().toISOString(),\r\n    }\r\n\r\n    // Console output\r\n    console.log(this.formatLogForConsole(fullEntry))\r\n    \r\n    // Additional details for errors or debug\r\n    if (entry.level === \"error\" && entry.error) {\r\n      console.error(`${colors.red}  Error: ${entry.error}${colors.reset}`)\r\n    }\r\n    \r\n    if (entry.requestBody && (entry.level === \"debug\" || entry.level === \"error\")) {\r\n      console.log(`${colors.dim}  Request: ${truncate(JSON.stringify(entry.requestBody))}${colors.reset}`)\r\n    }\r\n    \r\n    if (entry.responseBody && entry.level === \"error\") {\r\n      console.log(`${colors.dim}  Response: ${truncate(JSON.stringify(entry.responseBody))}${colors.reset}`)\r\n    }\r\n\r\n    // Add to buffer\r\n    logBuffer.push(fullEntry)\r\n    if (logBuffer.length > MAX_BUFFER_SIZE) {\r\n      logBuffer.shift()\r\n    }\r\n\r\n    // Save to Supabase (async, non-blocking)\r\n    this.saveToSupabase(fullEntry).catch(() => {})\r\n  }\r\n\r\n  private async saveToSupabase(entry: ApiLogEntry): Promise<void> {\r\n    const db = getSupabase()\r\n    if (!db) return\r\n\r\n    try {\r\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n      await (db.from(\"api_logs\") as any).insert({\r\n        timestamp: entry.timestamp,\r\n        level: entry.level,\r\n        category: entry.category,\r\n        action: entry.action,\r\n        method: entry.method,\r\n        endpoint: entry.endpoint,\r\n        request_body: entry.requestBody,\r\n        response_body: entry.responseBody,\r\n        status_code: entry.statusCode,\r\n        duration_ms: entry.duration,\r\n        user_id: entry.userId,\r\n        session_id: entry.sessionId,\r\n        ip_address: entry.ip,\r\n        user_agent: entry.userAgent,\r\n        error_message: entry.error,\r\n        metadata: entry.metadata,\r\n      })\r\n    } catch (error) {\r\n      // Silent fail - don't let logging break the app\r\n    }\r\n  }\r\n\r\n  // Convenience methods\r\n  debug(category: ApiLogEntry[\"category\"], action: string, metadata?: Record<string, any>) {\r\n    this.log({ level: \"debug\", category, action, metadata })\r\n  }\r\n\r\n  info(category: ApiLogEntry[\"category\"], action: string, metadata?: Record<string, any>) {\r\n    this.log({ level: \"info\", category, action, metadata })\r\n  }\r\n\r\n  warn(category: ApiLogEntry[\"category\"], action: string, metadata?: Record<string, any>) {\r\n    this.log({ level: \"warn\", category, action, metadata })\r\n  }\r\n\r\n  error(category: ApiLogEntry[\"category\"], action: string, error?: string, metadata?: Record<string, any>) {\r\n    this.log({ level: \"error\", category, action, error, metadata })\r\n  }\r\n\r\n  // API request logging\r\n  async logApiRequest(params: {\r\n    method: string\r\n    endpoint: string\r\n    requestBody?: any\r\n    responseBody?: any\r\n    statusCode: number\r\n    duration: number\r\n    userId?: string\r\n    ip?: string\r\n    userAgent?: string\r\n    error?: string\r\n  }) {\r\n    const level: LogLevel = params.statusCode >= 500 ? \"error\" : \r\n                           params.statusCode >= 400 ? \"warn\" : \"info\"\r\n    \r\n    await this.log({\r\n      level,\r\n      category: \"api\",\r\n      action: `API Request`,\r\n      ...params,\r\n    })\r\n  }\r\n\r\n  // Medici API logging\r\n  async logMediciCall(params: {\r\n    action: string\r\n    endpoint: string\r\n    requestBody?: any\r\n    responseBody?: any\r\n    statusCode: number\r\n    duration: number\r\n    error?: string\r\n  }) {\r\n    const level: LogLevel = params.statusCode >= 500 ? \"error\" : \r\n                           params.statusCode >= 400 ? \"warn\" : \"info\"\r\n    \r\n    await this.log({\r\n      level,\r\n      category: \"medici\",\r\n      method: \"POST\",\r\n      ...params,\r\n    })\r\n  }\r\n\r\n  // Get recent logs\r\n  getRecentLogs(count: number = 100, filter?: Partial<ApiLogEntry>): ApiLogEntry[] {\r\n    let logs = [...logBuffer].reverse()\r\n    \r\n    if (filter) {\r\n      logs = logs.filter(log => {\r\n        if (filter.level && log.level !== filter.level) return false\r\n        if (filter.category && log.category !== filter.category) return false\r\n        if (filter.action && !log.action.includes(filter.action)) return false\r\n        return true\r\n      })\r\n    }\r\n    \r\n    return logs.slice(0, count)\r\n  }\r\n\r\n  // Clear buffer\r\n  clearBuffer() {\r\n    logBuffer.length = 0\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const apiLogger = ApiLogger.getInstance()\r\n\r\n// Export helper for timing operations\r\nexport function withTiming<T>(operation: () => Promise<T>): Promise<{ result: T; duration: number }> {\r\n  const start = Date.now()\r\n  return operation().then(result => ({\r\n    result,\r\n    duration: Date.now() - start\r\n  }))\r\n}\r\n","// Medici Hotels API Client\r\n// Complete AI-Executable Integration\r\n// Base URL: https://medici-backend.azurewebsites.net\r\n\r\nimport type { HotelSearchResult, PreBookResponse, BookResponse } from \"./medici-types\"\r\nimport \"server-only\"\r\nexport * from \"./medici-types\"\r\n\r\n// Import logger\r\nimport { apiLogger } from \"@/lib/logging/api-logger\"\r\n\r\nconst MEDICI_BASE_URL = process.env.MEDICI_BASE_URL || \"https://medici-backend.azurewebsites.net\"\r\nconst MEDICI_IMAGES_BASE = \"https://medici-images.azurewebsites.net/images/\"\r\n\r\n// KNOWAA TOKEN (partnerships@knowaaglobal.com, UserId:24, AetherTokenStorageId:4, expires 2084) \r\n// PRIMARY TOKEN - Knowaa provider - Fresh from OnlyNightUsersTokenAPI\r\nconst KNOWAA_TOKEN = \"eyJhbGciOiJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzA0L3htbGRzaWctbW9yZSNobWFjLXNoYTI1NiIsInR5cCI6IkpXVCJ9.eyJQZXJtaXNzaW9ucyI6IjEiLCJVc2VySWQiOiIyNCIsIm5iZiI6MTc2OTEwODU0MiwiZXhwIjoyMDg0NjQxMzQyLCJpc3MiOiJodHRwczovL2FkbWluLm1lZGljaWhvdGVscy5jb20vIiwiYXVkIjoiaHR0cHM6Ly9hZG1pbi5tZWRpY2lob3RlbHMuY29tLyJ9.HlssMhdMpHq45f2u8ZdrXA7NWBDCwgO67CIG_lnjL0w\"\r\n\r\n// B2B MEDICI TOKEN (UserId:11, expires 2083) - BACKUP ONLY (has issues)\r\nconst MEDICI_TOKEN_LEGACY = \"eyJhbGciOiJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzA0L3htbGRzaWctbW9yZSNobWFjLXNoYTI1NiIsInR5cCI6IkpXVCJ9.eyJQZXJtaXNzaW9ucyI6IjEiLCJVc2VySWQiOiIxMSIsIm5iZiI6MTc2ODQ1NzU5NSwiZXhwIjoyMDgzOTkwMzk1LCJpc3MiOiJodHRwczovL2FkbWluLm1lZGljaWhvdGVscy5jb20vIiwiYXVkIjoiaHR0cHM6Ly9hZG1pbi5tZWRpY2lob3RlbHMuY29tLyJ9.g-CO7I75BlowE-F3J3GqlXsbIgNtG8_w2v1WMwG6djE\"\r\n\r\n// Use KNOWAA token as primary - already defined in code, no env var needed!\r\nconst MEDICI_TOKEN = KNOWAA_TOKEN\r\n\r\n// KNOWAA LIVE Aether Tokens - Required for Scarlet Hotel (863233) and full inventory\r\nconst KNOWAA_LIVE_AETHER_TOKEN = \"$2y$10$WrOg1sVjhWS32f3FA7/JTep2JvIialrDDNJD4uNNWhAm8DLBifGku\"\r\nconst KNOWAA_LIVE_AETHER_APP_KEY = \"$2y$10$GjHNpEhnS/dzZxkkPT7jROXic.Q6.fdg9bkuFTZQs5Gk3OZJG10Cm\"\r\n\r\n// =====================\r\n// TYPES\r\n// =====================\r\n\r\n// Types are imported from medici-types.ts\r\n\r\n// =====================\r\n// REFERENCE TABLES\r\n// =====================\r\n\r\nexport const BOARD_TYPES: Record<number, { code: string; name: string; nameHe: string }> = {\r\n  1: { code: \"RO\", name: \"Room Only\", nameHe: \"◊ú◊ô◊†◊î ◊ë◊ú◊ë◊ì\" },\r\n  2: { code: \"BB\", name: \"Bed & Breakfast\", nameHe: \"◊ê◊®◊ï◊ó◊™ ◊ë◊ï◊ß◊®\" },\r\n  3: { code: \"HB\", name: \"Half Board\", nameHe: \"◊ó◊¶◊ô ◊§◊†◊°◊ô◊ï◊ü\" },\r\n  4: { code: \"FB\", name: \"Full Board\", nameHe: \"◊§◊†◊°◊ô◊ï◊ü ◊û◊ú◊ê\" },\r\n  5: { code: \"AI\", name: \"All Inclusive\", nameHe: \"◊î◊õ◊ú ◊õ◊ú◊ï◊ú\" },\r\n}\r\n\r\nexport const ROOM_CATEGORIES: Record<number, { name: string; nameHe: string }> = {\r\n  1: { name: \"Standard\", nameHe: \"◊°◊ò◊†◊ì◊®◊ò\" },\r\n  2: { name: \"Superior\", nameHe: \"◊°◊ï◊§◊®◊ô◊ï◊®\" },\r\n  3: { name: \"Deluxe\", nameHe: \"◊ì◊ú◊ï◊ß◊°\" },\r\n  4: { name: \"Suite\", nameHe: \"◊°◊ï◊ï◊ô◊ò◊î\" },\r\n  5: { name: \"Junior Suite\", nameHe: \"◊°◊ï◊ï◊ô◊ò◊™ ◊í'◊ï◊†◊ô◊ï◊®\" },\r\n  6: { name: \"Family\", nameHe: \"◊û◊©◊§◊ó◊™◊ô\" },\r\n}\r\n\r\n// =====================\r\n// API CLIENT CLASS\r\n// =====================\r\n\r\nexport class MediciApiClient {\r\n  private baseUrl: string\r\n  private token: string\r\n  private retries: number\r\n  private maxRetries: number\r\n\r\n  constructor(token?: string) {\r\n    this.token = token || MEDICI_TOKEN\r\n    this.baseUrl = MEDICI_BASE_URL\r\n    this.retries = 0\r\n    this.maxRetries = 2\r\n  }\r\n\r\n  private async request<T>(endpoint: string, options: RequestInit = {}): Promise<T> {\r\n    const url = `${this.baseUrl}${endpoint}`\r\n    const startTime = Date.now()\r\n\r\n    const headers: Record<string, string> = {\r\n      \"Content-Type\": \"application/json\",\r\n      Authorization: `Bearer ${this.token}`,\r\n      ...(options.headers as Record<string, string>),\r\n    }\r\n\r\n    // Log request start\r\n    apiLogger.debug(\"medici\", `Medici API Request: ${endpoint}`, {\r\n      url,\r\n      method: options.method || \"GET\",\r\n    })\r\n\r\n    try {\r\n      const response = await fetch(url, {\r\n        ...options,\r\n        headers,\r\n      })\r\n\r\n      const duration = Date.now() - startTime\r\n\r\n      if (response.status === 204) {\r\n        apiLogger.info(\"medici\", `Medici API Success (204 No Content)`, {\r\n          endpoint,\r\n          duration,\r\n        })\r\n        return { _status: 204 } as T\r\n      }\r\n\r\n      if (!response.ok) {\r\n        const errorBody = await response.text()\r\n\r\n        // Log error\r\n        await apiLogger.logMediciCall({\r\n          action: \"Medici API Error\",\r\n          endpoint,\r\n          requestBody: options.body ? JSON.parse(options.body as string) : undefined,\r\n          statusCode: response.status,\r\n          duration,\r\n          error: errorBody,\r\n        })\r\n\r\n        if (response.status === 401 && this.retries < this.maxRetries) {\r\n          this.retries++\r\n          apiLogger.warn(\"medici\", `Token expired, refreshing (attempt ${this.retries})`)\r\n          await this.refreshToken()\r\n          return this.request<T>(endpoint, options)\r\n        }\r\n\r\n        throw new Error(`API Error ${response.status}: ${errorBody}`)\r\n      }\r\n\r\n      const data = await response.json()\r\n      this.retries = 0\r\n\r\n      // Log successful response\r\n      await apiLogger.logMediciCall({\r\n        action: \"Medici API Success\",\r\n        endpoint,\r\n        requestBody: options.body ? JSON.parse(options.body as string) : undefined,\r\n        responseBody: { itemCount: Array.isArray(data) ? data.length : (data?.items?.length || 1) },\r\n        statusCode: response.status,\r\n        duration,\r\n      })\r\n\r\n      return data\r\n    } catch (error) {\r\n      const duration = Date.now() - startTime\r\n      \r\n      if (error instanceof Error) {\r\n        apiLogger.error(\"medici\", `Medici API Exception: ${endpoint}`, error.message, { duration })\r\n        throw error\r\n      }\r\n      throw new Error(\"Unknown error occurred\")\r\n    }\r\n  }\r\n\r\n  // =====================\r\n  // STEP 1: SEARCH HOTELS\r\n  // =====================\r\n  async searchHotels(params: {\r\n    dateFrom: string\r\n    dateTo: string\r\n    hotelName?: string\r\n    city?: string\r\n    rooms?: Array<{ adults: number; children: number[] }> // Array of rooms\r\n    adults?: number // Fallback for single room\r\n    children?: number[] // Fallback for single room\r\n    stars?: number\r\n    limit?: number\r\n  }): Promise<HotelSearchResult[]> {\r\n    console.log(\"üîç MediciApi.searchHotels called with params:\", params)\r\n    \r\n    const pax = params.rooms || [\r\n      {\r\n        adults: params.adults || 2,\r\n        children: params.children || [],\r\n      },\r\n    ]\r\n\r\n    const searchBody: any = {\r\n      dateFrom: params.dateFrom,\r\n      dateTo: params.dateTo,\r\n      pax,\r\n      stars: params.stars || null,\r\n      limit: params.limit || null,\r\n      ShowExtendedData: true, // Get images, description, facilities from Medici\r\n      aetherAccessToken: KNOWAA_LIVE_AETHER_TOKEN, // Required for Scarlet Hotel and full inventory\r\n      aetherApplicationKey: KNOWAA_LIVE_AETHER_APP_KEY, // Application key for Knowaa Live\r\n    }\r\n\r\n    if (params.hotelName) {\r\n      searchBody.hotelName = params.hotelName\r\n    } else if (params.city) {\r\n      searchBody.city = params.city\r\n    }\r\n\r\n    console.log(\"üåê Making request to Medici API:\")\r\n    console.log(\"URL:\", `${this.baseUrl}/api/hotels/GetInnstantSearchPrice`)\r\n    console.log(\"Body:\", JSON.stringify(searchBody, null, 2))\r\n    console.log(\"Token (first 20 chars):\", this.token.substring(0, 20) + \"...\")\r\n\r\n    try {\r\n      const response = await this.request<any>(\"/api/hotels/GetInnstantSearchPrice\", {\r\n        method: \"POST\",\r\n        body: JSON.stringify(searchBody),\r\n      })\r\n\r\n      console.log(\"‚úÖ Medici API response received, length:\", JSON.stringify(response).length)\r\n      const hotels = this.transformSearchResults(response)\r\n      console.log(\"üè® Transformed to\", hotels.length, \"hotels\")\r\n\r\n      return hotels.map((hotel) => ({\r\n        ...hotel,\r\n        requestJson: JSON.stringify(params),\r\n        responseJson: JSON.stringify(response),\r\n      }))\r\n    } catch (error) {\r\n      console.error(\"‚ùå Medici API search failed:\", error)\r\n      \r\n      // Return empty array instead of throwing - let the caller handle it\r\n      return []\r\n    }\r\n  }\r\n\r\n  // =====================\r\n  // STEP 2: PRE-BOOK\r\n  // =====================\r\n  async preBook(params: {\r\n    jsonRequest: string\r\n  }): Promise<PreBookResponse> {\r\n    const preBookBody = {\r\n      jsonRequest: params.jsonRequest,\r\n    }\r\n\r\n    const response = await this.request<any>(\"/api/hotels/PreBook\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify(preBookBody),\r\n    })\r\n\r\n    if (response._status === 204) {\r\n      return {\r\n        success: true,\r\n        preBookId: 0,\r\n        token: \"\",\r\n        status: \"done\",\r\n        priceConfirmed: 0,\r\n        currency: \"USD\",\r\n        requestJson: params.jsonRequest,\r\n        responseJson: \"\",\r\n      }\r\n    }\r\n\r\n    const token = response?.content?.services?.hotels?.[0]?.token || response?.token || response?.preBookToken || \"\"\r\n\r\n    const preBookId = response?.opportunityId || response?.preBookId || response?.id || 0\r\n\r\n    const priceConfirmed =\r\n      response?.content?.services?.hotels?.[0]?.netPrice?.amount ||\r\n      response?.content?.services?.hotels?.[0]?.price?.amount ||\r\n      response?.price?.amount ||\r\n      0\r\n\r\n    const currency =\r\n      response?.content?.services?.hotels?.[0]?.netPrice?.currency ||\r\n      response?.content?.services?.hotels?.[0]?.price?.currency ||\r\n      \"USD\"\r\n\r\n    const isSuccess = token || response?.status === \"done\"\r\n\r\n    return {\r\n      success: isSuccess,\r\n      preBookId,\r\n      token,\r\n      status: response?.status || (isSuccess ? \"done\" : \"failed\"),\r\n      priceConfirmed,\r\n      currency,\r\n      requestJson: params.jsonRequest,\r\n      responseJson: response,\r\n    }\r\n  }\r\n\r\n  // =====================\r\n  // STEP 3: BOOK\r\n  // =====================\r\n  async book(params: {\r\n    jsonRequest: string\r\n  }): Promise<BookResponse> {\r\n    const bookBody = {\r\n      jsonRequest: params.jsonRequest,\r\n    }\r\n\r\n    try {\r\n      const response = await this.request<any>(\"/api/hotels/Book\", {\r\n        method: \"POST\",\r\n        body: JSON.stringify(bookBody),\r\n      })\r\n\r\n      console.log('[DEBUG] Book API Response:', JSON.stringify(response, null, 2))\r\n\r\n      const bookingID =\r\n        response?.bookRes?.content?.bookingID ||\r\n        response?.content?.bookingID ||\r\n        response?.bookingId ||\r\n        response?.bookingID ||\r\n        \"\"\r\n\r\n      const supplierReference =\r\n        response?.bookRes?.content?.services?.[0]?.supplier?.reference ||\r\n        response?.content?.services?.[0]?.supplier?.reference ||\r\n        response?.supplierReference ||\r\n        \"\"\r\n\r\n      const status = response?.bookRes?.content?.status || response?.content?.status || response?.status || \"\"\r\n\r\n      console.log('[DEBUG] Parsed:', { bookingID, supplierReference, status })\r\n\r\n      const isSuccess = status === \"confirmed\"\r\n\r\n      return {\r\n        success: isSuccess,\r\n        bookingId: String(bookingID),\r\n        supplierReference,\r\n        status,\r\n      }\r\n    } catch (error: any) {\r\n      return {\r\n        success: false,\r\n        bookingId: \"\",\r\n        supplierReference: \"\",\r\n        status: \"failed\",\r\n        error: error.message,\r\n      }\r\n    }\r\n  }\r\n\r\n  // =====================\r\n  // MANUAL BOOK (by code)\r\n  // =====================\r\n  async manualBook(params: { opportunityId: number; code: string }): Promise<BookResponse> {\r\n    try {\r\n      const response = await this.request<any>(\"/api/hotels/ManualBook\", {\r\n        method: \"POST\",\r\n        body: JSON.stringify({\r\n          opportunityId: params.opportunityId,\r\n          code: params.code,\r\n        }),\r\n      })\r\n\r\n      return {\r\n        success: response?.success || response?.bookingId,\r\n        bookingId: String(response?.bookingId || \"\"),\r\n        status: \"confirmed\",\r\n      }\r\n    } catch (error: any) {\r\n      return {\r\n        success: false,\r\n        error: error.message,\r\n      }\r\n    }\r\n  }\r\n\r\n  // =====================\r\n  // CANCEL BOOKING\r\n  // =====================\r\n  async cancelBooking(preBookId: number): Promise<{ success: boolean; error?: string }> {\r\n    try {\r\n      await this.request(`/api/hotels/CancelRoomActive?prebookId=${preBookId}`, {\r\n        method: \"DELETE\",\r\n      })\r\n      return { success: true }\r\n    } catch (error: any) {\r\n      return { success: false, error: error.message }\r\n    }\r\n  }\r\n\r\n  // =====================\r\n  // ROOM MANAGEMENT\r\n  // =====================\r\n\r\n  async getActiveRooms(params?: {\r\n    startDate?: string\r\n    endDate?: string\r\n    hotelName?: string\r\n    hotelStars?: number\r\n    city?: string\r\n    roomBoard?: string\r\n    roomCategory?: string\r\n    provider?: string\r\n  }): Promise<any[]> {\r\n    const response = await this.request<any>(\"/api/hotels/GetRoomsActive\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify(params || {}),\r\n    })\r\n    return Array.isArray(response) ? response : []\r\n  }\r\n\r\n  async getSoldRooms(params?: {\r\n    startDate?: string\r\n    endDate?: string\r\n    hotelName?: string\r\n  }): Promise<any[]> {\r\n    const response = await this.request<any>(\"/api/hotels/GetRoomsSales\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify(params || {}),\r\n    })\r\n    return Array.isArray(response) ? response : []\r\n  }\r\n\r\n  async getCancelledRooms(params?: {\r\n    startDate?: string\r\n    endDate?: string\r\n    hotelName?: string\r\n  }): Promise<any[]> {\r\n    const response = await this.request<any>(\"/api/hotels/GetRoomsCancel\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify(params || {}),\r\n    })\r\n    return Array.isArray(response) ? response : []\r\n  }\r\n\r\n  // =====================\r\n  // DASHBOARD\r\n  // =====================\r\n  async getDashboardInfo(params?: {\r\n    hotelStars?: number\r\n    city?: string\r\n    hotelName?: string\r\n    reservationMonthDate?: string\r\n    checkInMonthDate?: string\r\n    provider?: string\r\n  }): Promise<any> {\r\n    const response = await this.request<any>(\"/api/hotels/GetDashboardInfo\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify(params || {}),\r\n    })\r\n    return response || {}\r\n  }\r\n\r\n  // =====================\r\n  // OPPORTUNITIES\r\n  // =====================\r\n\r\n  async getOpportunities(params?: {\r\n    startDate?: string\r\n    endDate?: string\r\n  }): Promise<any[]> {\r\n    const response = await this.request<any>(\"/api/hotels/GetOpportunities\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify(params || {}),\r\n    })\r\n    return Array.isArray(response) ? response : []\r\n  }\r\n\r\n  async insertOpportunity(params: {\r\n    hotelId?: number\r\n    startDateStr: string\r\n    endDateStr: string\r\n    boardId: number\r\n    categoryId: number\r\n    buyPrice: number\r\n    pushPrice: number\r\n    maxRooms: number\r\n    paxAdults?: number\r\n    paxChildren?: number[]\r\n  }): Promise<{ success: boolean; opportunityId?: number; error?: string }> {\r\n    try {\r\n      const response = await this.request<any>(\"/api/hotels/InsertOpportunity\", {\r\n        method: \"POST\",\r\n        body: JSON.stringify(params),\r\n      })\r\n      return { success: true, opportunityId: response?.opportunityId }\r\n    } catch (error: any) {\r\n      return { success: false, error: error.message }\r\n    }\r\n  }\r\n\r\n  // =====================\r\n  // PRICE UPDATE\r\n  // =====================\r\n  async updatePushPrice(preBookId: number, pushPrice: number): Promise<{ success: boolean; error?: string }> {\r\n    try {\r\n      await this.request(\"/api/hotels/UpdateRoomsActivePushPrice\", {\r\n        method: \"POST\",\r\n        body: JSON.stringify({\r\n          preBookId,\r\n          pushPrice,\r\n        }),\r\n      })\r\n      return { success: true }\r\n    } catch (error: any) {\r\n      return { success: false, error: error.message }\r\n    }\r\n  }\r\n\r\n  // =====================\r\n  // ARCHIVE\r\n  // =====================\r\n  async getRoomArchive(params: {\r\n    stayFrom?: string\r\n    stayTo?: string\r\n    hotelName?: string\r\n    minPrice?: number\r\n    maxPrice?: number\r\n    city?: string\r\n    roomBoard?: string\r\n    roomCategory?: string\r\n    pageNumber?: number\r\n    pageSize?: number\r\n  }): Promise<{ data: any[]; totalCount: number }> {\r\n    const response = await this.request<any>(\"/api/hotels/GetRoomArchiveData\", {\r\n      method: \"POST\",\r\n      body: JSON.stringify({\r\n        ...params,\r\n        pageNumber: params.pageNumber || 1,\r\n        pageSize: params.pageSize || 50,\r\n      }),\r\n    })\r\n\r\n    return {\r\n      data: response?.data || [],\r\n      totalCount: response?.totalCount || 0,\r\n    }\r\n  }\r\n\r\n  async refreshToken(): Promise<string> {\r\n    try {\r\n      const formData = new URLSearchParams()\r\n      formData.append(\r\n        \"client_secret\",\r\n        process.env.MEDICI_CLIENT_SECRET || \"zlbgGGxz~|l3.Q?XXAT)uT!Lty,kJC>R?`:k?oQH$I=P7rL<R:Em:qDaM1G(jFU7\",\r\n      )\r\n\r\n      const response = await fetch(`${this.baseUrl}/api/auth/OnlyNightUsersTokenAPI`, {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/x-www-form-urlencoded\",\r\n        },\r\n        body: formData.toString(),\r\n      })\r\n\r\n      if (!response.ok) {\r\n        const errorText = await response.text()\r\n        throw new Error(`Token refresh failed: ${response.status} - ${errorText}`)\r\n      }\r\n\r\n      const data = await response.json()\r\n      this.token = data.token || data.access_token || data.aether_access_token\r\n      return this.token\r\n    } catch (error: any) {\r\n      console.error(\"Failed to refresh token:\", error.message)\r\n      throw error\r\n    }\r\n  }\r\n\r\n  private transformSearchResults(response: any): HotelSearchResult[] {\r\n    if (!response) {\r\n      return []\r\n    }\r\n\r\n    let items: any[] = []\r\n\r\n    if (Array.isArray(response)) {\r\n      items = response\r\n    } else if (response.items && Array.isArray(response.items)) {\r\n      items = response.items\r\n    } else if (response.data && Array.isArray(response.data)) {\r\n      items = response.data\r\n    }\r\n\r\n    const hotelMap = new Map<number, HotelSearchResult>()\r\n\r\n    for (const item of items) {\r\n      // Support new Medici format with ShowExtendedData\r\n      const hotelIdRaw = item.id || item.hotelId || item.hotelCode || item.HotelId || item.hotel_id || \r\n        (item.items?.[0]?.hotelId) || 0\r\n      const hotelId = typeof hotelIdRaw === \"number\" ? hotelIdRaw : Number.parseInt(String(hotelIdRaw), 10) || 0\r\n      const hotelName = item.name || item.hotelName || item.HotelName || item.items?.[0]?.hotelName || \"Unknown Hotel\"\r\n\r\n      // Extract facilities from new format (facilities.list or facilities.tags)\r\n      let facilitiesList: string[] = []\r\n      if (item.facilities) {\r\n        if (Array.isArray(item.facilities)) {\r\n          facilitiesList = item.facilities\r\n        } else if (item.facilities.list && Array.isArray(item.facilities.list)) {\r\n          facilitiesList = item.facilities.list\r\n        } else if (item.facilities.tags && Array.isArray(item.facilities.tags)) {\r\n          facilitiesList = item.facilities.tags\r\n        }\r\n      }\r\n\r\n      if (!hotelMap.has(hotelId)) {\r\n        hotelMap.set(hotelId, {\r\n          hotelId,\r\n          hotelName,\r\n          hotelImage: getHotelMainImage(item),\r\n          images: buildImagesArray(item),\r\n          location: item.address || item.location || \"\",\r\n          city: item.city || extractCityFromDestinations(item) || \"\",\r\n          stars: item.stars || item.rating || 0,\r\n          address: item.address || \"\",\r\n          description: item.description || \"\",\r\n          facilities: facilitiesList,\r\n          phone: item.phone || \"\",\r\n          fax: item.fax || \"\",\r\n          lat: item.lat || 0,\r\n          lon: item.lon || 0,\r\n          seoname: item.seoname || \"\",\r\n          rooms: [],\r\n        })\r\n      }\r\n\r\n      const hotel = hotelMap.get(hotelId)!\r\n\r\n      const roomItems = item.items || [item]\r\n\r\n      for (let roomIdx = 0; roomIdx < roomItems.length; roomIdx++) {\r\n        const roomItem = roomItems[roomIdx]\r\n\r\n        const possibleCodeFields = [\r\n          roomItem.code,\r\n          roomItem.Code,\r\n          roomItem.roomCode,\r\n          roomItem.RoomCode,\r\n          roomItem.rateKey,\r\n          roomItem.RateKey,\r\n          roomItem.bookingCode,\r\n          roomItem.BookingCode,\r\n          roomItem.optionCode,\r\n          roomItem.OptionCode,\r\n          roomItem.key,\r\n          roomItem.Key,\r\n          roomItem.id?.toString(),\r\n          roomItem.rate?.code,\r\n          roomItem.rate?.key,\r\n          roomItem.option?.code,\r\n          roomItem.booking?.code,\r\n        ]\r\n\r\n        let roomCode = \"\"\r\n        for (const codeField of possibleCodeFields) {\r\n          if (codeField && typeof codeField === \"string\" && codeField.length > 0) {\r\n            roomCode = codeField\r\n            break\r\n          }\r\n        }\r\n\r\n        if (!roomCode) {\r\n          const tempCode = `TEMP-${hotelId}-${roomItem.id || Date.now()}-${roomIdx}`\r\n          roomCode = tempCode\r\n        }\r\n\r\n        // Extract price from room item first, then fallback to parent item (hotel level)\r\n        let price = extractPriceFromRoom(roomItem)\r\n        if (price === 0) {\r\n          price = extractPriceFromRoom(item) // Fallback to hotel-level price\r\n        }\r\n\r\n        hotel.rooms.push({\r\n          code: roomCode,\r\n          roomId: String(roomItem.id || roomItem.roomId || `${hotel.hotelId}-${hotel.rooms.length + 1}`),\r\n          roomName: roomItem.name || roomItem.roomName || \"Standard Room\",\r\n          roomCategory: roomItem.category || roomItem.roomType || \"standard\",\r\n          categoryId: roomItem.categoryId || roomItem.category_id || 1,\r\n          roomImage: getRoomMainImage(roomItem) || hotel.hotelImage, // Fallback to hotel image\r\n          images: buildRoomImagesArray(roomItem),\r\n          bedding: roomItem.bedding || \"\",\r\n          board: roomItem.board || \"RO\",\r\n          boardId: roomItem.boardId || getBoardIdFromCode(roomItem.board || \"RO\"),\r\n          boardType: roomItem.board || \"RO\",\r\n          maxOccupancy: roomItem.pax?.adults || roomItem.maxOccupancy || 2,\r\n          size: roomItem.size || roomItem.roomSize || 0,\r\n          view: roomItem.view || \"\",\r\n          amenities: roomItem.amenities || roomItem.facilities || [],\r\n          price: price,\r\n          buyPrice: price,\r\n          originalPrice: price > 0 ? Math.round(price * 1.15) : 0,\r\n          currency: roomItem.currency || item.price?.currency || item.netPrice?.currency || \"USD\",\r\n          cancellationPolicy: formatCancellationPolicy(item.cancellation) || roomItem.cancellationPolicy || \"free\",\r\n          cancellation: item.cancellation || null,\r\n          available: roomItem.quantity?.max || roomItem.available || 1,\r\n          requestJson: item.code || roomItem.code || roomCode, // Use hotel-level code for prebook\r\n          pax: roomItem.pax || { adults: 2, children: [] },\r\n          confirmation: item.confirmation || \"on_request\",\r\n          paymentType: item.paymentType || \"pre\",\r\n          providers: item.providers || [],\r\n          specialOffers: item.specialOffers || [],\r\n        })\r\n      }\r\n    }\r\n\r\n    const results = Array.from(hotelMap.values())\r\n    return results\r\n  }\r\n}\r\n\r\nexport const mediciApi = new MediciApiClient()\r\n\r\n// =====================\r\n// HELPER FUNCTIONS\r\n// =====================\r\n\r\nfunction buildFullImageUrl(imagePath: string | undefined): string {\r\n  if (!imagePath) return \"\"\r\n  if (imagePath.startsWith(\"http://\") || imagePath.startsWith(\"https://\")) {\r\n    return imagePath\r\n  }\r\n  return `${MEDICI_IMAGES_BASE}${imagePath}`\r\n}\r\n\r\nfunction getHotelMainImage(item: any): string {\r\n  if (item.imageUrl) return buildFullImageUrl(item.imageUrl)\r\n  if (item.image) return buildFullImageUrl(item.image)\r\n  if (item.mainImage) return buildFullImageUrl(item.mainImage)\r\n\r\n  if (item.images && Array.isArray(item.images) && item.images.length > 0) {\r\n    const firstImage = item.images[0]\r\n    if (typeof firstImage === \"string\") return buildFullImageUrl(firstImage)\r\n    if (firstImage?.url) return buildFullImageUrl(firstImage.url)\r\n    if (firstImage?.path) return buildFullImageUrl(firstImage.path)\r\n  }\r\n\r\n  if (item.items && item.items[0]?.images && item.items[0].images.length > 0) {\r\n    return buildFullImageUrl(item.items[0].images[0])\r\n  }\r\n\r\n  return \"\"\r\n}\r\n\r\nfunction buildImagesArray(item: any): string[] {\r\n  const images: string[] = []\r\n\r\n  if (item.images && Array.isArray(item.images)) {\r\n    for (const img of item.images) {\r\n      if (typeof img === \"string\") {\r\n        images.push(buildFullImageUrl(img))\r\n      } else if (img?.url) {\r\n        images.push(buildFullImageUrl(img.url))\r\n      } else if (img?.path) {\r\n        images.push(buildFullImageUrl(img.path))\r\n      }\r\n    }\r\n  }\r\n\r\n  if (item.items && item.items[0]?.images) {\r\n    for (const img of item.items[0].images) {\r\n      if (typeof img === \"string\") {\r\n        images.push(buildFullImageUrl(img))\r\n      }\r\n    }\r\n  }\r\n\r\n  return images.filter(Boolean)\r\n}\r\n\r\nfunction extractPriceFromRoom(room: any): number {\r\n  const priceLocations = [\r\n    // Medici API uses netPrice as primary price field\r\n    { name: \"netPrice.amount\", value: room.netPrice?.amount },\r\n    { name: \"price.amount\", value: room.price?.amount },\r\n    { name: \"price.value\", value: room.price?.value },\r\n    { name: \"price (direct)\", value: room.price },\r\n    { name: \"buyPrice\", value: room.buyPrice },\r\n    { name: \"sellPrice\", value: room.sellPrice },\r\n    { name: \"totalPrice\", value: room.totalPrice },\r\n    { name: \"amount\", value: room.amount },\r\n    { name: \"rate.amount\", value: room.rate?.amount },\r\n    { name: \"rate.value\", value: room.rate?.value },\r\n    { name: \"rate (direct)\", value: room.rate },\r\n    { name: \"cost\", value: room.cost },\r\n    { name: \"netPrice\", value: room.netPrice },\r\n    { name: \"grossPrice\", value: room.grossPrice },\r\n    { name: \"Price\", value: room.Price },\r\n    { name: \"BuyPrice\", value: room.BuyPrice },\r\n    { name: \"SellPrice\", value: room.SellPrice },\r\n    { name: \"TotalPrice\", value: room.TotalPrice },\r\n  ]\r\n\r\n  for (const { name, value } of priceLocations) {\r\n    if (typeof value === \"number\" && value > 0) {\r\n      return value\r\n    }\r\n    if (typeof value === \"string\") {\r\n      const parsed = Number.parseFloat(value)\r\n      if (!isNaN(parsed) && parsed > 0) {\r\n        return parsed\r\n      }\r\n    }\r\n  }\r\n\r\n  return 0\r\n}\r\n\r\nfunction getRoomMainImage(room: any): string {\r\n  if (room.imageUrl) return buildFullImageUrl(room.imageUrl)\r\n  if (room.image) return buildFullImageUrl(room.image)\r\n  if (room.mainImage) return buildFullImageUrl(room.mainImage)\r\n\r\n  if (room.images && Array.isArray(room.images) && room.images.length > 0) {\r\n    const firstImage = room.images[0]\r\n    if (typeof firstImage === \"string\") return buildFullImageUrl(firstImage)\r\n    if (firstImage?.url) return buildFullImageUrl(firstImage.url)\r\n    if (firstImage?.path) return buildFullImageUrl(firstImage.path)\r\n  }\r\n\r\n  return \"\"\r\n}\r\n\r\nfunction buildRoomImagesArray(room: any): string[] {\r\n  const images: string[] = []\r\n\r\n  if (room.images && Array.isArray(room.images)) {\r\n    for (const img of room.images) {\r\n      if (typeof img === \"string\") {\r\n        images.push(buildFullImageUrl(img))\r\n      } else if (img?.url) {\r\n        images.push(buildFullImageUrl(img.url))\r\n      } else if (img?.path) {\r\n        images.push(buildFullImageUrl(img.path))\r\n      }\r\n    }\r\n  }\r\n\r\n  return images.filter(Boolean)\r\n}\r\n\r\nfunction getBoardIdFromCode(boardCode: string): number {\r\n  for (const [id, board] of Object.entries(BOARD_TYPES)) {\r\n    if (board.code === boardCode) {\r\n      return Number.parseInt(id, 10)\r\n    }\r\n  }\r\n  return 0\r\n}\r\n\r\n// Extract city from destinations array (new Medici format)\r\nfunction extractCityFromDestinations(item: any): string {\r\n  if (item.destinations && Array.isArray(item.destinations)) {\r\n    const cityDest = item.destinations.find((d: any) => d.type === \"city\")\r\n    if (cityDest?.destinationId) {\r\n      return `City-${cityDest.destinationId}` // Will be resolved by enrichment\r\n    }\r\n  }\r\n  if (item.surroundings && Array.isArray(item.surroundings)) {\r\n    const citySurr = item.surroundings.find((s: any) => s.type === \"city\")\r\n    if (citySurr?.destinationId) {\r\n      return `City-${citySurr.destinationId}`\r\n    }\r\n  }\r\n  return \"\"\r\n}\r\n\r\n// Format cancellation policy from new Medici format\r\nfunction formatCancellationPolicy(cancellation: any): string {\r\n  if (!cancellation) return \"free\"\r\n  \r\n  if (cancellation.type === \"fully-refundable\") {\r\n    return \"free\"\r\n  } else if (cancellation.type === \"non-refundable\") {\r\n    return \"non-refundable\"\r\n  } else if (cancellation.type === \"partially-refundable\") {\r\n    return \"partial\"\r\n  }\r\n  \r\n  // Check frames for deadline\r\n  if (cancellation.frames && Array.isArray(cancellation.frames)) {\r\n    const freeFrame = cancellation.frames.find((f: any) => \r\n      f.penalty?.amount === 0\r\n    )\r\n    if (freeFrame) {\r\n      const deadline = new Date(freeFrame.to)\r\n      return `Free cancellation until ${deadline.toLocaleDateString()}`\r\n    }\r\n  }\r\n  \r\n  return cancellation.type || \"free\"\r\n}\r\n","// Types and constants for Medici API - safe for client-side use\r\n// No environment variables accessed here\r\n\r\nexport interface HotelSearchResult {\r\n  hotelId: number\r\n  hotelName: string\r\n  hotelImage: string\r\n  images: string[]\r\n  location: string\r\n  city: string\r\n  stars: number\r\n  address: string\r\n  description: string\r\n  facilities: string[]\r\n  rooms: RoomResult[]\r\n  requestJson?: string // Original requestJson from API response - used for PreBook\r\n  responseJson?: any // Original responseJson from API response\r\n  // Extended data from ShowExtendedData: true\r\n  phone?: string\r\n  fax?: string\r\n  lat?: number\r\n  lon?: number\r\n  seoname?: string\r\n  destinations?: { destinationId: number; type: string }[]\r\n  surroundings?: { destinationId: number; type: string }[]\r\n}\r\n\r\nexport interface CancellationFrame {\r\n  from: string\r\n  to: string\r\n  penalty: {\r\n    amount: number\r\n    currency: string\r\n  }\r\n}\r\n\r\nexport interface CancellationInfo {\r\n  type: \"fully-refundable\" | \"non-refundable\" | \"partially-refundable\"\r\n  frames: CancellationFrame[]\r\n}\r\n\r\nexport interface Provider {\r\n  id: number\r\n  name: string\r\n}\r\n\r\nexport interface RoomResult {\r\n  code: string // The booking code from API (e.g., \"697024:standard:double:RO:6881f6a596dd21.40624605$1003X1095n1095t\")\r\n  roomId: string\r\n  roomName: string\r\n  roomCategory: string\r\n  categoryId: number\r\n  roomImage: string\r\n  images: string[]\r\n  bedding: string\r\n  board: string\r\n  boardId: number\r\n  boardType: string\r\n  maxOccupancy: number\r\n  size: number\r\n  view: string\r\n  amenities: string[]\r\n  price: number\r\n  buyPrice: number\r\n  originalPrice: number\r\n  currency: string\r\n  cancellationPolicy: string\r\n  cancellation?: CancellationInfo | null\r\n  available: number\r\n  requestJson?: string // Room code for prebook\r\n  pax?: { adults: number; children: number[] } // Occupancy info\r\n  // Extended data from ShowExtendedData: true\r\n  confirmation?: string // \"immediate\" | \"on_request\"\r\n  paymentType?: string // \"pre\" | \"post\"\r\n  providers?: Provider[]\r\n  specialOffers?: any[]\r\n}\r\n\r\nexport interface PreBookResponse {\r\n  success: boolean\r\n  preBookId: number\r\n  token: string // The token from content.services.hotels[0].token\r\n  status: string // Status from API (e.g., \"done\")\r\n  priceConfirmed: number\r\n  currency: string\r\n  requestJson?: string // The requestJson from PreBook response\r\n  responseJson?: string // The responseJson from PreBook response\r\n  error?: string\r\n}\r\n\r\nexport interface BookResponse {\r\n  success: boolean\r\n  bookingId: string // bookingID from bookRes.content.bookingID\r\n  supplierReference: string // supplier.reference from bookRes.content.services[0].supplier.reference\r\n  status: string // Status from API (e.g., \"confirmed\")\r\n  error?: string\r\n}\r\n\r\n// Board type translations\r\nexport const BOARD_TYPES: Record<number, string> = {\r\n  1: \"Room Only\",\r\n  2: \"Bed & Breakfast\",\r\n  3: \"Half Board\",\r\n  4: \"Full Board\",\r\n  5: \"All Inclusive\",\r\n}\r\n\r\n// Room category translations\r\nexport const ROOM_CATEGORIES: Record<number, string> = {\r\n  1: \"Standard\",\r\n  2: \"Superior\",\r\n  3: \"Deluxe\",\r\n  4: \"Suite\",\r\n  5: \"Executive\",\r\n}\r\n"],"names":[],"mappings":"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"}