module.exports=[41878,e=>{"use strict";var t=e.i(74119),r=e.i(74815),a=e.i(66969),n=e.i(8984),s=e.i(80568),i=e.i(85983),o=e.i(51311),l=e.i(48892),d=e.i(16339),u=e.i(34600),c=e.i(71794),p=e.i(4358),h=e.i(80603),f=e.i(79181),g=e.i(53442),m=e.i(70798),R=e.i(93695);e.i(51004);var v=e.i(64291),w=e.i(14539);let A=null,C=0;async function E(){if(A&&Date.now()<C)return A;let e=process.env.AMADEUS_CLIENT_ID,t=process.env.AMADEUS_CLIENT_SECRET,r=process.env.AMADEUS_API_URL||"https://test.api.amadeus.com";if(!e||!t)throw Error("Amadeus credentials not configured");try{let a=await fetch(`${r}/v1/security/oauth2/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"client_credentials",client_id:e,client_secret:t})});if(!a.ok)throw Error(`Amadeus auth failed: ${a.statusText}`);let n=await a.json();if(A=n.access_token,C=Date.now()+(n.expires_in-60)*1e3,!A)throw Error("Failed to get access token from Amadeus");return A}catch(e){throw console.error("[Flights] Amadeus authentication error:",e),e}}async function S(e){try{let t=process.env.FLIGHT_API_PROVIDER||"amadeus";if("amadeus"===t)return await x(e);if("serpapi"===t)return await _(e);return console.warn("[Flights] No provider configured, returning mock data"),D(e)}catch(t){return console.error("[Flights] Search error:",t),D(e)}}async function x(e){let t=await E(),r=process.env.AMADEUS_API_URL||"https://test.api.amadeus.com",a=new URLSearchParams({originLocationCode:e.origin,destinationLocationCode:e.destination,departureDate:e.departureDate,adults:e.adults.toString(),max:(e.maxResults||10).toString(),currencyCode:"USD"});e.returnDate&&a.append("returnDate",e.returnDate),e.children&&a.append("children",e.children.toString()),e.infants&&a.append("infants",e.infants.toString()),e.travelClass&&a.append("travelClass",e.travelClass),e.nonStop&&a.append("nonStop","true");let n=await fetch(`${r}/v2/shopping/flight-offers?${a}`,{headers:{Authorization:`Bearer ${t}`}});if(!n.ok)throw Error(`Amadeus API error: ${n.statusText}`);return(await n.json()).data||[]}async function _(e){var t;let r=process.env.SERPAPI_KEY;if(!r)throw Error("SerpAPI key not configured");let a=new URLSearchParams({engine:"google_flights",departure_id:e.origin,arrival_id:e.destination,outbound_date:e.departureDate,type:e.returnDate?"1":"2",adults:e.adults.toString(),currency:"USD",hl:"en",api_key:r});e.returnDate&&a.append("return_date",e.returnDate),e.children&&a.append("children",e.children.toString()),e.travelClass&&a.append("travel_class",{ECONOMY:"1",PREMIUM_ECONOMY:"2",BUSINESS:"3",FIRST:"4"}[e.travelClass]||"1");let n=await fetch(`https://serpapi.com/search?${a}`);if(!n.ok)throw Error(`SerpAPI error: ${n.statusText}`);return((t=await n.json()).best_flights||t.other_flights||[]).map((e,t)=>{let r=e.flights||[];return{id:`serp-${t}`,price:{total:e.price?.toString()||"0",currency:"USD",base:e.price?.toString()||"0",fees:"0"},itineraries:[{duration:`PT${Math.floor(e.total_duration/60)}H${e.total_duration%60}M`,segments:r.map(e=>({departure:{iataCode:e.departure_airport.id,at:e.departure_airport.time},arrival:{iataCode:e.arrival_airport.id,at:e.arrival_airport.time},carrierCode:e.airline,carrierName:e.airline_name||e.airline,flightNumber:e.flight_number,duration:`PT${Math.floor(e.duration/60)}H${e.duration%60}M`,numberOfStops:0}))}],travelerPricings:[],validatingAirlineCodes:[r[0]?.airline||"XX"]}})}async function y(e,t,r){try{let a=await E(),n=process.env.AMADEUS_API_URL||"https://test.api.amadeus.com",s=await fetch(`${n}/v1/shopping/flight-dates?origin=${e}&destination=${t}&departureDate=${r}-01,${r}-31&oneWay=false`,{headers:{Authorization:`Bearer ${a}`}});if(!s.ok)return{};let i=await s.json(),o={};return i.data&&i.data.forEach(e=>{o[e.departureDate]={price:parseFloat(e.price.total),currency:"USD"}}),o}catch(e){return console.error("[Flights] Calendar error:",e),{}}}async function U(e,t){try{let r=await E(),a=process.env.AMADEUS_API_URL||"https://test.api.amadeus.com",n=new URLSearchParams({origin:e,maxPrice:"2000",max:"10"});t&&n.append("destination",t);let s=await fetch(`${a}/v1/shopping/flight-destinations?${n}`,{headers:{Authorization:`Bearer ${r}`}});if(!s.ok)return[];return(await s.json()).data||[]}catch(e){return console.error("[Flights] Cheapest flights error:",e),[]}}function D(e){let t=500+1e3*Math.random();return Array.from({length:5},(r,a)=>({id:`mock-${a}`,price:{total:(t+50*a).toFixed(2),currency:"USD",base:(t+50*a-30).toFixed(2),fees:"30.00"},itineraries:[{duration:"PT12H30M",segments:[{departure:{iataCode:e.origin,at:new Date(e.departureDate).toISOString()},arrival:{iataCode:e.destination,at:new Date(new Date(e.departureDate).getTime()+45e6).toISOString()},carrierCode:0===a?"LY":1===a?"UA":"BA",carrierName:0===a?"El Al":1===a?"United":"British Airways",flightNumber:`${100+a}`,duration:"PT12H30M",numberOfStops:a%2}]}],travelerPricings:[{travelerId:"1",fareOption:"STANDARD",travelerType:"ADULT",price:{total:(t+50*a).toFixed(2),base:(t+50*a-30).toFixed(2)},fareDetailsBySegment:[{segmentId:"1",cabin:e.travelClass||"ECONOMY",fareBasis:"K",class:"K",includedCheckedBags:{quantity:1}}]}],validatingAirlineCodes:[0===a?"LY":1===a?"UA":"BA"],numberOfBookableSeats:9}))}async function N(e){try{let{action:t="search",origin:r,destination:a,departureDate:n,returnDate:s,adults:i=1,children:o=0,infants:l=0,travelClass:d="ECONOMY",nonStop:u=!1,maxResults:c=10,departureMonth:p}=await e.json();if("search"===t){if(!r||!a||!n)return w.NextResponse.json({error:"Missing required fields: origin, destination, departureDate"},{status:400});if(3!==r.length||3!==a.length)return w.NextResponse.json({error:"Invalid IATA codes. Use 3-letter codes (e.g., TLV, JFK)"},{status:400});let e=/^\d{4}-\d{2}-\d{2}$/;if(!e.test(n))return w.NextResponse.json({error:"Invalid date format. Use YYYY-MM-DD"},{status:400});if(s&&!e.test(s))return w.NextResponse.json({error:"Invalid return date format. Use YYYY-MM-DD"},{status:400});let t={origin:r.toUpperCase(),destination:a.toUpperCase(),departureDate:n,returnDate:s,adults:i,children:o,infants:l,travelClass:d,nonStop:u,maxResults:c},p=await S(t);return w.NextResponse.json({success:!0,data:p,count:p.length,params:t})}if("calendar"===t){if(!r||!a||!p)return w.NextResponse.json({error:"Missing required fields: origin, destination, departureMonth"},{status:400});let e=await y(r.toUpperCase(),a.toUpperCase(),p);return w.NextResponse.json({success:!0,data:e})}if("cheapest"===t){if(!r)return w.NextResponse.json({error:"Origin is required"},{status:400});let e=await U(r.toUpperCase(),a?.toUpperCase());return w.NextResponse.json({success:!0,data:e})}return w.NextResponse.json({error:"Invalid action. Use: search, calendar, or cheapest"},{status:400})}catch(e){return console.error("[API Flights] Error:",e),w.NextResponse.json({success:!1,error:e.message||"Failed to search flights"},{status:500})}}async function P(e){try{let{searchParams:t}=new URL(e.url),r=t.get("action")||"search";if("cheapest"===r){let e=t.get("origin"),r=t.get("destination");if(!e)return w.NextResponse.json({error:"Origin parameter is required"},{status:400});let a=await U(e.toUpperCase(),r?.toUpperCase());return w.NextResponse.json({success:!0,data:a})}return w.NextResponse.json({success:!0,message:"Use POST method for flight searches",supportedActions:["search","calendar","cheapest"]})}catch(e){return console.error("[API Flights] Error:",e),w.NextResponse.json({success:!1,error:e.message||"Failed to process request"},{status:500})}}e.s(["GET",()=>P,"POST",()=>N],88697);var T=e.i(88697);let I=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/flights/route",pathname:"/api/flights",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/v0-bookinengine/app/api/flights/route.ts",nextConfigOutput:"",userland:T}),{workAsyncStorage:M,workUnitAsyncStorage:O,serverHooks:b}=I;function $(){return(0,a.patchFetch)({workAsyncStorage:M,workUnitAsyncStorage:O})}async function j(e,t,a){I.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let w="/api/flights/route";w=w.replace(/\/index$/,"")||"/";let A=await I.prepare(e,t,{srcPage:w,multiZoneDraftMode:!1});if(!A)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:C,params:E,nextConfig:S,parsedUrl:x,isDraftMode:_,prerenderManifest:y,routerServerContext:U,isOnDemandRevalidate:D,revalidateOnlyGenerated:N,resolvedPathname:P,clientReferenceManifest:T,serverActionsManifest:M}=A,O=(0,l.normalizeAppPath)(w),b=!!(y.dynamicRoutes[O]||y.routes[P]),$=async()=>((null==U?void 0:U.render404)?await U.render404(e,t,x,!1):t.end("This page could not be found"),null);if(b&&!_){let e=!!y.routes[P],t=y.dynamicRoutes[O];if(t&&!1===t.fallback&&!e){if(S.experimental.adapterPath)return await $();throw new R.NoFallbackError}}let j=null;!b||I.isDev||_||(j="/index"===(j=P)?"/":j);let k=!0===I.isDev||!b,F=b&&!k;M&&T&&(0,i.setReferenceManifestsSingleton)({page:w,clientReferenceManifest:T,serverActionsManifest:M,serverModuleMap:(0,o.createServerModuleMap)({serverActionsManifest:M})});let L=e.method||"GET",H=(0,s.getTracer)(),q=H.getActiveScopeSpan(),B={params:E,prerenderManifest:y,renderOpts:{experimental:{authInterrupts:!!S.experimental.authInterrupts},cacheComponents:!!S.cacheComponents,supportsDynamicResponse:k,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:S.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>I.onRequestError(e,t,a,U)},sharedContext:{buildId:C}},Y=new d.NodeNextRequest(e),K=new d.NodeNextResponse(t),G=u.NextRequestAdapter.fromNodeNextRequest(Y,(0,u.signalFromNodeResponse)(t));try{let i=async e=>I.handle(G,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=H.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${L} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${L} ${w}`)}),o=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var s,l;let d=async({previousCacheEntry:r})=>{try{if(!o&&D&&N&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await i(n);e.fetchMetrics=B.renderOpts.fetchMetrics;let l=B.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let d=B.renderOpts.collectedTags;if(!b)return await (0,h.sendResponse)(Y,K,s,B.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,f.toNodeOutgoingHttpHeaders)(s.headers);d&&(t[m.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,a=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await I.onRequestError(e,t,{routerKind:"App Router",routePath:w,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:D})},U),t}},u=await I.handleResponse({req:e,nextConfig:S,cacheKey:j,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:D,revalidateOnlyGenerated:N,responseGenerator:d,waitUntil:a.waitUntil,isMinimalMode:o});if(!b)return null;if((null==u||null==(s=u.value)?void 0:s.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",D?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),_&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,f.fromNodeOutgoingHttpHeaders)(u.value.headers);return o&&b||c.delete(m.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,g.getCacheControlHeader)(u.cacheControl)),await (0,h.sendResponse)(Y,K,new Response(u.value.body,{headers:c,status:u.value.status||200})),null};q?await l(q):await H.withPropagatedContext(e.headers,()=>H.trace(c.BaseServerSpan.handleRequest,{spanName:`${L} ${w}`,kind:s.SpanKind.SERVER,attributes:{"http.method":L,"http.target":e.url}},l))}catch(t){if(t instanceof R.NoFallbackError||await I.onRequestError(e,t,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:D})}),b)throw t;return await (0,h.sendResponse)(Y,K,new Response(null,{status:500})),null}}e.s(["handler",()=>j,"patchFetch",()=>$,"routeModule",()=>I,"serverHooks",()=>b,"workAsyncStorage",()=>M,"workUnitAsyncStorage",()=>O],41878)}];

//# sourceMappingURL=52597_next_dist_esm_build_templates_app-route_01aeec24.js.map