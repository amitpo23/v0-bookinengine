module.exports=[716526,e=>{"use strict";var t=e.i(747909),r=e.i(174017),a=e.i(996250),i=e.i(759756),o=e.i(561916),n=e.i(114444),s=e.i(837092),l=e.i(869741),c=e.i(316795),d=e.i(487718),u=e.i(995169),p=e.i(47587),h=e.i(666012),m=e.i(570101),g=e.i(626937),f=e.i(10372),y=e.i(193695);e.i(52474);var v=e.i(257297),R=e.i(89171),w=e.i(369492);async function b(e,t,r){let a={},i=!r?.description||r.description.length<50,o=!r?.images||0===r.images.length,n=!r?.facilities||0===r.facilities.length;if(!i&&!o&&!n)return a;try{var s,l,c;let d,u,p=await E(e,t);if(p&&(i&&p.description&&(a.description=p.description),o&&p.images&&(a.images=p.images),n&&p.facilities&&(a.facilities=p.facilities),a.rating=p.rating,a.reviews=p.reviews),i&&!a.description){let r=await C(e,t);r?.description&&(a.description=r.description)}return i&&!a.description&&r?.facilities&&r.facilities.length>0&&(s=e,l=r.facilities,d=(c=t)?` in ${c}`:"",u=l.slice(0,5).join(", "),a.description=`${s}${d} offers modern accommodations with excellent facilities including ${u}. The hotel provides comfortable rooms and quality services for both leisure and business travelers.`),a}catch(e){return console.error("Hotel enrichment error:",e),a}}async function E(e,t){let r=process.env.GOOGLE_PLACES_API_KEY;if(!r)return null;try{let a=t?`${e} ${t}`:e,i=`https://maps.googleapis.com/maps/api/place/findplacefromtext/json?input=${encodeURIComponent(a)}&inputtype=textquery&fields=place_id&key=${r}`,o=await fetch(i),n=await o.json();if(!n.candidates||0===n.candidates.length)return null;let s=n.candidates[0].place_id,l=`https://maps.googleapis.com/maps/api/place/details/json?place_id=${s}&fields=name,formatted_address,formatted_phone_number,website,rating,user_ratings_total,photos,editorial_summary,types,business_status&key=${r}`,c=await fetch(l),d=await c.json();if(!d.result)return null;let u=d.result,p=[];if(u.photos)for(let e of u.photos.slice(0,10)){let t=`https://maps.googleapis.com/maps/api/place/photo?maxwidth=1200&photo_reference=${e.photo_reference}&key=${r}`;p.push(t)}return{description:u.editorial_summary?.overview||u.name,images:p,rating:u.rating,address:u.formatted_address,phone:u.formatted_phone_number,website:u.website,reviews:[{rating:u.rating||0,count:u.user_ratings_total||0,source:"Google"}]}}catch(e){return console.error("Google Places API error:",e),null}}async function C(e,t){let r=process.env.BING_SEARCH_API_KEY;if(!r)return null;try{let a=t?`${e} hotel ${t}`:`${e} hotel`,i=`https://api.bing.microsoft.com/v7.0/search?q=${encodeURIComponent(a)}&count=3`,o=await fetch(i,{headers:{"Ocp-Apim-Subscription-Key":r}}),n=await o.json();if(n.webPages?.value&&n.webPages.value.length>0)return{description:n.webPages.value[0].snippet||""};return null}catch(e){return console.error("Bing Search API error:",e),null}}async function P(e){try{let t=await e.json();console.log("ðŸ”¥ REAL API - Body received:",JSON.stringify(t,null,2));let{hotelName:r,hotelId:a,city:i,adults:o,children:n,stars:s,limit:l}=t,c=t.dateFrom||t.checkIn,d=t.dateTo||t.checkOut,u=t.city||t.destination;if(console.log("ðŸ” Searching Medici API for:",{hotelId:a,hotelName:r,city:u,dateFrom:c,dateTo:d}),!c||!d)return R.NextResponse.json({error:"dateFrom and dateTo are required"},{status:400});if(!a&&!r&&!u)return R.NextResponse.json({error:"Either hotelId, hotelName or city is required"},{status:400});let p=await w.mediciApi.searchHotels({dateFrom:c,dateTo:d,hotelId:a||void 0,hotelName:r||void 0,city:u||void 0,adults:o||2,children:n||[],stars:s?Number(s):void 0,limit:l?Number(l):20});console.log("ðŸŽ¯ Medici API returned:",p.length,"results");let h=await Promise.all(p.map(async e=>{let t=0;"number"==typeof e.hotelId&&e.hotelId>0?t=e.hotelId:"string"==typeof e.hotelId&&e.hotelId&&(t=Number.parseInt(e.hotelId,10)||0);let r=(e.rooms||[]).map((e,t)=>{var r,a;let i=e.code||e.rateKey||e.roomCode||"";return{code:i,roomId:String(e.roomId||e.id||t+1),roomName:e.roomName||e.name||"Standard Room",roomCategory:e.roomCategory||e.roomType||e.category||"standard",categoryId:e.categoryId||(r=e.roomCategory||e.roomType,({standard:1,superior:2,deluxe:3,suite:4,"junior suite":5,family:6})[r?.toLowerCase()]||1),boardId:e.boardId||(a=e.board||e.boardType,({ro:1,bb:2,hb:3,fb:4,ai:5})[a?.toLowerCase()]||1),boardType:e.boardType||e.board||"RO",buyPrice:"number"==typeof e.buyPrice?e.buyPrice:"object"==typeof e.price&&e.price?.amount?Number(e.price.amount):Number(e.price)||0,originalPrice:Number(e.originalPrice)||0,currency:e.currency||("object"==typeof e.price?e.price?.currency:void 0)||"ILS",maxOccupancy:e.maxOccupancy||e.pax?.adults||2,size:e.size||e.roomSize||0,view:e.view||"",bedding:e.bedding||"",amenities:e.amenities||e.facilities||[],images:e.images||[],cancellationPolicy:e.cancellationPolicy||"free",available:e.available||e.quantity?.max||1,requestJson:e.requestJson||i}}),a=e.description||"",i=e.images||[],o=e.facilities||e.amenities||[];if(!a||a.length<50||0===i.length||0===o.length)try{let t=await b(e.hotelName||e.name||"Unknown Hotel",e.city,{description:a,images:i,facilities:o,address:e.address});t.description&&!a&&(a=t.description),t.images&&0===i.length&&(i=t.images),t.facilities&&0===o.length&&(o=t.facilities)}catch(t){console.error("Enrichment failed for hotel:",e.hotelName,t)}return{hotelId:t,hotelName:e.hotelName||e.name||"Unknown Hotel",city:e.city||"",stars:e.stars||e.rating||0,address:e.address||e.location||"",imageUrl:e.hotelImage||e.imageUrl||i[0]||"",images:i,description:a,facilities:o,rooms:r,requestJson:e.requestJson,responseJson:e.responseJson}}));return R.NextResponse.json({success:!0,data:h,count:h.length})}catch(e){return console.error("Search API Error:",e.message),R.NextResponse.json({error:e.message||"Failed to search hotels"},{status:500})}}e.i(423502),e.s(["POST",()=>P],895099);var x=e.i(895099);let I=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/hotels/search/route",pathname:"/api/hotels/search",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/hotels/search/route.ts",nextConfigOutput:"",userland:x}),{workAsyncStorage:_,workUnitAsyncStorage:N,serverHooks:A}=I;function T(){return(0,a.patchFetch)({workAsyncStorage:_,workUnitAsyncStorage:N})}async function S(e,t,a){I.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let R="/api/hotels/search/route";R=R.replace(/\/index$/,"")||"/";let w=await I.prepare(e,t,{srcPage:R,multiZoneDraftMode:!1});if(!w)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:b,params:E,nextConfig:C,parsedUrl:P,isDraftMode:x,prerenderManifest:_,routerServerContext:N,isOnDemandRevalidate:A,revalidateOnlyGenerated:T,resolvedPathname:S,clientReferenceManifest:O,serverActionsManifest:$}=w,q=(0,l.normalizeAppPath)(R),H=!!(_.dynamicRoutes[q]||_.routes[S]),U=async()=>((null==N?void 0:N.render404)?await N.render404(e,t,P,!1):t.end("This page could not be found"),null);if(H&&!x){let e=!!_.routes[S],t=_.dynamicRoutes[q];if(t&&!1===t.fallback&&!e){if(C.experimental.adapterPath)return await U();throw new y.NoFallbackError}}let j=null;!H||I.isDev||x||(j="/index"===(j=S)?"/":j);let k=!0===I.isDev||!H,M=H&&!k;$&&O&&(0,n.setReferenceManifestsSingleton)({page:R,clientReferenceManifest:O,serverActionsManifest:$,serverModuleMap:(0,s.createServerModuleMap)({serverActionsManifest:$})});let D=e.method||"GET",K=(0,o.getTracer)(),F=K.getActiveScopeSpan(),L={params:E,prerenderManifest:_,renderOpts:{experimental:{authInterrupts:!!C.experimental.authInterrupts},cacheComponents:!!C.cacheComponents,supportsDynamicResponse:k,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:C.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>I.onRequestError(e,t,a,N)},sharedContext:{buildId:b}},B=new c.NodeNextRequest(e),G=new c.NodeNextResponse(t),J=d.NextRequestAdapter.fromNodeNextRequest(B,(0,d.signalFromNodeResponse)(t));try{let n=async e=>I.handle(J,L).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=K.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${D} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${D} ${R}`)}),s=!!(0,i.getRequestMeta)(e,"minimalMode"),l=async i=>{var o,l;let c=async({previousCacheEntry:r})=>{try{if(!s&&A&&T&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await n(i);e.fetchMetrics=L.renderOpts.fetchMetrics;let l=L.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let c=L.renderOpts.collectedTags;if(!H)return await (0,h.sendResponse)(B,G,o,L.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(o.headers);c&&(t[f.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,a=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await I.onRequestError(e,t,{routerKind:"App Router",routePath:R,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:A})},N),t}},d=await I.handleResponse({req:e,nextConfig:C,cacheKey:j,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:_,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:T,responseGenerator:c,waitUntil:a.waitUntil,isMinimalMode:s});if(!H)return null;if((null==d||null==(o=d.value)?void 0:o.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",A?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),x&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,m.fromNodeOutgoingHttpHeaders)(d.value.headers);return s&&H||u.delete(f.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,g.getCacheControlHeader)(d.cacheControl)),await (0,h.sendResponse)(B,G,new Response(d.value.body,{headers:u,status:d.value.status||200})),null};F?await l(F):await K.withPropagatedContext(e.headers,()=>K.trace(u.BaseServerSpan.handleRequest,{spanName:`${D} ${R}`,kind:o.SpanKind.SERVER,attributes:{"http.method":D,"http.target":e.url}},l))}catch(t){if(t instanceof y.NoFallbackError||await I.onRequestError(e,t,{routerKind:"App Router",routePath:q,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:A})}),H)throw t;return await (0,h.sendResponse)(B,G,new Response(null,{status:500})),null}}e.s(["handler",()=>S,"patchFetch",()=>T,"routeModule",()=>I,"serverHooks",()=>A,"workAsyncStorage",()=>_,"workUnitAsyncStorage",()=>N],716526)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_51ff4e60.js.map