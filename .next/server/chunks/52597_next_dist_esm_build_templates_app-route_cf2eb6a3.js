module.exports=[51803,e=>{"use strict";var t,s,r=e.i(74119),a=e.i(74815),i=e.i(66969),o=e.i(8984),n=e.i(80568),l=e.i(85983),E=e.i(51311),u=e.i(48892),c=e.i(16339),d=e.i(34600),A=e.i(71794),I=e.i(4358),_=e.i(80603),p=e.i(79181),T=e.i(53442),D=e.i(70798),R=e.i(93695);e.i(51004);var S=e.i(64291),g=e.i(14539),C=e.i(16940),O=e.i(45306),m=e.i(46479);(t={}).LOGIN="LOGIN",t.LOGOUT="LOGOUT",t.LOGIN_FAILED="LOGIN_FAILED",t.PASSWORD_CHANGED="PASSWORD_CHANGED",t.PASSWORD_RESET_REQUESTED="PASSWORD_RESET_REQUESTED",t.MFA_ENABLED="MFA_ENABLED",t.MFA_DISABLED="MFA_DISABLED",t.USER_CREATED="USER_CREATED",t.USER_UPDATED="USER_UPDATED",t.USER_DELETED="USER_DELETED",t.USER_ANONYMIZED="USER_ANONYMIZED",t.ROLE_CHANGED="ROLE_CHANGED",t.PERMISSION_GRANTED="PERMISSION_GRANTED",t.PERMISSION_REVOKED="PERMISSION_REVOKED",t.DATA_VIEWED="DATA_VIEWED",t.DATA_EXPORTED="DATA_EXPORTED",t.SENSITIVE_DATA_ACCESSED="SENSITIVE_DATA_ACCESSED",t.PII_ACCESSED="PII_ACCESSED",t.BOOKING_CREATED="BOOKING_CREATED",t.BOOKING_VIEWED="BOOKING_VIEWED",t.BOOKING_UPDATED="BOOKING_UPDATED",t.BOOKING_CANCELLED="BOOKING_CANCELLED",t.BOOKING_REFUNDED="BOOKING_REFUNDED",t.SETTINGS_CHANGED="SETTINGS_CHANGED",t.TEMPLATE_MODIFIED="TEMPLATE_MODIFIED",t.TEMPLATE_CREATED="TEMPLATE_CREATED",t.TEMPLATE_DELETED="TEMPLATE_DELETED",t.API_KEY_ACCESSED="API_KEY_ACCESSED",t.API_KEY_CREATED="API_KEY_CREATED",t.API_KEY_REVOKED="API_KEY_REVOKED",t.UNAUTHORIZED_ACCESS="UNAUTHORIZED_ACCESS",t.SUSPICIOUS_ACTIVITY="SUSPICIOUS_ACTIVITY",t.RATE_LIMIT_EXCEEDED="RATE_LIMIT_EXCEEDED",t.SQL_INJECTION_ATTEMPT="SQL_INJECTION_ATTEMPT",t.XSS_ATTEMPT="XSS_ATTEMPT",t.CSRF_TOKEN_INVALID="CSRF_TOKEN_INVALID",t.SESSION_HIJACK_ATTEMPT="SESSION_HIJACK_ATTEMPT",t.DATA_EXPORT_REQUESTED="DATA_EXPORT_REQUESTED",t.DATA_DELETION_REQUESTED="DATA_DELETION_REQUESTED",t.CONSENT_GIVEN="CONSENT_GIVEN",t.CONSENT_WITHDRAWN="CONSENT_WITHDRAWN",t.PRIVACY_POLICY_VIEWED="PRIVACY_POLICY_VIEWED",t.BACKUP_CREATED="BACKUP_CREATED",t.BACKUP_RESTORED="BACKUP_RESTORED",t.SYSTEM_ERROR="SYSTEM_ERROR",t.DATABASE_QUERY="DATABASE_QUERY",(s={}).INFO="INFO",s.LOW="LOW",s.MEDIUM="MEDIUM",s.HIGH="HIGH",s.CRITICAL="CRITICAL";let N=new class{isEnabled=!0;async log(e){if(this.isEnabled)try{let t={...e,timestamp:new Date};if(!m.supabaseAdmin)return;let{error:s}=await m.supabaseAdmin.from("audit_logs").insert({timestamp:t.timestamp.toISOString(),user_id:t.userId,user_email:t.userEmail,ip_address:t.ipAddress,user_agent:t.userAgent,action:t.action,severity:t.severity,resource:t.resource,resource_id:t.resourceId,old_value:t.oldValue,new_value:t.newValue,success:t.success,error_message:t.errorMessage,metadata:t.metadata,session_id:t.sessionId,request_id:t.requestId});s&&(console.error("âŒ Failed to write audit log:",s),await this.fallbackLog(t)),this.isCritical(e.severity)&&await this.sendSecurityAlert(t)}catch(e){console.error("âŒ Audit log error:",e)}}async logLogin(e,t,s,r){await this.log({userId:e,userEmail:t,ipAddress:s,userAgent:r,action:"LOGIN",severity:"INFO",resource:"authentication",success:!0})}async logLoginFailed(e,t,s,r){await this.log({userId:"anonymous",userEmail:e,ipAddress:t,userAgent:s,action:"LOGIN_FAILED",severity:"MEDIUM",resource:"authentication",success:!1,errorMessage:r})}async logLogout(e,t,s){await this.log({userId:e,userEmail:t,ipAddress:s,userAgent:"N/A",action:"LOGOUT",severity:"INFO",resource:"authentication",success:!0})}async logDataAccess(e,t,s,r,a,i){await this.log({userId:e,userEmail:t,ipAddress:a,userAgent:i,action:"SENSITIVE_DATA_ACCESSED",severity:"MEDIUM",resource:s,resourceId:r,success:!0})}async logDataExport(e,t,s,r,a){await this.log({userId:e,userEmail:t,ipAddress:a,userAgent:"N/A",action:"DATA_EXPORTED",severity:"HIGH",resource:s,success:!0,metadata:{recordCount:r}})}async logRoleChange(e,t,s,r,a,i){await this.log({userId:e,userEmail:t,ipAddress:i,userAgent:"N/A",action:"ROLE_CHANGED",severity:"HIGH",resource:"user_roles",resourceId:s,oldValue:{role:r},newValue:{role:a},success:!0})}async logUserDeleted(e,t,s,r,a){await this.log({userId:e,userEmail:t,ipAddress:a,userAgent:"N/A",action:"USER_DELETED",severity:"CRITICAL",resource:"users",resourceId:s,metadata:{deletedEmail:r},success:!0})}async logBookingCreated(e,t,s,r,a,i){await this.log({userId:e,userEmail:t,ipAddress:i,userAgent:"N/A",action:"BOOKING_CREATED",severity:"INFO",resource:"bookings",resourceId:s,metadata:{hotelName:r,totalPrice:a},success:!0})}async logBookingCancelled(e,t,s,r,a){await this.log({userId:e,userEmail:t,ipAddress:a,userAgent:"N/A",action:"BOOKING_CANCELLED",severity:"MEDIUM",resource:"bookings",resourceId:s,metadata:{reason:r},success:!0})}async logUnauthorizedAccess(e,t,s,r,a){await this.log({userId:e,userEmail:t,ipAddress:r,userAgent:a,action:"UNAUTHORIZED_ACCESS",severity:"CRITICAL",resource:s,success:!1,errorMessage:"Unauthorized access attempt"})}async logRateLimitExceeded(e,t,s,r){await this.log({userId:e,userEmail:t,ipAddress:r,userAgent:"N/A",action:"RATE_LIMIT_EXCEEDED",severity:"HIGH",resource:s,success:!1,errorMessage:"Too many requests"})}async logSuspiciousActivity(e,t,s,r,a){await this.log({userId:e,userEmail:t,ipAddress:r,userAgent:a,action:"SUSPICIOUS_ACTIVITY",severity:"CRITICAL",resource:"security",success:!1,errorMessage:s})}async logSettingsChanged(e,t,s,r,a,i){await this.log({userId:e,userEmail:t,ipAddress:i,userAgent:"N/A",action:"SETTINGS_CHANGED",severity:"MEDIUM",resource:"settings",resourceId:s,oldValue:r,newValue:a,success:!0})}async logApiKeyAccessed(e,t,s,r){await this.log({userId:e,userEmail:t,ipAddress:r,userAgent:"N/A",action:"API_KEY_ACCESSED",severity:"HIGH",resource:"api_keys",resourceId:s,success:!0})}async query(e){try{if(!m.supabaseAdmin)return console.warn("[Audit Log] Supabase admin client not available"),[];let t=m.supabaseAdmin.from("audit_logs").select("*").order("timestamp",{ascending:!1});e.userId&&(t=t.eq("user_id",e.userId)),e.action&&(t=t.eq("action",e.action)),e.severity&&(t=t.eq("severity",e.severity)),e.startDate&&(t=t.gte("timestamp",e.startDate.toISOString())),e.endDate&&(t=t.lte("timestamp",e.endDate.toISOString())),e.limit&&(t=t.limit(e.limit)),e.offset&&(t=t.range(e.offset,e.offset+(e.limit||100)));let{data:s,error:r}=await t;if(r)throw r;return(s||[]).map(e=>({id:e.id,timestamp:new Date(e.timestamp),userId:e.user_id,userEmail:e.user_email,ipAddress:e.ip_address,userAgent:e.user_agent,action:e.action,severity:e.severity,resource:e.resource,resourceId:e.resource_id,oldValue:e.old_value,newValue:e.new_value,success:e.success,errorMessage:e.error_message,metadata:e.metadata,sessionId:e.session_id,requestId:e.request_id}))}catch(e){return console.error("Failed to query audit logs:",e),[]}}async getStats(e){try{if(!m.supabaseAdmin)return console.warn("[Audit Log] Supabase admin client not available"),{totalEvents:0,failedLogins:0,suspiciousActivities:0,criticalEvents:0};let t=m.supabaseAdmin.from("audit_logs").select("action, severity, success",{count:"exact"});e&&(t=t.eq("user_id",e));let{data:s,count:r}=await t;return{totalEvents:r||0,failedLogins:s?.filter(e=>"LOGIN_FAILED"===e.action).length||0,suspiciousActivities:s?.filter(e=>"SUSPICIOUS_ACTIVITY"===e.action).length||0,criticalEvents:s?.filter(e=>"CRITICAL"===e.severity).length||0}}catch(e){return console.error("Failed to get audit stats:",e),{totalEvents:0,failedLogins:0,suspiciousActivities:0,criticalEvents:0}}}isCritical(e){return"CRITICAL"===e}async sendSecurityAlert(e){console.error("ðŸš¨ SECURITY ALERT ðŸš¨",{action:e.action,user:e.userEmail,resource:e.resource,timestamp:e.timestamp,ip:e.ipAddress})}async fallbackLog(e){console.log("[Audit Log Fallback]",JSON.stringify(e,null,2))}setEnabled(e){this.isEnabled=e}};async function h(e){try{let t=await (0,C.getServerSession)(O.authOptions);if(!t?.user?.email)return g.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:s}=new URL(e.url),r=s.get("userId")||void 0,a=s.get("action"),i=s.get("severity"),o=s.get("startDate")?new Date(s.get("startDate")):void 0,n=s.get("endDate")?new Date(s.get("endDate")):void 0,l=parseInt(s.get("limit")||"100"),E=parseInt(s.get("offset")||"0"),u=await N.query({userId:r,action:a,severity:i,startDate:o,endDate:n,limit:l,offset:E}),c=await N.getStats(r);return g.NextResponse.json({logs:u,stats:c,count:u.length,offset:E,limit:l})}catch(e){return console.error("Failed to fetch audit logs:",e),g.NextResponse.json({error:"Failed to fetch audit logs"},{status:500})}}async function v(e){try{let t=await (0,C.getServerSession)(O.authOptions);if(!t?.user?.email)return g.NextResponse.json({error:"Unauthorized"},{status:401});let{filters:s}=await e.json(),r=(await N.query(s)).map(e=>[e.timestamp.toISOString(),e.userEmail,e.action,e.severity,e.resource,e.resourceId||"",e.ipAddress,e.success?"Yes":"No",e.errorMessage||""]),a=[["Timestamp","User Email","Action","Severity","Resource","Resource ID","IP Address","Success","Error Message"],...r].map(e=>e.map(e=>`"${e}"`).join(",")).join("\n");return new g.NextResponse(a,{headers:{"Content-Type":"text/csv","Content-Disposition":`attachment; filename="audit-logs-${new Date().toISOString()}.csv"`}})}catch(e){return console.error("Failed to export audit logs:",e),g.NextResponse.json({error:"Failed to export audit logs"},{status:500})}}e.s(["GET",()=>h,"POST",()=>v],28683);var y=e.i(28683);let w=new r.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/admin/audit-logs/route",pathname:"/api/admin/audit-logs",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/v0-bookinengine/app/api/admin/audit-logs/route.ts",nextConfigOutput:"",userland:y}),{workAsyncStorage:L,workUnitAsyncStorage:P,serverHooks:U}=w;function f(){return(0,i.patchFetch)({workAsyncStorage:L,workUnitAsyncStorage:P})}async function M(e,t,s){w.isDev&&(0,o.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let r="/api/admin/audit-logs/route";r=r.replace(/\/index$/,"")||"/";let i=await w.prepare(e,t,{srcPage:r,multiZoneDraftMode:!1});if(!i)return t.statusCode=400,t.end("Bad Request"),null==s.waitUntil||s.waitUntil.call(s,Promise.resolve()),null;let{buildId:g,params:C,nextConfig:O,parsedUrl:m,isDraftMode:N,prerenderManifest:h,routerServerContext:v,isOnDemandRevalidate:y,revalidateOnlyGenerated:L,resolvedPathname:P,clientReferenceManifest:U,serverActionsManifest:f}=i,M=(0,u.normalizeAppPath)(r),G=!!(h.dynamicRoutes[M]||h.routes[P]),H=async()=>((null==v?void 0:v.render404)?await v.render404(e,t,m,!1):t.end("This page could not be found"),null);if(G&&!N){let e=!!h.routes[P],t=h.dynamicRoutes[M];if(t&&!1===t.fallback&&!e){if(O.experimental.adapterPath)return await H();throw new R.NoFallbackError}}let x=null;!G||w.isDev||N||(x="/index"===(x=P)?"/":x);let b=!0===w.isDev||!G,K=G&&!b;f&&U&&(0,l.setReferenceManifestsSingleton)({page:r,clientReferenceManifest:U,serverActionsManifest:f,serverModuleMap:(0,E.createServerModuleMap)({serverActionsManifest:f})});let F=e.method||"GET",V=(0,n.getTracer)(),B=V.getActiveScopeSpan(),q={params:C,prerenderManifest:h,renderOpts:{experimental:{authInterrupts:!!O.experimental.authInterrupts},cacheComponents:!!O.cacheComponents,supportsDynamicResponse:b,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:O.cacheLife,waitUntil:s.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,s,r)=>w.onRequestError(e,t,r,v)},sharedContext:{buildId:g}},Y=new c.NodeNextRequest(e),k=new c.NodeNextResponse(t),W=d.NextRequestAdapter.fromNodeNextRequest(Y,(0,d.signalFromNodeResponse)(t));try{let i=async e=>w.handle(W,q).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let s=V.getRootSpanAttributes();if(!s)return;if(s.get("next.span_type")!==A.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${s.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=s.get("next.route");if(a){let t=`${F} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${F} ${r}`)}),l=!!(0,o.getRequestMeta)(e,"minimalMode"),E=async o=>{var n,E;let u=async({previousCacheEntry:a})=>{try{if(!l&&y&&L&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let r=await i(o);e.fetchMetrics=q.renderOpts.fetchMetrics;let n=q.renderOpts.pendingWaitUntil;n&&s.waitUntil&&(s.waitUntil(n),n=void 0);let E=q.renderOpts.collectedTags;if(!G)return await (0,_.sendResponse)(Y,k,r,q.renderOpts.pendingWaitUntil),null;{let e=await r.blob(),t=(0,p.toNodeOutgoingHttpHeaders)(r.headers);E&&(t[D.NEXT_CACHE_TAGS_HEADER]=E),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let s=void 0!==q.renderOpts.collectedRevalidate&&!(q.renderOpts.collectedRevalidate>=D.INFINITE_CACHE)&&q.renderOpts.collectedRevalidate,a=void 0===q.renderOpts.collectedExpire||q.renderOpts.collectedExpire>=D.INFINITE_CACHE?void 0:q.renderOpts.collectedExpire;return{value:{kind:S.CachedRouteKind.APP_ROUTE,status:r.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:s,expire:a}}}}catch(t){throw(null==a?void 0:a.isStale)&&await w.onRequestError(e,t,{routerKind:"App Router",routePath:r,routeType:"route",revalidateReason:(0,I.getRevalidateReason)({isStaticGeneration:K,isOnDemandRevalidate:y})},v),t}},c=await w.handleResponse({req:e,nextConfig:O,cacheKey:x,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:h,isRoutePPREnabled:!1,isOnDemandRevalidate:y,revalidateOnlyGenerated:L,responseGenerator:u,waitUntil:s.waitUntil,isMinimalMode:l});if(!G)return null;if((null==c||null==(n=c.value)?void 0:n.kind)!==S.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(E=c.value)?void 0:E.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",y?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),N&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,p.fromNodeOutgoingHttpHeaders)(c.value.headers);return l&&G||d.delete(D.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,T.getCacheControlHeader)(c.cacheControl)),await (0,_.sendResponse)(Y,k,new Response(c.value.body,{headers:d,status:c.value.status||200})),null};B?await E(B):await V.withPropagatedContext(e.headers,()=>V.trace(A.BaseServerSpan.handleRequest,{spanName:`${F} ${r}`,kind:n.SpanKind.SERVER,attributes:{"http.method":F,"http.target":e.url}},E))}catch(t){if(t instanceof R.NoFallbackError||await w.onRequestError(e,t,{routerKind:"App Router",routePath:M,routeType:"route",revalidateReason:(0,I.getRevalidateReason)({isStaticGeneration:K,isOnDemandRevalidate:y})}),G)throw t;return await (0,_.sendResponse)(Y,k,new Response(null,{status:500})),null}}e.s(["handler",()=>M,"patchFetch",()=>f,"routeModule",()=>w,"serverHooks",()=>U,"workAsyncStorage",()=>L,"workUnitAsyncStorage",()=>P],51803)}];

//# sourceMappingURL=52597_next_dist_esm_build_templates_app-route_cf2eb6a3.js.map