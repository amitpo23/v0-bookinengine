module.exports=[24607,a=>{"use strict";let b;var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x=a.i(82746),y=a.i(80940),z=a.i(21958),A=a.i(40695),B=a.i(5522),C=a.i(17171),D=a.i(65733),E=a.i(87682),F=a.i(46893),G=a.i(80281),H=a.i(54161),I=a.i(3130),J=a.i(84980),K=a.i(10464),L=a.i(96826),M=a.i(61237);let N=(0,M.default)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);var O=a.i(7085);let P=(0,M.default)("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);var Q=a.i(1556);let R=(0,M.default)("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);class S extends Error{constructor(a,b="FunctionsError",c){super(a),this.name=b,this.context=c}}class T extends S{constructor(a){super("Failed to send a request to the Edge Function","FunctionsFetchError",a)}}class U extends S{constructor(a){super("Relay Error invoking the Edge Function","FunctionsRelayError",a)}}class V extends S{constructor(a){super("Edge Function returned a non-2xx status code","FunctionsHttpError",a)}}(c=m||(m={})).Any="any",c.ApNortheast1="ap-northeast-1",c.ApNortheast2="ap-northeast-2",c.ApSouth1="ap-south-1",c.ApSoutheast1="ap-southeast-1",c.ApSoutheast2="ap-southeast-2",c.CaCentral1="ca-central-1",c.EuCentral1="eu-central-1",c.EuWest1="eu-west-1",c.EuWest2="eu-west-2",c.EuWest3="eu-west-3",c.SaEast1="sa-east-1",c.UsEast1="us-east-1",c.UsWest1="us-west-1",c.UsWest2="us-west-2";var W=a.i(14875);class X{constructor(a,{headers:b={},customFetch:c,region:d=m.Any}={}){this.url=a,this.headers=b,this.region=d,this.fetch=(a=>a?(...b)=>a(...b):(...a)=>fetch(...a))(c)}setAuth(a){this.headers.Authorization=`Bearer ${a}`}invoke(a){return(0,W.__awaiter)(this,arguments,void 0,function*(a,b={}){var c;let d,e;try{let f,{headers:g,method:h,body:i,signal:j,timeout:k}=b,l={},{region:m}=b;m||(m=this.region);let n=new URL(`${this.url}/${a}`);m&&"any"!==m&&(l["x-region"]=m,n.searchParams.set("forceFunctionRegion",m)),i&&(g&&!Object.prototype.hasOwnProperty.call(g,"Content-Type")||!g)?"undefined"!=typeof Blob&&i instanceof Blob||i instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",f=i):"string"==typeof i?(l["Content-Type"]="text/plain",f=i):"undefined"!=typeof FormData&&i instanceof FormData?f=i:(l["Content-Type"]="application/json",f=JSON.stringify(i)):f=i;let o=j;k&&(e=new AbortController,d=setTimeout(()=>e.abort(),k),j?(o=e.signal,j.addEventListener("abort",()=>e.abort())):o=e.signal);let p=yield this.fetch(n.toString(),{method:h||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),g),body:f,signal:o}).catch(a=>{throw new T(a)}),q=p.headers.get("x-relay-error");if(q&&"true"===q)throw new U(p);if(!p.ok)throw new V(p);let r=(null!=(c=p.headers.get("Content-Type"))?c:"text/plain").split(";")[0].trim();return{data:"application/json"===r?yield p.json():"application/octet-stream"===r||"application/pdf"===r?yield p.blob():"text/event-stream"===r?p:"multipart/form-data"===r?yield p.formData():yield p.text(),error:null,response:p}}catch(a){return{data:null,error:a,response:a instanceof V||a instanceof U?a.context:void 0}}finally{d&&clearTimeout(d)}})}}var Y=class extends Error{constructor(a){super(a.message),this.name="PostgrestError",this.details=a.details,this.hint=a.hint,this.code=a.code}},Z=class{constructor(a){var b,c;this.shouldThrowOnError=!1,this.method=a.method,this.url=a.url,this.headers=new Headers(a.headers),this.schema=a.schema,this.body=a.body,this.shouldThrowOnError=null!=(b=a.shouldThrowOnError)&&b,this.signal=a.signal,this.isMaybeSingle=null!=(c=a.isMaybeSingle)&&c,a.fetch?this.fetch=a.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(a,b){return this.headers=new Headers(this.headers),this.headers.set(a,b),this}then(a,b){var c=this;void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");let d=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async a=>{var b,d,e,f;let g=null,h=null,i=null,j=a.status,k=a.statusText;if(a.ok){if("HEAD"!==c.method){let b=await a.text();""===b||(h="text/csv"===c.headers.get("Accept")||c.headers.get("Accept")&&(null==(e=c.headers.get("Accept"))?void 0:e.includes("application/vnd.pgrst.plan+text"))?b:JSON.parse(b))}let f=null==(b=c.headers.get("Prefer"))?void 0:b.match(/count=(exact|planned|estimated)/),l=null==(d=a.headers.get("content-range"))?void 0:d.split("/");f&&l&&l.length>1&&(i=parseInt(l[1])),c.isMaybeSingle&&"GET"===c.method&&Array.isArray(h)&&(h.length>1?(g={code:"PGRST116",details:`Results contain ${h.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},h=null,i=null,j=406,k="Not Acceptable"):h=1===h.length?h[0]:null)}else{let b=await a.text();try{g=JSON.parse(b),Array.isArray(g)&&404===a.status&&(h=[],g=null,j=200,k="OK")}catch(c){404===a.status&&""===b?(j=204,k="No Content"):g={message:b}}if(g&&c.isMaybeSingle&&(null==g||null==(f=g.details)?void 0:f.includes("0 rows"))&&(g=null,j=200,k="OK"),g&&c.shouldThrowOnError)throw new Y(g)}return{error:g,data:h,count:i,status:j,statusText:k}});return this.shouldThrowOnError||(d=d.catch(a=>{var b,c,d,e,f,g;let h="",i=null==a?void 0:a.cause;if(i){let b=null!=(c=null==i?void 0:i.message)?c:"",g=null!=(d=null==i?void 0:i.code)?d:"";h=`${null!=(e=null==a?void 0:a.name)?e:"FetchError"}: ${null==a?void 0:a.message}

Caused by: ${null!=(f=null==i?void 0:i.name)?f:"Error"}: ${b}`,g&&(h+=` (${g})`),(null==i?void 0:i.stack)&&(h+=`
${i.stack}`)}else h=null!=(g=null==a?void 0:a.stack)?g:"";return{error:{message:`${null!=(b=null==a?void 0:a.name)?b:"FetchError"}: ${null==a?void 0:a.message}`,details:h,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),d.then(a,b)}returns(){return this}overrideTypes(){return this}},$=class extends Z{select(a){let b=!1,c=(null!=a?a:"*").split("").map(a=>/\s/.test(a)&&!b?"":('"'===a&&(b=!b),a)).join("");return this.url.searchParams.set("select",c),this.headers.append("Prefer","return=representation"),this}order(a,{ascending:b=!0,nullsFirst:c,foreignTable:d,referencedTable:e=d}={}){let f=e?`${e}.order`:"order",g=this.url.searchParams.get(f);return this.url.searchParams.set(f,`${g?`${g},`:""}${a}.${b?"asc":"desc"}${void 0===c?"":c?".nullsfirst":".nullslast"}`),this}limit(a,{foreignTable:b,referencedTable:c=b}={}){let d=void 0===c?"limit":`${c}.limit`;return this.url.searchParams.set(d,`${a}`),this}range(a,b,{foreignTable:c,referencedTable:d=c}={}){let e=void 0===d?"offset":`${d}.offset`,f=void 0===d?"limit":`${d}.limit`;return this.url.searchParams.set(e,`${a}`),this.url.searchParams.set(f,`${b-a+1}`),this}abortSignal(a){return this.signal=a,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:a=!1,verbose:b=!1,settings:c=!1,buffers:d=!1,wal:e=!1,format:f="text"}={}){var g;let h=[a?"analyze":null,b?"verbose":null,c?"settings":null,d?"buffers":null,e?"wal":null].filter(Boolean).join("|"),i=null!=(g=this.headers.get("Accept"))?g:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${f}; for="${i}"; options=${h};`),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(a){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${a}`),this}};let _=RegExp("[,()]");var aa=class extends ${eq(a,b){return this.url.searchParams.append(a,`eq.${b}`),this}neq(a,b){return this.url.searchParams.append(a,`neq.${b}`),this}gt(a,b){return this.url.searchParams.append(a,`gt.${b}`),this}gte(a,b){return this.url.searchParams.append(a,`gte.${b}`),this}lt(a,b){return this.url.searchParams.append(a,`lt.${b}`),this}lte(a,b){return this.url.searchParams.append(a,`lte.${b}`),this}like(a,b){return this.url.searchParams.append(a,`like.${b}`),this}likeAllOf(a,b){return this.url.searchParams.append(a,`like(all).{${b.join(",")}}`),this}likeAnyOf(a,b){return this.url.searchParams.append(a,`like(any).{${b.join(",")}}`),this}ilike(a,b){return this.url.searchParams.append(a,`ilike.${b}`),this}ilikeAllOf(a,b){return this.url.searchParams.append(a,`ilike(all).{${b.join(",")}}`),this}ilikeAnyOf(a,b){return this.url.searchParams.append(a,`ilike(any).{${b.join(",")}}`),this}regexMatch(a,b){return this.url.searchParams.append(a,`match.${b}`),this}regexIMatch(a,b){return this.url.searchParams.append(a,`imatch.${b}`),this}is(a,b){return this.url.searchParams.append(a,`is.${b}`),this}isDistinct(a,b){return this.url.searchParams.append(a,`isdistinct.${b}`),this}in(a,b){let c=Array.from(new Set(b)).map(a=>"string"==typeof a&&_.test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(a,`in.(${c})`),this}notIn(a,b){let c=Array.from(new Set(b)).map(a=>"string"==typeof a&&_.test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(a,`not.in.(${c})`),this}contains(a,b){return"string"==typeof b?this.url.searchParams.append(a,`cs.${b}`):Array.isArray(b)?this.url.searchParams.append(a,`cs.{${b.join(",")}}`):this.url.searchParams.append(a,`cs.${JSON.stringify(b)}`),this}containedBy(a,b){return"string"==typeof b?this.url.searchParams.append(a,`cd.${b}`):Array.isArray(b)?this.url.searchParams.append(a,`cd.{${b.join(",")}}`):this.url.searchParams.append(a,`cd.${JSON.stringify(b)}`),this}rangeGt(a,b){return this.url.searchParams.append(a,`sr.${b}`),this}rangeGte(a,b){return this.url.searchParams.append(a,`nxl.${b}`),this}rangeLt(a,b){return this.url.searchParams.append(a,`sl.${b}`),this}rangeLte(a,b){return this.url.searchParams.append(a,`nxr.${b}`),this}rangeAdjacent(a,b){return this.url.searchParams.append(a,`adj.${b}`),this}overlaps(a,b){return"string"==typeof b?this.url.searchParams.append(a,`ov.${b}`):this.url.searchParams.append(a,`ov.{${b.join(",")}}`),this}textSearch(a,b,{config:c,type:d}={}){let e="";"plain"===d?e="pl":"phrase"===d?e="ph":"websearch"===d&&(e="w");let f=void 0===c?"":`(${c})`;return this.url.searchParams.append(a,`${e}fts${f}.${b}`),this}match(a){return Object.entries(a).forEach(([a,b])=>{this.url.searchParams.append(a,`eq.${b}`)}),this}not(a,b,c){return this.url.searchParams.append(a,`not.${b}.${c}`),this}or(a,{foreignTable:b,referencedTable:c=b}={}){let d=c?`${c}.or`:"or";return this.url.searchParams.append(d,`(${a})`),this}filter(a,b,c){return this.url.searchParams.append(a,`${b}.${c}`),this}},ab=class{constructor(a,{headers:b={},schema:c,fetch:d}){this.url=a,this.headers=new Headers(b),this.schema=c,this.fetch=d}select(a,b){let{head:c=!1,count:d}=null!=b?b:{},e=!1,f=(null!=a?a:"*").split("").map(a=>/\s/.test(a)&&!e?"":('"'===a&&(e=!e),a)).join("");return this.url.searchParams.set("select",f),d&&this.headers.append("Prefer",`count=${d}`),new aa({method:c?"HEAD":"GET",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(a,{count:b,defaultToNull:c=!0}={}){var d;if(b&&this.headers.append("Prefer",`count=${b}`),c||this.headers.append("Prefer","missing=default"),Array.isArray(a)){let b=a.reduce((a,b)=>a.concat(Object.keys(b)),[]);if(b.length>0){let a=[...new Set(b)].map(a=>`"${a}"`);this.url.searchParams.set("columns",a.join(","))}}return new aa({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:a,fetch:null!=(d=this.fetch)?d:fetch})}upsert(a,{onConflict:b,ignoreDuplicates:c=!1,count:d,defaultToNull:e=!0}={}){var f;if(this.headers.append("Prefer",`resolution=${c?"ignore":"merge"}-duplicates`),void 0!==b&&this.url.searchParams.set("on_conflict",b),d&&this.headers.append("Prefer",`count=${d}`),e||this.headers.append("Prefer","missing=default"),Array.isArray(a)){let b=a.reduce((a,b)=>a.concat(Object.keys(b)),[]);if(b.length>0){let a=[...new Set(b)].map(a=>`"${a}"`);this.url.searchParams.set("columns",a.join(","))}}return new aa({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:a,fetch:null!=(f=this.fetch)?f:fetch})}update(a,{count:b}={}){var c;return b&&this.headers.append("Prefer",`count=${b}`),new aa({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:a,fetch:null!=(c=this.fetch)?c:fetch})}delete({count:a}={}){var b;return a&&this.headers.append("Prefer",`count=${a}`),new aa({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:null!=(b=this.fetch)?b:fetch})}},ac=class a{constructor(a,{headers:b={},schema:c,fetch:d}={}){this.url=a,this.headers=new Headers(b),this.schemaName=c,this.fetch=d}from(a){if(!a||"string"!=typeof a||""===a.trim())throw Error("Invalid relation name: relation must be a non-empty string.");return new ab(new URL(`${this.url}/${a}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(b){return new a(this.url,{headers:this.headers,schema:b,fetch:this.fetch})}rpc(a,b={},{head:c=!1,get:d=!1,count:e}={}){var f;let g,h,i=new URL(`${this.url}/rpc/${a}`);c||d?(g=c?"HEAD":"GET",Object.entries(b).filter(([a,b])=>void 0!==b).map(([a,b])=>[a,Array.isArray(b)?`{${b.join(",")}}`:`${b}`]).forEach(([a,b])=>{i.searchParams.append(a,b)})):(g="POST",h=b);let j=new Headers(this.headers);return e&&j.set("Prefer",`count=${e}`),new aa({method:g,url:i,headers:j,schema:this.schemaName,body:h,fetch:null!=(f=this.fetch)?f:fetch})}};let ad=class{constructor(){}static detectEnvironment(){var b;if("undefined"!=typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if(void 0!==a.g.WebSocket)return{type:"native",constructor:a.g.WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocketPair&&void 0===globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!=typeof globalThis&&globalThis.EdgeRuntime||"undefined"!=typeof navigator&&(null==(b=navigator.userAgent)?void 0:b.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if("undefined"!=typeof process){let a=process.versions;if(a&&a.node){let b=parseInt(a.node.replace(/^v/,"").split(".")[0]);return b>=22?void 0!==globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${b} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${b} detected without native WebSocket support.`,workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){let a=this.detectEnvironment();if(a.constructor)return a.constructor;let b=a.error||"WebSocket not supported in this environment.";throw a.workaround&&(b+=`

Suggested solution: ${a.workaround}`),Error(b)}static createWebSocket(a,b){return new(this.getWebSocketConstructor())(a,b)}static isWebSocketSupported(){try{let a=this.detectEnvironment();return"native"===a.type||"ws"===a.type}catch(a){return!1}}},ae="1.0.0";(d=n||(n={}))[d.connecting=0]="connecting",d[d.open=1]="open",d[d.closing=2]="closing",d[d.closed=3]="closed",(e=o||(o={})).closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving",(f=p||(p={})).close="phx_close",f.error="phx_error",f.join="phx_join",f.reply="phx_reply",f.leave="phx_leave",f.access_token="access_token",(q||(q={})).websocket="websocket",(g=r||(r={})).Connecting="connecting",g.Open="open",g.Closing="closing",g.Closed="closed";class af{constructor(a){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=null!=a?a:[]}encode(a,b){return a.event!==this.BROADCAST_EVENT||a.payload instanceof ArrayBuffer||"string"!=typeof a.payload.event?b(JSON.stringify([a.join_ref,a.ref,a.topic,a.event,a.payload])):b(this._binaryEncodeUserBroadcastPush(a))}_binaryEncodeUserBroadcastPush(a){var b;return this._isArrayBuffer(null==(b=a.payload)?void 0:b.payload)?this._encodeBinaryUserBroadcastPush(a):this._encodeJsonUserBroadcastPush(a)}_encodeBinaryUserBroadcastPush(a){var b,c;let d=null!=(c=null==(b=a.payload)?void 0:b.payload)?c:new ArrayBuffer(0);return this._encodeUserBroadcastPush(a,this.BINARY_ENCODING,d)}_encodeJsonUserBroadcastPush(a){var b,c;let d=null!=(c=null==(b=a.payload)?void 0:b.payload)?c:{},e=new TextEncoder().encode(JSON.stringify(d)).buffer;return this._encodeUserBroadcastPush(a,this.JSON_ENCODING,e)}_encodeUserBroadcastPush(a,b,c){let d=a.topic,e=null!=(n=a.ref)?n:"",f=null!=(o=a.join_ref)?o:"",g=a.payload.event,h=this.allowedMetadataKeys?this._pick(a.payload,this.allowedMetadataKeys):{},i=0===Object.keys(h).length?"":JSON.stringify(h);if(f.length>255)throw Error(`joinRef length ${f.length} exceeds maximum of 255`);if(e.length>255)throw Error(`ref length ${e.length} exceeds maximum of 255`);if(d.length>255)throw Error(`topic length ${d.length} exceeds maximum of 255`);if(g.length>255)throw Error(`userEvent length ${g.length} exceeds maximum of 255`);if(i.length>255)throw Error(`metadata length ${i.length} exceeds maximum of 255`);let j=this.USER_BROADCAST_PUSH_META_LENGTH+f.length+e.length+d.length+g.length+i.length,k=new ArrayBuffer(this.HEADER_LENGTH+j),l=new DataView(k),m=0;l.setUint8(m++,this.KINDS.userBroadcastPush),l.setUint8(m++,f.length),l.setUint8(m++,e.length),l.setUint8(m++,d.length),l.setUint8(m++,g.length),l.setUint8(m++,i.length),l.setUint8(m++,b),Array.from(f,a=>l.setUint8(m++,a.charCodeAt(0))),Array.from(e,a=>l.setUint8(m++,a.charCodeAt(0))),Array.from(d,a=>l.setUint8(m++,a.charCodeAt(0))),Array.from(g,a=>l.setUint8(m++,a.charCodeAt(0))),Array.from(i,a=>l.setUint8(m++,a.charCodeAt(0)));var n,o,p=new Uint8Array(k.byteLength+c.byteLength);return p.set(new Uint8Array(k),0),p.set(new Uint8Array(c),k.byteLength),p.buffer}decode(a,b){if(this._isArrayBuffer(a))return b(this._binaryDecode(a));if("string"==typeof a){let[c,d,e,f,g]=JSON.parse(a);return b({join_ref:c,ref:d,topic:e,event:f,payload:g})}return b({})}_binaryDecode(a){let b=new DataView(a),c=b.getUint8(0),d=new TextDecoder;if(c===this.KINDS.userBroadcast)return this._decodeUserBroadcast(a,b,d)}_decodeUserBroadcast(a,b,c){let d=b.getUint8(1),e=b.getUint8(2),f=b.getUint8(3),g=b.getUint8(4),h=this.HEADER_LENGTH+4,i=c.decode(a.slice(h,h+d));h+=d;let j=c.decode(a.slice(h,h+e));h+=e;let k=c.decode(a.slice(h,h+f));h+=f;let l=a.slice(h,a.byteLength),m=g===this.JSON_ENCODING?JSON.parse(c.decode(l)):l,n={type:this.BROADCAST_EVENT,event:j,payload:m};return f>0&&(n.meta=JSON.parse(k)),{join_ref:null,ref:null,topic:i,event:this.BROADCAST_EVENT,payload:n}}_isArrayBuffer(a){var b;return a instanceof ArrayBuffer||(null==(b=null==a?void 0:a.constructor)?void 0:b.name)==="ArrayBuffer"}_pick(a,b){return a&&"object"==typeof a?Object.fromEntries(Object.entries(a).filter(([a])=>b.includes(a))):{}}}class ag{constructor(a,b){this.callback=a,this.timerCalc=b,this.timer=void 0,this.tries=0,this.callback=a,this.timerCalc=b}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}(h=s||(s={})).abstime="abstime",h.bool="bool",h.date="date",h.daterange="daterange",h.float4="float4",h.float8="float8",h.int2="int2",h.int4="int4",h.int4range="int4range",h.int8="int8",h.int8range="int8range",h.json="json",h.jsonb="jsonb",h.money="money",h.numeric="numeric",h.oid="oid",h.reltime="reltime",h.text="text",h.time="time",h.timestamp="timestamp",h.timestamptz="timestamptz",h.timetz="timetz",h.tsrange="tsrange",h.tstzrange="tstzrange";let ah=(a,b,c={})=>{var d;let e=null!=(d=c.skipTypes)?d:[];return b?Object.keys(b).reduce((c,d)=>(c[d]=ai(d,a,b,e),c),{}):{}},ai=(a,b,c,d)=>{let e=b.find(b=>b.name===a),f=null==e?void 0:e.type,g=c[a];return f&&!d.includes(f)?aj(f,g):ak(g)},aj=(a,b)=>{if("_"===a.charAt(0))return ao(b,a.slice(1,a.length));switch(a){case s.bool:return al(b);case s.float4:case s.float8:case s.int2:case s.int4:case s.int8:case s.numeric:case s.oid:return am(b);case s.json:case s.jsonb:return an(b);case s.timestamp:return ap(b);case s.abstime:case s.date:case s.daterange:case s.int4range:case s.int8range:case s.money:case s.reltime:case s.text:case s.time:case s.timestamptz:case s.timetz:case s.tsrange:case s.tstzrange:default:return ak(b)}},ak=a=>a,al=a=>{switch(a){case"t":return!0;case"f":return!1;default:return a}},am=a=>{if("string"==typeof a){let b=parseFloat(a);if(!Number.isNaN(b))return b}return a},an=a=>{if("string"==typeof a)try{return JSON.parse(a)}catch(a){}return a},ao=(a,b)=>{if("string"!=typeof a)return a;let c=a.length-1,d=a[c];if("{"===a[0]&&"}"===d){let d,e=a.slice(1,c);try{d=JSON.parse("["+e+"]")}catch(a){d=e?e.split(","):[]}return d.map(a=>aj(b,a))}return a},ap=a=>"string"==typeof a?a.replace(" ","T"):a,aq=a=>{let b=new URL(a);return b.protocol=b.protocol.replace(/^ws/i,"http"),b.pathname=b.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),""===b.pathname||"/"===b.pathname?b.pathname="/api/broadcast":b.pathname=b.pathname+"/api/broadcast",b.href};class ar{constructor(a,b,c={},d=1e4){this.channel=a,this.event=b,this.payload=c,this.timeout=d,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(a){this.timeout=a,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(a){this.payload=Object.assign(Object.assign({},this.payload),a)}receive(a,b){var c;return this._hasReceived(a)&&b(null==(c=this.receivedResp)?void 0:c.response),this.recHooks.push({status:a,callback:b}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);let a=a=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=a,this._matchReceive(a)};this.channel._on(this.refEvent,{},a),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(a,b){this.refEvent&&this.channel._trigger(this.refEvent,{status:a,response:b})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:a,response:b}){this.recHooks.filter(b=>b.status===a).forEach(a=>a.callback(b))}_hasReceived(a){return this.receivedResp&&this.receivedResp.status===a}}(i=t||(t={})).SYNC="sync",i.JOIN="join",i.LEAVE="leave";class as{constructor(a,b){this.channel=a,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const c=(null==b?void 0:b.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(c.state,{},a=>{let{onJoin:b,onLeave:c,onSync:d}=this.caller;this.joinRef=this.channel._joinRef(),this.state=as.syncState(this.state,a,b,c),this.pendingDiffs.forEach(a=>{this.state=as.syncDiff(this.state,a,b,c)}),this.pendingDiffs=[],d()}),this.channel._on(c.diff,{},a=>{let{onJoin:b,onLeave:c,onSync:d}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(a):(this.state=as.syncDiff(this.state,a,b,c),d())}),this.onJoin((a,b,c)=>{this.channel._trigger("presence",{event:"join",key:a,currentPresences:b,newPresences:c})}),this.onLeave((a,b,c)=>{this.channel._trigger("presence",{event:"leave",key:a,currentPresences:b,leftPresences:c})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(a,b,c,d){let e=this.cloneDeep(a),f=this.transformState(b),g={},h={};return this.map(e,(a,b)=>{f[a]||(h[a]=b)}),this.map(f,(a,b)=>{let c=e[a];if(c){let d=b.map(a=>a.presence_ref),e=c.map(a=>a.presence_ref),f=b.filter(a=>0>e.indexOf(a.presence_ref)),i=c.filter(a=>0>d.indexOf(a.presence_ref));f.length>0&&(g[a]=f),i.length>0&&(h[a]=i)}else g[a]=b}),this.syncDiff(e,{joins:g,leaves:h},c,d)}static syncDiff(a,b,c,d){let{joins:e,leaves:f}={joins:this.transformState(b.joins),leaves:this.transformState(b.leaves)};return c||(c=()=>{}),d||(d=()=>{}),this.map(e,(b,d)=>{var e;let f=null!=(e=a[b])?e:[];if(a[b]=this.cloneDeep(d),f.length>0){let c=a[b].map(a=>a.presence_ref),d=f.filter(a=>0>c.indexOf(a.presence_ref));a[b].unshift(...d)}c(b,f,d)}),this.map(f,(b,c)=>{let e=a[b];if(!e)return;let f=c.map(a=>a.presence_ref);e=e.filter(a=>0>f.indexOf(a.presence_ref)),a[b]=e,d(b,e,c),0===e.length&&delete a[b]}),a}static map(a,b){return Object.getOwnPropertyNames(a).map(c=>b(c,a[c]))}static transformState(a){return Object.getOwnPropertyNames(a=this.cloneDeep(a)).reduce((b,c)=>{let d=a[c];return"metas"in d?b[c]=d.metas.map(a=>(a.presence_ref=a.phx_ref,delete a.phx_ref,delete a.phx_ref_prev,a)):b[c]=d,b},{})}static cloneDeep(a){return JSON.parse(JSON.stringify(a))}onJoin(a){this.caller.onJoin=a}onLeave(a){this.caller.onLeave=a}onSync(a){this.caller.onSync=a}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}(j=u||(u={})).ALL="*",j.INSERT="INSERT",j.UPDATE="UPDATE",j.DELETE="DELETE",(k=v||(v={})).BROADCAST="broadcast",k.PRESENCE="presence",k.POSTGRES_CHANGES="postgres_changes",k.SYSTEM="system",(l=w||(w={})).SUBSCRIBED="SUBSCRIBED",l.TIMED_OUT="TIMED_OUT",l.CLOSED="CLOSED",l.CHANNEL_ERROR="CHANNEL_ERROR";class at{constructor(a,b={config:{}},c){var d,e;if(this.topic=a,this.params=b,this.socket=c,this.bindings={},this.state=o.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=a.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},b.config),this.timeout=this.socket.timeout,this.joinPush=new ar(this,p.join,this.params,this.timeout),this.rejoinTimer=new ag(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=o.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(a=>a.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=o.closed,this.socket._remove(this)}),this._onError(a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=o.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=o.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=o.errored,this.rejoinTimer.scheduleTimeout())}),this._on(p.reply,{},(a,b)=>{this._trigger(this._replyEventName(b),a)}),this.presence=new as(this),this.broadcastEndpointURL=aq(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(null==(e=null==(d=this.params.config)?void 0:d.broadcast)?void 0:e.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(a,b=this.timeout){var c,d,e;if(this.socket.isConnected()||this.socket.connect(),this.state==o.closed){let{config:{broadcast:f,presence:g,private:h}}=this.params,i=null!=(d=null==(c=this.bindings.postgres_changes)?void 0:c.map(a=>a.filter))?d:[],j=!!this.bindings[v.PRESENCE]&&this.bindings[v.PRESENCE].length>0||(null==(e=this.params.config.presence)?void 0:e.enabled)===!0,k={},l={broadcast:f,presence:Object.assign(Object.assign({},g),{enabled:j}),postgres_changes:i,private:h};this.socket.accessTokenValue&&(k.access_token=this.socket.accessTokenValue),this._onError(b=>null==a?void 0:a(w.CHANNEL_ERROR,b)),this._onClose(()=>null==a?void 0:a(w.CLOSED)),this.updateJoinPayload(Object.assign({config:l},k)),this.joinedOnce=!0,this._rejoin(b),this.joinPush.receive("ok",async({postgres_changes:b})=>{var c;if(this.socket._isManualToken()||this.socket.setAuth(),void 0===b){null==a||a(w.SUBSCRIBED);return}{let d=this.bindings.postgres_changes,e=null!=(c=null==d?void 0:d.length)?c:0,f=[];for(let c=0;c<e;c++){let e=d[c],{filter:{event:g,schema:h,table:i,filter:j}}=e,k=b&&b[c];if(k&&k.event===g&&at.isFilterValueEqual(k.schema,h)&&at.isFilterValueEqual(k.table,i)&&at.isFilterValueEqual(k.filter,j))f.push(Object.assign(Object.assign({},e),{id:k.id}));else{this.unsubscribe(),this.state=o.errored,null==a||a(w.CHANNEL_ERROR,Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=f,a&&a(w.SUBSCRIBED);return}}).receive("error",b=>{this.state=o.errored,null==a||a(w.CHANNEL_ERROR,Error(JSON.stringify(Object.values(b).join(", ")||"error")))}).receive("timeout",()=>{null==a||a(w.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(a,b={}){return await this.send({type:"presence",event:"track",payload:a},b.timeout||this.timeout)}async untrack(a={}){return await this.send({type:"presence",event:"untrack"},a)}on(a,b,c){return this.state===o.joined&&a===v.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(a,b,c)}async httpSend(a,b,c={}){var d;if(null==b)return Promise.reject("Payload is required for httpSend()");let e={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(e.Authorization=`Bearer ${this.socket.accessTokenValue}`);let f={method:"POST",headers:e,body:JSON.stringify({messages:[{topic:this.subTopic,event:a,payload:b,private:this.private}]})},g=await this._fetchWithTimeout(this.broadcastEndpointURL,f,null!=(d=c.timeout)?d:this.timeout);if(202===g.status)return{success:!0};let h=g.statusText;try{let a=await g.json();h=a.error||a.message||h}catch(a){}return Promise.reject(Error(h))}async send(a,b={}){var c,d;if(this._canPush()||"broadcast"!==a.type)return new Promise(c=>{var d,e,f;let g=this._push(a.type,a,b.timeout||this.timeout);"broadcast"!==a.type||(null==(f=null==(e=null==(d=this.params)?void 0:d.config)?void 0:e.broadcast)?void 0:f.ack)||c("ok"),g.receive("ok",()=>c("ok")),g.receive("error",()=>c("error")),g.receive("timeout",()=>c("timed out"))});{console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");let{event:e,payload:f}=a,g={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(g.Authorization=`Bearer ${this.socket.accessTokenValue}`);let h={method:"POST",headers:g,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:f,private:this.private}]})};try{let a=await this._fetchWithTimeout(this.broadcastEndpointURL,h,null!=(c=b.timeout)?c:this.timeout);return await (null==(d=a.body)?void 0:d.cancel()),a.ok?"ok":"error"}catch(a){if("AbortError"===a.name)return"timed out";return"error"}}}updateJoinPayload(a){this.joinPush.updatePayload(a)}unsubscribe(a=this.timeout){this.state=o.leaving;let b=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(p.close,"leave",this._joinRef())};this.joinPush.destroy();let c=null;return new Promise(d=>{(c=new ar(this,p.leave,{},a)).receive("ok",()=>{b(),d("ok")}).receive("timeout",()=>{b(),d("timed out")}).receive("error",()=>{d("error")}),c.send(),this._canPush()||c.trigger("ok",{})}).finally(()=>{null==c||c.destroy()})}teardown(){this.pushBuffer.forEach(a=>a.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=o.closed,this.bindings={}}async _fetchWithTimeout(a,b,c){let d=new AbortController,e=setTimeout(()=>d.abort(),c),f=await this.socket.fetch(a,Object.assign(Object.assign({},b),{signal:d.signal}));return clearTimeout(e),f}_push(a,b,c=this.timeout){if(!this.joinedOnce)throw`tried to push '${a}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let d=new ar(this,a,b,c);return this._canPush()?d.send():this._addToPushBuffer(d),d}_addToPushBuffer(a){if(a.startTimeout(),this.pushBuffer.push(a),this.pushBuffer.length>100){let a=this.pushBuffer.shift();a&&(a.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${a.event}`,a.payload))}}_onMessage(a,b,c){return b}_isMember(a){return this.topic===a}_joinRef(){return this.joinPush.ref}_trigger(a,b,c){var d,e;let f=a.toLocaleLowerCase(),{close:g,error:h,leave:i,join:j}=p;if(c&&[g,h,i,j].indexOf(f)>=0&&c!==this._joinRef())return;let k=this._onMessage(f,b,c);if(b&&!k)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(f)?null==(d=this.bindings.postgres_changes)||d.filter(a=>{var b,c,d;return(null==(b=a.filter)?void 0:b.event)==="*"||(null==(d=null==(c=a.filter)?void 0:c.event)?void 0:d.toLocaleLowerCase())===f}).map(a=>a.callback(k,c)):null==(e=this.bindings[f])||e.filter(a=>{var c,d,e,g,h,i;if(!["broadcast","presence","postgres_changes"].includes(f))return a.type.toLocaleLowerCase()===f;if("id"in a){let f=a.id,g=null==(c=a.filter)?void 0:c.event;return f&&(null==(d=b.ids)?void 0:d.includes(f))&&("*"===g||(null==g?void 0:g.toLocaleLowerCase())===(null==(e=b.data)?void 0:e.type.toLocaleLowerCase()))}{let c=null==(h=null==(g=null==a?void 0:a.filter)?void 0:g.event)?void 0:h.toLocaleLowerCase();return"*"===c||c===(null==(i=null==b?void 0:b.event)?void 0:i.toLocaleLowerCase())}}).map(a=>{if("object"==typeof k&&"ids"in k){let a=k.data,{schema:b,table:c,commit_timestamp:d,type:e,errors:f}=a;k=Object.assign(Object.assign({},{schema:b,table:c,commit_timestamp:d,eventType:e,new:{},old:{},errors:f}),this._getPayloadRecords(a))}a.callback(k,c)})}_isClosed(){return this.state===o.closed}_isJoined(){return this.state===o.joined}_isJoining(){return this.state===o.joining}_isLeaving(){return this.state===o.leaving}_replyEventName(a){return`chan_reply_${a}`}_on(a,b,c){let d=a.toLocaleLowerCase(),e={type:d,filter:b,callback:c};return this.bindings[d]?this.bindings[d].push(e):this.bindings[d]=[e],this}_off(a,b){let c=a.toLocaleLowerCase();return this.bindings[c]&&(this.bindings[c]=this.bindings[c].filter(a=>{var d;return!((null==(d=a.type)?void 0:d.toLocaleLowerCase())===c&&at.isEqual(a.filter,b))})),this}static isEqual(a,b){if(Object.keys(a).length!==Object.keys(b).length)return!1;for(let c in a)if(a[c]!==b[c])return!1;return!0}static isFilterValueEqual(a,b){return(null!=a?a:void 0)===(null!=b?b:void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(a){this._on(p.close,{},a)}_onError(a){this._on(p.error,{},b=>a(b))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(a=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=o.joining,this.joinPush.resend(a))}_getPayloadRecords(a){let b={new:{},old:{}};return("INSERT"===a.type||"UPDATE"===a.type)&&(b.new=ah(a.columns,a.record)),("UPDATE"===a.type||"DELETE"===a.type)&&(b.old=ah(a.columns,a.old_record)),b}}let au=()=>{},av=[1e3,2e3,5e3,1e4],aw=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class ax{constructor(a,b){var c;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=1e4,this.transport=null,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=au,this.ref=0,this.reconnectTimer=null,this.vsn=ae,this.logger=au,this.conn=null,this.sendBuffer=[],this.serializer=new af,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=a=>a?(...b)=>a(...b):(...a)=>fetch(...a),!(null==(c=null==b?void 0:b.params)?void 0:c.apikey))throw Error("API key is required to connect to Realtime");this.apiKey=b.params.apikey,this.endPoint=`${a}/${q.websocket}`,this.httpEndpoint=aq(a),this._initializeOptions(b),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null==b?void 0:b.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=ad.createWebSocket(this.endpointURL())}catch(b){this._setConnectionState("disconnected");let a=b.message;if(a.includes("Node.js"))throw Error(`${a}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`);throw Error(`WebSocket not available: ${a}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(a,b){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){let c=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(c),this._setConnectionState("disconnected")},"function"==typeof this.conn.close&&(a?this.conn.close(a,null!=b?b:""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(a){let b=await a.unsubscribe();return 0===this.channels.length&&this.disconnect(),b}async removeAllChannels(){let a=await Promise.all(this.channels.map(a=>a.unsubscribe()));return this.channels=[],this.disconnect(),a}log(a,b,c){this.logger(a,b,c)}connectionState(){switch(this.conn&&this.conn.readyState){case n.connecting:return r.Connecting;case n.open:return r.Open;case n.closing:return r.Closing;default:return r.Closed}}isConnected(){return this.connectionState()===r.Open}isConnecting(){return"connecting"===this._connectionState}isDisconnecting(){return"disconnecting"===this._connectionState}channel(a,b={config:{}}){let c=`realtime:${a}`,d=this.getChannels().find(a=>a.topic===c);if(d)return d;{let c=new at(`realtime:${a}`,b,this);return this.channels.push(c),c}}push(a){let{topic:b,event:c,payload:d,ref:e}=a,f=()=>{this.encode(a,a=>{var b;null==(b=this.conn)||b.send(a)})};this.log("push",`${b} ${c} (${e})`,d),this.isConnected()?f():this.sendBuffer.push(f)}async setAuth(a=null){this._authPromise=this._performAuth(a);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var a;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(a){this.log("error","error in heartbeat callback",a)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(a){this.log("error","error in heartbeat callback",a)}this._wasManualDisconnect=!1,null==(a=this.conn)||a.close(1e3,"heartbeat timeout"),setTimeout(()=>{var a;this.isConnected()||null==(a=this.reconnectTimer)||a.scheduleTimeout()},100);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(a){this.log("error","error in heartbeat callback",a)}this._setAuthSafely("heartbeat")}onHeartbeat(a){this.heartbeatCallback=a}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(a=>a()),this.sendBuffer=[])}_makeRef(){let a=this.ref+1;return a===this.ref?this.ref=0:this.ref=a,this.ref.toString()}_leaveOpenTopic(a){let b=this.channels.find(b=>b.topic===a&&(b._isJoined()||b._isJoining()));b&&(this.log("transport",`leaving duplicate topic "${a}"`),b.unsubscribe())}_remove(a){this.channels=this.channels.filter(b=>b.topic!==a.topic)}_onConnMessage(a){this.decode(a.data,a=>{if("phoenix"===a.topic&&"phx_reply"===a.event)try{this.heartbeatCallback("ok"===a.payload.status?"ok":"error")}catch(a){this.log("error","error in heartbeat callback",a)}a.ref&&a.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);let{topic:b,event:c,payload:d,ref:e}=a,f=e?`(${e})`:"",g=d.status||"";this.log("receive",`${g} ${b} ${c} ${f}`.trim(),d),this.channels.filter(a=>a._isMember(b)).forEach(a=>a._trigger(c,d,e)),this._triggerStateCallbacks("message",a)})}_clearTimer(a){var b;"heartbeat"===a&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===a&&(null==(b=this.reconnectTimer)||b.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=a=>this._onConnError(a),this.conn.onmessage=a=>this._onConnMessage(a),this.conn.onclose=a=>this._onConnClose(a),this.conn.readyState===n.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===n.open||this.conn.readyState===n.connecting)try{this.conn.close()}catch(a){this.log("error","Error closing connection",a)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(a=>a.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(a=>{this.log("error","error waiting for auth on connect",a),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");let a=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(a),this.workerRef.onerror=a=>{this.log("worker","worker error",a.message),this._terminateWorker()},this.workerRef.onmessage=a=>{"keepAlive"===a.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(a){var b;this._setConnectionState("disconnected"),this.log("transport","close",a),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||null==(b=this.reconnectTimer)||b.scheduleTimeout(),this._triggerStateCallbacks("close",a)}_onConnError(a){this._setConnectionState("disconnected"),this.log("transport",`${a}`),this._triggerChanError(),this._triggerStateCallbacks("error",a)}_triggerChanError(){this.channels.forEach(a=>a._trigger(p.error))}_appendParams(a,b){if(0===Object.keys(b).length)return a;let c=a.match(/\?/)?"&":"?",d=new URLSearchParams(b);return`${a}${c}${d}`}_workerObjectUrl(a){let b;if(a)b=a;else{let a=new Blob([aw],{type:"application/javascript"});b=URL.createObjectURL(a)}return b}_setConnectionState(a,b=!1){this._connectionState=a,"connecting"===a?this._wasManualDisconnect=!1:"disconnecting"===a&&(this._wasManualDisconnect=b)}async _performAuth(a=null){let b,c=!1;if(a)b=a,c=!0;else if(this.accessToken)try{b=await this.accessToken()}catch(a){this.log("error","Error fetching access token from callback",a),b=this.accessTokenValue}else b=this.accessTokenValue;c?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=b&&(this.accessTokenValue=b,this.channels.forEach(a=>{let c={access_token:b,version:"realtime-js/2.89.0"};b&&a.updateJoinPayload(c),a.joinedOnce&&a._isJoined()&&a._push(p.access_token,{access_token:b})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(a="general"){this._isManualToken()||this.setAuth().catch(b=>{this.log("error",`Error setting auth in ${a}`,b)})}_triggerStateCallbacks(a,b){try{this.stateChangeCallbacks[a].forEach(c=>{try{c(b)}catch(b){this.log("error",`error in ${a} callback`,b)}})}catch(b){this.log("error",`error triggering ${a} callbacks`,b)}}_setupReconnectionTimer(){this.reconnectTimer=new ag(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},10)},this.reconnectAfterMs)}_initializeOptions(a){var b,c,d,e,f,g,h,i,j,k,l,m;switch(this.transport=null!=(b=null==a?void 0:a.transport)?b:null,this.timeout=null!=(c=null==a?void 0:a.timeout)?c:1e4,this.heartbeatIntervalMs=null!=(d=null==a?void 0:a.heartbeatIntervalMs)?d:25e3,this.worker=null!=(e=null==a?void 0:a.worker)&&e,this.accessToken=null!=(f=null==a?void 0:a.accessToken)?f:null,this.heartbeatCallback=null!=(g=null==a?void 0:a.heartbeatCallback)?g:au,this.vsn=null!=(h=null==a?void 0:a.vsn)?h:ae,(null==a?void 0:a.params)&&(this.params=a.params),(null==a?void 0:a.logger)&&(this.logger=a.logger),((null==a?void 0:a.logLevel)||(null==a?void 0:a.log_level))&&(this.logLevel=a.logLevel||a.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!=(i=null==a?void 0:a.reconnectAfterMs)?i:a=>av[a-1]||1e4,this.vsn){case ae:this.encode=null!=(j=null==a?void 0:a.encode)?j:(a,b)=>b(JSON.stringify(a)),this.decode=null!=(k=null==a?void 0:a.decode)?k:(a,b)=>b(JSON.parse(a));break;case"2.0.0":this.encode=null!=(l=null==a?void 0:a.encode)?l:this.serializer.encode.bind(this.serializer),this.decode=null!=(m=null==a?void 0:a.decode)?m:this.serializer.decode.bind(this.serializer);break;default:throw Error(`Unsupported serializer version: ${this.vsn}`)}this.worker&&(this.workerUrl=null==a?void 0:a.workerUrl)}}var ay=class extends Error{constructor(a,b){super(a),this.name="IcebergError",this.status=b.status,this.icebergType=b.icebergType,this.icebergCode=b.icebergCode,this.details=b.details,this.isCommitStateUnknown="CommitStateUnknownException"===b.icebergType||[500,502,504].includes(b.status)&&b.icebergType?.includes("CommitState")===!0}isNotFound(){return 404===this.status}isConflict(){return 409===this.status}isAuthenticationTimeout(){return 419===this.status}};async function az(a){return a&&"none"!==a.type?"bearer"===a.type?{Authorization:`Bearer ${a.token}`}:"header"===a.type?{[a.name]:a.value}:"custom"===a.type?await a.getHeaders():{}:{}}function aA(a){return a.join("\x1f")}var aB=class{constructor(a,b=""){this.client=a,this.prefix=b}async listNamespaces(a){let b=a?{parent:aA(a.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:b})).data.namespaces.map(a=>({namespace:a}))}async createNamespace(a,b){let c={namespace:a.namespace,properties:b?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:c})).data}async dropNamespace(a){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${aA(a.namespace)}`})}async loadNamespaceMetadata(a){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${aA(a.namespace)}`})).data.properties}}async namespaceExists(a){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${aA(a.namespace)}`}),!0}catch(a){if(a instanceof ay&&404===a.status)return!1;throw a}}async createNamespaceIfNotExists(a,b){try{return await this.createNamespace(a,b)}catch(a){if(a instanceof ay&&409===a.status)return;throw a}}};function aC(a){return a.join("\x1f")}var aD=class{constructor(a,b="",c){this.client=a,this.prefix=b,this.accessDelegation=c}async listTables(a){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${aC(a.namespace)}/tables`})).data.identifiers}async createTable(a,b){let c={};return this.accessDelegation&&(c["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${aC(a.namespace)}/tables`,body:b,headers:c})).data.metadata}async updateTable(a,b){let c=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${aC(a.namespace)}/tables/${a.name}`,body:b});return{"metadata-location":c.data["metadata-location"],metadata:c.data.metadata}}async dropTable(a,b){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${aC(a.namespace)}/tables/${a.name}`,query:{purgeRequested:String(b?.purge??!1)}})}async loadTable(a){let b={};return this.accessDelegation&&(b["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${aC(a.namespace)}/tables/${a.name}`,headers:b})).data.metadata}async tableExists(a){let b={};this.accessDelegation&&(b["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${aC(a.namespace)}/tables/${a.name}`,headers:b}),!0}catch(a){if(a instanceof ay&&404===a.status)return!1;throw a}}async createTableIfNotExists(a,b){try{return await this.createTable(a,b)}catch(c){if(c instanceof ay&&409===c.status)return await this.loadTable({namespace:a.namespace,name:b.name});throw c}}},aE=class{constructor(a){let b="v1";a.catalogName&&(b+=`/${a.catalogName}`);const c=a.baseUrl.endsWith("/")?a.baseUrl:`${a.baseUrl}/`;this.client=function(a){let b=a.fetchImpl??globalThis.fetch;return{async request({method:c,path:d,query:e,body:f,headers:g}){let h=function(a,b,c){let d=new URL(b,a);if(c)for(let[a,b]of Object.entries(c))void 0!==b&&d.searchParams.set(a,b);return d.toString()}(a.baseUrl,d,e),i=await az(a.auth),j=await b(h,{method:c,headers:{...f?{"Content-Type":"application/json"}:{},...i,...g},body:f?JSON.stringify(f):void 0}),k=await j.text(),l=(j.headers.get("content-type")||"").includes("application/json"),m=l&&k?JSON.parse(k):k;if(!j.ok){let a=l?m:void 0,b=a?.error;throw new ay(b?.message??`Request failed with status ${j.status}`,{status:j.status,icebergType:b?.type,icebergCode:b?.code,details:a})}return{status:j.status,headers:j.headers,data:m}}}}({baseUrl:c,auth:a.auth,fetchImpl:a.fetch}),this.accessDelegation=a.accessDelegation?.join(","),this.namespaceOps=new aB(this.client,b),this.tableOps=new aD(this.client,b,this.accessDelegation)}async listNamespaces(a){return this.namespaceOps.listNamespaces(a)}async createNamespace(a,b){return this.namespaceOps.createNamespace(a,b)}async dropNamespace(a){await this.namespaceOps.dropNamespace(a)}async loadNamespaceMetadata(a){return this.namespaceOps.loadNamespaceMetadata(a)}async listTables(a){return this.tableOps.listTables(a)}async createTable(a,b){return this.tableOps.createTable(a,b)}async updateTable(a,b){return this.tableOps.updateTable(a,b)}async dropTable(a,b){await this.tableOps.dropTable(a,b)}async loadTable(a){return this.tableOps.loadTable(a)}async namespaceExists(a){return this.namespaceOps.namespaceExists(a)}async tableExists(a){return this.tableOps.tableExists(a)}async createNamespaceIfNotExists(a,b){return this.namespaceOps.createNamespaceIfNotExists(a,b)}async createTableIfNotExists(a,b){return this.tableOps.createTableIfNotExists(a,b)}},aF=class extends Error{constructor(a){super(a),this.__isStorageError=!0,this.name="StorageError"}};function aG(a){return"object"==typeof a&&null!==a&&"__isStorageError"in a}var aH=class extends aF{constructor(a,b,c){super(a),this.name="StorageApiError",this.status=b,this.statusCode=c}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},aI=class extends aF{constructor(a,b){super(a),this.name="StorageUnknownError",this.originalError=b}};let aJ=a=>a?(...b)=>a(...b):(...a)=>fetch(...a),aK=a=>{if(Array.isArray(a))return a.map(a=>aK(a));if("function"==typeof a||a!==Object(a))return a;let b={};return Object.entries(a).forEach(([a,c])=>{b[a.replace(/([-_][a-z])/gi,a=>a.toUpperCase().replace(/[-_]/g,""))]=aK(c)}),b};function aL(a){return(aL="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(a)}function aM(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function aN(a){for(var b=1;b<arguments.length;b++){var c=null!=arguments[b]?arguments[b]:{};b%2?aM(Object(c),!0).forEach(function(b){!function(a,b,c){var d;(d=function(a,b){if("object"!=aL(a)||!a)return a;var c=a[Symbol.toPrimitive];if(void 0!==c){var d=c.call(a,b||"default");if("object"!=aL(d))return d;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===b?String:Number)(a)}(b,"string"),(b="symbol"==aL(d)?d:d+"")in a)?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c}(a,b,c[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(c)):aM(Object(c)).forEach(function(b){Object.defineProperty(a,b,Object.getOwnPropertyDescriptor(c,b))})}return a}let aO=a=>{var b;return a.msg||a.message||a.error_description||("string"==typeof a.error?a.error:null==(b=a.error)?void 0:b.message)||JSON.stringify(a)},aP=async(a,b,c)=>{a instanceof await Response&&!(null==c?void 0:c.noResolveJson)?a.json().then(c=>{let d=a.status||500,e=(null==c?void 0:c.statusCode)||d+"";b(new aH(aO(c),d,e))}).catch(a=>{b(new aI(aO(a),a))}):b(new aI(aO(a),a))};async function aQ(a,b,c,d,e,f){return new Promise((g,h)=>{let i;a(c,(i={method:b,headers:(null==d?void 0:d.headers)||{}},"GET"===b||!f?i:((a=>{if("object"!=typeof a||null===a)return!1;let b=Object.getPrototypeOf(a);return(null===b||b===Object.prototype||null===Object.getPrototypeOf(b))&&!(Symbol.toStringTag in a)&&!(Symbol.iterator in a)})(f)?(i.headers=aN({"Content-Type":"application/json"},null==d?void 0:d.headers),i.body=JSON.stringify(f)):i.body=f,(null==d?void 0:d.duplex)&&(i.duplex=d.duplex),aN(aN({},i),e)))).then(a=>{if(!a.ok)throw a;return(null==d?void 0:d.noResolveJson)?a:a.json()}).then(a=>g(a)).catch(a=>aP(a,h,d))})}async function aR(a,b,c,d){return aQ(a,"GET",b,c,d)}async function aS(a,b,c,d,e){return aQ(a,"POST",b,d,e,c)}async function aT(a,b,c,d,e){return aQ(a,"PUT",b,d,e,c)}async function aU(a,b,c,d){return aQ(a,"HEAD",b,aN(aN({},c),{},{noResolveJson:!0}),d)}async function aV(a,b,c,d,e){return aQ(a,"DELETE",b,d,e,c)}var aW=class{constructor(a,b){this.downloadFn=a,this.shouldThrowOnError=b}then(a,b){return this.execute().then(a,b)}async execute(){try{return{data:(await this.downloadFn()).body,error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(aG(a))return{data:null,error:a};throw a}}};b=Symbol.toStringTag;var aX=class{constructor(a,c){this.downloadFn=a,this.shouldThrowOnError=c,this[b]="BlobDownloadBuilder",this.promise=null}asStream(){return new aW(this.downloadFn,this.shouldThrowOnError)}then(a,b){return this.getPromise().then(a,b)}catch(a){return this.getPromise().catch(a)}finally(a){return this.getPromise().finally(a)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){try{return{data:await (await this.downloadFn()).blob(),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(aG(a))return{data:null,error:a};throw a}}};let aY={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},aZ={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var a$=class{constructor(a,b={},c,d){this.shouldThrowOnError=!1,this.url=a,this.headers=b,this.bucketId=c,this.fetch=aJ(d)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(a,b,c,d){try{let e,f=aN(aN({},aZ),d),g=aN(aN({},this.headers),"POST"===a&&{"x-upsert":String(f.upsert)}),h=f.metadata;"undefined"!=typeof Blob&&c instanceof Blob?((e=new FormData).append("cacheControl",f.cacheControl),h&&e.append("metadata",this.encodeMetadata(h)),e.append("",c)):"undefined"!=typeof FormData&&c instanceof FormData?((e=c).has("cacheControl")||e.append("cacheControl",f.cacheControl),h&&!e.has("metadata")&&e.append("metadata",this.encodeMetadata(h))):(e=c,g["cache-control"]=`max-age=${f.cacheControl}`,g["content-type"]=f.contentType,h&&(g["x-metadata"]=this.toBase64(this.encodeMetadata(h))),("undefined"!=typeof ReadableStream&&e instanceof ReadableStream||e&&"object"==typeof e&&"pipe"in e&&"function"==typeof e.pipe)&&!f.duplex&&(f.duplex="half")),(null==d?void 0:d.headers)&&(g=aN(aN({},g),d.headers));let i=this._removeEmptyFolders(b),j=this._getFinalPath(i),k=await ("PUT"==a?aT:aS)(this.fetch,`${this.url}/object/${j}`,e,aN({headers:g},(null==f?void 0:f.duplex)?{duplex:f.duplex}:{}));return{data:{path:i,id:k.Id,fullPath:k.Key},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(aG(a))return{data:null,error:a};throw a}}async upload(a,b,c){return this.uploadOrUpdate("POST",a,b,c)}async uploadToSignedUrl(a,b,c,d){let e=this._removeEmptyFolders(a),f=this._getFinalPath(e),g=new URL(this.url+`/object/upload/sign/${f}`);g.searchParams.set("token",b);try{let a,b=aN({upsert:aZ.upsert},d),f=aN(aN({},this.headers),{"x-upsert":String(b.upsert)});return"undefined"!=typeof Blob&&c instanceof Blob?((a=new FormData).append("cacheControl",b.cacheControl),a.append("",c)):"undefined"!=typeof FormData&&c instanceof FormData?(a=c).append("cacheControl",b.cacheControl):(a=c,f["cache-control"]=`max-age=${b.cacheControl}`,f["content-type"]=b.contentType),{data:{path:e,fullPath:(await aT(this.fetch,g.toString(),a,{headers:f})).Key},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(aG(a))return{data:null,error:a};throw a}}async createSignedUploadUrl(a,b){try{let c=this._getFinalPath(a),d=aN({},this.headers);(null==b?void 0:b.upsert)&&(d["x-upsert"]="true");let e=await aS(this.fetch,`${this.url}/object/upload/sign/${c}`,{},{headers:d}),f=new URL(this.url+e.url),g=f.searchParams.get("token");if(!g)throw new aF("No token returned by API");return{data:{signedUrl:f.toString(),path:a,token:g},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(aG(a))return{data:null,error:a};throw a}}async update(a,b,c){return this.uploadOrUpdate("PUT",a,b,c)}async move(a,b,c){try{return{data:await aS(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:a,destinationKey:b,destinationBucket:null==c?void 0:c.destinationBucket},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(aG(a))return{data:null,error:a};throw a}}async copy(a,b,c){try{return{data:{path:(await aS(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:a,destinationKey:b,destinationBucket:null==c?void 0:c.destinationBucket},{headers:this.headers})).Key},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(aG(a))return{data:null,error:a};throw a}}async createSignedUrl(a,b,c){try{let d=this._getFinalPath(a),e=await aS(this.fetch,`${this.url}/object/sign/${d}`,aN({expiresIn:b},(null==c?void 0:c.transform)?{transform:c.transform}:{}),{headers:this.headers}),f=(null==c?void 0:c.download)?`&download=${!0===c.download?"":c.download}`:"";return{data:e={signedUrl:encodeURI(`${this.url}${e.signedURL}${f}`)},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(aG(a))return{data:null,error:a};throw a}}async createSignedUrls(a,b,c){var d=this;try{let e=await aS(d.fetch,`${d.url}/object/sign/${d.bucketId}`,{expiresIn:b,paths:a},{headers:d.headers}),f=(null==c?void 0:c.download)?`&download=${!0===c.download?"":c.download}`:"";return{data:e.map(a=>aN(aN({},a),{},{signedUrl:a.signedURL?encodeURI(`${d.url}${a.signedURL}${f}`):null})),error:null}}catch(a){if(d.shouldThrowOnError)throw a;if(aG(a))return{data:null,error:a};throw a}}download(a,b){let c=void 0!==(null==b?void 0:b.transform)?"render/image/authenticated":"object",d=this.transformOptsToQueryString((null==b?void 0:b.transform)||{}),e=d?`?${d}`:"",f=this._getFinalPath(a);return new aX(()=>aR(this.fetch,`${this.url}/${c}/${f}${e}`,{headers:this.headers,noResolveJson:!0}),this.shouldThrowOnError)}async info(a){let b=this._getFinalPath(a);try{return{data:aK(await aR(this.fetch,`${this.url}/object/info/${b}`,{headers:this.headers})),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(aG(a))return{data:null,error:a};throw a}}async exists(a){let b=this._getFinalPath(a);try{return await aU(this.fetch,`${this.url}/object/${b}`,{headers:this.headers}),{data:!0,error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(aG(a)&&a instanceof aI){let b=a.originalError;if([400,404].includes(null==b?void 0:b.status))return{data:!1,error:a}}throw a}}getPublicUrl(a,b){let c=this._getFinalPath(a),d=[],e=(null==b?void 0:b.download)?`download=${!0===b.download?"":b.download}`:"";""!==e&&d.push(e);let f=void 0!==(null==b?void 0:b.transform)?"render/image":"object",g=this.transformOptsToQueryString((null==b?void 0:b.transform)||{});""!==g&&d.push(g);let h=d.join("&");return""!==h&&(h=`?${h}`),{data:{publicUrl:encodeURI(`${this.url}/${f}/public/${c}${h}`)}}}async remove(a){try{return{data:await aV(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:a},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(aG(a))return{data:null,error:a};throw a}}async list(a,b,c){try{let d=aN(aN(aN({},aY),b),{},{prefix:a||""});return{data:await aS(this.fetch,`${this.url}/object/list/${this.bucketId}`,d,{headers:this.headers},c),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(aG(a))return{data:null,error:a};throw a}}async listV2(a,b){try{let c=aN({},a);return{data:await aS(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,c,{headers:this.headers},b),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(aG(a))return{data:null,error:a};throw a}}encodeMetadata(a){return JSON.stringify(a)}toBase64(a){return"undefined"!=typeof Buffer?Buffer.from(a).toString("base64"):btoa(a)}_getFinalPath(a){return`${this.bucketId}/${a.replace(/^\/+/,"")}`}_removeEmptyFolders(a){return a.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(a){let b=[];return a.width&&b.push(`width=${a.width}`),a.height&&b.push(`height=${a.height}`),a.resize&&b.push(`resize=${a.resize}`),a.format&&b.push(`format=${a.format}`),a.quality&&b.push(`quality=${a.quality}`),b.join("&")}};let a_="2.89.0",a0={"X-Client-Info":`storage-js/${a_}`};var a1=class{constructor(a,b={},c,d){this.shouldThrowOnError=!1;const e=new URL(a);(null==d?void 0:d.useNewHostname)&&/supabase\.(co|in|red)$/.test(e.hostname)&&!e.hostname.includes("storage.supabase.")&&(e.hostname=e.hostname.replace("supabase.","storage.supabase.")),this.url=e.href.replace(/\/$/,""),this.headers=aN(aN({},a0),b),this.fetch=aJ(c)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(a){try{let b=this.listBucketOptionsToQueryString(a);return{data:await aR(this.fetch,`${this.url}/bucket${b}`,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(aG(a))return{data:null,error:a};throw a}}async getBucket(a){try{return{data:await aR(this.fetch,`${this.url}/bucket/${a}`,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(aG(a))return{data:null,error:a};throw a}}async createBucket(a,b={public:!1}){try{return{data:await aS(this.fetch,`${this.url}/bucket`,{id:a,name:a,type:b.type,public:b.public,file_size_limit:b.fileSizeLimit,allowed_mime_types:b.allowedMimeTypes},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(aG(a))return{data:null,error:a};throw a}}async updateBucket(a,b){try{return{data:await aT(this.fetch,`${this.url}/bucket/${a}`,{id:a,name:a,public:b.public,file_size_limit:b.fileSizeLimit,allowed_mime_types:b.allowedMimeTypes},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(aG(a))return{data:null,error:a};throw a}}async emptyBucket(a){try{return{data:await aS(this.fetch,`${this.url}/bucket/${a}/empty`,{},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(aG(a))return{data:null,error:a};throw a}}async deleteBucket(a){try{return{data:await aV(this.fetch,`${this.url}/bucket/${a}`,{},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(aG(a))return{data:null,error:a};throw a}}listBucketOptionsToQueryString(a){let b={};return a&&("limit"in a&&(b.limit=String(a.limit)),"offset"in a&&(b.offset=String(a.offset)),a.search&&(b.search=a.search),a.sortColumn&&(b.sortColumn=a.sortColumn),a.sortOrder&&(b.sortOrder=a.sortOrder)),Object.keys(b).length>0?"?"+new URLSearchParams(b).toString():""}},a2=class{constructor(a,b={},c){this.shouldThrowOnError=!1,this.url=a.replace(/\/$/,""),this.headers=aN(aN({},a0),b),this.fetch=aJ(c)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(a){try{return{data:await aS(this.fetch,`${this.url}/bucket`,{name:a},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(aG(a))return{data:null,error:a};throw a}}async listBuckets(a){try{let b=new URLSearchParams;(null==a?void 0:a.limit)!==void 0&&b.set("limit",a.limit.toString()),(null==a?void 0:a.offset)!==void 0&&b.set("offset",a.offset.toString()),(null==a?void 0:a.sortColumn)&&b.set("sortColumn",a.sortColumn),(null==a?void 0:a.sortOrder)&&b.set("sortOrder",a.sortOrder),(null==a?void 0:a.search)&&b.set("search",a.search);let c=b.toString(),d=c?`${this.url}/bucket?${c}`:`${this.url}/bucket`;return{data:await aR(this.fetch,d,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(aG(a))return{data:null,error:a};throw a}}async deleteBucket(a){try{return{data:await aV(this.fetch,`${this.url}/bucket/${a}`,{},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(aG(a))return{data:null,error:a};throw a}}from(a){var b=this;if(!(!(!a||"string"!=typeof a||0===a.length||a.length>100||a.trim()!==a||a.includes("/")||a.includes("\\"))&&/^[\w!.\*'() &$@=;:+,?-]+$/.test(a)))throw new aF("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");let c=new aE({baseUrl:this.url,catalogName:a,auth:{type:"custom",getHeaders:async()=>b.headers},fetch:this.fetch}),d=this.shouldThrowOnError;return new Proxy(c,{get(a,b){let c=a[b];return"function"!=typeof c?c:async(...b)=>{try{return{data:await c.apply(a,b),error:null}}catch(a){if(d)throw a;return{data:null,error:a}}}}})}};let a3={"X-Client-Info":`storage-js/${a_}`,"Content-Type":"application/json"};var a4=class extends Error{constructor(a){super(a),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function a5(a){return"object"==typeof a&&null!==a&&"__isStorageVectorsError"in a}var a6=class extends a4{constructor(a,b,c){super(a),this.name="StorageVectorsApiError",this.status=b,this.statusCode=c}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},a7=class extends a4{constructor(a,b){super(a),this.name="StorageVectorsUnknownError",this.originalError=b}};let a8=a=>a?(...b)=>a(...b):(...a)=>fetch(...a),a9=a=>a.msg||a.message||a.error_description||a.error||JSON.stringify(a),ba=async(a,b,c)=>{if(a&&"object"==typeof a&&"status"in a&&"ok"in a&&"number"==typeof a.status&&!(null==c?void 0:c.noResolveJson)){let c=a.status||500;"function"==typeof a.json?a.json().then(a=>{let d=(null==a?void 0:a.statusCode)||(null==a?void 0:a.code)||c+"";b(new a6(a9(a),c,d))}).catch(()=>{b(new a6(a.statusText||`HTTP ${c} error`,c,c+""))}):b(new a6(a.statusText||`HTTP ${c} error`,c,c+""))}else b(new a7(a9(a),a))};async function bb(a,b,c,d,e,f){return new Promise((g,h)=>{let i;a(c,(i={method:b,headers:(null==d?void 0:d.headers)||{}},"GET"===b||!f?i:((a=>{if("object"!=typeof a||null===a)return!1;let b=Object.getPrototypeOf(a);return(null===b||b===Object.prototype||null===Object.getPrototypeOf(b))&&!(Symbol.toStringTag in a)&&!(Symbol.iterator in a)})(f)?(i.headers=aN({"Content-Type":"application/json"},null==d?void 0:d.headers),i.body=JSON.stringify(f)):i.body=f,aN(aN({},i),e)))).then(a=>{if(!a.ok)throw a;if(null==d?void 0:d.noResolveJson)return a;let b=a.headers.get("content-type");return b&&b.includes("application/json")?a.json():{}}).then(a=>g(a)).catch(a=>ba(a,h,d))})}async function bc(a,b,c,d,e){return bb(a,"POST",b,d,e,c)}var bd=class{constructor(a,b={},c){this.shouldThrowOnError=!1,this.url=a.replace(/\/$/,""),this.headers=aN(aN({},a3),b),this.fetch=a8(c)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(a){try{return{data:await bc(this.fetch,`${this.url}/CreateIndex`,a,{headers:this.headers})||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(a5(a))return{data:null,error:a};throw a}}async getIndex(a,b){try{return{data:await bc(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:a,indexName:b},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(a5(a))return{data:null,error:a};throw a}}async listIndexes(a){try{return{data:await bc(this.fetch,`${this.url}/ListIndexes`,a,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(a5(a))return{data:null,error:a};throw a}}async deleteIndex(a,b){try{return{data:await bc(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:a,indexName:b},{headers:this.headers})||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(a5(a))return{data:null,error:a};throw a}}},be=class{constructor(a,b={},c){this.shouldThrowOnError=!1,this.url=a.replace(/\/$/,""),this.headers=aN(aN({},a3),b),this.fetch=a8(c)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(a){try{if(a.vectors.length<1||a.vectors.length>500)throw Error("Vector batch size must be between 1 and 500 items");return{data:await bc(this.fetch,`${this.url}/PutVectors`,a,{headers:this.headers})||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(a5(a))return{data:null,error:a};throw a}}async getVectors(a){try{return{data:await bc(this.fetch,`${this.url}/GetVectors`,a,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(a5(a))return{data:null,error:a};throw a}}async listVectors(a){try{if(void 0!==a.segmentCount){if(a.segmentCount<1||a.segmentCount>16)throw Error("segmentCount must be between 1 and 16");if(void 0!==a.segmentIndex&&(a.segmentIndex<0||a.segmentIndex>=a.segmentCount))throw Error(`segmentIndex must be between 0 and ${a.segmentCount-1}`)}return{data:await bc(this.fetch,`${this.url}/ListVectors`,a,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(a5(a))return{data:null,error:a};throw a}}async queryVectors(a){try{return{data:await bc(this.fetch,`${this.url}/QueryVectors`,a,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(a5(a))return{data:null,error:a};throw a}}async deleteVectors(a){try{if(a.keys.length<1||a.keys.length>500)throw Error("Keys batch size must be between 1 and 500 items");return{data:await bc(this.fetch,`${this.url}/DeleteVectors`,a,{headers:this.headers})||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(a5(a))return{data:null,error:a};throw a}}},bf=class{constructor(a,b={},c){this.shouldThrowOnError=!1,this.url=a.replace(/\/$/,""),this.headers=aN(aN({},a3),b),this.fetch=a8(c)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(a){try{return{data:await bc(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:a},{headers:this.headers})||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(a5(a))return{data:null,error:a};throw a}}async getBucket(a){try{return{data:await bc(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:a},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(a5(a))return{data:null,error:a};throw a}}async listBuckets(a={}){try{return{data:await bc(this.fetch,`${this.url}/ListVectorBuckets`,a,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(a5(a))return{data:null,error:a};throw a}}async deleteBucket(a){try{return{data:await bc(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:a},{headers:this.headers})||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(a5(a))return{data:null,error:a};throw a}}},bg=class extends bf{constructor(a,b={}){super(a,b.headers||{},b.fetch)}from(a){return new bh(this.url,this.headers,a,this.fetch)}async createBucket(a){return super.createBucket.call(this,a)}async getBucket(a){return super.getBucket.call(this,a)}async listBuckets(a={}){return super.listBuckets.call(this,a)}async deleteBucket(a){return super.deleteBucket.call(this,a)}},bh=class extends bd{constructor(a,b,c,d){super(a,b,d),this.vectorBucketName=c}async createIndex(a){return super.createIndex.call(this,aN(aN({},a),{},{vectorBucketName:this.vectorBucketName}))}async listIndexes(a={}){return super.listIndexes.call(this,aN(aN({},a),{},{vectorBucketName:this.vectorBucketName}))}async getIndex(a){return super.getIndex.call(this,this.vectorBucketName,a)}async deleteIndex(a){return super.deleteIndex.call(this,this.vectorBucketName,a)}index(a){return new bi(this.url,this.headers,this.vectorBucketName,a,this.fetch)}},bi=class extends be{constructor(a,b,c,d,e){super(a,b,e),this.vectorBucketName=c,this.indexName=d}async putVectors(a){return super.putVectors.call(this,aN(aN({},a),{},{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))}async getVectors(a){return super.getVectors.call(this,aN(aN({},a),{},{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))}async listVectors(a={}){return super.listVectors.call(this,aN(aN({},a),{},{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))}async queryVectors(a){return super.queryVectors.call(this,aN(aN({},a),{},{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))}async deleteVectors(a){return super.deleteVectors.call(this,aN(aN({},a),{},{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))}},bj=class extends a1{constructor(a,b={},c,d){super(a,b,c,d)}from(a){return new a$(this.url,this.headers,a,this.fetch)}get vectors(){return new bg(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new a2(this.url+"/iceberg",this.headers,this.fetch)}};let bk="2.89.0",bl={"X-Client-Info":`gotrue-js/${bk}`},bm="X-Supabase-Api-Version",bn={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},bo=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class bp extends Error{constructor(a,b,c){super(a),this.__isAuthError=!0,this.name="AuthError",this.status=b,this.code=c}}function bq(a){return"object"==typeof a&&null!==a&&"__isAuthError"in a}class br extends bp{constructor(a,b,c){super(a,b,c),this.name="AuthApiError",this.status=b,this.code=c}}class bs extends bp{constructor(a,b){super(a),this.name="AuthUnknownError",this.originalError=b}}class bt extends bp{constructor(a,b,c,d){super(a,c,d),this.name=b,this.status=c}}class bu extends bt{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class bv extends bt{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class bw extends bt{constructor(a){super(a,"AuthInvalidCredentialsError",400,void 0)}}class bx extends bt{constructor(a,b=null){super(a,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=b}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class by extends bt{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class bz extends bt{constructor(a,b){super(a,"AuthRetryableFetchError",b,void 0)}}function bA(a){return bq(a)&&"AuthRetryableFetchError"===a.name}class bB extends bt{constructor(a,b,c){super(a,"AuthWeakPasswordError",b,"weak_password"),this.reasons=c}}class bC extends bt{constructor(a){super(a,"AuthInvalidJwtError",400,"invalid_jwt")}}let bD="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),bE=" 	\n\r=".split(""),bF=(()=>{let a=Array(128);for(let b=0;b<a.length;b+=1)a[b]=-1;for(let b=0;b<bE.length;b+=1)a[bE[b].charCodeAt(0)]=-2;for(let b=0;b<bD.length;b+=1)a[bD[b].charCodeAt(0)]=b;return a})();function bG(a,b,c){if(null!==a)for(b.queue=b.queue<<8|a,b.queuedBits+=8;b.queuedBits>=6;)c(bD[b.queue>>b.queuedBits-6&63]),b.queuedBits-=6;else if(b.queuedBits>0)for(b.queue=b.queue<<6-b.queuedBits,b.queuedBits=6;b.queuedBits>=6;)c(bD[b.queue>>b.queuedBits-6&63]),b.queuedBits-=6}function bH(a,b,c){let d=bF[a];if(d>-1)for(b.queue=b.queue<<6|d,b.queuedBits+=6;b.queuedBits>=8;)c(b.queue>>b.queuedBits-8&255),b.queuedBits-=8;else if(-2===d)return;else throw Error(`Invalid Base64-URL character "${String.fromCharCode(a)}"`)}function bI(a){let b=[],c=a=>{b.push(String.fromCodePoint(a))},d={utf8seq:0,codepoint:0},e={queue:0,queuedBits:0},f=a=>{!function(a,b,c){if(0===b.utf8seq){if(a<=127)return c(a);for(let c=1;c<6;c+=1)if((a>>7-c&1)==0){b.utf8seq=c;break}if(2===b.utf8seq)b.codepoint=31&a;else if(3===b.utf8seq)b.codepoint=15&a;else if(4===b.utf8seq)b.codepoint=7&a;else throw Error("Invalid UTF-8 sequence");b.utf8seq-=1}else if(b.utf8seq>0){if(a<=127)throw Error("Invalid UTF-8 sequence");b.codepoint=b.codepoint<<6|63&a,b.utf8seq-=1,0===b.utf8seq&&c(b.codepoint)}}(a,d,c)};for(let b=0;b<a.length;b+=1)bH(a.charCodeAt(b),e,f);return b.join("")}function bJ(a){let b=[],c={queue:0,queuedBits:0},d=a=>{b.push(a)};for(let b=0;b<a.length;b+=1)bH(a.charCodeAt(b),c,d);return new Uint8Array(b)}function bK(a){let b=[],c={queue:0,queuedBits:0},d=a=>{b.push(a)};return a.forEach(a=>bG(a,c,d)),bG(null,c,d),b.join("")}let bL=a=>a?(...b)=>a(...b):(...a)=>fetch(...a),bM=async(a,b,c)=>{await a.setItem(b,JSON.stringify(c))},bN=async(a,b)=>{let c=await a.getItem(b);if(!c)return null;try{return JSON.parse(c)}catch(a){return c}},bO=async(a,b)=>{await a.removeItem(b)};class bP{constructor(){this.promise=new bP.promiseConstructor((a,b)=>{this.resolve=a,this.reject=b})}}function bQ(a){let b=a.split(".");if(3!==b.length)throw new bC("Invalid JWT structure");for(let a=0;a<b.length;a++)if(!bo.test(b[a]))throw new bC("JWT not in base64url format");return{header:JSON.parse(bI(b[0])),payload:JSON.parse(bI(b[1])),signature:bJ(b[2]),raw:{header:b[0],payload:b[1]}}}async function bR(a){return await new Promise(b=>{setTimeout(()=>b(null),a)})}function bS(a){return("0"+a.toString(16)).substr(-2)}async function bT(a){let b=new TextEncoder().encode(a);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",b))).map(a=>String.fromCharCode(a)).join("")}async function bU(a){return"undefined"==typeof crypto||void 0===crypto.subtle||"undefined"==typeof TextEncoder?(console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),a):btoa(await bT(a)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function bV(a,b,c=!1){let d=function(){let a=new Uint32Array(56);if("undefined"==typeof crypto){let a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",b=a.length,c="";for(let d=0;d<56;d++)c+=a.charAt(Math.floor(Math.random()*b));return c}return crypto.getRandomValues(a),Array.from(a,bS).join("")}(),e=d;c&&(e+="/PASSWORD_RECOVERY"),await bM(a,`${b}-code-verifier`,e);let f=await bU(d),g=d===f?"plain":"s256";return[f,g]}bP.promiseConstructor=Promise;let bW=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i,bX=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function bY(a){if(!bX.test(a))throw Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function bZ(){return new Proxy({},{get:(a,b)=>{if("__isUserNotAvailableProxy"===b)return!0;if("symbol"==typeof b){let a=b.toString();if("Symbol(Symbol.toPrimitive)"===a||"Symbol(Symbol.toStringTag)"===a||"Symbol(util.inspect.custom)"===a)return}throw Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${b}" property of the session object is not supported. Please use getUser() instead.`)},set:(a,b)=>{throw Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${b}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(a,b)=>{throw Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${b}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function b$(a){return JSON.parse(JSON.stringify(a))}let b_=a=>a.msg||a.message||a.error_description||a.error||JSON.stringify(a),b0=[502,503,504];async function b1(a){var b;let c,d;if(!("object"==typeof a&&null!==a&&"status"in a&&"ok"in a&&"json"in a&&"function"==typeof a.json))throw new bz(b_(a),0);if(b0.includes(a.status))throw new bz(b_(a),a.status);try{c=await a.json()}catch(a){throw new bs(b_(a),a)}let e=function(a){let b=a.headers.get(bm);if(!b||!b.match(bW))return null;try{return new Date(`${b}T00:00:00.0Z`)}catch(a){return null}}(a);if(e&&e.getTime()>=bn["2024-01-01"].timestamp&&"object"==typeof c&&c&&"string"==typeof c.code?d=c.code:"object"==typeof c&&c&&"string"==typeof c.error_code&&(d=c.error_code),d){if("weak_password"===d)throw new bB(b_(c),a.status,(null==(b=c.weak_password)?void 0:b.reasons)||[]);else if("session_not_found"===d)throw new bu}else if("object"==typeof c&&c&&"object"==typeof c.weak_password&&c.weak_password&&Array.isArray(c.weak_password.reasons)&&c.weak_password.reasons.length&&c.weak_password.reasons.reduce((a,b)=>a&&"string"==typeof b,!0))throw new bB(b_(c),a.status,c.weak_password.reasons);throw new br(b_(c),a.status||500,d)}async function b2(a,b,c,d){var e;let f=Object.assign({},null==d?void 0:d.headers);f[bm]||(f[bm]=bn["2024-01-01"].name),(null==d?void 0:d.jwt)&&(f.Authorization=`Bearer ${d.jwt}`);let g=null!=(e=null==d?void 0:d.query)?e:{};(null==d?void 0:d.redirectTo)&&(g.redirect_to=d.redirectTo);let h=Object.keys(g).length?"?"+new URLSearchParams(g).toString():"",i=await b3(a,b,c+h,{headers:f,noResolveJson:null==d?void 0:d.noResolveJson},{},null==d?void 0:d.body);return(null==d?void 0:d.xform)?null==d?void 0:d.xform(i):{data:Object.assign({},i),error:null}}async function b3(a,b,c,d,e,f){let g,h,i=(h={method:b,headers:(null==d?void 0:d.headers)||{}},"GET"===b?h:(h.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==d?void 0:d.headers),h.body=JSON.stringify(f),Object.assign(Object.assign({},h),e)));try{g=await a(c,Object.assign({},i))}catch(a){throw console.error(a),new bz(b_(a),0)}if(g.ok||await b1(g),null==d?void 0:d.noResolveJson)return g;try{return await g.json()}catch(a){await b1(a)}}function b4(a){var b,c,d;let e=null;(d=a).access_token&&d.refresh_token&&d.expires_in&&(e=Object.assign({},a),a.expires_at||(e.expires_at=(c=a.expires_in,Math.round(Date.now()/1e3)+c)));return{data:{session:e,user:null!=(b=a.user)?b:a},error:null}}function b5(a){let b=b4(a);return!b.error&&a.weak_password&&"object"==typeof a.weak_password&&Array.isArray(a.weak_password.reasons)&&a.weak_password.reasons.length&&a.weak_password.message&&"string"==typeof a.weak_password.message&&a.weak_password.reasons.reduce((a,b)=>a&&"string"==typeof b,!0)&&(b.data.weak_password=a.weak_password),b}function b6(a){var b;return{data:{user:null!=(b=a.user)?b:a},error:null}}function b7(a){return{data:a,error:null}}function b8(a){let{action_link:b,email_otp:c,hashed_token:d,redirect_to:e,verification_type:f}=a;return{data:{properties:{action_link:b,email_otp:c,hashed_token:d,redirect_to:e,verification_type:f},user:Object.assign({},(0,W.__rest)(a,["action_link","email_otp","hashed_token","redirect_to","verification_type"]))},error:null}}function b9(a){return a}let ca=["global","local","others"];class cb{constructor({url:a="",headers:b={},fetch:c}){this.url=a,this.headers=b,this.fetch=bL(c),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(a,b=ca[0]){if(0>ca.indexOf(b))throw Error(`@supabase/auth-js: Parameter scope must be one of ${ca.join(", ")}`);try{return await b2(this.fetch,"POST",`${this.url}/logout?scope=${b}`,{headers:this.headers,jwt:a,noResolveJson:!0}),{data:null,error:null}}catch(a){if(bq(a))return{data:null,error:a};throw a}}async inviteUserByEmail(a,b={}){try{return await b2(this.fetch,"POST",`${this.url}/invite`,{body:{email:a,data:b.data},headers:this.headers,redirectTo:b.redirectTo,xform:b6})}catch(a){if(bq(a))return{data:{user:null},error:a};throw a}}async generateLink(a){try{let{options:b}=a,c=(0,W.__rest)(a,["options"]),d=Object.assign(Object.assign({},c),b);return"newEmail"in c&&(d.new_email=null==c?void 0:c.newEmail,delete d.newEmail),await b2(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:d,headers:this.headers,xform:b8,redirectTo:null==b?void 0:b.redirectTo})}catch(a){if(bq(a))return{data:{properties:null,user:null},error:a};throw a}}async createUser(a){try{return await b2(this.fetch,"POST",`${this.url}/admin/users`,{body:a,headers:this.headers,xform:b6})}catch(a){if(bq(a))return{data:{user:null},error:a};throw a}}async listUsers(a){var b,c,d,e,f,g,h;try{let i={nextPage:null,lastPage:0,total:0},j=await b2(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!=(c=null==(b=null==a?void 0:a.page)?void 0:b.toString())?c:"",per_page:null!=(e=null==(d=null==a?void 0:a.perPage)?void 0:d.toString())?e:""},xform:b9});if(j.error)throw j.error;let k=await j.json(),l=null!=(f=j.headers.get("x-total-count"))?f:0,m=null!=(h=null==(g=j.headers.get("link"))?void 0:g.split(","))?h:[];return m.length>0&&(m.forEach(a=>{let b=parseInt(a.split(";")[0].split("=")[1].substring(0,1)),c=JSON.parse(a.split(";")[1].split("=")[1]);i[`${c}Page`]=b}),i.total=parseInt(l)),{data:Object.assign(Object.assign({},k),i),error:null}}catch(a){if(bq(a))return{data:{users:[]},error:a};throw a}}async getUserById(a){bY(a);try{return await b2(this.fetch,"GET",`${this.url}/admin/users/${a}`,{headers:this.headers,xform:b6})}catch(a){if(bq(a))return{data:{user:null},error:a};throw a}}async updateUserById(a,b){bY(a);try{return await b2(this.fetch,"PUT",`${this.url}/admin/users/${a}`,{body:b,headers:this.headers,xform:b6})}catch(a){if(bq(a))return{data:{user:null},error:a};throw a}}async deleteUser(a,b=!1){bY(a);try{return await b2(this.fetch,"DELETE",`${this.url}/admin/users/${a}`,{headers:this.headers,body:{should_soft_delete:b},xform:b6})}catch(a){if(bq(a))return{data:{user:null},error:a};throw a}}async _listFactors(a){bY(a.userId);try{let{data:b,error:c}=await b2(this.fetch,"GET",`${this.url}/admin/users/${a.userId}/factors`,{headers:this.headers,xform:a=>({data:{factors:a},error:null})});return{data:b,error:c}}catch(a){if(bq(a))return{data:null,error:a};throw a}}async _deleteFactor(a){bY(a.userId),bY(a.id);try{return{data:await b2(this.fetch,"DELETE",`${this.url}/admin/users/${a.userId}/factors/${a.id}`,{headers:this.headers}),error:null}}catch(a){if(bq(a))return{data:null,error:a};throw a}}async _listOAuthClients(a){var b,c,d,e,f,g,h;try{let i={nextPage:null,lastPage:0,total:0},j=await b2(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:null!=(c=null==(b=null==a?void 0:a.page)?void 0:b.toString())?c:"",per_page:null!=(e=null==(d=null==a?void 0:a.perPage)?void 0:d.toString())?e:""},xform:b9});if(j.error)throw j.error;let k=await j.json(),l=null!=(f=j.headers.get("x-total-count"))?f:0,m=null!=(h=null==(g=j.headers.get("link"))?void 0:g.split(","))?h:[];return m.length>0&&(m.forEach(a=>{let b=parseInt(a.split(";")[0].split("=")[1].substring(0,1)),c=JSON.parse(a.split(";")[1].split("=")[1]);i[`${c}Page`]=b}),i.total=parseInt(l)),{data:Object.assign(Object.assign({},k),i),error:null}}catch(a){if(bq(a))return{data:{clients:[]},error:a};throw a}}async _createOAuthClient(a){try{return await b2(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:a,headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(bq(a))return{data:null,error:a};throw a}}async _getOAuthClient(a){try{return await b2(this.fetch,"GET",`${this.url}/admin/oauth/clients/${a}`,{headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(bq(a))return{data:null,error:a};throw a}}async _updateOAuthClient(a,b){try{return await b2(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${a}`,{body:b,headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(bq(a))return{data:null,error:a};throw a}}async _deleteOAuthClient(a){try{return await b2(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${a}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(a){if(bq(a))return{data:null,error:a};throw a}}async _regenerateOAuthClientSecret(a){try{return await b2(this.fetch,"POST",`${this.url}/admin/oauth/clients/${a}/regenerate_secret`,{headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(bq(a))return{data:null,error:a};throw a}}}function cc(a={}){return{getItem:b=>a[b]||null,setItem:(b,c)=>{a[b]=c},removeItem:b=>{delete a[b]}}}globalThis;class cd extends Error{constructor(a){super(a),this.isAcquireTimeout=!0}}function ce(a){if(!/^0x[a-fA-F0-9]{40}$/.test(a))throw Error(`@supabase/auth-js: Address "${a}" is invalid.`);return a.toLowerCase()}class cf extends Error{constructor({message:a,code:b,cause:c,name:d}){var e;super(a,{cause:c}),this.__isWebAuthnError=!0,this.name=null!=(e=null!=d?d:c instanceof Error?c.name:void 0)?e:"Unknown Error",this.code=b}}class cg extends cf{constructor(a,b){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:b,message:a}),this.name="WebAuthnUnknownError",this.originalError=b}}let ch=new class{createNewAbortSignal(){if(this.controller){let a=Error("Cancelling existing WebAuthn API call for new one");a.name="AbortError",this.controller.abort(a)}let a=new AbortController;return this.controller=a,a.signal}cancelCeremony(){if(this.controller){let a=Error("Manually cancelling existing WebAuthn API call");a.name="AbortError",this.controller.abort(a),this.controller=void 0}}};function ci(a){return"localhost"===a||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(a)}async function cj(a){try{let b=await navigator.credentials.create(a);if(!b)return{data:null,error:new cg("Empty credential response",b)};if(!(b instanceof PublicKeyCredential))return{data:null,error:new cg("Browser returned unexpected credential type",b)};return{data:b,error:null}}catch(b){return{data:null,error:function({error:a,options:b}){var c,d,e;let{publicKey:f}=b;if(!f)throw Error("options was missing required publicKey property");if("AbortError"===a.name){if(b.signal instanceof AbortSignal)return new cf({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:a})}else if("ConstraintError"===a.name){if((null==(c=f.authenticatorSelection)?void 0:c.requireResidentKey)===!0)return new cf({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:a});else if("conditional"===b.mediation&&(null==(d=f.authenticatorSelection)?void 0:d.userVerification)==="required")return new cf({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:a});else if((null==(e=f.authenticatorSelection)?void 0:e.userVerification)==="required")return new cf({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:a})}else if("InvalidStateError"===a.name)return new cf({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:a});else if("NotAllowedError"===a.name)return new cf({message:a.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:a});else if("NotSupportedError"===a.name)return new cf(0===f.pubKeyCredParams.filter(a=>"public-key"===a.type).length?{message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:a}:{message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:a});else if("SecurityError"===a.name){let b=window.location.hostname;if(!ci(b))return new cf({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:a});if(f.rp.id!==b)return new cf({message:`The RP ID "${f.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:a})}else if("TypeError"===a.name){if(f.user.id.byteLength<1||f.user.id.byteLength>64)return new cf({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:a})}else if("UnknownError"===a.name)return new cf({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:a});return new cf({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:a})}({error:b,options:a})}}}async function ck(a){try{let b=await navigator.credentials.get(a);if(!b)return{data:null,error:new cg("Empty credential response",b)};if(!(b instanceof PublicKeyCredential))return{data:null,error:new cg("Browser returned unexpected credential type",b)};return{data:b,error:null}}catch(b){return{data:null,error:function({error:a,options:b}){let{publicKey:c}=b;if(!c)throw Error("options was missing required publicKey property");if("AbortError"===a.name){if(b.signal instanceof AbortSignal)return new cf({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:a})}else if("NotAllowedError"===a.name)return new cf({message:a.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:a});else if("SecurityError"===a.name){let b=window.location.hostname;if(!ci(b))return new cf({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:a});if(c.rpId!==b)return new cf({message:`The RP ID "${c.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:a})}else if("UnknownError"===a.name)return new cf({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:a});return new cf({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:a})}({error:b,options:a})}}}let cl={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},cm={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function cn(...a){let b=a=>null!==a&&"object"==typeof a&&!Array.isArray(a),c=a=>a instanceof ArrayBuffer||ArrayBuffer.isView(a),d={};for(let e of a)if(e)for(let a in e){let f=e[a];if(void 0!==f)if(Array.isArray(f))d[a]=f;else if(c(f))d[a]=f;else if(b(f)){let c=d[a];b(c)?d[a]=cn(c,f):d[a]=cn(f)}else d[a]=f}return d}class co{constructor(a){this.client=a,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(a){return this.client.mfa.enroll(Object.assign(Object.assign({},a),{factorType:"webauthn"}))}async _challenge({factorId:a,webauthn:b,friendlyName:c,signal:d},e){try{var f,g,h,i;let{data:j,error:k}=await this.client.mfa.challenge({factorId:a,webauthn:b});if(!j)return{data:null,error:k};let l=null!=d?d:ch.createNewAbortSignal();if("create"===j.webauthn.type){let{user:a}=j.webauthn.credential_options.publicKey;a.name||(a.name=`${a.id}:${c}`),a.displayName||(a.displayName=a.name)}switch(j.webauthn.type){case"create":{let b=(f=j.webauthn.credential_options.publicKey,g=null==e?void 0:e.create,cn(cl,f,g||{})),{data:c,error:d}=await cj({publicKey:b,signal:l});if(c)return{data:{factorId:a,challengeId:j.id,webauthn:{type:j.webauthn.type,credential_response:c}},error:null};return{data:null,error:d}}case"request":{let b=(h=j.webauthn.credential_options.publicKey,i=null==e?void 0:e.request,cn(cm,h,i||{})),{data:c,error:d}=await ck(Object.assign(Object.assign({},j.webauthn.credential_options),{publicKey:b,signal:l}));if(c)return{data:{factorId:a,challengeId:j.id,webauthn:{type:j.webauthn.type,credential_response:c}},error:null};return{data:null,error:d}}}}catch(a){if(bq(a))return{data:null,error:a};return{data:null,error:new bs("Unexpected error in challenge",a)}}}async _verify({challengeId:a,factorId:b,webauthn:c}){return this.client.mfa.verify({factorId:b,challengeId:a,webauthn:c})}async _authenticate({factorId:a,webauthn:{rpId:b,rpOrigins:c,signal:d}={}},e){if(!b)return{data:null,error:new bp("rpId is required for WebAuthn authentication")};try{1;return{data:null,error:new bs("Browser does not support WebAuthn",null)}}catch(a){if(bq(a))return{data:null,error:a};return{data:null,error:new bs("Unexpected error in authenticate",a)}}}async _register({friendlyName:a,webauthn:{rpId:b,rpOrigins:c,signal:d}={}},e){if(!b)return{data:null,error:new bp("rpId is required for WebAuthn registration")};try{1;return{data:null,error:new bs("Browser does not support WebAuthn",null)}}catch(a){if(bq(a))return{data:null,error:a};return{data:null,error:new bs("Unexpected error in register",a)}}}}if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(a){"undefined"!=typeof self&&(self.globalThis=self)}let cp={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:bl,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function cq(a,b,c){return await c()}let cr={};class cs{get jwks(){var a,b;return null!=(b=null==(a=cr[this.storageKey])?void 0:a.jwks)?b:{keys:[]}}set jwks(a){cr[this.storageKey]=Object.assign(Object.assign({},cr[this.storageKey]),{jwks:a})}get jwks_cached_at(){var a,b;return null!=(b=null==(a=cr[this.storageKey])?void 0:a.cachedAt)?b:Number.MIN_SAFE_INTEGER}set jwks_cached_at(a){cr[this.storageKey]=Object.assign(Object.assign({},cr[this.storageKey]),{cachedAt:a})}constructor(a){var b;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const c=Object.assign(Object.assign({},cp),a);this.storageKey=c.storageKey,this.instanceID=null!=(b=cs.nextInstanceID[this.storageKey])?b:0,cs.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!c.debug,"function"==typeof c.debug&&(this.logger=c.debug),this.instanceID,this.persistSession=c.persistSession,this.autoRefreshToken=c.autoRefreshToken,this.admin=new cb({url:c.url,headers:c.headers,fetch:c.fetch}),this.url=c.url,this.headers=c.headers,this.fetch=bL(c.fetch),this.lock=c.lock||cq,this.detectSessionInUrl=c.detectSessionInUrl,this.flowType=c.flowType,this.hasCustomAuthorizationHeader=c.hasCustomAuthorizationHeader,this.throwOnError=c.throwOnError,c.lock?this.lock=c.lock:(this.persistSession,this.lock=cq),this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new co(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(c.storage?this.storage=c.storage:(this.memoryStorage={},this.storage=cc(this.memoryStorage)),c.userStorage&&(this.userStorage=c.userStorage)):(this.memoryStorage={},this.storage=cc(this.memoryStorage)),this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(a){if(this.throwOnError&&a&&a.error)throw a.error;return a}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${bk}) ${new Date().toISOString()}`}_debug(...a){return this.logDebugMessages&&this.logger(this._logPrefix(),...a),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){try{return await this._recoverAndRefresh(),{error:null}}catch(a){if(bq(a))return this._returnResult({error:a});return this._returnResult({error:new bs("Unexpected error during initialization",a)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(a){var b,c,d;try{let{data:e,error:f}=await b2(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!=(c=null==(b=null==a?void 0:a.options)?void 0:b.data)?c:{},gotrue_meta_security:{captcha_token:null==(d=null==a?void 0:a.options)?void 0:d.captchaToken}},xform:b4});if(f||!e)return this._returnResult({data:{user:null,session:null},error:f});let g=e.session,h=e.user;return e.session&&(await this._saveSession(e.session),await this._notifyAllSubscribers("SIGNED_IN",g)),this._returnResult({data:{user:h,session:g},error:null})}catch(a){if(bq(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signUp(a){var b,c,d;try{let e;if("email"in a){let{email:c,password:d,options:f}=a,g=null,h=null;"pkce"===this.flowType&&([g,h]=await bV(this.storage,this.storageKey)),e=await b2(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==f?void 0:f.emailRedirectTo,body:{email:c,password:d,data:null!=(b=null==f?void 0:f.data)?b:{},gotrue_meta_security:{captcha_token:null==f?void 0:f.captchaToken},code_challenge:g,code_challenge_method:h},xform:b4})}else if("phone"in a){let{phone:b,password:f,options:g}=a;e=await b2(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:b,password:f,data:null!=(c=null==g?void 0:g.data)?c:{},channel:null!=(d=null==g?void 0:g.channel)?d:"sms",gotrue_meta_security:{captcha_token:null==g?void 0:g.captchaToken}},xform:b4})}else throw new bw("You must provide either an email or phone number and a password");let{data:f,error:g}=e;if(g||!f)return await bO(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:g});let h=f.session,i=f.user;return f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("SIGNED_IN",h)),this._returnResult({data:{user:i,session:h},error:null})}catch(a){if(await bO(this.storage,`${this.storageKey}-code-verifier`),bq(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithPassword(a){try{let b;if("email"in a){let{email:c,password:d,options:e}=a;b=await b2(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:c,password:d,gotrue_meta_security:{captcha_token:null==e?void 0:e.captchaToken}},xform:b5})}else if("phone"in a){let{phone:c,password:d,options:e}=a;b=await b2(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:c,password:d,gotrue_meta_security:{captcha_token:null==e?void 0:e.captchaToken}},xform:b5})}else throw new bw("You must provide either an email or phone number and a password");let{data:c,error:d}=b;if(d)return this._returnResult({data:{user:null,session:null},error:d});if(!c||!c.session||!c.user){let a=new bv;return this._returnResult({data:{user:null,session:null},error:a})}return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),this._returnResult({data:Object.assign({user:c.user,session:c.session},c.weak_password?{weakPassword:c.weak_password}:null),error:d})}catch(a){if(bq(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithOAuth(a){var b,c,d,e;return await this._handleProviderSignIn(a.provider,{redirectTo:null==(b=a.options)?void 0:b.redirectTo,scopes:null==(c=a.options)?void 0:c.scopes,queryParams:null==(d=a.options)?void 0:d.queryParams,skipBrowserRedirect:null==(e=a.options)?void 0:e.skipBrowserRedirect})}async exchangeCodeForSession(a){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(a))}async signInWithWeb3(a){let{chain:b}=a;switch(b){case"ethereum":return await this.signInWithEthereum(a);case"solana":return await this.signInWithSolana(a);default:throw Error(`@supabase/auth-js: Unsupported chain "${b}"`)}}async signInWithEthereum(a){var b,c,d,e,f,g,h,i,j,k,l,m;let n,o;if("message"in a)n=a.message,o=a.signature;else{let{chain:k,wallet:l,statement:p,options:q}=a;if("object"!=typeof l||!(null==q?void 0:q.url))throw Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");let r=new URL(null!=(b=null==q?void 0:q.url)?b:window.location.href),s=await l.request({method:"eth_requestAccounts"}).then(a=>a).catch(()=>{throw Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!s||0===s.length)throw Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");let t=ce(s[0]),u=null==(c=null==q?void 0:q.signInWithEthereum)?void 0:c.chainId;u||(u=parseInt(await l.request({method:"eth_chainId"}),16)),n=function(a){var b;let{chainId:c,domain:d,expirationTime:e,issuedAt:f=new Date,nonce:g,notBefore:h,requestId:i,resources:j,scheme:k,uri:l,version:m}=a;if(!Number.isInteger(c))throw Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${c}`);if(!d)throw Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(g&&g.length<8)throw Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${g}`);if(!l)throw Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if("1"!==m)throw Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${m}`);if(null==(b=a.statement)?void 0:b.includes("\n"))throw Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${a.statement}`);let n=ce(a.address),o=k?`${k}://${d}`:d,p=a.statement?`${a.statement}
`:"",q=`${o} wants you to sign in with your Ethereum account:
${n}

${p}`,r=`URI: ${l}
Version: ${m}
Chain ID: ${c}${g?`
Nonce: ${g}`:""}
Issued At: ${f.toISOString()}`;if(e&&(r+=`
Expiration Time: ${e.toISOString()}`),h&&(r+=`
Not Before: ${h.toISOString()}`),i&&(r+=`
Request ID: ${i}`),j){let a="\nResources:";for(let b of j){if(!b||"string"!=typeof b)throw Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${b}`);a+=`
- ${b}`}r+=a}return`${q}
${r}`}({domain:r.host,address:t,statement:p,uri:r.href,version:"1",chainId:u,nonce:null==(d=null==q?void 0:q.signInWithEthereum)?void 0:d.nonce,issuedAt:null!=(f=null==(e=null==q?void 0:q.signInWithEthereum)?void 0:e.issuedAt)?f:new Date,expirationTime:null==(g=null==q?void 0:q.signInWithEthereum)?void 0:g.expirationTime,notBefore:null==(h=null==q?void 0:q.signInWithEthereum)?void 0:h.notBefore,requestId:null==(i=null==q?void 0:q.signInWithEthereum)?void 0:i.requestId,resources:null==(j=null==q?void 0:q.signInWithEthereum)?void 0:j.resources}),o=await l.request({method:"personal_sign",params:[(m=n,"0x"+Array.from(new TextEncoder().encode(m),a=>a.toString(16).padStart(2,"0")).join("")),t]})}try{let{data:b,error:c}=await b2(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:n,signature:o},(null==(k=a.options)?void 0:k.captchaToken)?{gotrue_meta_security:{captcha_token:null==(l=a.options)?void 0:l.captchaToken}}:null),xform:b4});if(c)throw c;if(!b||!b.session||!b.user){let a=new bv;return this._returnResult({data:{user:null,session:null},error:a})}return b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("SIGNED_IN",b.session)),this._returnResult({data:Object.assign({},b),error:c})}catch(a){if(bq(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithSolana(a){var b,c,d,e,f,g,h,i,j,k,l,m;let n,o;if("message"in a)n=a.message,o=a.signature;else{let{chain:l,wallet:m,statement:p,options:q}=a;if("object"!=typeof m||!(null==q?void 0:q.url))throw Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");let r=new URL(null!=(b=null==q?void 0:q.url)?b:window.location.href);if("signIn"in m&&m.signIn){let a,b=await m.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},null==q?void 0:q.signInWithSolana),{version:"1",domain:r.host,uri:r.href}),p?{statement:p}:null));if(Array.isArray(b)&&b[0]&&"object"==typeof b[0])a=b[0];else if(b&&"object"==typeof b&&"signedMessage"in b&&"signature"in b)a=b;else throw Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in a&&"signature"in a&&("string"==typeof a.signedMessage||a.signedMessage instanceof Uint8Array)&&a.signature instanceof Uint8Array)n="string"==typeof a.signedMessage?a.signedMessage:new TextDecoder().decode(a.signedMessage),o=a.signature;else throw Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in m)||"function"!=typeof m.signMessage||!("publicKey"in m)||"object"!=typeof m||!m.publicKey||!("toBase58"in m.publicKey)||"function"!=typeof m.publicKey.toBase58)throw Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");n=[`${r.host} wants you to sign in with your Solana account:`,m.publicKey.toBase58(),...p?["",p,""]:[""],"Version: 1",`URI: ${r.href}`,`Issued At: ${null!=(d=null==(c=null==q?void 0:q.signInWithSolana)?void 0:c.issuedAt)?d:new Date().toISOString()}`,...(null==(e=null==q?void 0:q.signInWithSolana)?void 0:e.notBefore)?[`Not Before: ${q.signInWithSolana.notBefore}`]:[],...(null==(f=null==q?void 0:q.signInWithSolana)?void 0:f.expirationTime)?[`Expiration Time: ${q.signInWithSolana.expirationTime}`]:[],...(null==(g=null==q?void 0:q.signInWithSolana)?void 0:g.chainId)?[`Chain ID: ${q.signInWithSolana.chainId}`]:[],...(null==(h=null==q?void 0:q.signInWithSolana)?void 0:h.nonce)?[`Nonce: ${q.signInWithSolana.nonce}`]:[],...(null==(i=null==q?void 0:q.signInWithSolana)?void 0:i.requestId)?[`Request ID: ${q.signInWithSolana.requestId}`]:[],...(null==(k=null==(j=null==q?void 0:q.signInWithSolana)?void 0:j.resources)?void 0:k.length)?["Resources",...q.signInWithSolana.resources.map(a=>`- ${a}`)]:[]].join("\n");let a=await m.signMessage(new TextEncoder().encode(n),"utf8");if(!a||!(a instanceof Uint8Array))throw Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");o=a}}try{let{data:b,error:c}=await b2(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:n,signature:bK(o)},(null==(l=a.options)?void 0:l.captchaToken)?{gotrue_meta_security:{captcha_token:null==(m=a.options)?void 0:m.captchaToken}}:null),xform:b4});if(c)throw c;if(!b||!b.session||!b.user){let a=new bv;return this._returnResult({data:{user:null,session:null},error:a})}return b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("SIGNED_IN",b.session)),this._returnResult({data:Object.assign({},b),error:c})}catch(a){if(bq(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async _exchangeCodeForSession(a){let b=await bN(this.storage,`${this.storageKey}-code-verifier`),[c,d]=(null!=b?b:"").split("/");try{if(!c&&"pkce"===this.flowType)throw new by;let{data:b,error:e}=await b2(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:a,code_verifier:c},xform:b4});if(await bO(this.storage,`${this.storageKey}-code-verifier`),e)throw e;if(!b||!b.session||!b.user){let a=new bv;return this._returnResult({data:{user:null,session:null,redirectType:null},error:a})}return b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("SIGNED_IN",b.session)),this._returnResult({data:Object.assign(Object.assign({},b),{redirectType:null!=d?d:null}),error:e})}catch(a){if(await bO(this.storage,`${this.storageKey}-code-verifier`),bq(a))return this._returnResult({data:{user:null,session:null,redirectType:null},error:a});throw a}}async signInWithIdToken(a){try{let{options:b,provider:c,token:d,access_token:e,nonce:f}=a,{data:g,error:h}=await b2(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:c,id_token:d,access_token:e,nonce:f,gotrue_meta_security:{captcha_token:null==b?void 0:b.captchaToken}},xform:b4});if(h)return this._returnResult({data:{user:null,session:null},error:h});if(!g||!g.session||!g.user){let a=new bv;return this._returnResult({data:{user:null,session:null},error:a})}return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),this._returnResult({data:g,error:h})}catch(a){if(bq(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithOtp(a){var b,c,d,e,f;try{if("email"in a){let{email:d,options:e}=a,f=null,g=null;"pkce"===this.flowType&&([f,g]=await bV(this.storage,this.storageKey));let{error:h}=await b2(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:d,data:null!=(b=null==e?void 0:e.data)?b:{},create_user:null==(c=null==e?void 0:e.shouldCreateUser)||c,gotrue_meta_security:{captcha_token:null==e?void 0:e.captchaToken},code_challenge:f,code_challenge_method:g},redirectTo:null==e?void 0:e.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:h})}if("phone"in a){let{phone:b,options:c}=a,{data:g,error:h}=await b2(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:b,data:null!=(d=null==c?void 0:c.data)?d:{},create_user:null==(e=null==c?void 0:c.shouldCreateUser)||e,gotrue_meta_security:{captcha_token:null==c?void 0:c.captchaToken},channel:null!=(f=null==c?void 0:c.channel)?f:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:null==g?void 0:g.message_id},error:h})}throw new bw("You must provide either an email or phone number.")}catch(a){if(await bO(this.storage,`${this.storageKey}-code-verifier`),bq(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async verifyOtp(a){var b,c;try{let d,e;"options"in a&&(d=null==(b=a.options)?void 0:b.redirectTo,e=null==(c=a.options)?void 0:c.captchaToken);let{data:f,error:g}=await b2(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},a),{gotrue_meta_security:{captcha_token:e}}),redirectTo:d,xform:b4});if(g)throw g;if(!f)throw Error("An error occurred on token verification.");let h=f.session,i=f.user;return(null==h?void 0:h.access_token)&&(await this._saveSession(h),await this._notifyAllSubscribers("recovery"==a.type?"PASSWORD_RECOVERY":"SIGNED_IN",h)),this._returnResult({data:{user:i,session:h},error:null})}catch(a){if(bq(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithSSO(a){var b,c,d,e;try{let f=null,g=null;"pkce"===this.flowType&&([f,g]=await bV(this.storage,this.storageKey));let h=await b2(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in a?{provider_id:a.providerId}:null),"domain"in a?{domain:a.domain}:null),{redirect_to:null!=(c=null==(b=a.options)?void 0:b.redirectTo)?c:void 0}),(null==(d=null==a?void 0:a.options)?void 0:d.captchaToken)?{gotrue_meta_security:{captcha_token:a.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:f,code_challenge_method:g}),headers:this.headers,xform:b7});return null==(e=h.data)||e.url,this._returnResult(h)}catch(a){if(await bO(this.storage,`${this.storageKey}-code-verifier`),bq(a))return this._returnResult({data:null,error:a});throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async a=>{let{data:{session:b},error:c}=a;if(c)throw c;if(!b)throw new bu;let{error:d}=await b2(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:b.access_token});return this._returnResult({data:{user:null,session:null},error:d})})}catch(a){if(bq(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async resend(a){try{let b=`${this.url}/resend`;if("email"in a){let{email:c,type:d,options:e}=a,{error:f}=await b2(this.fetch,"POST",b,{headers:this.headers,body:{email:c,type:d,gotrue_meta_security:{captcha_token:null==e?void 0:e.captchaToken}},redirectTo:null==e?void 0:e.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:f})}if("phone"in a){let{phone:c,type:d,options:e}=a,{data:f,error:g}=await b2(this.fetch,"POST",b,{headers:this.headers,body:{phone:c,type:d,gotrue_meta_security:{captcha_token:null==e?void 0:e.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:null==f?void 0:f.message_id},error:g})}throw new bw("You must provide either an email or phone number and a type")}catch(a){if(bq(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async a=>a))}async _acquireLock(a,b){this._debug("#_acquireLock","begin",a);try{if(this.lockAcquired){let a=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),c=(async()=>(await a,await b()))();return this.pendingInLock.push((async()=>{try{await c}catch(a){}})()),c}return await this.lock(`lock:${this.storageKey}`,a,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;let a=b();for(this.pendingInLock.push((async()=>{try{await a}catch(a){}})()),await a;this.pendingInLock.length;){let a=[...this.pendingInLock];await Promise.all(a),this.pendingInLock.splice(0,a.length)}return await a}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(a){this._debug("#_useSession","begin");try{let b=await this.__loadSession();return await a(b)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",Error().stack);try{let b=null,c=await bN(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",c),null!==c&&(this._isValidSession(c)?b=c:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!b)return{data:{session:null},error:null};let d=!!b.expires_at&&1e3*b.expires_at-Date.now()<9e4;if(this._debug("#__loadSession()",`session has${d?"":" not"} expired`,"expires_at",b.expires_at),!d){if(this.userStorage){let a=await bN(this.userStorage,this.storageKey+"-user");(null==a?void 0:a.user)?b.user=a.user:b.user=bZ()}if(this.storage.isServer&&b.user&&!b.user.__isUserNotAvailableProxy){var a;let c={value:this.suppressGetSessionWarning};b.user=(a=b.user,new Proxy(a,{get:(a,b,d)=>{if("__isInsecureUserWarningProxy"===b)return!0;if("symbol"==typeof b){let c=b.toString();if("Symbol(Symbol.toPrimitive)"===c||"Symbol(Symbol.toStringTag)"===c||"Symbol(util.inspect.custom)"===c||"Symbol(nodejs.util.inspect.custom)"===c)return Reflect.get(a,b,d)}return c.value||"string"!=typeof b||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),c.value=!0),Reflect.get(a,b,d)}})),c.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:b},error:null}}let{data:e,error:f}=await this._callRefreshToken(b.refresh_token);if(f)return this._returnResult({data:{session:null},error:f});return this._returnResult({data:{session:e},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(a){if(a)return await this._getUser(a);await this.initializePromise;let b=await this._acquireLock(-1,async()=>await this._getUser());return b.data.user&&(this.suppressGetSessionWarning=!0),b}async _getUser(a){try{if(a)return await b2(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:a,xform:b6});return await this._useSession(async a=>{var b,c,d;let{data:e,error:f}=a;if(f)throw f;return(null==(b=e.session)?void 0:b.access_token)||this.hasCustomAuthorizationHeader?await b2(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!=(d=null==(c=e.session)?void 0:c.access_token)?d:void 0,xform:b6}):{data:{user:null},error:new bu}})}catch(a){if(bq(a))return bq(a)&&"AuthSessionMissingError"===a.name&&(await this._removeSession(),await bO(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:a});throw a}}async updateUser(a,b={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(a,b))}async _updateUser(a,b={}){try{return await this._useSession(async c=>{let{data:d,error:e}=c;if(e)throw e;if(!d.session)throw new bu;let f=d.session,g=null,h=null;"pkce"===this.flowType&&null!=a.email&&([g,h]=await bV(this.storage,this.storageKey));let{data:i,error:j}=await b2(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==b?void 0:b.emailRedirectTo,body:Object.assign(Object.assign({},a),{code_challenge:g,code_challenge_method:h}),jwt:f.access_token,xform:b6});if(j)throw j;return f.user=i.user,await this._saveSession(f),await this._notifyAllSubscribers("USER_UPDATED",f),this._returnResult({data:{user:f.user},error:null})})}catch(a){if(await bO(this.storage,`${this.storageKey}-code-verifier`),bq(a))return this._returnResult({data:{user:null},error:a});throw a}}async setSession(a){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(a))}async _setSession(a){try{if(!a.access_token||!a.refresh_token)throw new bu;let b=Date.now()/1e3,c=b,d=!0,e=null,{payload:f}=bQ(a.access_token);if(f.exp&&(d=(c=f.exp)<=b),d){let{data:b,error:c}=await this._callRefreshToken(a.refresh_token);if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!b)return{data:{user:null,session:null},error:null};e=b}else{let{data:d,error:f}=await this._getUser(a.access_token);if(f)throw f;e={access_token:a.access_token,refresh_token:a.refresh_token,user:d.user,token_type:"bearer",expires_in:c-b,expires_at:c},await this._saveSession(e),await this._notifyAllSubscribers("SIGNED_IN",e)}return this._returnResult({data:{user:e.user,session:e},error:null})}catch(a){if(bq(a))return this._returnResult({data:{session:null,user:null},error:a});throw a}}async refreshSession(a){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(a))}async _refreshSession(a){try{return await this._useSession(async b=>{var c;if(!a){let{data:d,error:e}=b;if(e)throw e;a=null!=(c=d.session)?c:void 0}if(!(null==a?void 0:a.refresh_token))throw new bu;let{data:d,error:e}=await this._callRefreshToken(a.refresh_token);return e?this._returnResult({data:{user:null,session:null},error:e}):d?this._returnResult({data:{user:d.user,session:d},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(a){if(bq(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async _getSessionFromURL(a,b){try{throw new bx("No browser detected.")}catch(a){if(bq(a))return this._returnResult({data:{session:null,redirectType:null},error:a});throw a}}_isImplicitGrantCallback(a){return"function"==typeof this.detectSessionInUrl?this.detectSessionInUrl(new URL(window.location.href),a):!!(a.access_token||a.error_description)}async _isPKCECallback(a){let b=await bN(this.storage,`${this.storageKey}-code-verifier`);return!!(a.code&&b)}async signOut(a={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(a))}async _signOut({scope:a}={scope:"global"}){return await this._useSession(async b=>{var c;let{data:d,error:e}=b;if(e)return this._returnResult({error:e});let f=null==(c=d.session)?void 0:c.access_token;if(f){let{error:b}=await this.admin.signOut(f,a);if(b&&!(bq(b)&&"AuthApiError"===b.name&&(404===b.status||401===b.status||403===b.status)))return this._returnResult({error:b})}return"others"!==a&&(await this._removeSession(),await bO(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(a){let b=Symbol("auth-callback"),c={id:b,callback:a,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",b),this.stateChangeEmitters.delete(b)}};return this._debug("#onAuthStateChange()","registered callback with id",b),this.stateChangeEmitters.set(b,c),(async()=>{await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(b)})})(),{data:{subscription:c}}}async _emitInitialSession(a){return await this._useSession(async b=>{var c,d;try{let{data:{session:d},error:e}=b;if(e)throw e;await (null==(c=this.stateChangeEmitters.get(a))?void 0:c.callback("INITIAL_SESSION",d)),this._debug("INITIAL_SESSION","callback id",a,"session",d)}catch(b){await (null==(d=this.stateChangeEmitters.get(a))?void 0:d.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",a,"error",b),console.error(b)}})}async resetPasswordForEmail(a,b={}){let c=null,d=null;"pkce"===this.flowType&&([c,d]=await bV(this.storage,this.storageKey,!0));try{return await b2(this.fetch,"POST",`${this.url}/recover`,{body:{email:a,code_challenge:c,code_challenge_method:d,gotrue_meta_security:{captcha_token:b.captchaToken}},headers:this.headers,redirectTo:b.redirectTo})}catch(a){if(await bO(this.storage,`${this.storageKey}-code-verifier`),bq(a))return this._returnResult({data:null,error:a});throw a}}async getUserIdentities(){var a;try{let{data:b,error:c}=await this.getUser();if(c)throw c;return this._returnResult({data:{identities:null!=(a=b.user.identities)?a:[]},error:null})}catch(a){if(bq(a))return this._returnResult({data:null,error:a});throw a}}async linkIdentity(a){return"token"in a?this.linkIdentityIdToken(a):this.linkIdentityOAuth(a)}async linkIdentityOAuth(a){try{let{data:b,error:c}=await this._useSession(async b=>{var c,d,e,f,g;let{data:h,error:i}=b;if(i)throw i;let j=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,a.provider,{redirectTo:null==(c=a.options)?void 0:c.redirectTo,scopes:null==(d=a.options)?void 0:d.scopes,queryParams:null==(e=a.options)?void 0:e.queryParams,skipBrowserRedirect:!0});return await b2(this.fetch,"GET",j,{headers:this.headers,jwt:null!=(g=null==(f=h.session)?void 0:f.access_token)?g:void 0})});if(c)throw c;return this._returnResult({data:{provider:a.provider,url:null==b?void 0:b.url},error:null})}catch(b){if(bq(b))return this._returnResult({data:{provider:a.provider,url:null},error:b});throw b}}async linkIdentityIdToken(a){return await this._useSession(async b=>{var c;try{let{error:d,data:{session:e}}=b;if(d)throw d;let{options:f,provider:g,token:h,access_token:i,nonce:j}=a,{data:k,error:l}=await b2(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:null!=(c=null==e?void 0:e.access_token)?c:void 0,body:{provider:g,id_token:h,access_token:i,nonce:j,link_identity:!0,gotrue_meta_security:{captcha_token:null==f?void 0:f.captchaToken}},xform:b4});if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!k||!k.session||!k.user)return this._returnResult({data:{user:null,session:null},error:new bv});return k.session&&(await this._saveSession(k.session),await this._notifyAllSubscribers("USER_UPDATED",k.session)),this._returnResult({data:k,error:l})}catch(a){if(await bO(this.storage,`${this.storageKey}-code-verifier`),bq(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}})}async unlinkIdentity(a){try{return await this._useSession(async b=>{var c,d;let{data:e,error:f}=b;if(f)throw f;return await b2(this.fetch,"DELETE",`${this.url}/user/identities/${a.identity_id}`,{headers:this.headers,jwt:null!=(d=null==(c=e.session)?void 0:c.access_token)?d:void 0})})}catch(a){if(bq(a))return this._returnResult({data:null,error:a});throw a}}async _refreshAccessToken(a){let b=`#_refreshAccessToken(${a.substring(0,5)}...)`;this._debug(b,"begin");try{var c,d;let e=Date.now();return await (c=async c=>(c>0&&await bR(200*Math.pow(2,c-1)),this._debug(b,"refreshing attempt",c),await b2(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:a},headers:this.headers,xform:b4})),d=(a,b)=>{let c=200*Math.pow(2,a);return b&&bA(b)&&Date.now()+c-e<3e4},new Promise((a,b)=>{(async()=>{for(let e=0;e<1/0;e++)try{let b=await c(e);if(!d(e,null,b))return void a(b)}catch(a){if(!d(e,a))return void b(a)}})()}))}catch(a){if(this._debug(b,"error",a),bq(a))return this._returnResult({data:{session:null,user:null},error:a});throw a}finally{this._debug(b,"end")}}_isValidSession(a){return"object"==typeof a&&null!==a&&"access_token"in a&&"refresh_token"in a&&"expires_at"in a}async _handleProviderSignIn(a,b){let c=await this._getUrlForProvider(`${this.url}/authorize`,a,{redirectTo:b.redirectTo,scopes:b.scopes,queryParams:b.queryParams});return this._debug("#_handleProviderSignIn()","provider",a,"options",b,"url",c),{data:{provider:a,url:c},error:null}}async _recoverAndRefresh(){var a,b;let c="#_recoverAndRefresh()";this._debug(c,"begin");try{let d=await bN(this.storage,this.storageKey);if(d&&this.userStorage){let b=await bN(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!b&&(b={user:d.user},await bM(this.userStorage,this.storageKey+"-user",b)),d.user=null!=(a=null==b?void 0:b.user)?a:bZ()}else if(d&&!d.user&&!d.user){let a=await bN(this.storage,this.storageKey+"-user");a&&(null==a?void 0:a.user)?(d.user=a.user,await bO(this.storage,this.storageKey+"-user"),await bM(this.storage,this.storageKey,d)):d.user=bZ()}if(this._debug(c,"session from storage",d),!this._isValidSession(d)){this._debug(c,"session is not valid"),null!==d&&await this._removeSession();return}let e=(null!=(b=d.expires_at)?b:1/0)*1e3-Date.now()<9e4;if(this._debug(c,`session has${e?"":" not"} expired with margin of 90000s`),e){if(this.autoRefreshToken&&d.refresh_token){let{error:a}=await this._callRefreshToken(d.refresh_token);a&&(console.error(a),bA(a)||(this._debug(c,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else if(d.user&&!0===d.user.__isUserNotAvailableProxy)try{let{data:a,error:b}=await this._getUser(d.access_token);!b&&(null==a?void 0:a.user)?(d.user=a.user,await this._saveSession(d),await this._notifyAllSubscribers("SIGNED_IN",d)):this._debug(c,"could not get user data, skipping SIGNED_IN notification")}catch(a){console.error("Error getting user data:",a),this._debug(c,"error getting user data, skipping SIGNED_IN notification",a)}else await this._notifyAllSubscribers("SIGNED_IN",d)}catch(a){this._debug(c,"error",a),console.error(a);return}finally{this._debug(c,"end")}}async _callRefreshToken(a){var b,c;if(!a)throw new bu;if(this.refreshingDeferred)return this.refreshingDeferred.promise;let d=`#_callRefreshToken(${a.substring(0,5)}...)`;this._debug(d,"begin");try{this.refreshingDeferred=new bP;let{data:b,error:c}=await this._refreshAccessToken(a);if(c)throw c;if(!b.session)throw new bu;await this._saveSession(b.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",b.session);let d={data:b.session,error:null};return this.refreshingDeferred.resolve(d),d}catch(a){if(this._debug(d,"error",a),bq(a)){let c={data:null,error:a};return bA(a)||await this._removeSession(),null==(b=this.refreshingDeferred)||b.resolve(c),c}throw null==(c=this.refreshingDeferred)||c.reject(a),a}finally{this.refreshingDeferred=null,this._debug(d,"end")}}async _notifyAllSubscribers(a,b,c=!0){let d=`#_notifyAllSubscribers(${a})`;this._debug(d,"begin",b,`broadcast = ${c}`);try{this.broadcastChannel&&c&&this.broadcastChannel.postMessage({event:a,session:b});let d=[],e=Array.from(this.stateChangeEmitters.values()).map(async c=>{try{await c.callback(a,b)}catch(a){d.push(a)}});if(await Promise.all(e),d.length>0){for(let a=0;a<d.length;a+=1)console.error(d[a]);throw d[0]}}finally{this._debug(d,"end")}}async _saveSession(a){this._debug("#_saveSession()",a),this.suppressGetSessionWarning=!0,await bO(this.storage,`${this.storageKey}-code-verifier`);let b=Object.assign({},a),c=b.user&&!0===b.user.__isUserNotAvailableProxy;if(this.userStorage){!c&&b.user&&await bM(this.userStorage,this.storageKey+"-user",{user:b.user});let a=Object.assign({},b);delete a.user;let d=b$(a);await bM(this.storage,this.storageKey,d)}else{let a=b$(b);await bM(this.storage,this.storageKey,a)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await bO(this.storage,this.storageKey),await bO(this.storage,this.storageKey+"-code-verifier"),await bO(this.storage,this.storageKey+"-user"),this.userStorage&&await bO(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()"),this.visibilityChangedCallback,this.visibilityChangedCallback=null}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");let a=setInterval(()=>this._autoRefreshTokenTick(),3e4);this.autoRefreshTicker=a,a&&"object"==typeof a&&"function"==typeof a.unref?a.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(a),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");let a=this.autoRefreshTicker;this.autoRefreshTicker=null,a&&clearInterval(a)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{let a=Date.now();try{return await this._useSession(async b=>{let{data:{session:c}}=b;if(!c||!c.refresh_token||!c.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");let d=Math.floor((1e3*c.expires_at-a)/3e4);this._debug("#_autoRefreshTokenTick()",`access token expires in ${d} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),d<=3&&await this._callRefreshToken(c.refresh_token)})}catch(a){console.error("Auto refresh tick failed with error. This is likely a transient error.",a)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(a){if(a.isAcquireTimeout||a instanceof cd)this._debug("auto refresh token tick lock not available");else throw a}}async _handleVisibilityChange(){return this._debug("#_handleVisibilityChange()"),this.autoRefreshToken&&this.startAutoRefresh(),!1}async _onVisibilityChanged(a){let b=`#_onVisibilityChanged(${a})`;this._debug(b,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),a||(await this.initializePromise,await this._acquireLock(-1,async()=>{"visible"!==document.visibilityState?this._debug(b,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting"):await this._recoverAndRefresh()}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(a,b,c){let d=[`provider=${encodeURIComponent(b)}`];if((null==c?void 0:c.redirectTo)&&d.push(`redirect_to=${encodeURIComponent(c.redirectTo)}`),(null==c?void 0:c.scopes)&&d.push(`scopes=${encodeURIComponent(c.scopes)}`),"pkce"===this.flowType){let[a,b]=await bV(this.storage,this.storageKey),c=new URLSearchParams({code_challenge:`${encodeURIComponent(a)}`,code_challenge_method:`${encodeURIComponent(b)}`});d.push(c.toString())}if(null==c?void 0:c.queryParams){let a=new URLSearchParams(c.queryParams);d.push(a.toString())}return(null==c?void 0:c.skipBrowserRedirect)&&d.push(`skip_http_redirect=${c.skipBrowserRedirect}`),`${a}?${d.join("&")}`}async _unenroll(a){try{return await this._useSession(async b=>{var c;let{data:d,error:e}=b;return e?this._returnResult({data:null,error:e}):await b2(this.fetch,"DELETE",`${this.url}/factors/${a.factorId}`,{headers:this.headers,jwt:null==(c=null==d?void 0:d.session)?void 0:c.access_token})})}catch(a){if(bq(a))return this._returnResult({data:null,error:a});throw a}}async _enroll(a){try{return await this._useSession(async b=>{var c,d;let{data:e,error:f}=b;if(f)return this._returnResult({data:null,error:f});let g=Object.assign({friendly_name:a.friendlyName,factor_type:a.factorType},"phone"===a.factorType?{phone:a.phone}:"totp"===a.factorType?{issuer:a.issuer}:{}),{data:h,error:i}=await b2(this.fetch,"POST",`${this.url}/factors`,{body:g,headers:this.headers,jwt:null==(c=null==e?void 0:e.session)?void 0:c.access_token});return i?this._returnResult({data:null,error:i}):("totp"===a.factorType&&"totp"===h.type&&(null==(d=null==h?void 0:h.totp)?void 0:d.qr_code)&&(h.totp.qr_code=`data:image/svg+xml;utf-8,${h.totp.qr_code}`),this._returnResult({data:h,error:null}))})}catch(a){if(bq(a))return this._returnResult({data:null,error:a});throw a}}async _verify(a){return this._acquireLock(-1,async()=>{try{return await this._useSession(async b=>{var c,d,e;let{data:f,error:g}=b;if(g)return this._returnResult({data:null,error:g});let h=Object.assign({challenge_id:a.challengeId},"webauthn"in a?{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_response:"create"===a.webauthn.type?(d=a.webauthn.credential_response,"toJSON"in d&&"function"==typeof d.toJSON?d.toJSON():{id:d.id,rawId:d.id,response:{attestationObject:bK(new Uint8Array(d.response.attestationObject)),clientDataJSON:bK(new Uint8Array(d.response.clientDataJSON))},type:"public-key",clientExtensionResults:d.getClientExtensionResults(),authenticatorAttachment:null!=(e=d.authenticatorAttachment)?e:void 0}):function(a){var b;if("toJSON"in a&&"function"==typeof a.toJSON)return a.toJSON();let c=a.getClientExtensionResults(),d=a.response;return{id:a.id,rawId:a.id,response:{authenticatorData:bK(new Uint8Array(d.authenticatorData)),clientDataJSON:bK(new Uint8Array(d.clientDataJSON)),signature:bK(new Uint8Array(d.signature)),userHandle:d.userHandle?bK(new Uint8Array(d.userHandle)):void 0},type:"public-key",clientExtensionResults:c,authenticatorAttachment:null!=(b=a.authenticatorAttachment)?b:void 0}}(a.webauthn.credential_response)})}:{code:a.code}),{data:i,error:j}=await b2(this.fetch,"POST",`${this.url}/factors/${a.factorId}/verify`,{body:h,headers:this.headers,jwt:null==(c=null==f?void 0:f.session)?void 0:c.access_token});return j?this._returnResult({data:null,error:j}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),this._returnResult({data:i,error:j}))})}catch(a){if(bq(a))return this._returnResult({data:null,error:a});throw a}})}async _challenge(a){return this._acquireLock(-1,async()=>{try{return await this._useSession(async b=>{var c;let{data:d,error:e}=b;if(e)return this._returnResult({data:null,error:e});let f=await b2(this.fetch,"POST",`${this.url}/factors/${a.factorId}/challenge`,{body:a,headers:this.headers,jwt:null==(c=null==d?void 0:d.session)?void 0:c.access_token});if(f.error)return f;let{data:g}=f;if("webauthn"!==g.type)return{data:g,error:null};switch(g.webauthn.type){case"create":return{data:Object.assign(Object.assign({},g),{webauthn:Object.assign(Object.assign({},g.webauthn),{credential_options:Object.assign(Object.assign({},g.webauthn.credential_options),{publicKey:function(a){if(!a)throw Error("Credential creation options are required");if("undefined"!=typeof PublicKeyCredential&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseCreationOptionsFromJSON)return PublicKeyCredential.parseCreationOptionsFromJSON(a);let{challenge:b,user:c,excludeCredentials:d}=a,e=(0,W.__rest)(a,["challenge","user","excludeCredentials"]),f=bJ(b).buffer,g=Object.assign(Object.assign({},c),{id:bJ(c.id).buffer}),h=Object.assign(Object.assign({},e),{challenge:f,user:g});if(d&&d.length>0){h.excludeCredentials=Array(d.length);for(let a=0;a<d.length;a++){let b=d[a];h.excludeCredentials[a]=Object.assign(Object.assign({},b),{id:bJ(b.id).buffer,type:b.type||"public-key",transports:b.transports})}}return h}(g.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},g),{webauthn:Object.assign(Object.assign({},g.webauthn),{credential_options:Object.assign(Object.assign({},g.webauthn.credential_options),{publicKey:function(a){if(!a)throw Error("Credential request options are required");if("undefined"!=typeof PublicKeyCredential&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseRequestOptionsFromJSON)return PublicKeyCredential.parseRequestOptionsFromJSON(a);let{challenge:b,allowCredentials:c}=a,d=(0,W.__rest)(a,["challenge","allowCredentials"]),e=bJ(b).buffer,f=Object.assign(Object.assign({},d),{challenge:e});if(c&&c.length>0){f.allowCredentials=Array(c.length);for(let a=0;a<c.length;a++){let b=c[a];f.allowCredentials[a]=Object.assign(Object.assign({},b),{id:bJ(b.id).buffer,type:b.type||"public-key",transports:b.transports})}}return f}(g.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(a){if(bq(a))return this._returnResult({data:null,error:a});throw a}})}async _challengeAndVerify(a){let{data:b,error:c}=await this._challenge({factorId:a.factorId});return c?this._returnResult({data:null,error:c}):await this._verify({factorId:a.factorId,challengeId:b.id,code:a.code})}async _listFactors(){var a;let{data:{user:b},error:c}=await this.getUser();if(c)return{data:null,error:c};let d={all:[],phone:[],totp:[],webauthn:[]};for(let c of null!=(a=null==b?void 0:b.factors)?a:[])d.all.push(c),"verified"===c.status&&d[c.factor_type].push(c);return{data:d,error:null}}async _getAuthenticatorAssuranceLevel(){var a,b;let{data:{session:c},error:d}=await this.getSession();if(d)return this._returnResult({data:null,error:d});if(!c)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};let{payload:e}=bQ(c.access_token),f=null;e.aal&&(f=e.aal);let g=f;return(null!=(b=null==(a=c.user.factors)?void 0:a.filter(a=>"verified"===a.status))?b:[]).length>0&&(g="aal2"),{data:{currentLevel:f,nextLevel:g,currentAuthenticationMethods:e.amr||[]},error:null}}async _getAuthorizationDetails(a){try{return await this._useSession(async b=>{let{data:{session:c},error:d}=b;return d?this._returnResult({data:null,error:d}):c?await b2(this.fetch,"GET",`${this.url}/oauth/authorizations/${a}`,{headers:this.headers,jwt:c.access_token,xform:a=>({data:a,error:null})}):this._returnResult({data:null,error:new bu})})}catch(a){if(bq(a))return this._returnResult({data:null,error:a});throw a}}async _approveAuthorization(a,b){try{return await this._useSession(async b=>{let{data:{session:c},error:d}=b;if(d)return this._returnResult({data:null,error:d});if(!c)return this._returnResult({data:null,error:new bu});let e=await b2(this.fetch,"POST",`${this.url}/oauth/authorizations/${a}/consent`,{headers:this.headers,jwt:c.access_token,body:{action:"approve"},xform:a=>({data:a,error:null})});return e.data&&e.data.redirect_url,e})}catch(a){if(bq(a))return this._returnResult({data:null,error:a});throw a}}async _denyAuthorization(a,b){try{return await this._useSession(async b=>{let{data:{session:c},error:d}=b;if(d)return this._returnResult({data:null,error:d});if(!c)return this._returnResult({data:null,error:new bu});let e=await b2(this.fetch,"POST",`${this.url}/oauth/authorizations/${a}/consent`,{headers:this.headers,jwt:c.access_token,body:{action:"deny"},xform:a=>({data:a,error:null})});return e.data&&e.data.redirect_url,e})}catch(a){if(bq(a))return this._returnResult({data:null,error:a});throw a}}async _listOAuthGrants(){try{return await this._useSession(async a=>{let{data:{session:b},error:c}=a;return c?this._returnResult({data:null,error:c}):b?await b2(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:b.access_token,xform:a=>({data:a,error:null})}):this._returnResult({data:null,error:new bu})})}catch(a){if(bq(a))return this._returnResult({data:null,error:a});throw a}}async _revokeOAuthGrant(a){try{return await this._useSession(async b=>{let{data:{session:c},error:d}=b;return d?this._returnResult({data:null,error:d}):c?(await b2(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:c.access_token,query:{client_id:a.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new bu})})}catch(a){if(bq(a))return this._returnResult({data:null,error:a});throw a}}async fetchJwk(a,b={keys:[]}){let c=b.keys.find(b=>b.kid===a);if(c)return c;let d=Date.now();if((c=this.jwks.keys.find(b=>b.kid===a))&&this.jwks_cached_at+6e5>d)return c;let{data:e,error:f}=await b2(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(f)throw f;return e.keys&&0!==e.keys.length&&(this.jwks=e,this.jwks_cached_at=d,c=e.keys.find(b=>b.kid===a))?c:null}async getClaims(a,b={}){try{var c;let d,e=a;if(!e){let{data:a,error:b}=await this.getSession();if(b||!a.session)return this._returnResult({data:null,error:b});e=a.session.access_token}let{header:f,payload:g,signature:h,raw:{header:i,payload:j}}=bQ(e);(null==b?void 0:b.allowExpired)||function(a){if(!a)throw Error("Missing exp claim");if(a<=Math.floor(Date.now()/1e3))throw Error("JWT has expired")}(g.exp);let k=!f.alg||f.alg.startsWith("HS")||!f.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(f.kid,(null==b?void 0:b.keys)?{keys:b.keys}:null==b?void 0:b.jwks);if(!k){let{error:a}=await this.getUser(e);if(a)throw a;return{data:{claims:g,header:f,signature:h},error:null}}let l=function(a){switch(a){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw Error("Invalid alg claim")}}(f.alg),m=await crypto.subtle.importKey("jwk",k,l,!0,["verify"]);if(!await crypto.subtle.verify(l,m,h,(c=`${i}.${j}`,d=[],!function(a,b){for(let c=0;c<a.length;c+=1){let d=a.charCodeAt(c);if(d>55295&&d<=56319){let b=(d-55296)*1024&65535;d=(a.charCodeAt(c+1)-56320&65535|b)+65536,c+=1}!function(a,b){if(a<=127)return b(a);if(a<=2047){b(192|a>>6),b(128|63&a);return}if(a<=65535){b(224|a>>12),b(128|a>>6&63),b(128|63&a);return}if(a<=1114111){b(240|a>>18),b(128|a>>12&63),b(128|a>>6&63),b(128|63&a);return}throw Error(`Unrecognized Unicode codepoint: ${a.toString(16)}`)}(d,b)}}(c,a=>d.push(a)),new Uint8Array(d))))throw new bC("Invalid JWT signature");return{data:{claims:g,header:f,signature:h},error:null}}catch(a){if(bq(a))return this._returnResult({data:null,error:a});throw a}}}cs.nextInstanceID={};let ct=cs,cu="";cu="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";let cv={headers:{"X-Client-Info":`supabase-js-${cu}/2.89.0`}},cw={schema:"public"},cx={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},cy={};function cz(a){return(cz="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(a)}function cA(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function cB(a){for(var b=1;b<arguments.length;b++){var c=null!=arguments[b]?arguments[b]:{};b%2?cA(Object(c),!0).forEach(function(b){!function(a,b,c){var d;(d=function(a,b){if("object"!=cz(a)||!a)return a;var c=a[Symbol.toPrimitive];if(void 0!==c){var d=c.call(a,b||"default");if("object"!=cz(d))return d;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===b?String:Number)(a)}(b,"string"),(b="symbol"==cz(d)?d:d+"")in a)?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c}(a,b,c[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(c)):cA(Object(c)).forEach(function(b){Object.defineProperty(a,b,Object.getOwnPropertyDescriptor(c,b))})}return a}var cC=class extends ct{constructor(a){super(a)}},cD=class{constructor(a,b,c){var d,e,f;this.supabaseUrl=a,this.supabaseKey=b;const g=function(a){let b=null==a?void 0:a.trim();if(!b)throw Error("supabaseUrl is required.");if(!b.match(/^https?:\/\//i))throw Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(b.endsWith("/")?b:b+"/")}catch(a){throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}(a);if(!b)throw Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",g),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",g),this.storageUrl=new URL("storage/v1",g),this.functionsUrl=new URL("functions/v1",g);const h=`sb-${g.hostname.split(".")[0]}-auth-token`,i=function(a,b){var c,d;let{db:e,auth:f,realtime:g,global:h}=a,{db:i,auth:j,realtime:k,global:l}=b,m={db:cB(cB({},i),e),auth:cB(cB({},j),f),realtime:cB(cB({},k),g),storage:{},global:cB(cB(cB({},l),h),{},{headers:cB(cB({},null!=(c=null==l?void 0:l.headers)?c:{}),null!=(d=null==h?void 0:h.headers)?d:{})}),accessToken:async()=>""};return a.accessToken?m.accessToken=a.accessToken:delete m.accessToken,m}(null!=c?c:{},{db:cw,realtime:cy,auth:cB(cB({},cx),{},{storageKey:h}),global:cv});this.storageKey=null!=(d=i.auth.storageKey)?d:"",this.headers=null!=(e=i.global.headers)?e:{},i.accessToken?(this.accessToken=i.accessToken,this.auth=new Proxy({},{get:(a,b)=>{throw Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(b)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!=(f=i.auth)?f:{},this.headers,i.global.fetch),this.fetch=((a,b,c)=>{let d=c?(...a)=>c(...a):(...a)=>fetch(...a),e=Headers;return async(c,f)=>{var g;let h=null!=(g=await b())?g:a,i=new e(null==f?void 0:f.headers);return i.has("apikey")||i.set("apikey",a),i.has("Authorization")||i.set("Authorization",`Bearer ${h}`),d(c,cB(cB({},f),{},{headers:i}))}})(b,this._getAccessToken.bind(this),i.global.fetch),this.realtime=this._initRealtimeClient(cB({headers:this.headers,accessToken:this._getAccessToken.bind(this)},i.realtime)),this.accessToken&&this.accessToken().then(a=>this.realtime.setAuth(a)).catch(a=>console.warn("Failed to set initial Realtime auth token:",a)),this.rest=new ac(new URL("rest/v1",g).href,{headers:this.headers,schema:i.db.schema,fetch:this.fetch}),this.storage=new bj(this.storageUrl.href,this.headers,this.fetch,null==c?void 0:c.storage),i.accessToken||this._listenForAuthEvents()}get functions(){return new X(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(a){return this.rest.from(a)}schema(a){return this.rest.schema(a)}rpc(a,b={},c={head:!1,get:!1,count:void 0}){return this.rest.rpc(a,b,c)}channel(a,b={config:{}}){return this.realtime.channel(a,b)}getChannels(){return this.realtime.getChannels()}removeChannel(a){return this.realtime.removeChannel(a)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var a,b;if(this.accessToken)return await this.accessToken();let{data:c}=await this.auth.getSession();return null!=(a=null==(b=c.session)?void 0:b.access_token)?a:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:a,persistSession:b,detectSessionInUrl:c,storage:d,userStorage:e,storageKey:f,flowType:g,lock:h,debug:i,throwOnError:j},k,l){let m={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new cC({url:this.authUrl.href,headers:cB(cB({},m),k),storageKey:f,autoRefreshToken:a,persistSession:b,detectSessionInUrl:c,storage:d,userStorage:e,flowType:g,lock:h,debug:i,throwOnError:j,fetch:l,hasCustomAuthorizationHeader:Object.keys(this.headers).some(a=>"authorization"===a.toLowerCase())})}_initRealtimeClient(a){return new ax(this.realtimeUrl.href,cB(cB({},a),{},{params:cB(cB({},{apikey:this.supabaseKey}),null==a?void 0:a.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((a,b)=>{this._handleTokenChanged(a,"CLIENT",null==b?void 0:b.access_token)})}_handleTokenChanged(a,b,c){("TOKEN_REFRESHED"===a||"SIGNED_IN"===a)&&this.changedAccessToken!==c?(this.changedAccessToken=c,this.realtime.setAuth(c)):"SIGNED_OUT"===a&&(this.realtime.setAuth(),"STORAGE"==b&&this.auth.signOut(),this.changedAccessToken=void 0)}};let cE=(a,b,c)=>new cD(a,b,c);(function(){if("undefined"==typeof process)return!1;let a=process.version;if(null==a)return!1;let b=a.match(/^v(\d+)\./);return!!b&&18>=parseInt(b[1],10)})()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");let cF=process.env.NEXT_PUBLIC_SUPABASE_URL,cG=cE(cF,process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY);cE(cF,process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}});var cH=a.i(73608);function cI(){let[a,b]=(0,y.useState)([]),[c,d]=(0,y.useState)(!0),[e,f]=(0,y.useState)(""),[g,h]=(0,y.useState)(!1),[i,j]=(0,y.useState)(null),[k,l]=(0,y.useState)({code:"",description:"",discount_type:"percentage",discount_value:10,min_purchase_amount:"",max_discount_amount:"",usage_limit:"",valid_from:(0,cH.format)(new Date,"yyyy-MM-dd"),valid_until:"",is_active:!0,applicable_templates:[]});(0,y.useEffect)(()=>{m()},[]);let m=async()=>{try{let{data:a,error:c}=await cG.from("promo_codes").select("*").order("created_at",{ascending:!1});if(c)throw c;b(a||[])}catch(a){console.error("Error loading promo codes:",a)}finally{d(!1)}},n=async()=>{try{let a={code:k.code.toUpperCase(),description:k.description,discount_type:k.discount_type,discount_value:k.discount_value,min_purchase_amount:k.min_purchase_amount?parseFloat(k.min_purchase_amount):null,max_discount_amount:k.max_discount_amount?parseFloat(k.max_discount_amount):null,usage_limit:k.usage_limit?parseInt(k.usage_limit):null,valid_from:new Date(k.valid_from).toISOString(),valid_until:k.valid_until?new Date(k.valid_until).toISOString():null,is_active:k.is_active,applicable_templates:k.applicable_templates.length>0?k.applicable_templates:null};if(i){let{error:b}=await cG.from("promo_codes").update(a).eq("id",i.id);if(b)throw b}else{let{error:b}=await cG.from("promo_codes").insert(a);if(b)throw b}await m(),h(!1),p()}catch(a){console.error("Error saving promo code:",a),alert("   : "+a.message)}},o=async a=>{if(confirm("       ?"))try{let{error:b}=await cG.from("promo_codes").delete().eq("id",a);if(b)throw b;await m()}catch(a){console.error("Error deleting promo code:",a),alert("   ")}},p=()=>{j(null),l({code:"",description:"",discount_type:"percentage",discount_value:10,min_purchase_amount:"",max_discount_amount:"",usage_limit:"",valid_from:(0,cH.format)(new Date,"yyyy-MM-dd"),valid_until:"",is_active:!0,applicable_templates:[]})},q=a.filter(a=>a.code.toLowerCase().includes(e.toLowerCase())||a.description.toLowerCase().includes(e.toLowerCase()));return(0,x.jsxs)("div",{className:"space-y-6",children:[(0,x.jsxs)("div",{className:"flex items-center justify-between",children:[(0,x.jsxs)("div",{children:[(0,x.jsxs)("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[(0,x.jsx)(P,{className:"h-6 w-6"})," "]}),(0,x.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"   "})]}),(0,x.jsxs)(A.Button,{onClick:()=>{p(),h(!0)},className:"gap-2",children:[(0,x.jsx)(J.Plus,{className:"h-4 w-4"}),"  "]})]}),(0,x.jsxs)("div",{className:"relative",children:[(0,x.jsx)(O.Search,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,x.jsx)(B.Input,{placeholder:"    ...",value:e,onChange:a=>f(a.target.value),className:"pr-10"})]}),(0,x.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,x.jsxs)(I.Card,{className:"p-4",children:[(0,x.jsx)("div",{className:"text-sm text-muted-foreground",children:'" '}),(0,x.jsx)("div",{className:"text-2xl font-bold mt-1",children:a.length})]}),(0,x.jsxs)(I.Card,{className:"p-4",children:[(0,x.jsx)("div",{className:"text-sm text-muted-foreground",children:" "}),(0,x.jsx)("div",{className:"text-2xl font-bold mt-1 text-green-600",children:a.filter(a=>a.is_active).length})]}),(0,x.jsxs)(I.Card,{className:"p-4",children:[(0,x.jsx)("div",{className:"text-sm text-muted-foreground",children:'" '}),(0,x.jsx)("div",{className:"text-2xl font-bold mt-1",children:a.reduce((a,b)=>a+b.usage_count,0)})]}),(0,x.jsxs)(I.Card,{className:"p-4",children:[(0,x.jsx)("div",{className:"text-sm text-muted-foreground",children:" "}),(0,x.jsx)("div",{className:"text-2xl font-bold mt-1 text-red-600",children:a.filter(a=>a.valid_until&&new Date(a.valid_until)<new Date).length})]})]}),(0,x.jsx)("div",{className:"space-y-3",children:c?(0,x.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"..."}):0===q.length?(0,x.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:e?"  ":"   "}):q.map(a=>{let b=a.valid_until&&new Date(a.valid_until)<new Date,c=a.usage_limit&&a.usage_count>=a.usage_limit;return(0,x.jsx)(I.Card,{className:"p-4",children:(0,x.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,x.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,x.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,x.jsx)("code",{className:"text-lg font-bold bg-muted px-3 py-1 rounded",children:a.code}),(0,x.jsx)(H.Badge,{variant:a.is_active&&!b?"default":"secondary",children:a.is_active?b?" ":"":" "}),"percentage"===a.discount_type?(0,x.jsxs)(H.Badge,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:[a.discount_value,"% "]}):(0,x.jsxs)(H.Badge,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:[a.discount_value," "]}),c&&(0,x.jsx)(H.Badge,{variant:"outline",className:"bg-red-50 text-red-700 border-red-200",children:" "})]}),(0,x.jsx)("p",{className:"text-sm text-muted-foreground",children:a.description}),(0,x.jsxs)("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[(0,x.jsxs)("span",{className:"flex items-center gap-1",children:[(0,x.jsx)(Q.Calendar,{className:"h-3 w-3"}),(0,cH.format)(new Date(a.valid_from),"dd/MM/yyyy"),a.valid_until&&` - ${(0,cH.format)(new Date(a.valid_until),"dd/MM/yyyy")}`]}),(0,x.jsxs)("span",{className:"flex items-center gap-1",children:[(0,x.jsx)(R,{className:"h-3 w-3"}),": ",a.usage_count,a.usage_limit&&` / ${a.usage_limit}`]}),a.min_purchase_amount&&(0,x.jsxs)("span",{children:[": ",a.min_purchase_amount,""]})]})]}),(0,x.jsxs)("div",{className:"flex items-center gap-2",children:[(0,x.jsx)(A.Button,{variant:"ghost",size:"sm",onClick:()=>{var b;return b=a.code,void(navigator.clipboard.writeText(b),alert(` ${b}  `))},title:" ",children:(0,x.jsx)(N,{className:"h-4 w-4"})}),(0,x.jsx)(A.Button,{variant:"ghost",size:"sm",onClick:()=>{j(a),l({code:a.code,description:a.description,discount_type:a.discount_type,discount_value:a.discount_value,min_purchase_amount:a.min_purchase_amount?.toString()||"",max_discount_amount:a.max_discount_amount?.toString()||"",usage_limit:a.usage_limit?.toString()||"",valid_from:(0,cH.format)(new Date(a.valid_from),"yyyy-MM-dd"),valid_until:a.valid_until?(0,cH.format)(new Date(a.valid_until),"yyyy-MM-dd"):"",is_active:a.is_active,applicable_templates:a.applicable_templates||[]}),h(!0)},title:"",children:(0,x.jsx)(K.Pencil,{className:"h-4 w-4"})}),(0,x.jsx)(A.Button,{variant:"ghost",size:"sm",onClick:()=>o(a.id),title:"",className:"text-red-600 hover:text-red-700",children:(0,x.jsx)(L.Trash2,{className:"h-4 w-4"})})]})]})},a.id)})}),(0,x.jsx)(D.Dialog,{open:g,onOpenChange:h,children:(0,x.jsxs)(D.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,x.jsxs)(D.DialogHeader,{children:[(0,x.jsx)(D.DialogTitle,{children:i?"  ":"  "}),(0,x.jsx)(D.DialogDescription,{children:"      "})]}),(0,x.jsxs)("div",{className:"space-y-4",children:[(0,x.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,x.jsxs)("div",{className:"space-y-2",children:[(0,x.jsx)(C.Label,{children:" *"}),(0,x.jsx)(B.Input,{placeholder:"SUMMER20",value:k.code,onChange:a=>l({...k,code:a.target.value.toUpperCase()}),maxLength:20})]}),(0,x.jsxs)("div",{className:"space-y-2",children:[(0,x.jsx)(C.Label,{children:"  *"}),(0,x.jsxs)(E.Select,{value:k.discount_type,onValueChange:a=>l({...k,discount_type:a}),children:[(0,x.jsx)(E.SelectTrigger,{children:(0,x.jsx)(E.SelectValue,{})}),(0,x.jsxs)(E.SelectContent,{children:[(0,x.jsx)(E.SelectItem,{value:"percentage",children:" (%)"}),(0,x.jsx)(E.SelectItem,{value:"fixed",children:"  ()"})]})]})]})]}),(0,x.jsxs)("div",{className:"space-y-2",children:[(0,x.jsx)(C.Label,{children:" *"}),(0,x.jsx)(F.Textarea,{placeholder:"  20%",value:k.description,onChange:a=>l({...k,description:a.target.value}),rows:2})]}),(0,x.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,x.jsxs)("div",{className:"space-y-2",children:[(0,x.jsxs)(C.Label,{children:["  * (","percentage"===k.discount_type?"%":"",")"]}),(0,x.jsx)(B.Input,{type:"number",min:"0",value:k.discount_value,onChange:a=>l({...k,discount_value:parseFloat(a.target.value)})})]}),(0,x.jsxs)("div",{className:"space-y-2",children:[(0,x.jsx)(C.Label,{children:"  ()"}),(0,x.jsx)(B.Input,{type:"number",min:"0",placeholder:" ",value:k.usage_limit,onChange:a=>l({...k,usage_limit:a.target.value})})]})]}),(0,x.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,x.jsxs)("div",{className:"space-y-2",children:[(0,x.jsx)(C.Label,{children:"   ()"}),(0,x.jsx)(B.Input,{type:"number",min:"0",placeholder:"0",value:k.min_purchase_amount,onChange:a=>l({...k,min_purchase_amount:a.target.value})})]}),(0,x.jsxs)("div",{className:"space-y-2",children:[(0,x.jsx)(C.Label,{children:"  ()"}),(0,x.jsx)(B.Input,{type:"number",min:"0",placeholder:" ",value:k.max_discount_amount,onChange:a=>l({...k,max_discount_amount:a.target.value})})]})]}),(0,x.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,x.jsxs)("div",{className:"space-y-2",children:[(0,x.jsx)(C.Label,{children:" - *"}),(0,x.jsx)(B.Input,{type:"date",value:k.valid_from,onChange:a=>l({...k,valid_from:a.target.value})})]}),(0,x.jsxs)("div",{className:"space-y-2",children:[(0,x.jsx)(C.Label,{children:"  ()"}),(0,x.jsx)(B.Input,{type:"date",value:k.valid_until,onChange:a=>l({...k,valid_until:a.target.value})})]})]}),(0,x.jsxs)("div",{className:"flex items-center gap-2",children:[(0,x.jsx)(G.Switch,{checked:k.is_active,onCheckedChange:a=>l({...k,is_active:a})}),(0,x.jsx)(C.Label,{children:" "})]}),(0,x.jsxs)("div",{className:"flex gap-2 pt-4",children:[(0,x.jsx)(A.Button,{onClick:n,className:"flex-1",children:i?"":"  "}),(0,x.jsx)(A.Button,{variant:"outline",onClick:()=>h(!1),children:""})]})]})]})})]})}var cJ=a.i(44986);let cK=(0,M.default)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);var cL=a.i(6665),cM=a.i(96926),cN=a.i(26345),cO=a.i(75407);let cP={bronze:{label:"Bronze",color:"bg-orange-100 text-orange-700 border-orange-300",gradient:"from-orange-400 to-orange-600",nextTier:"Silver",nextAmount:2e3},silver:{label:"Silver",color:"bg-gray-200 text-gray-700 border-gray-400",gradient:"from-gray-400 to-gray-600",nextTier:"Gold",nextAmount:5e3},gold:{label:"Gold",color:"bg-yellow-100 text-yellow-700 border-yellow-400",gradient:"from-yellow-400 to-yellow-600",nextTier:"Platinum",nextAmount:1e4},platinum:{label:"Platinum",color:"bg-purple-100 text-purple-700 border-purple-400",gradient:"from-purple-400 to-purple-600",nextTier:null,nextAmount:null}};function cQ(){let[a,b]=(0,y.useState)([]),[c,d]=(0,y.useState)(!0),[e,f]=(0,y.useState)(""),[g,h]=(0,y.useState)("all"),[i,j]=(0,y.useState)(null),[k,l]=(0,y.useState)(!1);(0,y.useEffect)(()=>{m()},[]);let m=async()=>{try{let{data:a,error:c}=await cG.from("loyalty_members").select("*").order("total_spent",{ascending:!1});if(c)throw c;b(a||[])}catch(a){console.error("Error loading loyalty members:",a)}finally{d(!1)}},n=async(a,b)=>{if(confirm("        ?"))try{let{error:c}=await cG.from("loyalty_members").update({membership_tier:b,discount_percentage:{bronze:5,silver:10,gold:15,platinum:20}[b]}).eq("id",a);if(c)throw c;await m(),alert("   !")}catch(a){console.error("Error upgrading tier:",a),alert("  ")}},o=a.filter(a=>{let b=a.email.toLowerCase().includes(e.toLowerCase())||a.first_name?.toLowerCase().includes(e.toLowerCase())||a.last_name?.toLowerCase().includes(e.toLowerCase()),c="all"===g||a.membership_tier===g;return b&&c}),p={total:a.length,active:a.filter(a=>a.is_active).length,totalBookings:a.reduce((a,b)=>a+b.total_bookings,0),totalRevenue:a.reduce((a,b)=>a+b.total_spent,0),bronze:a.filter(a=>"bronze"===a.membership_tier).length,silver:a.filter(a=>"silver"===a.membership_tier).length,gold:a.filter(a=>"gold"===a.membership_tier).length,platinum:a.filter(a=>"platinum"===a.membership_tier).length};return(0,x.jsxs)("div",{className:"space-y-6",children:[(0,x.jsxs)("div",{children:[(0,x.jsxs)("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[(0,x.jsx)(cJ.Crown,{className:"h-6 w-6 text-yellow-500"})," "]}),(0,x.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"     "})]}),(0,x.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,x.jsx)(I.Card,{className:"p-4",children:(0,x.jsxs)("div",{className:"flex items-center justify-between",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("div",{className:"text-sm text-muted-foreground",children:'" '}),(0,x.jsx)("div",{className:"text-2xl font-bold mt-1",children:p.total})]}),(0,x.jsx)(cL.Users,{className:"h-8 w-8 text-muted-foreground/30"})]})}),(0,x.jsx)(I.Card,{className:"p-4",children:(0,x.jsxs)("div",{className:"flex items-center justify-between",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("div",{className:"text-sm text-muted-foreground",children:""}),(0,x.jsx)("div",{className:"text-2xl font-bold mt-1",children:p.totalBookings})]}),(0,x.jsx)(cK,{className:"h-8 w-8 text-muted-foreground/30"})]})}),(0,x.jsx)(I.Card,{className:"p-4",children:(0,x.jsxs)("div",{className:"flex items-center justify-between",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("div",{className:"text-sm text-muted-foreground",children:""}),(0,x.jsxs)("div",{className:"text-2xl font-bold mt-1",children:[p.totalRevenue.toLocaleString(),""]})]}),(0,x.jsx)(cM.DollarSign,{className:"h-8 w-8 text-muted-foreground/30"})]})}),(0,x.jsxs)(I.Card,{className:"p-4",children:[(0,x.jsx)("div",{className:"text-sm text-muted-foreground mb-2",children:" "}),(0,x.jsxs)("div",{className:"space-y-1 text-xs",children:[(0,x.jsxs)("div",{className:"flex justify-between",children:[(0,x.jsx)("span",{children:" Bronze"}),(0,x.jsx)("span",{className:"font-semibold",children:p.bronze})]}),(0,x.jsxs)("div",{className:"flex justify-between",children:[(0,x.jsx)("span",{children:" Silver"}),(0,x.jsx)("span",{className:"font-semibold",children:p.silver})]}),(0,x.jsxs)("div",{className:"flex justify-between",children:[(0,x.jsx)("span",{children:" Gold"}),(0,x.jsx)("span",{className:"font-semibold",children:p.gold})]}),(0,x.jsxs)("div",{className:"flex justify-between",children:[(0,x.jsx)("span",{children:" Platinum"}),(0,x.jsx)("span",{className:"font-semibold",children:p.platinum})]})]})]})]}),(0,x.jsxs)("div",{className:"flex gap-3",children:[(0,x.jsxs)("div",{className:"relative flex-1",children:[(0,x.jsx)(O.Search,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,x.jsx)(B.Input,{placeholder:"    ...",value:e,onChange:a=>f(a.target.value),className:"pr-10"})]}),(0,x.jsxs)(E.Select,{value:g,onValueChange:h,children:[(0,x.jsx)(E.SelectTrigger,{className:"w-[180px]",children:(0,x.jsx)(E.SelectValue,{placeholder:" "})}),(0,x.jsxs)(E.SelectContent,{children:[(0,x.jsx)(E.SelectItem,{value:"all",children:" "}),(0,x.jsx)(E.SelectItem,{value:"bronze",children:" Bronze"}),(0,x.jsx)(E.SelectItem,{value:"silver",children:" Silver"}),(0,x.jsx)(E.SelectItem,{value:"gold",children:" Gold"}),(0,x.jsx)(E.SelectItem,{value:"platinum",children:" Platinum"})]})]})]}),(0,x.jsx)("div",{className:"space-y-3",children:c?(0,x.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"..."}):0===o.length?(0,x.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:e||"all"!==g?"  ":"   "}):o.map(a=>{let b=cP[a.membership_tier],c=b.nextAmount?a.total_spent/b.nextAmount*100:100;return(0,x.jsx)(I.Card,{className:"p-4 cursor-pointer hover:bg-accent/50 transition-colors",onClick:()=>{j(a),l(!0)},children:(0,x.jsx)("div",{className:"flex items-start justify-between gap-4",children:(0,x.jsxs)("div",{className:"flex-1 space-y-3",children:[(0,x.jsxs)("div",{className:"flex items-center gap-3 flex-wrap",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("div",{className:"font-semibold",children:a.first_name&&a.last_name?`${a.first_name} ${a.last_name}`:a.email}),(0,x.jsxs)("div",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[(0,x.jsx)(cN.Mail,{className:"h-3 w-3"}),a.email]}),a.phone&&(0,x.jsxs)("div",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[(0,x.jsx)(cO.Phone,{className:"h-3 w-3"}),a.phone]})]}),(0,x.jsxs)(H.Badge,{variant:"outline",className:b.color,children:[(0,x.jsx)(cJ.Crown,{className:"h-3 w-3 mr-1"}),b.label]}),(0,x.jsxs)(H.Badge,{variant:"secondary",children:[a.discount_percentage,"% "]})]}),(0,x.jsxs)("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("div",{className:"text-muted-foreground",children:""}),(0,x.jsx)("div",{className:"font-semibold",children:a.total_bookings})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("div",{className:"text-muted-foreground",children:""}),(0,x.jsxs)("div",{className:"font-semibold",children:[a.total_spent.toLocaleString(),""]})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("div",{className:"text-muted-foreground",children:""}),(0,x.jsx)("div",{className:"font-semibold",children:a.points.toLocaleString()})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("div",{className:"text-muted-foreground",children:" "}),(0,x.jsx)("div",{className:"font-semibold text-xs",children:a.last_booking_at?(0,cH.format)(new Date(a.last_booking_at),"dd/MM/yy"):"-"})]})]}),b.nextTier&&(0,x.jsxs)("div",{children:[(0,x.jsxs)("div",{className:"flex justify-between text-xs text-muted-foreground mb-1",children:[(0,x.jsxs)("span",{children:[" -",b.nextTier]}),(0,x.jsxs)("span",{children:[a.total_spent.toLocaleString()," /"," ",b.nextAmount?.toLocaleString(),""]})]}),(0,x.jsx)("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:(0,x.jsx)("div",{className:`h-full bg-gradient-to-r ${b.gradient}`,style:{width:`${Math.min(c,100)}%`}})})]})]})})},a.id)})}),i&&(0,x.jsx)(D.Dialog,{open:k,onOpenChange:l,children:(0,x.jsxs)(D.DialogContent,{className:"max-w-md",children:[(0,x.jsxs)(D.DialogHeader,{children:[(0,x.jsx)(D.DialogTitle,{children:"  "}),(0,x.jsxs)(D.DialogDescription,{children:[i.first_name," ",i.last_name]})]}),(0,x.jsxs)("div",{className:"space-y-4",children:[(0,x.jsxs)("div",{className:"space-y-2",children:[(0,x.jsx)("div",{className:"text-sm font-medium",children:" "}),(0,x.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,x.jsxs)("div",{className:"flex justify-between",children:[(0,x.jsx)("span",{className:"text-muted-foreground",children:":"}),(0,x.jsx)("span",{children:i.email})]}),i.phone&&(0,x.jsxs)("div",{className:"flex justify-between",children:[(0,x.jsx)("span",{className:"text-muted-foreground",children:":"}),(0,x.jsx)("span",{children:i.phone})]}),(0,x.jsxs)("div",{className:"flex justify-between",children:[(0,x.jsx)("span",{className:"text-muted-foreground",children:" :"}),(0,x.jsx)("span",{children:(0,cH.format)(new Date(i.created_at),"dd/MM/yyyy")})]})]})]}),(0,x.jsxs)("div",{className:"space-y-2",children:[(0,x.jsx)("div",{className:"text-sm font-medium",children:" "}),(0,x.jsxs)("div",{className:"flex items-center gap-2",children:[(0,x.jsx)(H.Badge,{className:cP[i.membership_tier].color,children:cP[i.membership_tier].label}),(0,x.jsxs)("span",{className:"text-sm",children:[i.discount_percentage,"% "]})]}),(0,x.jsxs)(E.Select,{value:i.membership_tier,onValueChange:a=>n(i.id,a),children:[(0,x.jsx)(E.SelectTrigger,{children:(0,x.jsx)(E.SelectValue,{})}),(0,x.jsxs)(E.SelectContent,{children:[(0,x.jsx)(E.SelectItem,{value:"bronze",children:" Bronze (5%)"}),(0,x.jsx)(E.SelectItem,{value:"silver",children:" Silver (10%)"}),(0,x.jsx)(E.SelectItem,{value:"gold",children:" Gold (15%)"}),(0,x.jsx)(E.SelectItem,{value:"platinum",children:" Platinum (20%)"})]})]})]}),(0,x.jsxs)("div",{className:"space-y-2",children:[(0,x.jsx)("div",{className:"text-sm font-medium",children:""}),(0,x.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,x.jsxs)(I.Card,{className:"p-3",children:[(0,x.jsx)("div",{className:"text-xs text-muted-foreground",children:""}),(0,x.jsx)("div",{className:"text-xl font-bold",children:i.total_bookings})]}),(0,x.jsxs)(I.Card,{className:"p-3",children:[(0,x.jsx)("div",{className:"text-xs text-muted-foreground",children:""}),(0,x.jsx)("div",{className:"text-xl font-bold",children:i.points})]}),(0,x.jsxs)(I.Card,{className:"p-3 col-span-2",children:[(0,x.jsx)("div",{className:"text-xs text-muted-foreground",children:'" '}),(0,x.jsxs)("div",{className:"text-xl font-bold",children:[i.total_spent.toLocaleString(),""]})]})]})]}),(0,x.jsx)(A.Button,{variant:"outline",className:"w-full",onClick:()=>l(!1),children:""})]})]})})]})}let cR=(0,M.default)("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),cS=(0,M.default)("MousePointer",[["path",{d:"M12.586 12.586 19 19",key:"ea5xo7"}],["path",{d:"M3.688 3.037a.497.497 0 0 0-.651.651l6.5 15.999a.501.501 0 0 0 .947-.062l1.569-6.083a2 2 0 0 1 1.448-1.479l6.124-1.579a.5.5 0 0 0 .063-.947z",key:"277e5u"}]]);var cT=a.i(71917);let cU=(0,M.default)("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);var cV=a.i(52621);let cW=(0,M.default)("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);function cX(){let[a,b]=(0,y.useState)([]),[c,d]=(0,y.useState)(!0),[e,f]=(0,y.useState)("7"),[g,h]=(0,y.useState)("all");(0,y.useEffect)(()=>{i()},[e]);let i=async()=>{try{let a=new Date;a.setDate(a.getDate()-parseInt(e));let c=cG.from("affiliate_tracking").select("*").gte("created_at",a.toISOString()).order("created_at",{ascending:!1}),{data:d,error:f}=await c;if(f)throw f;b(d||[])}catch(a){console.error("Error loading affiliate tracking:",a)}finally{d(!1)}},j="all"===g?a:a.filter(a=>a.utm_source===g),k={totalVisits:j.length,conversions:j.filter(a=>a.converted).length,conversionRate:j.length>0?j.filter(a=>a.converted).length/j.length*100:0,totalRevenue:j.reduce((a,b)=>a+(b.conversion_value||0),0),totalCommission:j.reduce((a,b)=>a+(b.commission_amount||0),0),avgOrderValue:j.filter(a=>a.converted).length>0?j.reduce((a,b)=>a+(b.conversion_value||0),0)/j.filter(a=>a.converted).length:0},l=j.reduce((a,b)=>{let c=b.utm_source||"direct";return a[c]||(a[c]={visits:0,conversions:0,revenue:0}),a[c].visits++,b.converted&&(a[c].conversions++,a[c].revenue+=b.conversion_value||0),a},{}),m=j.reduce((a,b)=>{let c=b.utm_campaign||"no-campaign";return a[c]||(a[c]={visits:0,conversions:0,revenue:0}),a[c].visits++,b.converted&&(a[c].conversions++,a[c].revenue+=b.conversion_value||0),a},{}),n=j.reduce((a,b)=>{let c=b.device_type||"unknown";return a[c]=(a[c]||0)+1,a},{}),o=Array.from(new Set(a.map(a=>a.utm_source).filter(Boolean)));return(0,x.jsxs)("div",{className:"space-y-6",children:[(0,x.jsxs)("div",{className:"flex items-center justify-between",children:[(0,x.jsxs)("div",{children:[(0,x.jsxs)("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[(0,x.jsx)(cR,{className:"h-6 w-6"}),"Affiliate Analytics"]}),(0,x.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"    "})]}),(0,x.jsxs)("div",{className:"flex gap-2",children:[(0,x.jsxs)(E.Select,{value:g,onValueChange:h,children:[(0,x.jsx)(E.SelectTrigger,{className:"w-[150px]",children:(0,x.jsx)(E.SelectValue,{placeholder:" "})}),(0,x.jsxs)(E.SelectContent,{children:[(0,x.jsx)(E.SelectItem,{value:"all",children:" "}),o.map(a=>(0,x.jsx)(E.SelectItem,{value:a,children:a},a))]})]}),(0,x.jsxs)(E.Select,{value:e,onValueChange:f,children:[(0,x.jsx)(E.SelectTrigger,{className:"w-[150px]",children:(0,x.jsx)(E.SelectValue,{})}),(0,x.jsxs)(E.SelectContent,{children:[(0,x.jsx)(E.SelectItem,{value:"1",children:"24 "}),(0,x.jsx)(E.SelectItem,{value:"7",children:"7 "}),(0,x.jsx)(E.SelectItem,{value:"30",children:"30 "}),(0,x.jsx)(E.SelectItem,{value:"90",children:"90 "}),(0,x.jsx)(E.SelectItem,{value:"365",children:""})]})]})]})]}),(0,x.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[(0,x.jsx)(I.Card,{className:"p-4",children:(0,x.jsxs)("div",{className:"flex items-center justify-between",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("div",{className:"text-sm text-muted-foreground",children:""}),(0,x.jsx)("div",{className:"text-2xl font-bold mt-1",children:k.totalVisits})]}),(0,x.jsx)(cS,{className:"h-8 w-8 text-muted-foreground/30"})]})}),(0,x.jsx)(I.Card,{className:"p-4",children:(0,x.jsxs)("div",{className:"flex items-center justify-between",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("div",{className:"text-sm text-muted-foreground",children:""}),(0,x.jsx)("div",{className:"text-2xl font-bold mt-1 text-green-600",children:k.conversions})]}),(0,x.jsx)(cT.CheckCircle,{className:"h-8 w-8 text-green-600/30"})]})}),(0,x.jsx)(I.Card,{className:"p-4",children:(0,x.jsxs)("div",{className:"flex items-center justify-between",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("div",{className:"text-sm text-muted-foreground",children:" "}),(0,x.jsxs)("div",{className:"text-2xl font-bold mt-1",children:[k.conversionRate.toFixed(1),"%"]})]}),(0,x.jsx)(cK,{className:"h-8 w-8 text-muted-foreground/30"})]})}),(0,x.jsx)(I.Card,{className:"p-4",children:(0,x.jsxs)("div",{className:"flex items-center justify-between",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("div",{className:"text-sm text-muted-foreground",children:""}),(0,x.jsxs)("div",{className:"text-2xl font-bold mt-1",children:[k.totalRevenue.toLocaleString(),""]})]}),(0,x.jsx)(cM.DollarSign,{className:"h-8 w-8 text-muted-foreground/30"})]})}),(0,x.jsx)(I.Card,{className:"p-4",children:(0,x.jsxs)("div",{className:"flex items-center justify-between",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("div",{className:"text-sm text-muted-foreground",children:""}),(0,x.jsxs)("div",{className:"text-2xl font-bold mt-1 text-blue-600",children:[k.totalCommission.toLocaleString(),""]})]}),(0,x.jsx)(cM.DollarSign,{className:"h-8 w-8 text-blue-600/30"})]})}),(0,x.jsx)(I.Card,{className:"p-4",children:(0,x.jsxs)("div",{className:"flex items-center justify-between",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("div",{className:"text-sm text-muted-foreground",children:" "}),(0,x.jsxs)("div",{className:"text-2xl font-bold mt-1",children:[k.avgOrderValue.toLocaleString(),""]})]}),(0,x.jsx)(cL.Users,{className:"h-8 w-8 text-muted-foreground/30"})]})})]}),(0,x.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,x.jsxs)(I.Card,{className:"p-6",children:[(0,x.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[(0,x.jsx)(cU,{className:"h-5 w-5"}),"  "]}),(0,x.jsxs)("div",{className:"space-y-3",children:[Object.entries(l).sort((a,b)=>b[1].visits-a[1].visits).slice(0,5).map(([a,b])=>(0,x.jsxs)("div",{className:"flex items-center justify-between",children:[(0,x.jsxs)("div",{className:"flex-1",children:[(0,x.jsxs)("div",{className:"flex items-center gap-2",children:[(0,x.jsx)("span",{className:"font-medium capitalize",children:a}),(0,x.jsxs)(H.Badge,{variant:"secondary",className:"text-xs",children:[b.visits," "]})]}),(0,x.jsxs)("div",{className:"text-sm text-muted-foreground mt-1",children:[b.conversions,"  (",(b.conversions/b.visits*100).toFixed(1),"%)"]})]}),(0,x.jsxs)("div",{className:"text-right",children:[(0,x.jsxs)("div",{className:"font-semibold",children:[b.revenue.toLocaleString(),""]}),(0,x.jsx)("div",{className:"text-xs text-muted-foreground",children:""})]})]},a)),0===Object.keys(l).length&&(0,x.jsx)("div",{className:"text-center py-8 text-muted-foreground text-sm",children:"  "})]})]}),(0,x.jsxs)(I.Card,{className:"p-6",children:[(0,x.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[(0,x.jsx)(cK,{className:"h-5 w-5"})," "]}),(0,x.jsxs)("div",{className:"space-y-3",children:[Object.entries(m).sort((a,b)=>b[1].revenue-a[1].revenue).slice(0,5).map(([a,b])=>(0,x.jsxs)("div",{className:"flex items-center justify-between",children:[(0,x.jsxs)("div",{className:"flex-1",children:[(0,x.jsxs)("div",{className:"flex items-center gap-2",children:[(0,x.jsx)("span",{className:"font-medium",children:"no-campaign"===a?" ":a}),(0,x.jsx)(H.Badge,{variant:"secondary",className:"text-xs",children:b.visits})]}),(0,x.jsxs)("div",{className:"text-sm text-muted-foreground mt-1",children:[b.conversions," "]})]}),(0,x.jsx)("div",{className:"text-right",children:(0,x.jsxs)("div",{className:"font-semibold",children:[b.revenue.toLocaleString(),""]})})]},a)),0===Object.keys(m).length&&(0,x.jsx)("div",{className:"text-center py-8 text-muted-foreground text-sm",children:"  "})]})]})]}),(0,x.jsxs)(I.Card,{className:"p-6",children:[(0,x.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"  "}),(0,x.jsx)("div",{className:"grid grid-cols-3 gap-4",children:Object.entries(n).map(([a,b])=>{let c=b/k.totalVisits*100;return(0,x.jsxs)("div",{className:"text-center",children:["mobile"===a?(0,x.jsx)(cV.Smartphone,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}):(0,x.jsx)(cW,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),(0,x.jsx)("div",{className:"text-2xl font-bold",children:b}),(0,x.jsxs)("div",{className:"text-sm text-muted-foreground capitalize",children:[a," (",c.toFixed(1),"%)"]})]},a)})})]}),(0,x.jsxs)(I.Card,{className:"p-6",children:[(0,x.jsx)("h3",{className:"text-lg font-semibold mb-4",children:" "}),(0,x.jsx)("div",{className:"space-y-3",children:c?(0,x.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"..."}):0===j.length?(0,x.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"  "}):j.slice(0,10).map(a=>(0,x.jsxs)("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[(0,x.jsxs)("div",{className:"flex-1",children:[(0,x.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,x.jsx)(H.Badge,{variant:"outline",className:"capitalize",children:a.utm_source||"direct"}),a.utm_medium&&(0,x.jsx)(H.Badge,{variant:"secondary",children:a.utm_medium}),a.utm_campaign&&(0,x.jsx)(H.Badge,{variant:"secondary",children:a.utm_campaign}),a.converted&&(0,x.jsx)(H.Badge,{className:"bg-green-600",children:" "})]}),(0,x.jsxs)("div",{className:"text-xs text-muted-foreground mt-1",children:[(0,cH.format)(new Date(a.created_at),"dd/MM/yyyy HH:mm")," "," ",a.device_type||"unknown","  ",a.browser||"unknown"]})]}),a.converted&&a.conversion_value&&(0,x.jsxs)("div",{className:"text-right",children:[(0,x.jsxs)("div",{className:"font-semibold",children:[a.conversion_value.toLocaleString(),""]}),a.commission_amount&&(0,x.jsxs)("div",{className:"text-xs text-muted-foreground",children:[": ",a.commission_amount.toLocaleString(),""]})]})]},a.id))})]})]})}function cY(){let[a,b]=(0,y.useState)("promo");return(0,x.jsxs)("div",{className:"container mx-auto p-6",children:[(0,x.jsxs)("div",{className:"mb-6",children:[(0,x.jsx)("h1",{className:"text-3xl font-bold",children:"  "}),(0,x.jsx)("p",{className:"text-muted-foreground mt-2",children:"  ,   -Affiliate tracking"})]}),(0,x.jsxs)(z.Tabs,{value:a,onValueChange:b,children:[(0,x.jsxs)(z.TabsList,{className:"grid w-full grid-cols-3 mb-6",children:[(0,x.jsxs)(z.TabsTrigger,{value:"promo",className:"flex items-center gap-2",children:[(0,x.jsx)(P,{className:"h-4 w-4"})," "]}),(0,x.jsxs)(z.TabsTrigger,{value:"loyalty",className:"flex items-center gap-2",children:[(0,x.jsx)(cJ.Crown,{className:"h-4 w-4"})," "]}),(0,x.jsxs)(z.TabsTrigger,{value:"affiliate",className:"flex items-center gap-2",children:[(0,x.jsx)(cR,{className:"h-4 w-4"}),"Affiliate"]})]}),(0,x.jsx)(z.TabsContent,{value:"promo",children:(0,x.jsx)(cI,{})}),(0,x.jsx)(z.TabsContent,{value:"loyalty",children:(0,x.jsx)(cQ,{})}),(0,x.jsx)(z.TabsContent,{value:"affiliate",children:(0,x.jsx)(cX,{})})]})]})}a.s(["MarketingDashboard",()=>cY],24607)}];

//# sourceMappingURL=components_admin_marketing-dashboard_tsx_8ee2a550._.js.map