module.exports=[1124,e=>{"use strict";e.i(23301),e.i(60859);var t=e.i(82220);let r=process.env.MEDICI_API_URL||"https://api.medici.com",a=process.env.MEDICI_API_KEY;async function n(e){let{endpoint:t,method:n,body:o,token:s}=e,i={"Content-Type":"application/json"};s?i.Authorization=`Bearer ${s}`:a&&(i["x-api-key"]=a);try{let e=await fetch(`${r}${t}`,{method:n,headers:i,body:o?JSON.stringify(o):void 0});if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.message||`API error: ${e.status}`)}return await e.json()}catch(e){throw console.error("Medici API error:",e),e}}async function o(e,t){try{let r={destination:e.destination,checkin:e.checkIn,checkout:e.checkOut,rooms:e.rooms,adults:e.adults,children:e.children||0,currency:e.currency||"USD",...e.filters},a=await n({endpoint:"/v1/hotels/search",method:"POST",body:r});return a.searchId&&(t.metadata.lastSearchId=a.searchId),{success:!0,data:{searchId:a.searchId,totalResults:a.hotels?.length||0,hotels:a.hotels?.slice(0,10).map(e=>({hotelId:e.hotelId,name:e.name,address:e.address,starRating:e.starRating,rating:e.rating,reviewCount:e.reviewCount,mainImage:e.images?.[0],lowestPrice:e.lowestPrice,currency:e.currency,amenities:e.amenities?.slice(0,5),distanceFromCenter:e.distanceFromCenter}))}}}catch(e){return{success:!1,data:null,error:e.message||"Failed to search hotels"}}}async function s(e,t){try{let t=await n({endpoint:`/v1/destinations/search?q=${encodeURIComponent(e.query)}&limit=${e.limit||10}`,method:"GET"});return{success:!0,data:{destinations:t.destinations?.map(e=>({id:e.id,name:e.name,type:e.type,country:e.country,region:e.region,coordinates:e.coordinates}))}}}catch(e){return{success:!1,data:null,error:e.message||"Failed to search destinations"}}}async function i(e,t){try{let r=await n({endpoint:"/v1/booking/prebook",method:"POST",body:{hotelId:e.hotelId,roomId:e.roomId,rateId:e.rateId,checkin:e.checkIn,checkout:e.checkOut,guests:e.guests}});return r.prebookToken&&(t.metadata.prebookToken=r.prebookToken,t.metadata.prebookExpiry=r.expiresAt),{success:!0,data:{prebookToken:r.prebookToken,expiresAt:r.expiresAt,totalPrice:r.totalPrice,currency:r.currency,cancellationPolicy:r.cancellationPolicy,roomDetails:{name:r.room?.name,bedType:r.room?.bedType,maxOccupancy:r.room?.maxOccupancy,amenities:r.room?.amenities},rateDetails:{name:r.rate?.name,mealPlan:r.rate?.mealPlan,refundable:r.rate?.refundable}}}}catch(e){return{success:!1,data:null,error:e.message||"Failed to prebook room"}}}async function c(e,t){try{let r=e.prebookToken||t.metadata.prebookToken;if(!r)return{success:!1,data:null,error:"No prebook token available. Please prebook a room first."};let a=await n({endpoint:"/v1/booking/book",method:"POST",body:{prebookToken:r,guest:e.guest,payment:e.payment}});return t.metadata.lastBookingId=a.bookingId,t.metadata.lastConfirmationNumber=a.confirmationNumber,{success:!0,data:{bookingId:a.bookingId,confirmationNumber:a.confirmationNumber,status:a.status,hotelName:a.hotel?.name,checkIn:a.checkIn,checkOut:a.checkOut,roomType:a.room?.name,totalPrice:a.totalPrice,currency:a.currency,guestName:`${e.guest.firstName} ${e.guest.lastName}`,confirmationEmail:e.guest.email}}}catch(e){return{success:!1,data:null,error:e.message||"Failed to complete booking"}}}async function l(e,t){try{let r=e.bookingId||t.metadata.lastBookingId,a=e.confirmationNumber||t.metadata.lastConfirmationNumber;if(!r&&!a)return{success:!1,data:null,error:"Please provide a booking ID or confirmation number."};let o=await n({endpoint:"/v1/booking/cancel",method:"POST",body:{bookingId:r,confirmationNumber:a,email:e.email,reason:e.reason}});return{success:!0,data:{cancellationId:o.cancellationId,bookingId:o.bookingId,confirmationNumber:o.confirmationNumber,status:o.status,refundAmount:o.refundAmount,refundCurrency:o.refundCurrency,refundStatus:o.refundStatus,cancellationFee:o.cancellationFee,message:o.message||"Booking successfully cancelled"}}}catch(e){return{success:!1,data:null,error:e.message||"Failed to cancel booking"}}}async function d(e,t){try{let t=new URLSearchParams;e.bookingId&&t.set("bookingId",e.bookingId),e.confirmationNumber&&t.set("confirmationNumber",e.confirmationNumber),e.email&&t.set("email",e.email);let r=await n({endpoint:`/v1/booking/lookup?${t.toString()}`,method:"GET"});return{success:!0,data:{bookingId:r.bookingId,confirmationNumber:r.confirmationNumber,status:r.status,hotelName:r.hotel?.name,hotelAddress:r.hotel?.address,checkIn:r.checkIn,checkOut:r.checkOut,roomType:r.room?.name,guestName:r.guest?.name,totalPrice:r.totalPrice,currency:r.currency,cancellationPolicy:r.cancellationPolicy,canCancel:r.canCancel,canModify:r.canModify}}}catch(e){return{success:!1,data:null,error:e.message||"Failed to find booking"}}}async function u(e,t){try{let t=await n({endpoint:`/v1/hotels/${e.hotelId}`,method:"GET"});return{success:!0,data:{hotelId:t.hotelId,name:t.name,description:t.description,address:t.address,city:t.city,country:t.country,coordinates:t.coordinates,starRating:t.starRating,rating:t.rating,reviewCount:t.reviewCount,images:t.images,amenities:t.amenities,policies:{checkIn:t.policies?.checkIn,checkOut:t.policies?.checkOut,cancellation:t.policies?.cancellation,children:t.policies?.children,pets:t.policies?.pets},contact:t.contact}}}catch(e){return{success:!1,data:null,error:e.message||"Failed to get hotel details"}}}(0,t.registerToolHandler)("search_hotels",o),(0,t.registerToolHandler)("search_destinations",s),(0,t.registerToolHandler)("prebook_room",i),(0,t.registerToolHandler)("complete_booking",c),(0,t.registerToolHandler)("cancel_booking",l),(0,t.registerToolHandler)("lookup_booking",d),(0,t.registerToolHandler)("get_hotel_details",u),process.env.AZURE_COMMUNICATION_CONNECTION_STRING,process.env.AZURE_SPEECH_KEY,process.env.AZURE_SPEECH_REGION,process.env.TWILIO_ACCOUNT_SID,process.env.TWILIO_AUTH_TOKEN,process.env.TWILIO_PHONE_NUMBER;let m=new Map;async function g(e,t){try{if(e.phoneNumber.replace(/\D/g,"").length<10)return{success:!1,data:null,error:"Invalid phone number format"};let r=`voice-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,a={sessionId:r,phoneNumber:e.phoneNumber,status:"initiating",startTime:new Date().toISOString(),transcript:[],metadata:{language:e.language||"en",initialMessage:e.initialMessage,conversationSessionId:t.sessionId}};return m.set(r,a),a.status="ringing",a.callId=`call-${Date.now()}`,t.metadata.activeVoiceSession=r,{success:!0,data:{sessionId:r,callId:a.callId,status:a.status,phoneNumber:e.phoneNumber,message:"Call initiated successfully. Waiting for customer to answer."}}}catch(e){return{success:!1,data:null,error:e.message||"Failed to initiate call"}}}async function p(e,t){try{let r=e.sessionId||t.metadata.activeVoiceSession;if(!r)return{success:!1,data:null,error:"No active voice session found"};let a=m.get(r);if(!a)return{success:!1,data:null,error:"Voice session not found"};a.status="ended",a.endTime=new Date().toISOString();let n=new Date(a.startTime).getTime(),o=new Date(a.endTime).getTime(),s=Math.round((o-n)/1e3);return delete t.metadata.activeVoiceSession,{success:!0,data:{sessionId:r,status:"ended",duration:s,transcriptLength:a.transcript.length,endReason:e.reason||"completed",message:"Call ended successfully"}}}catch(e){return{success:!1,data:null,error:e.message||"Failed to end call"}}}async function h(e,t){try{let r=t.metadata.activeVoiceSession;if(!r)return{success:!1,data:null,error:"No active voice session"};let a=m.get(r);if(!a||"connected"!==a.status)return{success:!1,data:null,error:"Voice session not connected"};return a.transcript.push({speaker:"agent",text:e.text,timestamp:new Date().toISOString()}),{success:!0,data:{sessionId:r,text:e.text,language:e.language||a.metadata.language,voiceId:e.voiceId||"he-IL-HilaNeural",duration:Math.ceil(e.text.length/15),message:"Speech synthesized and played"}}}catch(e){return{success:!1,data:null,error:e.message||"Failed to synthesize speech"}}}async function y(e,t){try{let r=t.metadata.activeVoiceSession;if(!r)return{success:!1,data:null,error:"No active voice session"};let a=m.get(r);if(!a||"connected"!==a.status)return{success:!1,data:null,error:"Voice session not connected"};return{success:!0,data:{sessionId:r,recognized:!0,text:"[Customer response would be transcribed here]",confidence:.95,language:e.language||a.metadata.language,message:"Listening for customer input"}}}catch(e){return{success:!1,data:null,error:e.message||"Failed to recognize speech"}}}async function f(e,t){try{if(e.phoneNumber.replace(/\D/g,"").length<10)return{success:!1,data:null,error:"Invalid phone number format"};if(e.message.length>1600)return{success:!1,data:null,error:"Message too long. Maximum 1600 characters."};let r=`sms-${Date.now()}-${Math.random().toString(36).substr(2,6)}`;return t.metadata.sentMessages||(t.metadata.sentMessages=[]),t.metadata.sentMessages.push({id:r,type:"sms",to:e.phoneNumber,content:e.message,sentAt:new Date().toISOString()}),{success:!0,data:{messageId:r,to:e.phoneNumber,status:"sent",segments:Math.ceil(e.message.length/160),message:"SMS sent successfully"}}}catch(e){return{success:!1,data:null,error:e.message||"Failed to send SMS"}}}async function b(e,t){try{let r=e.sessionId||t.metadata.activeVoiceSession;if(!r)return{success:!1,data:null,error:"No voice session specified"};let a=m.get(r);if(!a)return{success:!1,data:null,error:"Voice session not found"};let n=new Date(a.startTime).getTime(),o=a.endTime?new Date(a.endTime).getTime():Date.now(),s=Math.round((o-n)/1e3);return{success:!0,data:{sessionId:r,callId:a.callId,status:a.status,phoneNumber:a.phoneNumber,duration:s,transcriptLength:a.transcript.length,language:a.metadata.language}}}catch(e){return{success:!1,data:null,error:e.message||"Failed to get call status"}}}async function I(e,t){try{let r=e.sessionId||t.metadata.activeVoiceSession;if(!r)return{success:!1,data:null,error:"No voice session to transfer"};let a=m.get(r);if(!a||"connected"!==a.status)return{success:!1,data:null,error:"Voice session not connected"};return{success:!0,data:{sessionId:r,status:"transferring",targetNumber:e.targetNumber,reason:e.reason||"Customer request",message:"Call transfer initiated"}}}catch(e){return{success:!1,data:null,error:e.message||"Failed to transfer call"}}}(0,t.registerToolHandler)("initiate_call",g),(0,t.registerToolHandler)("end_call",p),(0,t.registerToolHandler)("speak_text",h),(0,t.registerToolHandler)("listen_speech",y),(0,t.registerToolHandler)("send_sms",f),(0,t.registerToolHandler)("get_call_status",b),(0,t.registerToolHandler)("transfer_call",I);let $=new Map,k=new Map;async function P(e,t){try{let r=`alert-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,a={id:r,hotelId:e.hotelId,hotelName:e.hotelName,roomType:e.roomType,checkIn:e.checkIn,checkOut:e.checkOut,alertType:e.alertType,targetPrice:e.targetPrice,thresholdPercentage:e.thresholdPercentage||10,status:"active",createdAt:new Date().toISOString(),priceHistory:[],userId:t.metadata.userId,notificationMethod:e.notificationMethod,notificationEmail:e.email,notificationPhone:e.phone};return $.set(r,a),t.metadata.priceAlerts||(t.metadata.priceAlerts=[]),t.metadata.priceAlerts.push(r),{success:!0,data:{alertId:r,hotelName:e.hotelName,roomType:e.roomType,dates:`${e.checkIn} to ${e.checkOut}`,alertType:e.alertType,targetPrice:e.targetPrice,thresholdPercentage:e.thresholdPercentage,notificationMethod:e.notificationMethod,status:"active",message:"Price alert created successfully. You will be notified when conditions are met."}}}catch(e){return{success:!1,data:null,error:e.message||"Failed to create price alert"}}}async function T(e,t){try{let r=Array.from($.values());return t.metadata.userId&&(r=r.filter(e=>e.userId===t.metadata.userId)),e.status&&(r=r.filter(t=>t.status===e.status)),e.hotelId&&(r=r.filter(t=>t.hotelId===e.hotelId)),{success:!0,data:{totalAlerts:r.length,alerts:r.map(e=>({id:e.id,hotelName:e.hotelName,roomType:e.roomType,dates:`${e.checkIn} to ${e.checkOut}`,alertType:e.alertType,targetPrice:e.targetPrice,status:e.status,createdAt:e.createdAt,lastChecked:e.lastChecked,currentPrice:e.priceHistory[e.priceHistory.length-1]?.price,priceChanges:e.priceHistory.length}))}}}catch(e){return{success:!1,data:null,error:e.message||"Failed to get price alerts"}}}async function N(e,t){try{let r=$.get(e.alertId);if(!r)return{success:!1,data:null,error:"Price alert not found"};if(t.metadata.userId&&r.userId!==t.metadata.userId)return{success:!1,data:null,error:"Not authorized to cancel this alert"};return r.status="cancelled",{success:!0,data:{alertId:e.alertId,hotelName:r.hotelName,status:"cancelled",message:"Price alert cancelled successfully"}}}catch(e){return{success:!1,data:null,error:e.message||"Failed to cancel price alert"}}}async function v(e,t){try{let t=`${e.hotelId}-${e.roomType||"all"}`,r=k.get(t)||[],a=r;(e.startDate||e.endDate)&&(a=r.filter(t=>{let r=new Date(t.timestamp);return!(e.startDate&&r<new Date(e.startDate)||e.endDate&&r>new Date(e.endDate))}));let n=a.map(e=>e.price),o=n.length>0?{minPrice:Math.min(...n),maxPrice:Math.max(...n),avgPrice:Math.round(n.reduce((e,t)=>e+t,0)/n.length),currentPrice:n[n.length-1],priceChange:n.length>1?((n[n.length-1]-n[0])/n[0]*100).toFixed(1):0}:null;return{success:!0,data:{hotelId:e.hotelId,roomType:e.roomType,dataPoints:a.length,dateRange:{from:a[0]?.timestamp,to:a[a.length-1]?.timestamp},statistics:o,trend:o&&-5>Number(o.priceChange)?"declining":o&&Number(o.priceChange)>5?"rising":"stable",history:a.slice(-30)}}}catch(e){return{success:!1,data:null,error:e.message||"Failed to get price history"}}}async function w(e,t){try{let t,r,a=`${e.hotelId}-${e.roomType||"all"}`,n=k.get(a)||[],o="week"===e.period?7:"quarter"===e.period?90:30,s=new Date;s.setDate(s.getDate()-o);let i=n.filter(e=>new Date(e.timestamp)>=s);if(i.length<2)return{success:!0,data:{hotelId:e.hotelId,period:e.period||"month",message:"Insufficient data for trend analysis",recommendation:"Continue monitoring to gather more price data"}};let c=i.map(e=>e.price),l=c[0],d=c[c.length-1],u=((d-l)/l*100).toFixed(1),m=c.reduce((e,t)=>e+t,0)/c.length,g=c.reduce((e,t)=>e+Math.pow(t-m,2),0)/c.length,p=Math.sqrt(g);return -10>=Number(u)?(t="strong-decline",r="Great time to book! Prices have dropped significantly."):-5>=Number(u)?(t="moderate-decline",r="Good opportunity to book. Prices are trending down."):Number(u)>=10?(t="strong-increase",r="Consider booking soon. Prices are rising quickly."):Number(u)>=5?(t="moderate-increase",r="Prices are slowly rising. Book when ready."):(t="stable",r="Prices are stable. No urgency to book."),{success:!0,data:{hotelId:e.hotelId,roomType:e.roomType,period:e.period||"month",dataPoints:i.length,analysis:{trend:t,changePercent:`${u}%`,startPrice:l,endPrice:d,minPrice:Math.min(...c),maxPrice:Math.max(...c),avgPrice:Math.round(m),volatility:p.toFixed(2),volatilityLevel:p>.1*m?"high":p>.05*m?"moderate":"low"},recommendation:r,bestTimeToBook:t.includes("decline")?"Prices may drop further. Consider waiting a few more days.":t.includes("increase")?"Book now before prices increase more.":"Current prices are reasonable. Book at your convenience."}}}catch(e){return{success:!1,data:null,error:e.message||"Failed to analyze price trends"}}}async function S(e,t){try{let t=e.hotelIds.map((e,t)=>{let r=150+200*Math.random();return{hotelId:e,hotelName:`Hotel ${e}`,prices:[{source:"Direct",price:Math.round(r),currency:"USD"},{source:"Booking.com",price:Math.round(1.05*r),currency:"USD"},{source:"Expedia",price:Math.round(1.08*r),currency:"USD"},{source:"Hotels.com",price:Math.round(1.03*r),currency:"USD"}],bestPrice:Math.round(r),bestSource:"Direct"}}),r=t.reduce((e,t)=>t.bestPrice<e.bestPrice?t:e);return{success:!0,data:{checkIn:e.checkIn,checkOut:e.checkOut,roomType:e.roomType,comparisons:t,bestOverall:{hotelId:r.hotelId,hotelName:r.hotelName,price:r.bestPrice,source:r.bestSource},savings:`Book direct to save up to ${Math.round(15*Math.random()+5)}%`}}}catch(e){return{success:!1,data:null,error:e.message||"Failed to compare prices"}}}async function M(e,t){try{if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.to))return{success:!1,data:null,error:"Invalid email address format"};let r=`email-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;return console.log(`Sending email to ${e.to}: ${e.subject}`),t.metadata.sentNotifications||(t.metadata.sentNotifications=[]),t.metadata.sentNotifications.push({id:r,type:"email",to:e.to,subject:e.subject,sentAt:new Date().toISOString()}),{success:!0,data:{messageId:r,to:e.to,subject:e.subject,status:"sent",timestamp:new Date().toISOString(),message:"Email sent successfully"}}}catch(e){return{success:!1,data:null,error:e.message||"Failed to send email"}}}async function D(e,t){try{let{bookingDetails:r,language:a="en"}=e,n="he"===a?`砖专  - ${r.hotelName}`:`Booking Confirmation - ${r.hotelName}`,o="he"===a?`
砖 ${r.guestName},

转 注 转!  驻专 :

住驻专 砖专: ${r.confirmationNumber}
: ${r.hotelName}
转转: ${r.hotelAddress}
爪'拽-: ${r.checkIn}
爪'拽-: ${r.checkOut}
住 专: ${r.roomType}
住": ${r.currency} ${r.totalPrice}

${r.cancellationPolicy?`转 : ${r.cancellationPolicy}`:""}

转专!
    `:`
Dear ${r.guestName},

Thank you for your booking! Here are your reservation details:

Confirmation Number: ${r.confirmationNumber}
Hotel: ${r.hotelName}
Address: ${r.hotelAddress}
Check-in: ${r.checkIn}
Check-out: ${r.checkOut}
Room Type: ${r.roomType}
Total: ${r.currency} ${r.totalPrice}

${r.cancellationPolicy?`Cancellation Policy: ${r.cancellationPolicy}`:""}

We look forward to welcoming you!
    `;return M({to:e.email,subject:n,body:o,templateId:"booking-confirmation",templateData:r},t)}catch(e){return{success:!1,data:null,error:e.message||"Failed to send booking confirmation"}}}async function _(e,t){try{let{cancellationDetails:r,language:a="en"}=e,n="he"===a?`砖专  - ${r.hotelName}`:`Cancellation Confirmation - ${r.hotelName}`,o=r.refundAmount?"he"===a?`住 专: ${r.refundCurrency} ${r.refundAmount}`:`Refund Amount: ${r.refundCurrency} ${r.refundAmount}`:"",s="he"===a?`
砖 ${r.guestName},

转  爪.

住驻专  拽专: ${r.confirmationNumber}
住驻专 : ${r.cancellationId}
: ${r.hotelName}
${o}

砖 砖专转 转 注转.
    `:`
Dear ${r.guestName},

Your booking has been successfully cancelled.

Original Confirmation: ${r.confirmationNumber}
Cancellation ID: ${r.cancellationId}
Hotel: ${r.hotelName}
${o}

We hope to serve you again in the future.
    `;return M({to:e.email,subject:n,body:s,templateId:"cancellation-confirmation",templateData:r},t)}catch(e){return{success:!1,data:null,error:e.message||"Failed to send cancellation confirmation"}}}async function C(e,t){try{let{alertDetails:r,method:a,language:n="en"}=e;if("email"===a&&!e.email)return{success:!1,data:null,error:"Email address required for email notifications"};if("sms"===a&&!e.phone)return{success:!1,data:null,error:"Phone number required for SMS notifications"};let o=r.priceChange<0?"he"===n?"专":"dropped":"he"===n?"注":"increased",s=`alert-${Date.now()}-${Math.random().toString(36).substr(2,6)}`;if("email"===a){let a="he"===n?` 转专转 专: ${r.hotelName}`:` Price Alert: ${r.hotelName}`,s="he"===n?`
专 注专 ${r.hotelName} ${o}!

专: ${r.roomType}
转专: ${r.dates}
专 拽: ${r.currency} ${r.previousPrice}
专 : ${r.currency} ${r.currentPrice}
砖: ${r.priceChange}%

${r.bookingUrl?`: ${r.bookingUrl}`:""}
      `:`
The price for ${r.hotelName} has ${o}!

Room: ${r.roomType}
Dates: ${r.dates}
Previous Price: ${r.currency} ${r.previousPrice}
Current Price: ${r.currency} ${r.currentPrice}
Change: ${r.priceChange}%

${r.bookingUrl?`Book now: ${r.bookingUrl}`:""}
      `;return M({to:e.email,subject:a,body:s,templateId:"price-alert"},t)}if("sms"!==a)return{success:!0,data:{messageId:s,type:"push",status:"sent",message:"Push notification sent successfully"}};{let a="he"===n?` ${r.hotelName}: 专 ${o} -${r.currency}${r.currentPrice} (${r.priceChange}%)`:` ${r.hotelName}: Price ${o} to ${r.currency}${r.currentPrice} (${r.priceChange}%)`;return t.metadata.sentNotifications||(t.metadata.sentNotifications=[]),t.metadata.sentNotifications.push({id:s,type:"sms",to:e.phone,content:a,sentAt:new Date().toISOString()}),{success:!0,data:{messageId:s,to:e.phone,type:"sms",status:"sent",message:"Price alert SMS sent successfully"}}}}catch(e){return{success:!1,data:null,error:e.message||"Failed to send price alert notification"}}}async function O(e,t){try{let{reminderDetails:r,method:a}=e,n=`reminder-${Date.now()}-${Math.random().toString(36).substr(2,6)}`;if("email"===a&&e.email)return M({to:e.email,subject:r.title,body:r.message,templateId:`reminder-${r.type}`},t);return t.metadata.sentNotifications||(t.metadata.sentNotifications=[]),t.metadata.sentNotifications.push({id:n,type:a,reminderType:r.type,title:r.title,sentAt:new Date().toISOString()}),{success:!0,data:{messageId:n,type:a,reminderType:r.type,status:"sent",message:"Reminder sent successfully"}}}catch(e){return{success:!1,data:null,error:e.message||"Failed to send reminder"}}}async function H(e,t){try{let r=t.metadata.sentNotifications||[];return e.type&&(r=r.filter(t=>t.type===e.type)),e.limit&&(r=r.slice(-e.limit)),{success:!0,data:{totalNotifications:r.length,notifications:r.map(e=>({id:e.id,type:e.type,to:e.to,subject:e.subject,sentAt:e.sentAt}))}}}catch(e){return{success:!1,data:null,error:e.message||"Failed to get notification history"}}}(0,t.registerToolHandler)("create_price_alert",P),(0,t.registerToolHandler)("get_price_alerts",T),(0,t.registerToolHandler)("cancel_price_alert",N),(0,t.registerToolHandler)("get_price_history",v),(0,t.registerToolHandler)("analyze_price_trends",w),(0,t.registerToolHandler)("compare_prices",S),(0,t.registerToolHandler)("send_email",M),(0,t.registerToolHandler)("send_booking_confirmation",D),(0,t.registerToolHandler)("send_cancellation_confirmation",_),(0,t.registerToolHandler)("send_price_alert",C),(0,t.registerToolHandler)("send_reminder",O),(0,t.registerToolHandler)("get_notification_history",H);let A=new Map,F=[],x={bronze:0,silver:5e3,gold:15e3,platinum:5e4},E={bronze:["Earn 1 point per $1","Member-only rates","Birthday bonus"],silver:["Earn 1.25 points per $1","Late checkout","Welcome drink","Priority support"],gold:["Earn 1.5 points per $1","Room upgrade when available","Lounge access","Free breakfast"],platinum:["Earn 2 points per $1","Guaranteed upgrade","Suite access","Personal concierge","Airport transfer"]};async function R(e,t){try{let r;if(e.memberId?r=A.get(e.memberId):e.email?r=Array.from(A.values()).find(t=>t.email===e.email):t.metadata.loyaltyMemberId&&(r=A.get(t.metadata.loyaltyMemberId)),!r)return{success:!1,data:null,error:"Loyalty member not found"};let a=E[r.tier],n="platinum"===r.tier?null:"gold"===r.tier?"platinum":"silver"===r.tier?"gold":"silver",o=n?x[n]-r.tierProgressPoints:0;return{success:!0,data:{memberId:r.id,name:`${r.firstName} ${r.lastName}`,email:r.email,tier:r.tier,points:r.points,lifetimePoints:r.lifetimePoints,tierProgress:{currentPoints:r.tierProgressPoints,nextTier:n,pointsToNextTier:o,progressPercent:n?Math.round(r.tierProgressPoints/x[n]*100):100},benefits:a,expiringPoints:r.expiringPoints,memberSince:r.joinDate}}}catch(e){return{success:!1,data:null,error:e.message||"Failed to get loyalty account"}}}async function U(e,t){try{let r=e.memberId||t.metadata.loyaltyMemberId;if(!r)return{success:!1,data:null,error:"Member ID required"};let a=A.get(r);if(!a)return{success:!1,data:null,error:"Loyalty member not found"};let n=F.filter(e=>e.memberId===r).slice(-5).map(e=>({type:e.type,points:e.points,description:e.description,date:e.timestamp}));return{success:!0,data:{memberId:a.id,availablePoints:a.points,lifetimePoints:a.lifetimePoints,tier:a.tier,expiringPoints:a.expiringPoints,recentTransactions:n}}}catch(e){return{success:!1,data:null,error:e.message||"Failed to get points balance"}}}async function L(e,t){try{let t;if(e.memberId?t=A.get(e.memberId):e.email&&(t=Array.from(A.values()).find(t=>t.email===e.email)),!t)return{success:!1,data:null,error:"Loyalty member not found"};let r=Math.round(e.amount),a={bronze:1,silver:1.25,gold:1.5,platinum:2}[t.tier],n=e.bonusMultiplier||1,o=Math.round(r*a*n);t.points+=o,t.lifetimePoints+=o,t.tierProgressPoints+=o;let s=null;"bronze"===t.tier&&t.tierProgressPoints>=x.silver?(t.tier="silver",s="silver"):"silver"===t.tier&&t.tierProgressPoints>=x.gold?(t.tier="gold",s="gold"):"gold"===t.tier&&t.tierProgressPoints>=x.platinum&&(t.tier="platinum",s="platinum");let i={id:`txn-${Date.now()}-${Math.random().toString(36).substr(2,6)}`,memberId:t.id,type:"earn",points:o,description:e.description||`Earned from booking ${e.bookingId||"N/A"}`,bookingId:e.bookingId,timestamp:new Date().toISOString()};return F.push(i),{success:!0,data:{memberId:t.id,pointsEarned:o,breakdown:{basePoints:r,tierMultiplier:a,bonusMultiplier:n,total:o},newBalance:t.points,tierUpgrade:s,tier:t.tier,transactionId:i.id,message:s?`Congratulations! You earned ${o} points and upgraded to ${s}!`:`You earned ${o} points!`}}}catch(e){return{success:!1,data:null,error:e.message||"Failed to earn points"}}}async function B(e,t){try{let r=e.memberId||t.metadata.loyaltyMemberId;if(!r)return{success:!1,data:null,error:"Member ID required"};let a=A.get(r);if(!a)return{success:!1,data:null,error:"Loyalty member not found"};if(a.points<e.points)return{success:!1,data:null,error:`Insufficient points. You have ${a.points} points, need ${e.points}`};a.points-=e.points;let n={id:`txn-${Date.now()}-${Math.random().toString(36).substr(2,6)}`,memberId:a.id,type:"redeem",points:-e.points,description:`Redeemed for ${e.rewardType}`,timestamp:new Date().toISOString()};F.push(n);let o={discount:.01*e.points,"free-night":+(e.points>=1e4),upgrade:e.points>=5e3?"room-upgrade":null,experience:"experience-voucher",transfer:e.points};return{success:!0,data:{memberId:a.id,pointsRedeemed:e.points,rewardType:e.rewardType,rewardValue:o[e.rewardType],remainingPoints:a.points,transactionId:n.id,redemptionCode:`RDM-${Date.now().toString(36).toUpperCase()}`,message:`Successfully redeemed ${e.points} points for ${e.rewardType}`}}}catch(e){return{success:!1,data:null,error:e.message||"Failed to redeem points"}}}async function z(e,t){try{let r=e.tier;if(!r&&e.memberId){let t=A.get(e.memberId);t&&(r=t.tier)}if(!r&&t.metadata.loyaltyMemberId){let e=A.get(t.metadata.loyaltyMemberId);e&&(r=e.tier)}r||(r="bronze");let a=["bronze","silver","gold","platinum"],n=a.indexOf(r);return{success:!0,data:{currentTier:r,benefits:E[r],threshold:x[r],nextTier:n<3?a[n+1]:null,nextTierThreshold:n<3?x[a[n+1]]:null,allTiers:a.map(e=>({name:e,threshold:x[e],benefits:E[e]}))}}}catch(e){return{success:!1,data:null,error:e.message||"Failed to get tier benefits"}}}async function V(e,t){try{let r=e.memberId||t.metadata.loyaltyMemberId;if(!r)return{success:!1,data:null,error:"Member ID required"};let a=F.filter(e=>e.memberId===r);e.type&&(a=a.filter(t=>t.type===e.type)),e.limit&&(a=a.slice(-e.limit));let n=a.filter(e=>"earn"===e.type||"bonus"===e.type).reduce((e,t)=>e+t.points,0),o=a.filter(e=>"redeem"===e.type).reduce((e,t)=>e+Math.abs(t.points),0);return{success:!0,data:{memberId:r,totalTransactions:a.length,summary:{totalEarned:n,totalRedeemed:o,netPoints:n-o},transactions:a.map(e=>({id:e.id,type:e.type,points:e.points,description:e.description,bookingId:e.bookingId,date:e.timestamp}))}}}catch(e){return{success:!1,data:null,error:e.message||"Failed to get transaction history"}}}(0,t.registerToolHandler)("get_loyalty_account",R),(0,t.registerToolHandler)("get_points_balance",U),(0,t.registerToolHandler)("earn_points",L),(0,t.registerToolHandler)("redeem_points",B),(0,t.registerToolHandler)("get_tier_benefits",z),(0,t.registerToolHandler)("get_transaction_history",V),e.s([],1124)}];

//# sourceMappingURL=v0-bookinengine_lib_hotel-booking-ai_index_ts_b9f209b2._.js.map