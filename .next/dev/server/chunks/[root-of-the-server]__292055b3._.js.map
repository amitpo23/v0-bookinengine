{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/97250/Desktop/booking%20engine/v0-bookinengine/lib/promotions/promotions-db.ts"],"sourcesContent":["import type { Promotion } from \"./types\"\r\n\r\nconst promotions: Promotion[] = [\r\n  {\r\n    id: \"MOBILE_FLASH_2024\",\r\n    title: \"מבצע פלאש - הזמנה מהמובייל!\",\r\n    description: \"קבלו 20% הנחה על כל ההזמנות מהמובייל - מוגבל לשעות הקרובות בלבד!\",\r\n    discountType: \"percentage\",\r\n    discountValue: 20,\r\n    validFrom: new Date().toISOString(),\r\n    validTo: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(),\r\n    mobileOnly: true,\r\n    active: true,\r\n    imageUrl: \"/mobile-flash-sale.jpg\",\r\n    terms: \"ההנחה תקפה להזמנות מהמובייל בלבד. לא ניתן לשלב עם מבצעים אחרים.\",\r\n  },\r\n  {\r\n    id: \"EARLY_BIRD_2024\",\r\n    title: \"מבצע הזמנה מוקדמת\",\r\n    description: \"הזמינו 30 יום מראש וקבלו 15% הנחה!\",\r\n    discountType: \"percentage\",\r\n    discountValue: 15,\r\n    minNights: 2,\r\n    validFrom: new Date().toISOString(),\r\n    validTo: new Date(Date.now() + 90 * 24 * 60 * 60 * 1000).toISOString(),\r\n    mobileOnly: false,\r\n    active: true,\r\n    imageUrl: \"/early-bird-discount.jpg\",\r\n    terms: \"ההנחה תקפה להזמנות של 2 לילות לפחות. תאריכי שהייה לפי זמינות.\",\r\n  },\r\n  {\r\n    id: \"WEEKEND_SPECIAL\",\r\n    title: 'מבצע סופ\"ש',\r\n    description: '500 ₪ הנחה על חבילות סופ\"ש!',\r\n    discountType: \"fixed\",\r\n    discountValue: 500,\r\n    minNights: 2,\r\n    validFrom: new Date().toISOString(),\r\n    validTo: new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toISOString(),\r\n    mobileOnly: false,\r\n    active: true,\r\n    imageUrl: \"/weekend-getaway.png\",\r\n    terms: \"תקף לשישי-שבת בלבד. מינימום 2 לילות.\",\r\n  },\r\n]\r\n\r\nexport function getAllPromotions(): Promotion[] {\r\n  return promotions.filter((p) => p.active)\r\n}\r\n\r\nexport function getActivePromotions(isMobile: boolean): Promotion[] {\r\n  return promotions.filter((p) => {\r\n    if (!p.active) return false\r\n    if (p.mobileOnly && !isMobile) return false\r\n\r\n    const now = new Date()\r\n    const validFrom = new Date(p.validFrom)\r\n    const validTo = new Date(p.validTo)\r\n\r\n    return now >= validFrom && now <= validTo\r\n  })\r\n}\r\n\r\nexport function getPromotionById(id: string): Promotion | undefined {\r\n  return promotions.find((p) => p.id === id)\r\n}\r\n\r\nexport function addPromotion(promotion: Promotion): void {\r\n  promotions.push(promotion)\r\n}\r\n\r\nexport function updatePromotion(id: string, updates: Partial<Promotion>): boolean {\r\n  const index = promotions.findIndex((p) => p.id === id)\r\n  if (index === -1) return false\r\n\r\n  promotions[index] = { ...promotions[index], ...updates }\r\n  return true\r\n}\r\n\r\nexport function deletePromotion(id: string): boolean {\r\n  const index = promotions.findIndex((p) => p.id === id)\r\n  if (index === -1) return false\r\n\r\n  promotions.splice(index, 1)\r\n  return true\r\n}\r\n\r\nexport function calculateDiscount(\r\n  promotion: Promotion,\r\n  price: number,\r\n  nights: number,\r\n): { discountAmount: number; finalPrice: number } {\r\n  if (promotion.minNights && nights < promotion.minNights) {\r\n    return { discountAmount: 0, finalPrice: price }\r\n  }\r\n\r\n  let discountAmount = 0\r\n\r\n  if (promotion.discountType === \"percentage\") {\r\n    discountAmount = (price * promotion.discountValue) / 100\r\n  } else {\r\n    discountAmount = promotion.discountValue\r\n  }\r\n\r\n  discountAmount = Math.min(discountAmount, price)\r\n  const finalPrice = Math.max(0, price - discountAmount)\r\n\r\n  return { discountAmount, finalPrice }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAEA,MAAM,aAA0B;IAC9B;QACE,IAAI;QACJ,OAAO;QACP,aAAa;QACb,cAAc;QACd,eAAe;QACf,WAAW,IAAI,OAAO,WAAW;QACjC,SAAS,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK,KAAK,MAAM,WAAW;QAC/D,YAAY;QACZ,QAAQ;QACR,UAAU;QACV,OAAO;IACT;IACA;QACE,IAAI;QACJ,OAAO;QACP,aAAa;QACb,cAAc;QACd,eAAe;QACf,WAAW;QACX,WAAW,IAAI,OAAO,WAAW;QACjC,SAAS,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK,KAAK,KAAK,MAAM,WAAW;QACpE,YAAY;QACZ,QAAQ;QACR,UAAU;QACV,OAAO;IACT;IACA;QACE,IAAI;QACJ,OAAO;QACP,aAAa;QACb,cAAc;QACd,eAAe;QACf,WAAW;QACX,WAAW,IAAI,OAAO,WAAW;QACjC,SAAS,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK,KAAK,KAAK,MAAM,WAAW;QACpE,YAAY;QACZ,QAAQ;QACR,UAAU;QACV,OAAO;IACT;CACD;AAEM,SAAS;IACd,OAAO,WAAW,MAAM,CAAC,CAAC,IAAM,EAAE,MAAM;AAC1C;AAEO,SAAS,oBAAoB,QAAiB;IACnD,OAAO,WAAW,MAAM,CAAC,CAAC;QACxB,IAAI,CAAC,EAAE,MAAM,EAAE,OAAO;QACtB,IAAI,EAAE,UAAU,IAAI,CAAC,UAAU,OAAO;QAEtC,MAAM,MAAM,IAAI;QAChB,MAAM,YAAY,IAAI,KAAK,EAAE,SAAS;QACtC,MAAM,UAAU,IAAI,KAAK,EAAE,OAAO;QAElC,OAAO,OAAO,aAAa,OAAO;IACpC;AACF;AAEO,SAAS,iBAAiB,EAAU;IACzC,OAAO,WAAW,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;AACzC;AAEO,SAAS,aAAa,SAAoB;IAC/C,WAAW,IAAI,CAAC;AAClB;AAEO,SAAS,gBAAgB,EAAU,EAAE,OAA2B;IACrE,MAAM,QAAQ,WAAW,SAAS,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;IACnD,IAAI,UAAU,CAAC,GAAG,OAAO;IAEzB,UAAU,CAAC,MAAM,GAAG;QAAE,GAAG,UAAU,CAAC,MAAM;QAAE,GAAG,OAAO;IAAC;IACvD,OAAO;AACT;AAEO,SAAS,gBAAgB,EAAU;IACxC,MAAM,QAAQ,WAAW,SAAS,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;IACnD,IAAI,UAAU,CAAC,GAAG,OAAO;IAEzB,WAAW,MAAM,CAAC,OAAO;IACzB,OAAO;AACT;AAEO,SAAS,kBACd,SAAoB,EACpB,KAAa,EACb,MAAc;IAEd,IAAI,UAAU,SAAS,IAAI,SAAS,UAAU,SAAS,EAAE;QACvD,OAAO;YAAE,gBAAgB;YAAG,YAAY;QAAM;IAChD;IAEA,IAAI,iBAAiB;IAErB,IAAI,UAAU,YAAY,KAAK,cAAc;QAC3C,iBAAiB,AAAC,QAAQ,UAAU,aAAa,GAAI;IACvD,OAAO;QACL,iBAAiB,UAAU,aAAa;IAC1C;IAEA,iBAAiB,KAAK,GAAG,CAAC,gBAAgB;IAC1C,MAAM,aAAa,KAAK,GAAG,CAAC,GAAG,QAAQ;IAEvC,OAAO;QAAE;QAAgB;IAAW;AACtC"}},
    {"offset": {"line": 157, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/97250/Desktop/booking%20engine/v0-bookinengine/app/api/admin/promotions/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\r\nimport { addPromotion, updatePromotion, deletePromotion, getAllPromotions } from \"@/lib/promotions/promotions-db\"\r\nimport type { Promotion } from \"@/lib/promotions/types\"\r\n\r\nexport async function GET(request: NextRequest) {\r\n  const searchParams = request.nextUrl.searchParams\r\n  const template = searchParams.get(\"template\")\r\n  \r\n  const promotions = getAllPromotions()\r\n  \r\n  // Transform to expected format for admin\r\n  const formattedPromotions = promotions.map(p => ({\r\n    id: p.id,\r\n    code: p.id,\r\n    title: p.title,\r\n    description: p.description,\r\n    discountType: p.discountType,\r\n    discountValue: p.discountValue,\r\n    minNights: p.minNights,\r\n    validFrom: p.validFrom,\r\n    validTo: p.validTo,\r\n    usageCount: 0, // Not tracked yet\r\n    maxUsage: undefined,\r\n    active: p.active,\r\n    mobileOnly: p.mobileOnly,\r\n  }))\r\n  \r\n  return NextResponse.json({ success: true, promotions: formattedPromotions })\r\n}\r\n\r\nexport async function POST(request: Request) {\r\n  try {\r\n    const promotion: Promotion = await request.json()\r\n\r\n    if (!promotion.id || !promotion.title) {\r\n      return NextResponse.json({ success: false, error: \"Missing required fields\" }, { status: 400 })\r\n    }\r\n\r\n    addPromotion(promotion)\r\n    return NextResponse.json({ success: true, data: promotion })\r\n  } catch (error) {\r\n    return NextResponse.json({ success: false, error: \"Failed to create promotion\" }, { status: 500 })\r\n  }\r\n}\r\n\r\nexport async function PUT(request: Request) {\r\n  try {\r\n    const { id, ...updates } = await request.json()\r\n\r\n    if (!id) {\r\n      return NextResponse.json({ success: false, error: \"Missing promotion ID\" }, { status: 400 })\r\n    }\r\n\r\n    const success = updatePromotion(id, updates)\r\n\r\n    if (!success) {\r\n      return NextResponse.json({ success: false, error: \"Promotion not found\" }, { status: 404 })\r\n    }\r\n\r\n    return NextResponse.json({ success: true })\r\n  } catch (error) {\r\n    return NextResponse.json({ success: false, error: \"Failed to update promotion\" }, { status: 500 })\r\n  }\r\n}\r\n\r\nexport async function DELETE(request: Request) {\r\n  try {\r\n    const { id } = await request.json()\r\n\r\n    if (!id) {\r\n      return NextResponse.json({ success: false, error: \"Missing promotion ID\" }, { status: 400 })\r\n    }\r\n\r\n    const success = deletePromotion(id)\r\n\r\n    if (!success) {\r\n      return NextResponse.json({ success: false, error: \"Promotion not found\" }, { status: 404 })\r\n    }\r\n\r\n    return NextResponse.json({ success: true })\r\n  } catch (error) {\r\n    return NextResponse.json({ success: false, error: \"Failed to delete promotion\" }, { status: 500 })\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAGO,eAAe,IAAI,OAAoB;IAC5C,MAAM,eAAe,QAAQ,OAAO,CAAC,YAAY;IACjD,MAAM,WAAW,aAAa,GAAG,CAAC;IAElC,MAAM,aAAa,IAAA,2JAAgB;IAEnC,yCAAyC;IACzC,MAAM,sBAAsB,WAAW,GAAG,CAAC,CAAA,IAAK,CAAC;YAC/C,IAAI,EAAE,EAAE;YACR,MAAM,EAAE,EAAE;YACV,OAAO,EAAE,KAAK;YACd,aAAa,EAAE,WAAW;YAC1B,cAAc,EAAE,YAAY;YAC5B,eAAe,EAAE,aAAa;YAC9B,WAAW,EAAE,SAAS;YACtB,WAAW,EAAE,SAAS;YACtB,SAAS,EAAE,OAAO;YAClB,YAAY;YACZ,UAAU;YACV,QAAQ,EAAE,MAAM;YAChB,YAAY,EAAE,UAAU;QAC1B,CAAC;IAED,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,SAAS;QAAM,YAAY;IAAoB;AAC5E;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,YAAuB,MAAM,QAAQ,IAAI;QAE/C,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,UAAU,KAAK,EAAE;YACrC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAA0B,GAAG;gBAAE,QAAQ;YAAI;QAC/F;QAEA,IAAA,uJAAY,EAAC;QACb,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM,MAAM;QAAU;IAC5D,EAAE,OAAO,OAAO;QACd,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO;QAA6B,GAAG;YAAE,QAAQ;QAAI;IAClG;AACF;AAEO,eAAe,IAAI,OAAgB;IACxC,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,SAAS,GAAG,MAAM,QAAQ,IAAI;QAE7C,IAAI,CAAC,IAAI;YACP,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAuB,GAAG;gBAAE,QAAQ;YAAI;QAC5F;QAEA,MAAM,UAAU,IAAA,0JAAe,EAAC,IAAI;QAEpC,IAAI,CAAC,SAAS;YACZ,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC3F;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC3C,EAAE,OAAO,OAAO;QACd,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO;QAA6B,GAAG;YAAE,QAAQ;QAAI;IAClG;AACF;AAEO,eAAe,OAAO,OAAgB;IAC3C,IAAI;QACF,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM,QAAQ,IAAI;QAEjC,IAAI,CAAC,IAAI;YACP,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAuB,GAAG;gBAAE,QAAQ;YAAI;QAC5F;QAEA,MAAM,UAAU,IAAA,0JAAe,EAAC;QAEhC,IAAI,CAAC,SAAS;YACZ,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAsB,GAAG;gBAAE,QAAQ;YAAI;QAC3F;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC3C,EAAE,OAAO,OAAO;QACd,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO;QAA6B,GAAG;YAAE,QAAQ;QAAI;IAClG;AACF"}}]
}