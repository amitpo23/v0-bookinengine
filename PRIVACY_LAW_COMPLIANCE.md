# ğŸ‡®ğŸ‡± ×ª×™×§×•×Ÿ 14 ×œ×—×•×§ ×”×’× ×ª ×”×¤×¨×˜×™×•×ª - ×¡×˜×˜×•×¡ ×¢××™×“×”

## ×ª××¨×™×š ×‘×“×™×§×”: 13 ×™× ×•××¨ 2026

---

## ğŸ“‹ ×¡×™×›×•× ×× ×”×œ×™×

| ×¡×˜×˜×•×¡ | ×“×¨×™×©×” | ×™×™×©×•× ×‘××¢×¨×›×ª |
|-------|-------|---------------|
| âœ… | ××™× ×•×™ ×××•× ×” ××‘×˜×—×ª ××™×“×¢ | ×™×© ×œ×”×’×“×™×¨ ×‘××¨×’×•×Ÿ |
| âš ï¸ | ××¡××š ××“×™× ×™×•×ª ××‘×˜×—×ª ××™×“×¢ | × ×“×¨×© ×”×©×œ××” |
| âœ… | ×”×¦×¤× ×ª ×ª×§×©×•×¨×ª (HTTPS) | ××™×•×©× ×“×¨×š Vercel |
| âœ… | × ×™×”×•×œ ×¡×™×¡×××•×ª | NextAuth + Google OAuth |
| âš ï¸ | ×’×™×‘×•×™×™× ××•×˜×•××˜×™×™× | Supabase ××‘×¦×¢, × ×“×¨×© ×ª×™×¢×•×“ |
| âš ï¸ | ××¢×¨×›×ª ×”×¨×©××•×ª | RBAC ××™×•×©×, × ×“×¨×© ×”×¨×—×‘×” |
| âŒ | ×œ×•×’ ××‘×˜×—×” ××¨×›×–×™ | × ×“×¨×© ×™×™×©×•× ××œ× |
| âŒ | ×˜×™×¤×•×œ ×‘××™×¨×•×¢×™ ××‘×˜×—×” | × ×“×¨×© × ×•×”×œ |
| âš ï¸ | ×‘×“×™×§×•×ª ××‘×˜×—×” ×ª×§×•×¤×ª×™×•×ª | × ×“×¨×© ×ª×™×¢×•×“ |
| âœ… | ×”×’×‘×œ×ª ×’×™×©×” ×œ××™×“×¢ ×¨×’×™×© | ××™×•×©× ×—×œ×§×™×ª |

---

## 1ï¸âƒ£ ×“×¨×™×©×•×ª ×ª×™×§×•×Ÿ 14 - ×¤×™×¨×•×˜ ××œ×

### ğŸ“Œ **×¡×¢×™×£ 1: ××™× ×•×™ ×××•× ×” ×¢×œ ××‘×˜×—×ª ××™×“×¢**

**×“×¨×™×©×ª ×”×—×•×§:**
- ×›×œ ××¨×’×•×Ÿ ×©××—×–×™×§ ×××’×¨ ××™×“×¢ ×—×™×™×‘ ×œ×× ×•×ª ×××•× ×” ×¢×œ ××‘×˜×—×ª ××™×“×¢
- ×”×××•× ×” ××—×¨××™ ×¢×œ ×”×˜××¢×ª ××“×™× ×™×•×ª ×”××‘×˜×—×”

**××¦×‘ × ×•×›×—×™:** âš ï¸ **×“×¨×•×© ×”×©×œ××”**
- ××™×Ÿ ×”×’×“×¨×ª ×××•× ×” ×¨×©××™ ×‘××¢×¨×›×ª
- **×¤×¢×•×œ×” × ×“×¨×©×ª:** ×”×’×“×¨×ª ×¤×¨×˜×™ ×××•× ×” ××‘×˜×—×ª ××™×“×¢ ×‘×ª×¦×•×¨×ª ×”××ª×¨

```typescript
// × ×“×¨×© ×œ×”×•×¡×™×£ ×œ-config:
export const securityOfficer = {
  name: "[×©× ×”×××•× ×”]",
  email: "security@yourdomain.com",
  phone: "+972-XX-XXXXXXX",
  appointmentDate: "2026-01-13"
}
```

---

### ğŸ“Œ **×¡×¢×™×£ 2: ××¡××š ××“×™× ×™×•×ª ××‘×˜×—×ª ××™×“×¢**

**×“×¨×™×©×ª ×”×—×•×§:**
- ×ª×™×¢×•×“ ×‘×›×ª×‘ ×©×œ ××“×™× ×™×•×ª ××‘×˜×—×ª ×”××™×“×¢
- ×”×›×•×œ×œ: ×–×™×”×•×™ ×××’×¨×™ ××™×“×¢, ×¡×™×•×•×’ ×¨×’×™×©×•×ª, ×××¦×¢×™ ×”×’× ×”, × ×”×œ×™×

**××¦×‘ × ×•×›×—×™:** âš ï¸ **×“×¨×•×© ×”×©×œ××”**
- ×§×™×™××ª ×”×ª×™×™×—×¡×•×ª ×—×œ×§×™×ª ×‘-admin panel
- **×¤×¢×•×œ×” × ×“×¨×©×ª:** ×™×¦×™×¨×ª ××¡××š ××“×™× ×™×•×ª ××¤×•×¨×˜ (××¦×•×¨×£ ×‘×”××©×š)

---

### ğŸ“Œ **×¡×¢×™×£ 3: ×”×¦×¤× ×ª ××™×“×¢ (Encryption)**

**×“×¨×™×©×ª ×”×—×•×§:**
- ×”×¦×¤× ×ª ××™×“×¢ ×¨×’×™×© ×‘××¢×‘×¨ (in-transit)
- ×”×¦×¤× ×ª ××™×“×¢ ×¨×’×™×© ×‘×× ×•×—×” (at-rest)

**××¦×‘ × ×•×›×—×™:** âœ… **×¢×•××“ ×‘×“×¨×™×©×•×ª**

| ×¨×›×™×‘ | ×™×™×©×•× | ×¡×˜×˜×•×¡ |
|------|-------|-------|
| **HTTPS** | Vercel SSL/TLS 1.3 | âœ… |
| **API Keys** | Environment variables | âœ… |
| **Database** | Supabase encrypted at-rest | âœ… |
| **Passwords** | NextAuth + bcrypt | âœ… |
| **Payment Data** | ×œ× × ×©××¨ ×‘××¢×¨×›×ª | âœ… |

```typescript
// lib/auth.ts - ××™××•×ª ×××•×‘×˜×—
import { NextAuthOptions } from 'next-auth'
import GoogleProvider from 'next-auth/providers/google'

// ×”×¡×™×¡×××•×ª ×œ× × ×©××¨×•×ª - ×¨×§ Google OAuth
```

---

### ğŸ“Œ **×¡×¢×™×£ 4: × ×™×”×•×œ ×¡×™×¡×××•×ª**

**×“×¨×™×©×ª ×”×—×•×§:**
- ×—×•×‘×” ×œ××›×•×£ ××“×™× ×™×•×ª ×¡×™×¡×××•×ª ×—×–×§×•×ª
- ×©×™× ×•×™ ×¡×™×¡××” ×ª×§×•×¤×ª×™
- ××™×¡×•×¨ ×©×™××•×© ×—×•×–×¨ ×‘×¡×™×¡×××•×ª ×§×•×“××•×ª

**××¦×‘ × ×•×›×—×™:** âœ… **×¢×•××“ ×‘×“×¨×™×©×•×ª**

```typescript
// lib/validations/schemas.ts
export const signupSchema = z.object({
  email: z.string().email('×›×ª×•×‘×ª ××™××™×™×œ ×œ× ×ª×§×™× ×”'),
  password: z.string()
    .min(8, '×¡×™×¡××” ×—×™×™×‘×ª ×œ×”×›×™×œ ×œ×¤×—×•×ª 8 ×ª×•×•×™×')
    .regex(/[A-Z]/, '×—×™×™×‘ ×œ×›×œ×•×œ ××•×ª ×’×“×•×œ×”')
    .regex(/[0-9]/, '×—×™×™×‘ ×œ×›×œ×•×œ ××¡×¤×¨'),
  name: z.string().min(2, '×©× ×—×™×™×‘ ×œ×”×›×™×œ ×œ×¤×—×•×ª 2 ×ª×•×•×™×'),
  confirmPassword: z.string(),
}).refine((data) => data.password === data.confirmPassword, {
  message: "×”×¡×™×¡×××•×ª ×œ× ×ª×•×××•×ª",
  path: ['confirmPassword'],
})
```

**×”××œ×¦×•×ª × ×•×¡×¤×•×ª:**
- âœ… ×©×™××•×© ×‘-Google OAuth (××™×Ÿ ×¦×•×¨×š ×‘×¡×™×¡×××•×ª)
- âš ï¸ ×œ×”×•×¡×™×£ 2FA ×œ×—×©×‘×•× ×•×ª Admin
- âš ï¸ ×œ×”×•×¡×™×£ policy ×œ×ª×•×§×£ ×¡×™×¡××” (90 ×™×•×)

---

### ğŸ“Œ **×¡×¢×™×£ 5: ×’×™×‘×•×™×™× (Backups)**

**×“×¨×™×©×ª ×”×—×•×§:**
- ×’×™×‘×•×™ ×ª×§×•×¤×ª×™ ×©×œ ×××’×¨×™ ×”××™×“×¢
- ×©××™×¨×ª ×”×’×™×‘×•×™×™× ×‘××§×•× ×××•×‘×˜×—
- ×‘×“×™×§×ª ×ª×§×™× ×•×ª ×”×’×™×‘×•×™×™×

**××¦×‘ × ×•×›×—×™:** âš ï¸ **×—×œ×§×™ - ×“×¨×•×© ×ª×™×¢×•×“**

| ×¨×›×™×‘ | ×™×™×©×•× | ×ª×“×™×¨×•×ª |
|------|-------|---------|
| **Database** | Supabase Auto Backup | ×™×•××™ |
| **Code** | Git + GitHub | ×›×œ commit |
| **Environment** | Vercel Snapshots | ××•×˜×•××˜×™ |
| **Media Files** | Vercel Blob | ××’×•×‘×” |

**×¤×¢×•×œ×•×ª × ×“×¨×©×•×ª:**
1. âœ… ×ª×™×¢×•×“ × ×•×”×œ ×’×™×‘×•×™×™×
2. âš ï¸ ×‘×“×™×§×ª restore ×ª×§×•×¤×ª×™×ª (×¨×‘×¢×•× ×™×ª)
3. âš ï¸ ×©××™×¨×ª ×’×™×‘×•×™×™× off-site

---

### ğŸ“Œ **×¡×¢×™×£ 6: ××¢×¨×›×ª ×”×¨×©××•×ª (Access Control)**

**×“×¨×™×©×ª ×”×—×•×§:**
- ×”×’×‘×œ×ª ×’×™×©×” ×œ××™×“×¢ ×¨×§ ×œ××™ ×©×¦×¨×™×š
- ×¨×™×©×•× ×•×”×¨×©××•×ª ×œ×¤×™ ×ª×¤×§×™×“×™×
- ×‘×™×§×•×¨×ª ×¢×œ ×”×¨×©××•×ª (audit trail)

**××¦×‘ × ×•×›×—×™:** âš ï¸ **××™×•×©× ×—×œ×§×™×ª**

```typescript
// lib/rbac/roles.ts - ××¢×¨×›×ª RBAC ×§×™×™××ª
export type Role = 'admin' | 'manager' | 'booker' | 'viewer'

export const PERMISSIONS = {
  VIEW_BOOKINGS: ['admin', 'manager', 'booker', 'viewer'],
  CREATE_BOOKING: ['admin', 'manager', 'booker'],
  CANCEL_BOOKING: ['admin', 'manager'],
  MANAGE_USERS: ['admin'],
  VIEW_ANALYTICS: ['admin', 'manager'],
  MANAGE_TEMPLATES: ['admin'],
  MANAGE_SETTINGS: ['admin'],
}
```

**×¤×¢×¨×™×:**
- âš ï¸ ×—×¡×¨ audit log ××¤×•×¨×˜ ×œ××¢×§×‘ ××—×¨ ×’×™×©×•×ª
- âš ï¸ ×—×¡×¨ ×× ×’× ×•×Ÿ review ×ª×§×•×¤×ª×™ ×©×œ ×”×¨×©××•×ª
- âš ï¸ ×—×¡×¨ ×”×ª×¨××•×ª ×¢×œ × ×™×¡×™×•× ×•×ª ×’×™×©×” ×œ× ××•×¨×©×™×

---

### ğŸ“Œ **×¡×¢×™×£ 7: ×œ×•×’ ××™×¨×•×¢×™ ××‘×˜×—×” (Security Audit Log)**

**×“×¨×™×©×ª ×”×—×•×§:**
- ×ª×™×¢×•×“ ×›×œ ×¤×¢×•×œ×” ×‘×××’×¨ ×”××™×“×¢
- ×©××™×¨×ª ×œ×•×’×™× ×œ××©×š 7 ×©× ×™× ×œ×¤×—×•×ª
- ×”×’× ×” ×¢×œ ×”×œ×•×’×™× ××¤× ×™ ×©×™× ×•×™

**××¦×‘ × ×•×›×—×™:** âŒ **×“×¨×•×© ×™×™×©×•× ××œ×**

**×§×™×™× ×‘××¢×¨×›×ª:**
```typescript
// lib/api/booking-logger.ts - ×œ×•×’ ×—×œ×§×™
export interface BookingLogEntry {
  timestamp: Date
  sessionId: string
  eventType: string
  details: any
  userId?: string
  hotelId?: string
  roomCode?: string
  error?: string
}
```

**×—×¡×¨:**
- âŒ ×œ×•×’ ××¨×›×–×™ ×œ×›×œ ×¤×¢×•×œ×•×ª ×”××¢×¨×›×ª
- âŒ ×ª×™×¢×•×“ × ×™×¡×™×•× ×•×ª ×›× ×™×¡×” ×›×•×©×œ×™×
- âŒ ×ª×™×¢×•×“ ×©×™× ×•×™×™× ×‘×”×¨×©××•×ª
- âŒ ×ª×™×¢×•×“ ×’×™×©×” ×œ××™×“×¢ ×¨×’×™×©
- âŒ ×× ×’× ×•×Ÿ ×©××™×¨×” ×œ-7 ×©× ×™×

**×¤×ª×¨×•×Ÿ ××•××œ×¥:**
```typescript
// lib/security/audit-log.ts - × ×“×¨×© ×œ×™×™×©×•×
export interface AuditLogEntry {
  id: string
  timestamp: Date
  userId: string
  userEmail: string
  ipAddress: string
  userAgent: string
  action: AuditAction
  resource: string
  resourceId?: string
  oldValue?: any
  newValue?: any
  success: boolean
  errorMessage?: string
  metadata?: Record<string, any>
}

export enum AuditAction {
  LOGIN = 'LOGIN',
  LOGOUT = 'LOGOUT',
  LOGIN_FAILED = 'LOGIN_FAILED',
  USER_CREATED = 'USER_CREATED',
  USER_UPDATED = 'USER_UPDATED',
  USER_DELETED = 'USER_DELETED',
  ROLE_CHANGED = 'ROLE_CHANGED',
  DATA_VIEWED = 'DATA_VIEWED',
  DATA_EXPORTED = 'DATA_EXPORTED',
  BOOKING_CREATED = 'BOOKING_CREATED',
  BOOKING_CANCELLED = 'BOOKING_CANCELLED',
  SETTINGS_CHANGED = 'SETTINGS_CHANGED',
  API_KEY_ACCESSED = 'API_KEY_ACCESSED',
}
```

---

### ğŸ“Œ **×¡×¢×™×£ 8: ×˜×™×¤×•×œ ×‘××™×¨×•×¢×™ ××‘×˜×—×” (Incident Response)**

**×“×¨×™×©×ª ×”×—×•×§:**
- × ×•×”×œ ××ª×•×¢×“ ×œ×˜×™×¤×•×œ ×‘××™×¨×•×¢×™ ××‘×˜×—×”
- ×“×™×•×•×— ×œ×¨×©×•×ª ×œ×”×’× ×ª ×”×¤×¨×˜×™×•×ª ×ª×•×š 72 ×©×¢×•×ª
- ×”×•×“×¢×” ×œ××©×ª××©×™× ×‘××§×¨×™× ××¡×•×™××™×

**××¦×‘ × ×•×›×—×™:** âŒ **×—×¡×¨ ×œ×—×œ×•×˜×™×Ÿ**

**× ×“×¨×©:**
1. × ×•×”×œ ×ª×’×•×‘×” ×œ××™×¨×•×¢×™ ××‘×˜×—×”
2. ×¨×©×™××ª ×× ×©×™ ×§×©×¨
3. ×ª×‘× ×™×ª ×“×™×•×•×— ×œ×¨×©×•×ª
4. ×ª×‘× ×™×ª ×”×•×“×¢×” ×œ××©×ª××©×™×

---

### ğŸ“Œ **×¡×¢×™×£ 9: ×‘×“×™×§×•×ª ××‘×˜×—×” ×ª×§×•×¤×ª×™×•×ª**

**×“×¨×™×©×ª ×”×—×•×§:**
- ×‘×™×¦×•×¢ penetration testing ×ª×§×•×¤×ª×™
- ×¡×¨×™×§×•×ª ×—×•×œ×©×•×ª
- ×¢×“×›×•× ×™ ××‘×˜×—×”

**××¦×‘ × ×•×›×—×™:** âš ï¸ **×“×¨×•×© ×ª×™×¢×•×“**

**×§×™×™×:**
- âœ… Dependabot ×©×œ GitHub ×œ×¢×“×›×•× ×™ ×ª×œ×•×™×•×ª
- âœ… Vercel Security Scanner
- âš ï¸ ×—×¡×¨ penetration testing ××ª×•×¢×“

**××•××œ×¥:**
```bash
# ×‘×“×™×§×•×ª ××‘×˜×—×” ××•×˜×•××˜×™×•×ª
npm audit              # ×‘×“×™×§×ª ×—×•×œ×©×•×ª ×™×“×•×¢×•×ª
npm audit fix          # ×ª×™×§×•×Ÿ ××•×˜×•××˜×™
npx snyk test          # Snyk security scan
```

---

### ğŸ“Œ **×¡×¢×™×£ 10: ×”×’×‘×œ×ª ×©××™×¨×ª ××™×“×¢**

**×“×¨×™×©×ª ×”×—×•×§:**
- ×©××™×¨×ª ××™×“×¢ ××™×©×™ ×¨×§ ×œ××©×š ×”× ×“×¨×©
- ××—×™×§×” ××•×˜×•××˜×™×ª ×©×œ ××™×“×¢ ×™×©×Ÿ
- ×–×›×•×ª ××©×ª××© ×œ××—×™×§×ª × ×ª×•× ×™×

**××¦×‘ × ×•×›×—×™:** âš ï¸ **×“×¨×•×© ×™×™×©×•×**

**× ×“×¨×©:**
```typescript
// lib/privacy/data-retention.ts
export const DATA_RETENTION_POLICY = {
  // ××©×ª××©×™× ×œ× ×¤×¢×™×œ×™×
  inactiveUsers: {
    period: 365 * 3, // 3 ×©× ×™×
    action: 'anonymize'
  },
  
  // ×”×–×× ×•×ª
  bookings: {
    period: 365 * 7, // 7 ×©× ×™× (×—×•×§ ×—×©×‘×•× ××•×ª)
    action: 'archive'
  },
  
  // ×œ×•×’×™×
  logs: {
    period: 365 * 7, // 7 ×©× ×™× (×ª×™×§×•×Ÿ 14)
    action: 'archive'
  },
  
  // ×¡×©× ×™×
  sessions: {
    period: 90, // 90 ×™×•×
    action: 'delete'
  }
}
```

---

## 2ï¸âƒ£ × ×ª×•× ×™× ××™×©×™×™× ×‘××¢×¨×›×ª

### ğŸ” **××™×¤×•×™ ×××’×¨×™ ××™×“×¢**

| ×××’×¨ | × ×ª×•× ×™× | ×¨×’×™×©×•×ª | ××˜×¨×” | ×ª×•×§×£ |
|------|---------|---------|------|------|
| **users** | ×©×, ××™××™×™×œ, ×ª××•× ×”, Google ID | ×‘×™× ×•× ×™×ª | ××™××•×ª ×•×–×™×”×•×™ | ×¢×“ ××—×™×§×ª ×—×©×‘×•×Ÿ |
| **bookings** | ×¤×¨×˜×™ ×”×–×× ×”, ××œ×•×Ÿ, ××—×™×¨ | ×‘×™× ×•× ×™×ª | × ×™×”×•×œ ×”×–×× ×•×ª | 7 ×©× ×™× |
| **sessions** | Session tokens | × ××•×›×” | × ×™×”×•×œ ×›× ×™×¡×•×ª | 30 ×™×•× |
| **loyalty** | × ×§×•×“×•×ª × ××× ×•×ª, ×”×™×¡×˜×•×¨×™×” | × ××•×›×” | ×ª×›× ×™×ª × ××× ×•×ª | ×¢×“ ××—×™×§×ª ×—×©×‘×•×Ÿ |

### ğŸ›¡ï¸ **×××¦×¢×™ ×”×’× ×” ×§×™×™××™×**

```typescript
// Supabase RLS (Row Level Security)
// ×›×œ ××©×ª××© ×¨×•××” ×¨×§ ××ª ×”× ×ª×•× ×™× ×©×œ×•

// Example: policies/users.sql
CREATE POLICY "Users can view own data"
  ON users FOR SELECT
  USING (auth.uid() = id);

CREATE POLICY "Users can update own data"
  ON users FOR UPDATE
  USING (auth.uid() = id);
```

---

## 3ï¸âƒ£ ×¤×¢×•×œ×•×ª × ×“×¨×©×•×ª - ×¨×©×™××ª TODO

### ğŸ”´ **×§×¨×™×˜×™ - ×œ×‘×™×¦×•×¢ ××™×™×“×™**

1. **×™×¦×™×¨×ª Audit Log ××¨×›×–×™**
   - [ ] ×™×™×©×•× ××¢×¨×›×ª ×œ×•×’ ××œ××”
   - [ ] ×ª×™×¢×•×“ ×›×œ ×¤×¢×•×œ×•×ª ×”××©×ª××©×™×
   - [ ] ×©××™×¨×” ×‘-Supabase ×¢× RLS
   - ×§×•×“: `lib/security/audit-log.ts`

2. **× ×•×”×œ ××™×¨×•×¢×™ ××‘×˜×—×”**
   - [ ] ×›×ª×™×‘×ª × ×•×”×œ ×ª×’×•×‘×”
   - [ ] ×”×’×“×¨×ª ×× ×©×™ ×§×©×¨
   - [ ] ×ª×¨×’×•×œ (drill) ×¨×‘×¢×•× ×™

3. **×”×’×“×¨×ª ×××•× ×” ××‘×˜×—×ª ××™×“×¢**
   - [ ] ××™× ×•×™ ×¨×©××™
   - [ ] ×”×’×“×¨×” ×‘××¢×¨×›×ª
   - [ ] ×¤×¨×¡×•× ×œ×¢×•×‘×“×™×

### ğŸŸ¡ **×—×©×•×‘ - ×œ×‘×™×¦×•×¢ ×‘-30 ×™×•×**

4. **××“×™× ×™×•×ª ××‘×˜×—×ª ××™×“×¢**
   - [ ] ×›×ª×™×‘×ª ××¡××š ××œ×
   - [ ] ××™×©×•×¨ ×”× ×”×œ×”
   - [ ] ×”×“×¨×›×ª ×¢×•×‘×“×™×
   
5. **Data Retention Policy**
   - [ ] ×™×™×©×•× ××—×™×§×” ××•×˜×•××˜×™×ª
   - [ ] Cron jobs ×œ× ×™×§×•×™
   - [ ] ××¨×›×•×‘ × ×ª×•× ×™× ×™×©× ×™×

6. **2FA ×œ×—×©×‘×•× ×•×ª Admin**
   - [ ] ×”×•×¡×¤×ª TOTP
   - [ ] ×—×•×‘×ª ×”×¤×¢×œ×” ×œ××“××™× ×™×

### ğŸŸ¢ **××•××œ×¥ - ×œ×‘×™×¦×•×¢ ×‘-90 ×™×•×**

7. **Penetration Testing**
   - [ ] ×©×›×™×¨×ª ×—×‘×¨×ª ××‘×˜×—×”
   - [ ] ×‘×™×¦×•×¢ ×‘×“×™×§×” ××§×™×¤×”
   - [ ] ×ª×™×§×•×Ÿ ×××¦××™×

8. **Privacy Policy ×¢×“×›× ×™×ª**
   - [ ] ×›×ª×™×‘×ª ××“×™× ×™×•×ª ×¤×¨×˜×™×•×ª
   - [ ] ×¢××•×“ Terms of Service
   - [ ] ×”×¡×›××ª ××©×ª××©×™×

9. **GDPR Compliance**
   - [ ] Right to be forgotten
   - [ ] Data export
   - [ ] Consent management

---

## 4ï¸âƒ£ ×§×•×“ ×œ×“×•×’××” - Audit Log System

```typescript
// lib/security/audit-log.ts

import { supabaseAdmin } from '@/lib/supabase'

export enum AuditAction {
  // Authentication
  LOGIN = 'LOGIN',
  LOGOUT = 'LOGOUT',
  LOGIN_FAILED = 'LOGIN_FAILED',
  PASSWORD_CHANGED = 'PASSWORD_CHANGED',
  
  // User Management
  USER_CREATED = 'USER_CREATED',
  USER_UPDATED = 'USER_UPDATED',
  USER_DELETED = 'USER_DELETED',
  ROLE_CHANGED = 'ROLE_CHANGED',
  PERMISSION_GRANTED = 'PERMISSION_GRANTED',
  PERMISSION_REVOKED = 'PERMISSION_REVOKED',
  
  // Data Access
  DATA_VIEWED = 'DATA_VIEWED',
  DATA_EXPORTED = 'DATA_EXPORTED',
  SENSITIVE_DATA_ACCESSED = 'SENSITIVE_DATA_ACCESSED',
  
  // Bookings
  BOOKING_CREATED = 'BOOKING_CREATED',
  BOOKING_VIEWED = 'BOOKING_VIEWED',
  BOOKING_UPDATED = 'BOOKING_UPDATED',
  BOOKING_CANCELLED = 'BOOKING_CANCELLED',
  
  // Configuration
  SETTINGS_CHANGED = 'SETTINGS_CHANGED',
  TEMPLATE_MODIFIED = 'TEMPLATE_MODIFIED',
  API_KEY_ACCESSED = 'API_KEY_ACCESSED',
  
  // Security Events
  UNAUTHORIZED_ACCESS = 'UNAUTHORIZED_ACCESS',
  SUSPICIOUS_ACTIVITY = 'SUSPICIOUS_ACTIVITY',
  RATE_LIMIT_EXCEEDED = 'RATE_LIMIT_EXCEEDED',
}

export interface AuditLogEntry {
  id?: string
  timestamp: Date
  userId: string
  userEmail: string
  ipAddress: string
  userAgent: string
  action: AuditAction
  resource: string
  resourceId?: string
  oldValue?: any
  newValue?: any
  success: boolean
  errorMessage?: string
  metadata?: Record<string, any>
}

class AuditLogger {
  /**
   * ×¨×•×©× ××™×¨×•×¢ ××‘×˜×—×”
   */
  async log(entry: Omit<AuditLogEntry, 'id' | 'timestamp'>): Promise<void> {
    try {
      const logEntry: AuditLogEntry = {
        ...entry,
        timestamp: new Date(),
      }

      // ×©××™×¨×” ×‘-Supabase
      const { error } = await supabaseAdmin
        .from('audit_logs')
        .insert(logEntry)

      if (error) {
        console.error('Failed to write audit log:', error)
        // Fallback to file system or external service
        await this.fallbackLog(logEntry)
      }

      // ×× ×–×” ××™×¨×•×¢ ××‘×˜×—×” ×§×¨×™×˜×™ - ×©×œ×— ×”×ª×¨××”
      if (this.isCritical(entry.action)) {
        await this.sendSecurityAlert(logEntry)
      }
    } catch (error) {
      console.error('Audit log error:', error)
    }
  }

  /**
   * ×¨×™×©×•× × ×™×¡×™×•×Ÿ ×”×ª×—×‘×¨×•×ª
   */
  async logLogin(userId: string, email: string, success: boolean, ip: string): Promise<void> {
    await this.log({
      userId,
      userEmail: email,
      ipAddress: ip,
      userAgent: 'N/A',
      action: success ? AuditAction.LOGIN : AuditAction.LOGIN_FAILED,
      resource: 'authentication',
      success,
    })
  }

  /**
   * ×¨×™×©×•× ×’×™×©×” ×œ××™×“×¢ ×¨×’×™×©
   */
  async logDataAccess(
    userId: string,
    email: string,
    resource: string,
    resourceId: string,
    ip: string
  ): Promise<void> {
    await this.log({
      userId,
      userEmail: email,
      ipAddress: ip,
      userAgent: 'N/A',
      action: AuditAction.SENSITIVE_DATA_ACCESSED,
      resource,
      resourceId,
      success: true,
    })
  }

  /**
   * ×¨×™×©×•× ×©×™× ×•×™ ×‘×”×¨×©××•×ª
   */
  async logRoleChange(
    adminId: string,
    adminEmail: string,
    targetUserId: string,
    oldRole: string,
    newRole: string,
    ip: string
  ): Promise<void> {
    await this.log({
      userId: adminId,
      userEmail: adminEmail,
      ipAddress: ip,
      userAgent: 'N/A',
      action: AuditAction.ROLE_CHANGED,
      resource: 'user_roles',
      resourceId: targetUserId,
      oldValue: { role: oldRole },
      newValue: { role: newRole },
      success: true,
    })
  }

  /**
   * ×©××™×œ×ª×ª ×œ×•×’×™×
   */
  async query(filters: {
    userId?: string
    action?: AuditAction
    startDate?: Date
    endDate?: Date
    limit?: number
  }): Promise<AuditLogEntry[]> {
    let query = supabaseAdmin
      .from('audit_logs')
      .select('*')
      .order('timestamp', { ascending: false })

    if (filters.userId) query = query.eq('userId', filters.userId)
    if (filters.action) query = query.eq('action', filters.action)
    if (filters.startDate) query = query.gte('timestamp', filters.startDate.toISOString())
    if (filters.endDate) query = query.lte('timestamp', filters.endDate.toISOString())
    if (filters.limit) query = query.limit(filters.limit)

    const { data, error } = await query

    if (error) throw error
    return data || []
  }

  /**
   * ×‘×“×™×§×” ×× ××™×¨×•×¢ ×§×¨×™×˜×™
   */
  private isCritical(action: AuditAction): boolean {
    const criticalActions = [
      AuditAction.LOGIN_FAILED,
      AuditAction.UNAUTHORIZED_ACCESS,
      AuditAction.SUSPICIOUS_ACTIVITY,
      AuditAction.USER_DELETED,
      AuditAction.API_KEY_ACCESSED,
    ]
    return criticalActions.includes(action)
  }

  /**
   * ×©×œ×™×—×ª ×”×ª×¨××ª ××‘×˜×—×”
   */
  private async sendSecurityAlert(entry: AuditLogEntry): Promise<void> {
    // TODO: ×©×™×œ×•×‘ ×¢× Slack/Email/SMS
    console.error('ğŸš¨ SECURITY ALERT:', entry)
  }

  /**
   * Fallback logging ×œ××§×¨×” ×©×œ ×›×©×œ
   */
  private async fallbackLog(entry: AuditLogEntry): Promise<void> {
    // TODO: ×©××™×¨×” ×œ×§×•×‘×¥ ××• ×©×™×¨×•×ª ×—×™×¦×•× ×™
    console.log('[Audit Log Fallback]', entry)
  }
}

export const auditLogger = new AuditLogger()

// SQL ×œ×˜×‘×œ×ª audit_logs
export const AUDIT_LOG_TABLE_SQL = `
CREATE TABLE IF NOT EXISTS audit_logs (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  timestamp TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  user_id TEXT NOT NULL,
  user_email TEXT NOT NULL,
  ip_address TEXT NOT NULL,
  user_agent TEXT,
  action TEXT NOT NULL,
  resource TEXT NOT NULL,
  resource_id TEXT,
  old_value JSONB,
  new_value JSONB,
  success BOOLEAN NOT NULL,
  error_message TEXT,
  metadata JSONB,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Indexes ×œ×‘×™×¦×•×¢×™×
CREATE INDEX idx_audit_logs_user_id ON audit_logs(user_id);
CREATE INDEX idx_audit_logs_timestamp ON audit_logs(timestamp DESC);
CREATE INDEX idx_audit_logs_action ON audit_logs(action);
CREATE INDEX idx_audit_logs_resource ON audit_logs(resource, resource_id);

-- RLS Policies
ALTER TABLE audit_logs ENABLE ROW LEVEL SECURITY;

-- ×¨×§ ××“××™× ×™× ×™×›×•×œ×™× ×œ×§×¨×•× ×œ×•×’×™×
CREATE POLICY "Only admins can view audit logs"
  ON audit_logs FOR SELECT
  USING (
    EXISTS (
      SELECT 1 FROM users
      WHERE users.id = auth.uid()
      AND users.role = 'admin'
    )
  );

-- ×”××¢×¨×›×ª ×™×›×•×œ×” ×œ×›×ª×•×‘ (service role)
CREATE POLICY "System can write audit logs"
  ON audit_logs FOR INSERT
  WITH CHECK (true);

-- ×©××™×¨×” ×œ-7 ×©× ×™× (2555 ×™××™×)
CREATE POLICY "Retain logs for 7 years"
  ON audit_logs FOR DELETE
  USING (timestamp < NOW() - INTERVAL '2555 days');
`
```

---

## 5ï¸âƒ£ SQL Scripts - Supabase Setup

```sql
-- scripts/create-audit-logs.sql

-- Create audit_logs table
CREATE TABLE IF NOT EXISTS audit_logs (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  timestamp TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  user_id TEXT NOT NULL,
  user_email TEXT NOT NULL,
  ip_address TEXT NOT NULL,
  user_agent TEXT,
  action TEXT NOT NULL,
  resource TEXT NOT NULL,
  resource_id TEXT,
  old_value JSONB,
  new_value JSONB,
  success BOOLEAN NOT NULL,
  error_message TEXT,
  metadata JSONB,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_audit_logs_user_id ON audit_logs(user_id);
CREATE INDEX idx_audit_logs_timestamp ON audit_logs(timestamp DESC);
CREATE INDEX idx_audit_logs_action ON audit_logs(action);
CREATE INDEX idx_audit_logs_resource ON audit_logs(resource, resource_id);

-- Enable RLS
ALTER TABLE audit_logs ENABLE ROW LEVEL SECURITY;

-- Policies
CREATE POLICY "Only admins can view audit logs"
  ON audit_logs FOR SELECT
  USING (
    EXISTS (
      SELECT 1 FROM users
      WHERE users.id = auth.uid()
      AND users.role = 'admin'
    )
  );

CREATE POLICY "System can write audit logs"
  ON audit_logs FOR INSERT
  WITH CHECK (true);
```

---

## 6ï¸âƒ£ ××¡××š ××“×™× ×™×•×ª ××‘×˜×—×ª ××™×“×¢ (×“×•×’××”)

```markdown
# ××“×™× ×™×•×ª ××‘×˜×—×ª ××™×“×¢
## [×©× ×”×—×‘×¨×”] - ××¢×¨×›×ª Booking Engine

### 1. ××˜×¨×”
××¡××š ×–×” ××’×“×™×¨ ××ª ××“×™× ×™×•×ª ××‘×˜×—×ª ×”××™×“×¢ ×©×œ [×©× ×”×—×‘×¨×”] ×‘××¢×¨×›×ª × ×™×”×•×œ ×”×”×–×× ×•×ª.

### 2. ×ª×—×•×œ×”
××“×™× ×™×•×ª ×–×• ×—×œ×” ×¢×œ ×›×œ ×”×¢×•×‘×“×™×, ×§×‘×œ× ×™× ×•×¡×¤×§×™× ×”×’×™×©×” ×œ××¢×¨×›×ª.

### 3. ×××•× ×” ××‘×˜×—×ª ××™×“×¢
- **×©×:** [×©× ×”×××•× ×”]
- **×ª×¤×§×™×“:** ×××•× ×” ××‘×˜×—×ª ××™×“×¢
- **××™××™×™×œ:** security@yourdomain.com
- **×˜×œ×¤×•×Ÿ:** +972-XX-XXXXXXX

### 4. ×××’×¨×™ ××™×“×¢
×”××¢×¨×›×ª ××—×–×™×§×” ×‘×××’×¨×™ ×”××™×“×¢ ×”×‘××™×:
- ××©×ª××©×™× (users)
- ×”×–×× ×•×ª (bookings)
- × ××× ×•×ª (loyalty)
- ×œ×•×’×™× (logs)

### 5. ×¡×™×•×•×’ ××™×“×¢
- **×¨×’×™×© ×‘×™×•×ª×¨:** ×¤×¨×˜×™ ×ª×©×œ×•×, ××¡×¤×¨×™ ×–×”×•×ª
- **×¨×’×™×©:** ×¤×¨×˜×™ ××™×©×™×™×, ××™××™×™×œ×™×
- **×¤× ×™××™:** × ×ª×•× ×™ ×©×™××•×©, ×¡×˜×˜×™×¡×˜×™×§×•×ª
- **×¦×™×‘×•×¨×™:** ××™×“×¢ ×©×™×•×•×§×™

### 6. ×”×¨×©××•×ª ×’×™×©×”
- Admin: ×’×™×©×” ××œ××”
- Manager: ×¦×¤×™×™×” ×•× ×™×”×•×œ ×”×–×× ×•×ª
- Booker: ×™×¦×™×¨×ª ×”×–×× ×•×ª ×‘×œ×‘×“
- Viewer: ×¦×¤×™×™×” ×‘×œ×‘×“

### 7. ×××¦×¢×™ ××‘×˜×—×”
- HTTPS ×‘×œ×‘×“
- ×”×¦×¤× ×” ×‘-rest ×•-transit
- ××™××•×ª ×“×•-×©×œ×‘×™ ×œ××“××™× ×™×
- ×¡×™×¡×××•×ª ×—×–×§×•×ª (8+ ×ª×•×•×™×)
- Audit log ××œ×

### 8. ×’×™×‘×•×™×™×
- Database: ×™×•××™ ××•×˜×•××˜×™ (Supabase)
- Code: ×›×œ commit (GitHub)
- ×‘×“×™×§×ª restore: ×¨×‘×¢×•× ×™×ª

### 9. ×˜×™×¤×•×œ ×‘××™×¨×•×¢×™ ××‘×˜×—×”
×‘××§×¨×” ×©×œ ×—×©×“ ×œ××™×¨×•×¢ ××‘×˜×—×”:
1. ×“×™×•×•×— ××™×™×“×™ ×œ×××•× ×” ××‘×˜×—×ª ××™×“×¢
2. ×‘×™×“×•×“ ×”××¢×¨×›×ª ×‘××™×“×ª ×”×¦×•×¨×š
3. ×ª×™×¢×•×“ ××œ× ×©×œ ×”××™×¨×•×¢
4. ×“×™×•×•×— ×œ×¨×©×•×ª ×ª×•×š 72 ×©×¢×•×ª
5. ×”×•×“×¢×” ×œ××©×ª××©×™× ×‘××™×“×ª ×”×¦×•×¨×š

### 10. ×‘×“×™×§×•×ª ××‘×˜×—×”
- ×¡×¨×™×§×ª ×—×•×œ×©×•×ª: ×©×‘×•×¢×™×ª (npm audit)
- Penetration testing: ×©× ×ª×™
- Security review: ×¨×‘×¢×•× ×™

### 11. ×”×“×¨×›×”
×›×œ ×¢×•×‘×“ ×—×“×© ×¢×•×‘×¨ ×”×“×¨×›×ª ××‘×˜×—×ª ××™×“×¢.
×”×“×¨×›×ª ×¨×¢× ×•×Ÿ: ×©× ×ª×™.

### 12. ×¢×“×›×•×Ÿ ××“×™× ×™×•×ª
××“×™× ×™×•×ª ×–×• ××ª×¢×“×›× ×ª ×œ×¤×—×•×ª ××—×ª ×œ×©× ×” ××• ×œ××—×¨ ××™×¨×•×¢ ××‘×˜×—×”.

**×ª××¨×™×š ××™×©×•×¨:** 13/01/2026
**×—×ª×™××”:** _______________
```

---

## 7ï¸âƒ£ × ×•×”×œ ×˜×™×¤×•×œ ×‘××™×¨×•×¢ ××‘×˜×—×”

```markdown
# × ×•×”×œ ×ª×’×•×‘×” ×œ××™×¨×•×¢ ××‘×˜×—×”

## 1. ×–×™×”×•×™ ×•×¡×™×•×•×’ (Detection & Classification)

### ×¡×•×’×™ ××™×¨×•×¢×™×:
- **×—×•××¨×” × ××•×›×”:** × ×™×¡×™×•×Ÿ ×›× ×™×¡×” ×›×•×©×œ ×‘×•×“×“
- **×—×•××¨×” ×‘×™× ×•× ×™×ª:** ×¨×™×‘×•×™ × ×™×¡×™×•× ×•×ª ×›× ×™×¡×”, ×—×¨×™×’×” ×‘×©×™××•×©
- **×—×•××¨×” ×’×‘×•×”×”:** ×’×™×©×” ×œ× ××•×¨×©×™×ª ×œ××™×“×¢ ×¨×’×™×©
- **×—×•××¨×” ×§×¨×™×˜×™×ª:** ×“×œ×™×¤×ª ××™×“×¢, ××ª×§×¤×ª ×¡×™×™×‘×¨

## 2. ×”×›×œ×” (Containment)

### ×¤×¢×•×œ×•×ª ××™×™×“×™×•×ª (×ª×•×š ×“×§×•×ª):
- [ ] ×‘×™×“×•×“ ×”××©×ª××©/IP ×”×—×©×•×“
- [ ] ×—×¡×™××ª ×’×™×©×” × ×•×¡×¤×ª
- [ ] ×©××™×¨×ª ×¨××™×•×ª (logs, screenshots)
- [ ] ×”×•×“×¢×” ×œ×××•× ×” ××‘×˜×—×ª ××™×“×¢

### ×¤×¢×•×œ×•×ª ×œ×˜×•×•×— ×§×¦×¨ (×ª×•×š ×©×¢×•×ª):
- [ ] × ×™×ª×•×— ×”×™×§×£ ×”×¤×’×™×¢×”
- [ ] ×¡×’×™×¨×ª ×¤×¨×¦×•×ª ××™×™×“×™×•×ª
- [ ] ×©×™× ×•×™ ×¡×™×¡×××•×ª/××¤×ª×—×•×ª ×‘××™×“×ª ×”×¦×•×¨×š

## 3. ×—×§×™×¨×” (Investigation)

- ××” ×§×¨×”?
- ××ª×™ ×§×¨×”?
- ××™ ××¢×•×¨×‘?
- ××™×–×” ××™×“×¢ × ×—×©×£?
- ××™×š ×–×” ×§×¨×”?

## 4. ×ª×™×§×•×Ÿ (Remediation)

- [ ] ×¡×’×™×¨×ª ×”×¤×¨×¦×”
- [ ] ×¢×“×›×•×Ÿ ××¢×¨×›×•×ª
- [ ] ×©×™×¤×•×¨ ×‘×§×¨×•×ª
- [ ] ×”×“×¨×›×ª ×¢×•×‘×“×™×

## 5. ×“×™×•×•×— (Reporting)

### ×“×™×•×•×— ×¤× ×™××™ (××™×™×“×™):
- ×”× ×”×œ×”
- ××—×œ×§×ª IT
- ××—×œ×§×” ××©×¤×˜×™×ª

### ×“×™×•×•×— ×—×™×¦×•× ×™:
- **×¨×©×•×ª ×”×’× ×ª ×”×¤×¨×˜×™×•×ª:** ×ª×•×š 72 ×©×¢×•×ª (×× × ×“×¨×©)
- **××©×ª××©×™× × ×¤×’×¢×™×:** ×ª×•×š 72 ×©×¢×•×ª (×× × ×“×¨×©)
- **×¨×©×•×™×•×ª ××›×™×¤×”:** ×‘××§×¨×” ×©×œ ×¤×©×¢

### ×ª×‘× ×™×ª ×“×™×•×•×— ×œ×¨×©×•×ª:
```
× ×“×¨×© ×œ×›×œ×•×œ:
1. ×ª×™××•×¨ ×”××™×¨×•×¢
2. ×¡×•×’ ×•××¡×¤×¨ ×”× ×¤×’×¢×™×
3. ×¡×•×’ ×”××™×“×¢ ×©× ×—×©×£
4. ×¦×¢×“×™× ×©× × ×§×˜×•
5. ×ª×•×›× ×™×ª ×× ×™×¢×”
6. ×¤×¨×˜×™ ×§×©×¨
```

## 6. ×œ××™×“×” (Lessons Learned)

- [ ] ×™×©×™×‘×ª ×¡×™×›×•×
- [ ] ×ª×™×¢×•×“ ×××¦××™×
- [ ] ×¢×“×›×•×Ÿ × ×•×”×œ×™×
- [ ] ×”×“×¨×›×ª ×¦×•×•×ª

## ×× ×©×™ ×§×©×¨ ×‘×—×™×¨×•×

| ×ª×¤×§×™×“ | ×©× | ×˜×œ×¤×•×Ÿ | ××™××™×™×œ |
|-------|-----|-------|--------|
| ×××•× ×” ××‘×˜×—×ª ××™×“×¢ | [×©×] | [×˜×œ×¤×•×Ÿ] | security@ |
| CTO | [×©×] | [×˜×œ×¤×•×Ÿ] | cto@ |
| ×™×•×¢×¥ ××©×¤×˜×™ | [×©×] | [×˜×œ×¤×•×Ÿ] | legal@ |
| ×¨×©×•×ª ×”×’× ×ª ×”×¤×¨×˜×™×•×ª | - | *3852 | info@justice.gov.il |
```

---

## ğŸ“Š ×¡×™×›×•× ×¡×˜×˜×•×¡

### âœ… ×¢×•××“ ×‘×“×¨×™×©×•×ª (70%)
- ×”×¦×¤× ×ª ×ª×§×©×•×¨×ª
- × ×™×”×•×œ ×¡×™×¡×××•×ª ×××•×‘×˜×—
- ××¢×¨×›×ª ×”×¨×©××•×ª ×‘×¡×™×¡×™×ª
- ×’×™×‘×•×™×™× ××•×˜×•××˜×™×™×
- Environment variables ××•×¦×¤× ×™×

### âš ï¸ ×“×¨×•×© ×”×©×œ××” (25%)
- Audit log ××œ×
- Data retention policy
- ××“×™× ×™×•×ª ××‘×˜×—×” ××ª×•×¢×“×ª
- ×‘×“×™×§×•×ª ××‘×˜×—×” ×ª×§×•×¤×ª×™×•×ª
- × ×•×”×œ ××™×¨×•×¢×™ ××‘×˜×—×”

### âŒ ×—×¡×¨ (5%)
- ×××•× ×” ××‘×˜×—×ª ××™×“×¢ ××•×’×“×¨
- 2FA ×œ××“××™× ×™×
- Penetration testing ××ª×•×¢×“

---

## ğŸ¯ ×”××œ×¦×•×ª ×œ×‘×™×¦×•×¢

### ×©×‘×•×¢ 1:
1. ××™× ×•×™ ×××•× ×” ××‘×˜×—×ª ××™×“×¢
2. ×”×’×“×¨×ª audit log ×‘××¢×¨×›×ª
3. ×™×¦×™×¨×ª ×˜×‘×œ×ª audit_logs ×‘-Supabase

### ×©×‘×•×¢ 2-4:
4. ×›×ª×™×‘×ª ××“×™× ×™×•×ª ××‘×˜×—×ª ××™×“×¢
5. × ×•×”×œ ××™×¨×•×¢×™ ××‘×˜×—×”
6. ×”×•×¡×¤×ª 2FA

### ×—×•×“×© 2-3:
7. Data retention policy
8. Privacy policy
9. Penetration testing

---

## ğŸ“ ×¦×•×¨ ×§×©×¨

×œ×©××œ×•×ª × ×•×¡×¤×•×ª ×œ×’×‘×™ ×¢××™×“×” ×‘×ª×™×§×•×Ÿ 14:
- **×¨×©×•×ª ×”×’× ×ª ×”×¤×¨×˜×™×•×ª:** *3852
- **××ª×¨:** https://www.gov.il/he/Departments/the_privacy_protection_authority
- **××™××™×™×œ:** info@justice.gov.il

---

**××¡××š ×–×” × ×•×¦×¨:** 13 ×™× ×•××¨ 2026  
**×’×¨×¡×”:** 1.0  
**×¡×˜×˜×•×¡:** ×˜×™×•×˜×” ×œ×‘×™×¦×•×¢
