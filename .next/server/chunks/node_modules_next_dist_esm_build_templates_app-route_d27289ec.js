module.exports=[764377,e=>{"use strict";var t=e.i(747909),n=e.i(174017),a=e.i(996250),i=e.i(759756),s=e.i(561916),o=e.i(114444),r=e.i(837092),d=e.i(869741),l=e.i(316795),c=e.i(487718),u=e.i(995169),p=e.i(47587),g=e.i(666012),h=e.i(570101),m=e.i(626937),y=e.i(10372),f=e.i(193695);e.i(52474);var b=e.i(257297),v=e.i(89171),w=e.i(323831),k=e.i(711897);class _{static instance;agents=new Map;running=new Set;constructor(){this.initializeAgents()}static getInstance(){return _.instance||(_.instance=new _),_.instance}initializeAgents(){for(let e of[{id:"booking_verifier_1",type:"booking_verifier",name:"Booking Status Verifier",description:"Verifies booking status consistency between local DB and Medici",enabled:!0},{id:"cancellation_checker_1",type:"cancellation_checker",name:"Cancellation Status Checker",description:"Checks if cancelled bookings are properly refunded",enabled:!0},{id:"payment_reconciler_1",type:"payment_reconciler",name:"Payment Reconciliation Agent",description:"Ensures payment amounts match booking totals",enabled:!0},{id:"price_watcher_1",type:"price_watcher",name:"Price Change Monitor",description:"Detects significant price changes between search and book",enabled:!0},{id:"integrity_checker_1",type:"integrity_checker",name:"Data Integrity Checker",description:"Checks for orphaned records and data inconsistencies",enabled:!0}])this.agents.set(e.id,e)}async runAgent(e,t){let n=this.agents.get(e);if(!n)throw Error(`Agent ${e} not found`);if(this.running.has(e))throw Error(`Agent ${e} is already running`);this.running.add(e);let a=Date.now(),i=[];w.apiLogger.info("system",`Agent started: ${n.name}`,{agentId:e,type:n.type,bookingsCount:t.length});try{switch(n.type){case"booking_verifier":i.push(...await this.runBookingVerifier(t));break;case"cancellation_checker":i.push(...await this.runCancellationChecker(t));break;case"payment_reconciler":i.push(...await this.runPaymentReconciler(t));break;case"price_watcher":i.push(...await this.runPriceWatcher(t));break;case"integrity_checker":i.push(...await this.runIntegrityChecker(t))}let s={agentId:e,type:n.type,runAt:new Date().toISOString(),duration:Date.now()-a,success:!0,itemsChecked:t.length,issuesFound:i.length,issues:i};for(let t of(n.lastRun=s.runAt,n.lastResult=s,i))await (0,k.triggerAlert)(this.mapIssueToAlertType(t.type),t.severity,`Agent Issue: ${t.type}`,t.description,{agentId:e,entityType:t.entityType,entityId:t.entityId,...t.data});return w.apiLogger.info("system",`Agent completed: ${n.name}`,{agentId:e,duration:s.duration,issuesFound:i.length}),s}catch(i){return w.apiLogger.error("system",`Agent failed: ${n.name}`,i.message,{agentId:e}),{agentId:e,type:n.type,runAt:new Date().toISOString(),duration:Date.now()-a,success:!1,itemsChecked:t.length,issuesFound:0,issues:[]}}finally{this.running.delete(e)}}async runBookingVerifier(e){let t=[];for(let n of e)"pending"===n.status&&new Date(n.createdAt).getTime()<Date.now()-36e5&&t.push({id:`issue_${Date.now()}_${Math.random().toString(36).substring(7)}`,severity:"high",type:"stuck_pending_booking",description:`Booking ${n.id} has been pending for over 1 hour`,entityType:"booking",entityId:n.id,data:{createdAt:n.createdAt,hotelName:n.hotelName,guestName:n.guestName},suggestedAction:"Review and either confirm or cancel the booking"}),"confirmed"!==n.status||n.mediciBookingId||t.push({id:`issue_${Date.now()}_${Math.random().toString(36).substring(7)}`,severity:"critical",type:"missing_medici_id",description:`Confirmed booking ${n.id} has no Medici booking ID`,entityType:"booking",entityId:n.id,data:{hotelName:n.hotelName,guestName:n.guestName},suggestedAction:"Manually verify with Medici and update booking"}),new Date(n.checkIn)<new Date&&"pending"===n.status&&t.push({id:`issue_${Date.now()}_${Math.random().toString(36).substring(7)}`,severity:"high",type:"past_checkin_pending",description:`Booking ${n.id} check-in date passed but still pending`,entityType:"booking",entityId:n.id,data:{checkIn:n.checkIn,hotelName:n.hotelName},suggestedAction:"Contact guest and hotel to resolve"});return t}async runCancellationChecker(e){let t=[];for(let n of e)"cancelled"===n.status&&"paid"===n.paymentStatus&&(n.cancelledAt?new Date(n.cancelledAt).getTime():0)<Date.now()-864e5&&t.push({id:`issue_${Date.now()}_${Math.random().toString(36).substring(7)}`,severity:"critical",type:"cancelled_not_refunded",description:`Cancelled booking ${n.id} has not been refunded after 24 hours`,entityType:"booking",entityId:n.id,data:{cancelledAt:n.cancelledAt,paymentAmount:n.paymentAmount,guestEmail:n.guestEmail},suggestedAction:"Process refund immediately"}),"cancelled"!==n.status||n.cancellationReason||t.push({id:`issue_${Date.now()}_${Math.random().toString(36).substring(7)}`,severity:"low",type:"missing_cancellation_reason",description:`Cancelled booking ${n.id} has no cancellation reason`,entityType:"booking",entityId:n.id,data:{cancelledAt:n.cancelledAt},suggestedAction:"Update with cancellation reason for records"});return t}async runPaymentReconciler(e){let t=[];for(let n of e){if("paid"===n.paymentStatus&&n.paymentAmount){let e=Math.abs(n.totalPrice-n.paymentAmount);e>.01*n.totalPrice&&t.push({id:`issue_${Date.now()}_${Math.random().toString(36).substring(7)}`,severity:"high",type:"payment_amount_mismatch",description:`Payment amount mismatch for booking ${n.id}`,entityType:"payment",entityId:n.id,data:{totalPrice:n.totalPrice,paymentAmount:n.paymentAmount,difference:e,currency:n.currency},suggestedAction:"Review payment and adjust if needed"})}"confirmed"===n.status&&"failed"===n.paymentStatus&&t.push({id:`issue_${Date.now()}_${Math.random().toString(36).substring(7)}`,severity:"critical",type:"confirmed_payment_failed",description:`Booking ${n.id} is confirmed but payment failed`,entityType:"payment",entityId:n.id,data:{totalPrice:n.totalPrice,guestEmail:n.guestEmail},suggestedAction:"Either collect payment or cancel booking"}),"completed"===n.status&&"pending"===n.paymentStatus&&t.push({id:`issue_${Date.now()}_${Math.random().toString(36).substring(7)}`,severity:"medium",type:"completed_payment_pending",description:`Completed booking ${n.id} still has pending payment`,entityType:"payment",entityId:n.id,data:{totalPrice:n.totalPrice,checkOut:n.checkOut},suggestedAction:"Verify and update payment status"})}return t}async runPriceWatcher(e){let t=[];for(let n of e)n.totalPrice<=0&&t.push({id:`issue_${Date.now()}_${Math.random().toString(36).substring(7)}`,severity:"critical",type:"invalid_price",description:`Booking ${n.id} has invalid price: ${n.totalPrice}`,entityType:"booking",entityId:n.id,data:{totalPrice:n.totalPrice,hotelName:n.hotelName},suggestedAction:"Review booking and correct price"});return t}async runIntegrityChecker(e){let t=[];for(let n of e){n.guestEmail||t.push({id:`issue_${Date.now()}_${Math.random().toString(36).substring(7)}`,severity:"medium",type:"missing_guest_email",description:`Booking ${n.id} has no guest email`,entityType:"booking",entityId:n.id,data:{guestName:n.guestName},suggestedAction:"Update with guest email for communications"});let e=new Date(n.checkIn),a=new Date(n.checkOut);a<=e&&t.push({id:`issue_${Date.now()}_${Math.random().toString(36).substring(7)}`,severity:"high",type:"invalid_date_range",description:`Booking ${n.id} has invalid date range`,entityType:"booking",entityId:n.id,data:{checkIn:n.checkIn,checkOut:n.checkOut},suggestedAction:"Correct date range with guest"});let i=Math.ceil((a.getTime()-e.getTime())/864e5);i>30&&t.push({id:`issue_${Date.now()}_${Math.random().toString(36).substring(7)}`,severity:"low",type:"unusually_long_stay",description:`Booking ${n.id} has ${i} night stay`,entityType:"booking",entityId:n.id,data:{nights:i,checkIn:n.checkIn,checkOut:n.checkOut},suggestedAction:"Verify this is intentional"})}return t}mapIssueToAlertType(e){return({stuck_pending_booking:"booking_failed",missing_medici_id:"data_integrity",past_checkin_pending:"business_logic",cancelled_not_refunded:"cancellation_issue",missing_cancellation_reason:"business_logic",payment_amount_mismatch:"payment_failed",confirmed_payment_failed:"payment_failed",completed_payment_pending:"payment_failed",invalid_price:"data_integrity",missing_guest_email:"data_integrity",invalid_date_range:"data_integrity",unusually_long_stay:"business_logic"})[e]||"business_logic"}getAgents(){return Array.from(this.agents.values())}getAgent(e){return this.agents.get(e)}setAgentEnabled(e,t){let n=this.agents.get(e);n&&(n.enabled=t)}async runAllAgents(e){let t=[];for(let n of this.agents.values())if(n.enabled)try{let a=await this.runAgent(n.id,e);t.push(a)}catch(e){console.error(`Failed to run agent ${n.id}:`,e)}return t}}let x=_.getInstance(),A=new Map,I=[];class R{static instance;constructor(){}static getInstance(){return R.instance||(R.instance=new R),R.instance}startRequest(e){let t=`req_${Date.now()}_${Math.random().toString(36).substring(2,8)}`,n=new Date().toISOString(),a={requestId:t,type:e.type,status:"started",startedAt:n,userId:e.userId,sessionId:e.sessionId,ip:e.ip,userAgent:e.userAgent,steps:[],parentRequestId:e.parentRequestId,searchParams:e.metadata};for(A.set(t,a),I.push(t);I.length>1e3;){let e=I.shift();e&&A.delete(e)}if(e.parentRequestId){let n=A.get(e.parentRequestId);n&&(n.childRequestIds=n.childRequestIds||[],n.childRequestIds.push(t))}return w.apiLogger.debug("system",`Request started: ${e.type}`,{requestId:t,type:e.type}),a}startStep(e,t,n){let a=A.get(e);if(!a)throw Error(`Request ${e} not found`);let i={stepId:`step_${Date.now()}_${Math.random().toString(36).substring(2,6)}`,name:t,status:"processing",startedAt:new Date().toISOString(),input:n};return a.steps.push(i),a.currentStep=i.stepId,a.status="processing",w.apiLogger.debug("system",`Step started: ${t}`,{requestId:e,stepId:i.stepId}),i}completeStep(e,t,n){let a=A.get(e);if(!a)return;let i=a.steps.find(e=>e.stepId===t);i&&(i.status="completed",i.completedAt=new Date().toISOString(),i.duration=new Date(i.completedAt).getTime()-new Date(i.startedAt).getTime(),i.output=n,w.apiLogger.debug("system",`Step completed: ${i.name}`,{requestId:e,stepId:t,duration:i.duration}))}failStep(e,t,n){let a=A.get(e);if(!a)return;let i=a.steps.find(e=>e.stepId===t);i&&(i.status="failed",i.completedAt=new Date().toISOString(),i.duration=new Date(i.completedAt).getTime()-new Date(i.startedAt).getTime(),i.error=n,w.apiLogger.error("system",`Step failed: ${i.name}`,n,{requestId:e,stepId:t}))}setWaitingExternal(e,t){let n=A.get(e);n&&(n.status="waiting_external",w.apiLogger.debug("system",`Waiting for external: ${t}`,{requestId:e,service:t}))}completeRequest(e,t){let n=A.get(e);n&&(n.status="completed",n.success=!0,n.completedAt=new Date().toISOString(),n.totalDuration=new Date(n.completedAt).getTime()-new Date(n.startedAt).getTime(),n.result=t,w.apiLogger.info("system",`Request completed: ${n.type}`,{requestId:e,duration:n.totalDuration,stepsCount:n.steps.length}))}failRequest(e,t){let n=A.get(e);n&&(n.status="failed",n.success=!1,n.completedAt=new Date().toISOString(),n.totalDuration=new Date(n.completedAt).getTime()-new Date(n.startedAt).getTime(),n.error=t,w.apiLogger.error("system",`Request failed: ${n.type}`,t,{requestId:e,duration:n.totalDuration}))}getRequest(e){return A.get(e)}getRecentRequests(e){let t=Array.from(A.values()).reverse();return e&&(e.type&&(t=t.filter(t=>t.type===e.type)),e.status&&(t=t.filter(t=>t.status===e.status)),e.userId&&(t=t.filter(t=>t.userId===e.userId))),t.slice(0,e?.limit||50)}getRequestChain(e){let t=[],n=A.get(e);if(!n)return t;let a=n;for(;a.parentRequestId;){let e=A.get(a.parentRequestId);if(!e)break;a=e}let i=e=>{if(t.push(e),e.childRequestIds)for(let t of e.childRequestIds){let e=A.get(t);e&&i(e)}};return i(a),t}linkBooking(e,t){let n=A.get(e);n&&(n.bookingId=t)}linkHotel(e,t){let n=A.get(e);n&&(n.hotelId=t)}getStats(){let e=Array.from(A.values()),t={},n={};for(let a of e)t[a.type]=(t[a.type]||0)+1,a.totalDuration&&(n[a.type]=n[a.type]||[],n[a.type].push(a.totalDuration));let a={};for(let[e,t]of Object.entries(n))a[e]=Math.round(t.reduce((e,t)=>e+t,0)/t.length);return{total:e.length,active:e.filter(e=>"started"===e.status||"processing"===e.status||"waiting_external"===e.status).length,completed:e.filter(e=>"completed"===e.status).length,failed:e.filter(e=>"failed"===e.status).length,byType:t,avgDuration:a}}}let S=R.getInstance();async function $(e){var t,n;let a,i=e.nextUrl.searchParams.get("format")||"json",s=x.getAgents(),o=S.getStats();return"html"===i?new v.NextResponse((t=s,n=o,a=t.map(e=>{let t=e.lastRun?new Date(e.lastRun).toLocaleString("he-IL"):"专 专抓",n=e.lastResult?.issuesFound||0,a=e.enabled?"#28a745":"#6c757d";return`
      <div class="agent-card">
        <div class="agent-header">
          <div class="agent-status" style="background: ${a}"></div>
          <h3>${e.name}</h3>
          <span class="agent-type">${e.type}</span>
        </div>
        <p class="agent-description">${e.description}</p>
        <div class="agent-stats">
          <div class="agent-stat">
            <span class="value">${t}</span>
            <span class="label">专爪 专</span>
          </div>
          <div class="agent-stat">
            <span class="value" style="color: ${n>0?"#dc3545":"#28a745"}">${n}</span>
            <span class="label">注转 砖爪</span>
          </div>
          <div class="agent-stat">
            <span class="value">${e.lastResult?.duration||0}ms</span>
            <span class="label"> 专爪</span>
          </div>
        </div>
        <div class="agent-actions">
          <button onclick="toggleAgent('${e.id}', ${!e.enabled})">${e.enabled?"砖转":"驻注"}</button>
          <button class="primary" onclick="runAgent('${e.id}')">专抓 注砖</button>
        </div>
      </div>
    `}).join(""),`
<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> Booking Agents - Monitoring Dashboard</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { 
      font-family: 'Segoe UI', Tahoma, sans-serif; 
      background: linear-gradient(135deg, #0f0f1e 0%, #1a1a35 100%);
      color: #eee;
      min-height: 100vh;
      padding: 20px;
    }
    h1 { 
      color: #00d4ff; 
      margin-bottom: 25px;
      font-size: 28px;
    }
    h2 {
      color: #aaa;
      font-size: 18px;
      margin-bottom: 15px;
    }
    .dashboard-grid {
      display: grid;
      grid-template-columns: 1fr 300px;
      gap: 20px;
    }
    @media (max-width: 900px) {
      .dashboard-grid { grid-template-columns: 1fr; }
    }
    .request-stats {
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      padding: 20px;
    }
    .stats-row {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }
    .stat-box {
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
      padding: 15px;
      text-align: center;
    }
    .stat-box .value {
      font-size: 28px;
      font-weight: bold;
      color: #00d4ff;
    }
    .stat-box .label {
      font-size: 11px;
      color: #888;
    }
    .agents-container {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .agent-card {
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      padding: 20px;
      border: 1px solid rgba(255,255,255,0.1);
    }
    .agent-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
    }
    .agent-status {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }
    .agent-header h3 {
      flex: 1;
      font-size: 16px;
    }
    .agent-type {
      font-size: 11px;
      background: rgba(0,212,255,0.2);
      color: #00d4ff;
      padding: 4px 8px;
      border-radius: 4px;
    }
    .agent-description {
      color: #888;
      font-size: 13px;
      margin-bottom: 15px;
    }
    .agent-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-bottom: 15px;
    }
    .agent-stat {
      text-align: center;
    }
    .agent-stat .value {
      font-size: 14px;
      font-weight: 600;
      color: #eee;
    }
    .agent-stat .label {
      font-size: 10px;
      color: #666;
    }
    .agent-actions {
      display: flex;
      gap: 10px;
    }
    .agent-actions button {
      flex: 1;
      padding: 10px;
      border: 1px solid #333;
      border-radius: 6px;
      background: transparent;
      color: #eee;
      cursor: pointer;
      font-size: 13px;
    }
    .agent-actions button:hover {
      background: rgba(255,255,255,0.1);
    }
    .agent-actions button.primary {
      background: #00d4ff;
      color: #000;
      border: none;
    }
    .global-actions {
      margin-bottom: 20px;
      display: flex;
      gap: 10px;
    }
    .global-actions button {
      padding: 12px 20px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 14px;
    }
    .global-actions .run-all {
      background: linear-gradient(135deg, #00d4ff, #0099cc);
      color: #000;
      font-weight: bold;
    }
    .global-actions .test {
      background: #ffc107;
      color: #000;
    }
    .loading {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .loading.active { display: flex; }
    .loader {
      width: 50px;
      height: 50px;
      border: 3px solid #333;
      border-top-color: #00d4ff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <h1> Booking Verification Agents</h1>
  
  <div class="global-actions">
    <button class="run-all" onclick="runAllAgents()">讹 专抓 转  住</button>
    <button class="test" onclick="runTestAgents()">И 专抓 注 转 拽</button>
    <button onclick="location.reload()"> 专注</button>
    <button onclick="location.href='/api/alerts?format=html'"> 转专转</button>
  </div>

  <div class="dashboard-grid">
    <div>
      <h2>住 驻注</h2>
      <div class="agents-container">
        ${a}
      </div>
    </div>
    
    <div class="request-stats">
      <h2>住住拽转 拽砖转</h2>
      <div class="stats-row">
        <div class="stat-box">
          <div class="value">${n.total}</div>
          <div class="label">住" 拽砖转</div>
        </div>
        <div class="stat-box">
          <div class="value" style="color: ${n.active>0?"#ffc107":"#28a745"}">${n.active}</div>
          <div class="label">拽砖转 驻注转</div>
        </div>
        <div class="stat-box">
          <div class="value" style="color: #28a745">${n.completed}</div>
          <div class="label">砖</div>
        </div>
        <div class="stat-box">
          <div class="value" style="color: #dc3545">${n.failed}</div>
          <div class="label">砖</div>
        </div>
      </div>
      
      <h2>驻 住</h2>
      ${Object.entries(n.byType||{}).map(([e,t])=>`
        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #333;">
          <span>${e}</span>
          <span style="color: #00d4ff">${t}</span>
        </div>
      `).join("")}
      
      <h2 style="margin-top: 20px;"> 爪注 (ms)</h2>
      ${Object.entries(n.avgDuration||{}).map(([e,t])=>`
        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #333;">
          <span>${e}</span>
          <span style="color: #ffc107">${t}ms</span>
        </div>
      `).join("")}
    </div>
  </div>

  <div class="loading" id="loadingOverlay">
    <div class="loader"></div>
  </div>

  <script>
    function showLoading() {
      document.getElementById('loadingOverlay').classList.add('active');
    }
    function hideLoading() {
      document.getElementById('loadingOverlay').classList.remove('active');
    }

    async function runAgent(agentId) {
      showLoading();
      try {
        const response = await fetch('/api/agents', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'run', agentId })
        });
        const data = await response.json();
        if (data.success) {
          alert('住 住转. 注转 砖爪: ' + (data.result?.issuesFound || 0));
        }
        location.reload();
      } catch (error) {
        alert('砖 专爪转 住');
        hideLoading();
      }
    }

    async function runAllAgents() {
      showLoading();
      try {
        const response = await fetch('/api/agents', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'run' })
        });
        const data = await response.json();
        if (data.success) {
          const totalIssues = data.results.reduce((sum, r) => sum + r.issuesFound, 0);
          alert(' 住 住转. 住" 注转: ' + totalIssues);
        }
        location.reload();
      } catch (error) {
        alert('砖 专爪转 住');
        hideLoading();
      }
    }

    async function runTestAgents() {
      showLoading();
      try {
        const response = await fetch('/api/agents', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'test' })
        });
        const data = await response.json();
        if (data.success) {
          const totalIssues = data.results.reduce((sum, r) => sum + r.issuesFound, 0);
          alert('拽 住转 注 ' + data.mockBookingsUsed + ' 转 转.\\n注转 砖爪: ' + totalIssues);
        }
        location.reload();
      } catch (error) {
        alert('砖 专爪转 拽');
        hideLoading();
      }
    }

    async function toggleAgent(agentId, enable) {
      try {
        await fetch('/api/agents', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: enable ? 'enable' : 'disable', agentId })
        });
        location.reload();
      } catch (error) {
        alert('砖 注 住');
      }
    }
  </script>
</body>
</html>
  `),{headers:{"Content-Type":"text/html"}}):v.NextResponse.json({success:!0,agents:s,requestStats:o})}async function D(e){try{let{action:t,agentId:n,bookings:a}=await e.json();if("run"===t)if(n){let e=await x.runAgent(n,a||[]);return v.NextResponse.json({success:!0,result:e})}else{let e=await x.runAllAgents(a||[]);return v.NextResponse.json({success:!0,results:e})}if("enable"===t||"disable"===t){if(!n)return v.NextResponse.json({error:"agentId required"},{status:400});return x.setAgentEnabled(n,"enable"===t),v.NextResponse.json({success:!0})}if("test"===t){let e=[{id:"test-booking-1",status:"pending",hotelId:697024,hotelName:"Dizengoff Inn",checkIn:new Date(Date.now()-72e5).toISOString(),checkOut:"2026-03-15",guestName:"Test Guest",guestEmail:"test@example.com",totalPrice:250,currency:"USD",paymentStatus:"pending",createdAt:new Date(Date.now()-72e5).toISOString(),updatedAt:new Date().toISOString()},{id:"test-booking-2",status:"confirmed",hotelId:697025,hotelName:"Test Hotel",checkIn:"2026-03-20",checkOut:"2026-03-22",guestName:"Another Guest",guestEmail:"",totalPrice:0,currency:"USD",paymentStatus:"paid",paymentAmount:350,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{id:"test-booking-3",status:"cancelled",hotelId:697026,hotelName:"Cancelled Hotel",checkIn:"2026-03-10",checkOut:"2026-03-12",guestName:"Cancelled Guest",guestEmail:"cancelled@example.com",totalPrice:180,currency:"USD",paymentStatus:"paid",paymentAmount:180,createdAt:new Date(Date.now()-1728e5).toISOString(),updatedAt:new Date(Date.now()-864e5).toISOString(),cancelledAt:new Date(Date.now()-1728e5).toISOString()}],t=await x.runAllAgents(e);return v.NextResponse.json({success:!0,results:t,mockBookingsUsed:e.length})}return v.NextResponse.json({error:"Invalid action"},{status:400})}catch(e){return v.NextResponse.json({error:e.message},{status:500})}}e.s(["GET",()=>$,"POST",()=>D],858204);var T=e.i(858204);let C=new t.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/agents/route",pathname:"/api/agents",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/agents/route.ts",nextConfigOutput:"",userland:T}),{workAsyncStorage:O,workUnitAsyncStorage:E,serverHooks:N}=C;function P(){return(0,a.patchFetch)({workAsyncStorage:O,workUnitAsyncStorage:E})}async function M(e,t,a){C.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let v="/api/agents/route";v=v.replace(/\/index$/,"")||"/";let w=await C.prepare(e,t,{srcPage:v,multiZoneDraftMode:!1});if(!w)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:k,params:_,nextConfig:x,parsedUrl:A,isDraftMode:I,prerenderManifest:R,routerServerContext:S,isOnDemandRevalidate:$,revalidateOnlyGenerated:D,resolvedPathname:T,clientReferenceManifest:O,serverActionsManifest:E}=w,N=(0,d.normalizeAppPath)(v),P=!!(R.dynamicRoutes[N]||R.routes[T]),M=async()=>((null==S?void 0:S.render404)?await S.render404(e,t,A,!1):t.end("This page could not be found"),null);if(P&&!I){let e=!!R.routes[T],t=R.dynamicRoutes[N];if(t&&!1===t.fallback&&!e){if(x.experimental.adapterPath)return await M();throw new f.NoFallbackError}}let q=null;!P||C.isDev||I||(q="/index"===(q=T)?"/":q);let j=!0===C.isDev||!P,L=P&&!j;E&&O&&(0,o.setReferenceManifestsSingleton)({page:v,clientReferenceManifest:O,serverActionsManifest:E,serverModuleMap:(0,r.createServerModuleMap)({serverActionsManifest:E})});let U=e.method||"GET",B=(0,s.getTracer)(),H=B.getActiveScopeSpan(),z={params:_,prerenderManifest:R,renderOpts:{experimental:{authInterrupts:!!x.experimental.authInterrupts},cacheComponents:!!x.cacheComponents,supportsDynamicResponse:j,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:x.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,n,a)=>C.onRequestError(e,t,a,S)},sharedContext:{buildId:k}},F=new l.NodeNextRequest(e),V=new l.NodeNextResponse(t),K=c.NextRequestAdapter.fromNodeNextRequest(F,(0,c.signalFromNodeResponse)(t));try{let o=async e=>C.handle(K,z).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let n=B.getRootSpanAttributes();if(!n)return;if(n.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${n.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=n.get("next.route");if(a){let t=`${U} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${U} ${v}`)}),r=!!(0,i.getRequestMeta)(e,"minimalMode"),d=async i=>{var s,d;let l=async({previousCacheEntry:n})=>{try{if(!r&&$&&D&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await o(i);e.fetchMetrics=z.renderOpts.fetchMetrics;let d=z.renderOpts.pendingWaitUntil;d&&a.waitUntil&&(a.waitUntil(d),d=void 0);let l=z.renderOpts.collectedTags;if(!P)return await (0,g.sendResponse)(F,V,s,z.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(s.headers);l&&(t[y.NEXT_CACHE_TAGS_HEADER]=l),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let n=void 0!==z.renderOpts.collectedRevalidate&&!(z.renderOpts.collectedRevalidate>=y.INFINITE_CACHE)&&z.renderOpts.collectedRevalidate,a=void 0===z.renderOpts.collectedExpire||z.renderOpts.collectedExpire>=y.INFINITE_CACHE?void 0:z.renderOpts.collectedExpire;return{value:{kind:b.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:n,expire:a}}}}catch(t){throw(null==n?void 0:n.isStale)&&await C.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:L,isOnDemandRevalidate:$})},S),t}},c=await C.handleResponse({req:e,nextConfig:x,cacheKey:q,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:R,isRoutePPREnabled:!1,isOnDemandRevalidate:$,revalidateOnlyGenerated:D,responseGenerator:l,waitUntil:a.waitUntil,isMinimalMode:r});if(!P)return null;if((null==c||null==(s=c.value)?void 0:s.kind)!==b.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(d=c.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});r||t.setHeader("x-nextjs-cache",$?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),I&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,h.fromNodeOutgoingHttpHeaders)(c.value.headers);return r&&P||u.delete(y.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,m.getCacheControlHeader)(c.cacheControl)),await (0,g.sendResponse)(F,V,new Response(c.value.body,{headers:u,status:c.value.status||200})),null};H?await d(H):await B.withPropagatedContext(e.headers,()=>B.trace(u.BaseServerSpan.handleRequest,{spanName:`${U} ${v}`,kind:s.SpanKind.SERVER,attributes:{"http.method":U,"http.target":e.url}},d))}catch(t){if(t instanceof f.NoFallbackError||await C.onRequestError(e,t,{routerKind:"App Router",routePath:N,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:L,isOnDemandRevalidate:$})}),P)throw t;return await (0,g.sendResponse)(F,V,new Response(null,{status:500})),null}}e.s(["handler",()=>M,"patchFetch",()=>P,"routeModule",()=>C,"serverHooks",()=>N,"workAsyncStorage",()=>O,"workUnitAsyncStorage",()=>E],764377)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_d27289ec.js.map