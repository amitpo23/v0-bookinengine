{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/v0-bookinengine/lib/api/medici-types.ts"],"sourcesContent":["// Types and constants for Medici API - safe for client-side use\n// No environment variables accessed here\n\nexport interface HotelSearchResult {\n  hotelId: number\n  hotelName: string\n  hotelImage: string\n  images: string[]\n  location: string\n  city: string\n  stars: number\n  address: string\n  description: string\n  facilities: string[]\n  rooms: RoomResult[]\n  requestJson?: string // Original requestJson from API response - used for PreBook\n  responseJson?: any // Original responseJson from API response\n  // Extended data from ShowExtendedData: true\n  phone?: string\n  fax?: string\n  lat?: number\n  lon?: number\n  seoname?: string\n  destinations?: { destinationId: number; type: string }[]\n  surroundings?: { destinationId: number; type: string }[]\n}\n\nexport interface CancellationFrame {\n  from: string\n  to: string\n  penalty: {\n    amount: number\n    currency: string\n  }\n}\n\nexport interface CancellationInfo {\n  type: \"fully-refundable\" | \"non-refundable\" | \"partially-refundable\"\n  frames: CancellationFrame[]\n}\n\nexport interface Provider {\n  id: number\n  name: string\n}\n\nexport interface RoomResult {\n  code: string // The booking code from API (e.g., \"697024:standard:double:RO:6881f6a596dd21.40624605$1003X1095n1095t\")\n  roomId: string\n  roomName: string\n  roomCategory: string\n  categoryId: number\n  roomImage: string\n  images: string[]\n  bedding: string\n  board: string\n  boardId: number\n  boardType: string\n  maxOccupancy: number\n  size: number\n  view: string\n  amenities: string[]\n  price: number\n  buyPrice: number\n  originalPrice: number\n  currency: string\n  cancellationPolicy: string\n  cancellation?: CancellationInfo | null\n  available: number\n  requestJson?: string // Room code for prebook\n  pax?: { adults: number; children: number[] } // Occupancy info\n  // Extended data from ShowExtendedData: true\n  confirmation?: string // \"immediate\" | \"on_request\"\n  paymentType?: string // \"pre\" | \"post\"\n  providers?: Provider[]\n  specialOffers?: any[]\n}\n\nexport interface PreBookResponse {\n  success: boolean\n  preBookId: number\n  token: string // The token from content.services.hotels[0].token\n  status: string // Status from API (e.g., \"done\")\n  priceConfirmed: number\n  currency: string\n  requestJson?: string // The requestJson from PreBook response\n  responseJson?: string // The responseJson from PreBook response\n  error?: string\n}\n\nexport interface BookResponse {\n  success: boolean\n  bookingId: string // bookingID from bookRes.content.bookingID\n  supplierReference: string // supplier.reference from bookRes.content.services[0].supplier.reference\n  status: string // Status from API (e.g., \"confirmed\")\n  error?: string\n}\n\n// Board type translations\nexport const BOARD_TYPES: Record<number, string> = {\n  1: \"Room Only\",\n  2: \"Bed & Breakfast\",\n  3: \"Half Board\",\n  4: \"Full Board\",\n  5: \"All Inclusive\",\n}\n\n// Room category translations\nexport const ROOM_CATEGORIES: Record<number, string> = {\n  1: \"Standard\",\n  2: \"Superior\",\n  3: \"Deluxe\",\n  4: \"Suite\",\n  5: \"Executive\",\n}\n"],"names":[],"mappings":"AAAA,gEAAgE;AAChE,yCAAyC;;;;;;;AAkGlC,MAAM,cAAsC;IACjD,GAAG;IACH,GAAG;IACH,GAAG;IACH,GAAG;IACH,GAAG;AACL;AAGO,MAAM,kBAA0C;IACrD,GAAG;IACH,GAAG;IACH,GAAG;IACH,GAAG;IACH,GAAG;AACL"}},
    {"offset": {"line": 66, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/v0-bookinengine/lib/logging/api-logger.ts"],"sourcesContent":["// Comprehensive API Logging System\n// Tracks all API calls, responses, and errors\n\nimport { createClient } from \"@supabase/supabase-js\"\n\n// Log levels\nexport type LogLevel = \"debug\" | \"info\" | \"warn\" | \"error\"\n\n// Log entry structure\nexport interface ApiLogEntry {\n  id?: string\n  timestamp: string\n  level: LogLevel\n  category: \"api\" | \"medici\" | \"booking\" | \"auth\" | \"system\"\n  action: string\n  method?: string\n  endpoint?: string\n  requestBody?: any\n  responseBody?: any\n  statusCode?: number\n  duration?: number\n  userId?: string\n  sessionId?: string\n  ip?: string\n  userAgent?: string\n  error?: string\n  metadata?: Record<string, any>\n}\n\n// In-memory buffer for logs (also saved to Supabase if configured)\nconst logBuffer: ApiLogEntry[] = []\nconst MAX_BUFFER_SIZE = 1000\n\n// Supabase client for persistent logging\nlet supabase: ReturnType<typeof createClient> | null = null\n\nfunction getSupabase() {\n  if (!supabase && process.env.NEXT_PUBLIC_SUPABASE_URL && process.env.SUPABASE_SERVICE_KEY) {\n    supabase = createClient(\n      process.env.NEXT_PUBLIC_SUPABASE_URL,\n      process.env.SUPABASE_SERVICE_KEY\n    )\n  }\n  return supabase\n}\n\n// Color codes for console output\nconst colors = {\n  reset: \"\\x1b[0m\",\n  bright: \"\\x1b[1m\",\n  dim: \"\\x1b[2m\",\n  red: \"\\x1b[31m\",\n  green: \"\\x1b[32m\",\n  yellow: \"\\x1b[33m\",\n  blue: \"\\x1b[34m\",\n  magenta: \"\\x1b[35m\",\n  cyan: \"\\x1b[36m\",\n  white: \"\\x1b[37m\",\n  bgRed: \"\\x1b[41m\",\n  bgGreen: \"\\x1b[42m\",\n  bgYellow: \"\\x1b[43m\",\n  bgBlue: \"\\x1b[44m\",\n}\n\nfunction getLevelColor(level: LogLevel): string {\n  switch (level) {\n    case \"debug\": return colors.dim\n    case \"info\": return colors.cyan\n    case \"warn\": return colors.yellow\n    case \"error\": return colors.red\n    default: return colors.white\n  }\n}\n\nfunction getCategoryIcon(category: ApiLogEntry[\"category\"]): string {\n  switch (category) {\n    case \"api\": return \"\"\n    case \"medici\": return \"\"\n    case \"booking\": return \"\"\n    case \"auth\": return \"\"\n    case \"system\": return \"锔\"\n    default: return \"\"\n  }\n}\n\nfunction formatDuration(ms: number): string {\n  if (ms < 1000) return `${ms}ms`\n  return `${(ms / 1000).toFixed(2)}s`\n}\n\nfunction truncate(str: string, maxLen: number = 200): string {\n  if (!str) return \"\"\n  if (str.length <= maxLen) return str\n  return str.substring(0, maxLen) + \"...\"\n}\n\n// Main logger class\nclass ApiLogger {\n  private static instance: ApiLogger\n  private enabled: boolean = true\n\n  private constructor() {}\n\n  static getInstance(): ApiLogger {\n    if (!ApiLogger.instance) {\n      ApiLogger.instance = new ApiLogger()\n    }\n    return ApiLogger.instance\n  }\n\n  setEnabled(enabled: boolean) {\n    this.enabled = enabled\n  }\n\n  private formatLogForConsole(entry: ApiLogEntry): string {\n    const time = new Date(entry.timestamp).toLocaleTimeString(\"he-IL\")\n    const icon = getCategoryIcon(entry.category)\n    const levelColor = getLevelColor(entry.level)\n    \n    let output = `${colors.dim}[${time}]${colors.reset} ${icon} ${levelColor}[${entry.level.toUpperCase()}]${colors.reset} `\n    output += `${colors.bright}${entry.action}${colors.reset}`\n    \n    if (entry.method && entry.endpoint) {\n      const methodColor = entry.method === \"GET\" ? colors.green : \n                         entry.method === \"POST\" ? colors.blue : \n                         entry.method === \"PUT\" ? colors.yellow : colors.red\n      output += ` ${methodColor}${entry.method}${colors.reset} ${entry.endpoint}`\n    }\n    \n    if (entry.statusCode) {\n      const statusColor = entry.statusCode < 300 ? colors.green : \n                         entry.statusCode < 400 ? colors.yellow : colors.red\n      output += ` ${statusColor}[${entry.statusCode}]${colors.reset}`\n    }\n    \n    if (entry.duration) {\n      output += ` ${colors.magenta}(${formatDuration(entry.duration)})${colors.reset}`\n    }\n    \n    return output\n  }\n\n  async log(entry: Omit<ApiLogEntry, \"id\" | \"timestamp\">): Promise<void> {\n    if (!this.enabled) return\n\n    const fullEntry: ApiLogEntry = {\n      ...entry,\n      timestamp: new Date().toISOString(),\n    }\n\n    // Console output\n    console.log(this.formatLogForConsole(fullEntry))\n    \n    // Additional details for errors or debug\n    if (entry.level === \"error\" && entry.error) {\n      console.error(`${colors.red}  Error: ${entry.error}${colors.reset}`)\n    }\n    \n    if (entry.requestBody && (entry.level === \"debug\" || entry.level === \"error\")) {\n      console.log(`${colors.dim}  Request: ${truncate(JSON.stringify(entry.requestBody))}${colors.reset}`)\n    }\n    \n    if (entry.responseBody && entry.level === \"error\") {\n      console.log(`${colors.dim}  Response: ${truncate(JSON.stringify(entry.responseBody))}${colors.reset}`)\n    }\n\n    // Add to buffer\n    logBuffer.push(fullEntry)\n    if (logBuffer.length > MAX_BUFFER_SIZE) {\n      logBuffer.shift()\n    }\n\n    // Save to Supabase (async, non-blocking)\n    this.saveToSupabase(fullEntry).catch(() => {})\n  }\n\n  private async saveToSupabase(entry: ApiLogEntry): Promise<void> {\n    const db = getSupabase()\n    if (!db) return\n\n    try {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      await (db.from(\"api_logs\") as any).insert({\n        timestamp: entry.timestamp,\n        level: entry.level,\n        category: entry.category,\n        action: entry.action,\n        method: entry.method,\n        endpoint: entry.endpoint,\n        request_body: entry.requestBody,\n        response_body: entry.responseBody,\n        status_code: entry.statusCode,\n        duration_ms: entry.duration,\n        user_id: entry.userId,\n        session_id: entry.sessionId,\n        ip_address: entry.ip,\n        user_agent: entry.userAgent,\n        error_message: entry.error,\n        metadata: entry.metadata,\n      })\n    } catch (error) {\n      // Silent fail - don't let logging break the app\n    }\n  }\n\n  // Convenience methods\n  debug(category: ApiLogEntry[\"category\"], action: string, metadata?: Record<string, any>) {\n    this.log({ level: \"debug\", category, action, metadata })\n  }\n\n  info(category: ApiLogEntry[\"category\"], action: string, metadata?: Record<string, any>) {\n    this.log({ level: \"info\", category, action, metadata })\n  }\n\n  warn(category: ApiLogEntry[\"category\"], action: string, metadata?: Record<string, any>) {\n    this.log({ level: \"warn\", category, action, metadata })\n  }\n\n  error(category: ApiLogEntry[\"category\"], action: string, error?: string, metadata?: Record<string, any>) {\n    this.log({ level: \"error\", category, action, error, metadata })\n  }\n\n  // API request logging\n  async logApiRequest(params: {\n    method: string\n    endpoint: string\n    requestBody?: any\n    responseBody?: any\n    statusCode: number\n    duration: number\n    userId?: string\n    ip?: string\n    userAgent?: string\n    error?: string\n  }) {\n    const level: LogLevel = params.statusCode >= 500 ? \"error\" : \n                           params.statusCode >= 400 ? \"warn\" : \"info\"\n    \n    await this.log({\n      level,\n      category: \"api\",\n      action: `API Request`,\n      ...params,\n    })\n  }\n\n  // Medici API logging\n  async logMediciCall(params: {\n    action: string\n    endpoint: string\n    requestBody?: any\n    responseBody?: any\n    statusCode: number\n    duration: number\n    error?: string\n  }) {\n    const level: LogLevel = params.statusCode >= 500 ? \"error\" : \n                           params.statusCode >= 400 ? \"warn\" : \"info\"\n    \n    await this.log({\n      level,\n      category: \"medici\",\n      method: \"POST\",\n      ...params,\n    })\n  }\n\n  // Get recent logs\n  getRecentLogs(count: number = 100, filter?: Partial<ApiLogEntry>): ApiLogEntry[] {\n    let logs = [...logBuffer].reverse()\n    \n    if (filter) {\n      logs = logs.filter(log => {\n        if (filter.level && log.level !== filter.level) return false\n        if (filter.category && log.category !== filter.category) return false\n        if (filter.action && !log.action.includes(filter.action)) return false\n        return true\n      })\n    }\n    \n    return logs.slice(0, count)\n  }\n\n  // Clear buffer\n  clearBuffer() {\n    logBuffer.length = 0\n  }\n}\n\n// Export singleton instance\nexport const apiLogger = ApiLogger.getInstance()\n\n// Export helper for timing operations\nexport function withTiming<T>(operation: () => Promise<T>): Promise<{ result: T; duration: number }> {\n  const start = Date.now()\n  return operation().then(result => ({\n    result,\n    duration: Date.now() - start\n  }))\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 315, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/v0-bookinengine/lib/api/medici-client.ts"],"sourcesContent":["// Medici Hotels API Client\n// Complete AI-Executable Integration\n// Base URL: https://medici-backend.azurewebsites.net\n\nimport type { HotelSearchResult, PreBookResponse, BookResponse } from \"./medici-types\"\nimport \"server-only\"\nexport * from \"./medici-types\"\n\n// Import logger\nimport { apiLogger } from \"@/lib/logging/api-logger\"\n\nconst MEDICI_BASE_URL = process.env.MEDICI_BASE_URL || \"https://medici-backend.azurewebsites.net\"\nconst MEDICI_IMAGES_BASE = \"https://medici-images.azurewebsites.net/images/\"\n\n// IMPORTANT: Use hardcoded token (UserId:11, expires 2066) - DO NOT use env variable as it may have old token\nconst MEDICI_TOKEN = \"eyJhbGciOiJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzA0L3htbGRzaWctbW9yZSNobWFjLXNoYTI1NiIsInR5cCI6IkpXVCJ9.eyJQZXJtaXNzaW9ucyI6IjEiLCJVc2VySWQiOiIxMSIsIm5iZiI6MTc2ODQ1NzU5NSwiZXhwIjoyMDgzOTkwMzk1LCJpc3MiOiJodHRwczovL2FkbWluLm1lZGljaWhvdGVscy5jb20vIiwiYXVkIjoiaHR0cHM6Ly9hZG1pbi5tZWRpY2lob3RlbHMuY29tLyJ9.g-CO7I75BlowE-F3J3GqlXsbIgNtG8_w2v1WMwG6djE\"\n\n// =====================\n// TYPES\n// =====================\n\n// Types are imported from medici-types.ts\n\n// =====================\n// REFERENCE TABLES\n// =====================\n\nexport const BOARD_TYPES: Record<number, { code: string; name: string; nameHe: string }> = {\n  1: { code: \"RO\", name: \"Room Only\", nameHe: \" \" },\n  2: { code: \"BB\", name: \"Bed & Breakfast\", nameHe: \"专转 拽专\" },\n  3: { code: \"HB\", name: \"Half Board\", nameHe: \"爪 驻住\" },\n  4: { code: \"FB\", name: \"Full Board\", nameHe: \"驻住 \" },\n  5: { code: \"AI\", name: \"All Inclusive\", nameHe: \" \" },\n}\n\nexport const ROOM_CATEGORIES: Record<number, { name: string; nameHe: string }> = {\n  1: { name: \"Standard\", nameHe: \"住专\" },\n  2: { name: \"Superior\", nameHe: \"住驻专专\" },\n  3: { name: \"Deluxe\", nameHe: \"拽住\" },\n  4: { name: \"Suite\", nameHe: \"住\" },\n  5: { name: \"Junior Suite\", nameHe: \"住转 '专\" },\n  6: { name: \"Family\", nameHe: \"砖驻转\" },\n}\n\n// =====================\n// API CLIENT CLASS\n// =====================\n\nexport class MediciApiClient {\n  private baseUrl: string\n  private token: string\n  private retries: number\n  private maxRetries: number\n\n  constructor(token?: string) {\n    this.token = token || MEDICI_TOKEN\n    this.baseUrl = MEDICI_BASE_URL\n    this.retries = 0\n    this.maxRetries = 2\n  }\n\n  private async request<T>(endpoint: string, options: RequestInit = {}): Promise<T> {\n    const url = `${this.baseUrl}${endpoint}`\n    const startTime = Date.now()\n\n    const headers: Record<string, string> = {\n      \"Content-Type\": \"application/json\",\n      Authorization: `Bearer ${this.token}`,\n      ...(options.headers as Record<string, string>),\n    }\n\n    // Log request start\n    apiLogger.debug(\"medici\", `Medici API Request: ${endpoint}`, {\n      url,\n      method: options.method || \"GET\",\n    })\n\n    try {\n      const response = await fetch(url, {\n        ...options,\n        headers,\n      })\n\n      const duration = Date.now() - startTime\n\n      if (response.status === 204) {\n        apiLogger.info(\"medici\", `Medici API Success (204 No Content)`, {\n          endpoint,\n          duration,\n        })\n        return { _status: 204 } as T\n      }\n\n      if (!response.ok) {\n        const errorBody = await response.text()\n\n        // Log error\n        await apiLogger.logMediciCall({\n          action: \"Medici API Error\",\n          endpoint,\n          requestBody: options.body ? JSON.parse(options.body as string) : undefined,\n          statusCode: response.status,\n          duration,\n          error: errorBody,\n        })\n\n        if (response.status === 401 && this.retries < this.maxRetries) {\n          this.retries++\n          apiLogger.warn(\"medici\", `Token expired, refreshing (attempt ${this.retries})`)\n          await this.refreshToken()\n          return this.request<T>(endpoint, options)\n        }\n\n        throw new Error(`API Error ${response.status}: ${errorBody}`)\n      }\n\n      const data = await response.json()\n      this.retries = 0\n\n      // Log successful response\n      await apiLogger.logMediciCall({\n        action: \"Medici API Success\",\n        endpoint,\n        requestBody: options.body ? JSON.parse(options.body as string) : undefined,\n        responseBody: { itemCount: Array.isArray(data) ? data.length : (data?.items?.length || 1) },\n        statusCode: response.status,\n        duration,\n      })\n\n      return data\n    } catch (error) {\n      const duration = Date.now() - startTime\n      \n      if (error instanceof Error) {\n        apiLogger.error(\"medici\", `Medici API Exception: ${endpoint}`, error.message, { duration })\n        throw error\n      }\n      throw new Error(\"Unknown error occurred\")\n    }\n  }\n\n  // =====================\n  // STEP 1: SEARCH HOTELS\n  // =====================\n  async searchHotels(params: {\n    dateFrom: string\n    dateTo: string\n    hotelName?: string\n    city?: string\n    rooms?: Array<{ adults: number; children: number[] }> // Array of rooms\n    adults?: number // Fallback for single room\n    children?: number[] // Fallback for single room\n    stars?: number\n    limit?: number\n  }): Promise<HotelSearchResult[]> {\n    const pax = params.rooms || [\n      {\n        adults: params.adults || 2,\n        children: params.children || [],\n      },\n    ]\n\n    const searchBody: any = {\n      dateFrom: params.dateFrom,\n      dateTo: params.dateTo,\n      pax,\n      stars: params.stars || null,\n      limit: params.limit || null,\n      ShowExtendedData: true, // Get images, description, facilities from Medici\n    }\n\n    if (params.hotelName) {\n      searchBody.hotelName = params.hotelName\n    } else if (params.city) {\n      searchBody.city = params.city\n    }\n\n    const response = await this.request<any>(\"/api/hotels/GetInnstantSearchPrice\", {\n      method: \"POST\",\n      body: JSON.stringify(searchBody),\n    })\n\n    const hotels = this.transformSearchResults(response)\n\n    return hotels.map((hotel) => ({\n      ...hotel,\n      requestJson: params,\n      responseJson: response,\n    }))\n  }\n\n  // =====================\n  // STEP 2: PRE-BOOK\n  // =====================\n  async preBook(params: {\n    jsonRequest: string\n  }): Promise<PreBookResponse> {\n    const preBookBody = {\n      jsonRequest: params.jsonRequest,\n    }\n\n    const response = await this.request<any>(\"/api/hotels/PreBook\", {\n      method: \"POST\",\n      body: JSON.stringify(preBookBody),\n    })\n\n    if (response._status === 204) {\n      return {\n        success: true,\n        preBookId: 0,\n        token: \"\",\n        status: \"done\",\n        priceConfirmed: 0,\n        currency: \"USD\",\n        requestJson: params.jsonRequest,\n        responseJson: \"\",\n      }\n    }\n\n    const token = response?.content?.services?.hotels?.[0]?.token || response?.token || response?.preBookToken || \"\"\n\n    const preBookId = response?.opportunityId || response?.preBookId || response?.id || 0\n\n    const priceConfirmed =\n      response?.content?.services?.hotels?.[0]?.netPrice?.amount ||\n      response?.content?.services?.hotels?.[0]?.price?.amount ||\n      response?.price?.amount ||\n      0\n\n    const currency =\n      response?.content?.services?.hotels?.[0]?.netPrice?.currency ||\n      response?.content?.services?.hotels?.[0]?.price?.currency ||\n      \"USD\"\n\n    const isSuccess = token || response?.status === \"done\"\n\n    return {\n      success: isSuccess,\n      preBookId,\n      token,\n      status: response?.status || (isSuccess ? \"done\" : \"failed\"),\n      priceConfirmed,\n      currency,\n      requestJson: params.jsonRequest,\n      responseJson: response,\n    }\n  }\n\n  // =====================\n  // STEP 3: BOOK\n  // =====================\n  async book(params: {\n    jsonRequest: string\n  }): Promise<BookResponse> {\n    const bookBody = {\n      jsonRequest: params.jsonRequest,\n    }\n\n    try {\n      const response = await this.request<any>(\"/api/hotels/Book\", {\n        method: \"POST\",\n        body: JSON.stringify(bookBody),\n      })\n\n      console.log('[DEBUG] Book API Response:', JSON.stringify(response, null, 2))\n\n      const bookingID =\n        response?.bookRes?.content?.bookingID ||\n        response?.content?.bookingID ||\n        response?.bookingId ||\n        response?.bookingID ||\n        \"\"\n\n      const supplierReference =\n        response?.bookRes?.content?.services?.[0]?.supplier?.reference ||\n        response?.content?.services?.[0]?.supplier?.reference ||\n        response?.supplierReference ||\n        \"\"\n\n      const status = response?.bookRes?.content?.status || response?.content?.status || response?.status || \"\"\n\n      console.log('[DEBUG] Parsed:', { bookingID, supplierReference, status })\n\n      const isSuccess = status === \"confirmed\"\n\n      return {\n        success: isSuccess,\n        bookingId: String(bookingID),\n        supplierReference,\n        status,\n      }\n    } catch (error: any) {\n      return {\n        success: false,\n        bookingId: \"\",\n        supplierReference: \"\",\n        status: \"failed\",\n        error: error.message,\n      }\n    }\n  }\n\n  // =====================\n  // MANUAL BOOK (by code)\n  // =====================\n  async manualBook(params: { opportunityId: number; code: string }): Promise<BookResponse> {\n    try {\n      const response = await this.request<any>(\"/api/hotels/ManualBook\", {\n        method: \"POST\",\n        body: JSON.stringify({\n          opportunityId: params.opportunityId,\n          code: params.code,\n        }),\n      })\n\n      return {\n        success: response?.success || response?.bookingId,\n        bookingId: String(response?.bookingId || \"\"),\n        status: \"confirmed\",\n      }\n    } catch (error: any) {\n      return {\n        success: false,\n        error: error.message,\n      }\n    }\n  }\n\n  // =====================\n  // CANCEL BOOKING\n  // =====================\n  async cancelBooking(preBookId: number): Promise<{ success: boolean; error?: string }> {\n    try {\n      await this.request(`/api/hotels/CancelRoomActive?prebookId=${preBookId}`, {\n        method: \"DELETE\",\n      })\n      return { success: true }\n    } catch (error: any) {\n      return { success: false, error: error.message }\n    }\n  }\n\n  // =====================\n  // ROOM MANAGEMENT\n  // =====================\n\n  async getActiveRooms(params?: {\n    startDate?: string\n    endDate?: string\n    hotelName?: string\n    hotelStars?: number\n    city?: string\n    roomBoard?: string\n    roomCategory?: string\n    provider?: string\n  }): Promise<any[]> {\n    const response = await this.request<any>(\"/api/hotels/GetRoomsActive\", {\n      method: \"POST\",\n      body: JSON.stringify(params || {}),\n    })\n    return Array.isArray(response) ? response : []\n  }\n\n  async getSoldRooms(params?: {\n    startDate?: string\n    endDate?: string\n    hotelName?: string\n  }): Promise<any[]> {\n    const response = await this.request<any>(\"/api/hotels/GetRoomsSales\", {\n      method: \"POST\",\n      body: JSON.stringify(params || {}),\n    })\n    return Array.isArray(response) ? response : []\n  }\n\n  async getCancelledRooms(params?: {\n    startDate?: string\n    endDate?: string\n    hotelName?: string\n  }): Promise<any[]> {\n    const response = await this.request<any>(\"/api/hotels/GetRoomsCancel\", {\n      method: \"POST\",\n      body: JSON.stringify(params || {}),\n    })\n    return Array.isArray(response) ? response : []\n  }\n\n  // =====================\n  // DASHBOARD\n  // =====================\n  async getDashboardInfo(params?: {\n    hotelStars?: number\n    city?: string\n    hotelName?: string\n    reservationMonthDate?: string\n    checkInMonthDate?: string\n    provider?: string\n  }): Promise<any> {\n    const response = await this.request<any>(\"/api/hotels/GetDashboardInfo\", {\n      method: \"POST\",\n      body: JSON.stringify(params || {}),\n    })\n    return response || {}\n  }\n\n  // =====================\n  // OPPORTUNITIES\n  // =====================\n\n  async getOpportunities(params?: {\n    startDate?: string\n    endDate?: string\n  }): Promise<any[]> {\n    const response = await this.request<any>(\"/api/hotels/GetOpportunities\", {\n      method: \"POST\",\n      body: JSON.stringify(params || {}),\n    })\n    return Array.isArray(response) ? response : []\n  }\n\n  async insertOpportunity(params: {\n    hotelId?: number\n    startDateStr: string\n    endDateStr: string\n    boardId: number\n    categoryId: number\n    buyPrice: number\n    pushPrice: number\n    maxRooms: number\n    paxAdults?: number\n    paxChildren?: number[]\n  }): Promise<{ success: boolean; opportunityId?: number; error?: string }> {\n    try {\n      const response = await this.request<any>(\"/api/hotels/InsertOpportunity\", {\n        method: \"POST\",\n        body: JSON.stringify(params),\n      })\n      return { success: true, opportunityId: response?.opportunityId }\n    } catch (error: any) {\n      return { success: false, error: error.message }\n    }\n  }\n\n  // =====================\n  // PRICE UPDATE\n  // =====================\n  async updatePushPrice(preBookId: number, pushPrice: number): Promise<{ success: boolean; error?: string }> {\n    try {\n      await this.request(\"/api/hotels/UpdateRoomsActivePushPrice\", {\n        method: \"POST\",\n        body: JSON.stringify({\n          preBookId,\n          pushPrice,\n        }),\n      })\n      return { success: true }\n    } catch (error: any) {\n      return { success: false, error: error.message }\n    }\n  }\n\n  // =====================\n  // ARCHIVE\n  // =====================\n  async getRoomArchive(params: {\n    stayFrom?: string\n    stayTo?: string\n    hotelName?: string\n    minPrice?: number\n    maxPrice?: number\n    city?: string\n    roomBoard?: string\n    roomCategory?: string\n    pageNumber?: number\n    pageSize?: number\n  }): Promise<{ data: any[]; totalCount: number }> {\n    const response = await this.request<any>(\"/api/hotels/GetRoomArchiveData\", {\n      method: \"POST\",\n      body: JSON.stringify({\n        ...params,\n        pageNumber: params.pageNumber || 1,\n        pageSize: params.pageSize || 50,\n      }),\n    })\n\n    return {\n      data: response?.data || [],\n      totalCount: response?.totalCount || 0,\n    }\n  }\n\n  async refreshToken(): Promise<string> {\n    try {\n      const formData = new URLSearchParams()\n      formData.append(\n        \"client_secret\",\n        process.env.MEDICI_CLIENT_SECRET || \"zlbgGGxz~|l3.Q?XXAT)uT!Lty,kJC>R?`:k?oQH$I=P7rL<R:Em:qDaM1G(jFU7\",\n      )\n\n      const response = await fetch(`${this.baseUrl}/api/auth/OnlyNightUsersTokenAPI`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/x-www-form-urlencoded\",\n        },\n        body: formData.toString(),\n      })\n\n      if (!response.ok) {\n        const errorText = await response.text()\n        throw new Error(`Token refresh failed: ${response.status} - ${errorText}`)\n      }\n\n      const data = await response.json()\n      this.token = data.token || data.access_token || data.aether_access_token\n      return this.token\n    } catch (error: any) {\n      console.error(\"Failed to refresh token:\", error.message)\n      throw error\n    }\n  }\n\n  private transformSearchResults(response: any): HotelSearchResult[] {\n    if (!response) {\n      return []\n    }\n\n    let items: any[] = []\n\n    if (Array.isArray(response)) {\n      items = response\n    } else if (response.items && Array.isArray(response.items)) {\n      items = response.items\n    } else if (response.data && Array.isArray(response.data)) {\n      items = response.data\n    }\n\n    const hotelMap = new Map<number, HotelSearchResult>()\n\n    for (const item of items) {\n      // Support new Medici format with ShowExtendedData\n      const hotelIdRaw = item.id || item.hotelId || item.hotelCode || item.HotelId || item.hotel_id || \n        (item.items?.[0]?.hotelId) || 0\n      const hotelId = typeof hotelIdRaw === \"number\" ? hotelIdRaw : Number.parseInt(String(hotelIdRaw), 10) || 0\n      const hotelName = item.name || item.hotelName || item.HotelName || item.items?.[0]?.hotelName || \"Unknown Hotel\"\n\n      // Extract facilities from new format (facilities.list or facilities.tags)\n      let facilitiesList: string[] = []\n      if (item.facilities) {\n        if (Array.isArray(item.facilities)) {\n          facilitiesList = item.facilities\n        } else if (item.facilities.list && Array.isArray(item.facilities.list)) {\n          facilitiesList = item.facilities.list\n        } else if (item.facilities.tags && Array.isArray(item.facilities.tags)) {\n          facilitiesList = item.facilities.tags\n        }\n      }\n\n      if (!hotelMap.has(hotelId)) {\n        hotelMap.set(hotelId, {\n          hotelId,\n          hotelName,\n          hotelImage: getHotelMainImage(item),\n          images: buildImagesArray(item),\n          location: item.address || item.location || \"\",\n          city: item.city || extractCityFromDestinations(item) || \"\",\n          stars: item.stars || item.rating || 0,\n          address: item.address || \"\",\n          description: item.description || \"\",\n          facilities: facilitiesList,\n          phone: item.phone || \"\",\n          fax: item.fax || \"\",\n          lat: item.lat || 0,\n          lon: item.lon || 0,\n          seoname: item.seoname || \"\",\n          rooms: [],\n        })\n      }\n\n      const hotel = hotelMap.get(hotelId)!\n\n      const roomItems = item.items || [item]\n\n      for (let roomIdx = 0; roomIdx < roomItems.length; roomIdx++) {\n        const roomItem = roomItems[roomIdx]\n\n        const possibleCodeFields = [\n          roomItem.code,\n          roomItem.Code,\n          roomItem.roomCode,\n          roomItem.RoomCode,\n          roomItem.rateKey,\n          roomItem.RateKey,\n          roomItem.bookingCode,\n          roomItem.BookingCode,\n          roomItem.optionCode,\n          roomItem.OptionCode,\n          roomItem.key,\n          roomItem.Key,\n          roomItem.id?.toString(),\n          roomItem.rate?.code,\n          roomItem.rate?.key,\n          roomItem.option?.code,\n          roomItem.booking?.code,\n        ]\n\n        let roomCode = \"\"\n        for (const codeField of possibleCodeFields) {\n          if (codeField && typeof codeField === \"string\" && codeField.length > 0) {\n            roomCode = codeField\n            break\n          }\n        }\n\n        if (!roomCode) {\n          const tempCode = `TEMP-${hotelId}-${roomItem.id || Date.now()}-${roomIdx}`\n          roomCode = tempCode\n        }\n\n        // Extract price from room item first, then fallback to parent item (hotel level)\n        let price = extractPriceFromRoom(roomItem)\n        if (price === 0) {\n          price = extractPriceFromRoom(item) // Fallback to hotel-level price\n        }\n\n        hotel.rooms.push({\n          code: roomCode,\n          roomId: String(roomItem.id || roomItem.roomId || `${hotel.hotelId}-${hotel.rooms.length + 1}`),\n          roomName: roomItem.name || roomItem.roomName || \"Standard Room\",\n          roomCategory: roomItem.category || roomItem.roomType || \"standard\",\n          categoryId: roomItem.categoryId || roomItem.category_id || 1,\n          roomImage: getRoomMainImage(roomItem) || hotel.hotelImage, // Fallback to hotel image\n          images: buildRoomImagesArray(roomItem),\n          bedding: roomItem.bedding || \"\",\n          board: roomItem.board || \"RO\",\n          boardId: roomItem.boardId || getBoardIdFromCode(roomItem.board || \"RO\"),\n          boardType: roomItem.board || \"RO\",\n          maxOccupancy: roomItem.pax?.adults || roomItem.maxOccupancy || 2,\n          size: roomItem.size || roomItem.roomSize || 0,\n          view: roomItem.view || \"\",\n          amenities: roomItem.amenities || roomItem.facilities || [],\n          price: price,\n          buyPrice: price,\n          originalPrice: price > 0 ? Math.round(price * 1.15) : 0,\n          currency: roomItem.currency || item.price?.currency || item.netPrice?.currency || \"USD\",\n          cancellationPolicy: formatCancellationPolicy(item.cancellation) || roomItem.cancellationPolicy || \"free\",\n          cancellation: item.cancellation || null,\n          available: roomItem.quantity?.max || roomItem.available || 1,\n          requestJson: item.code || roomItem.code || roomCode, // Use hotel-level code for prebook\n          pax: roomItem.pax || { adults: 2, children: [] },\n          confirmation: item.confirmation || \"on_request\",\n          paymentType: item.paymentType || \"pre\",\n          providers: item.providers || [],\n          specialOffers: item.specialOffers || [],\n        })\n      }\n    }\n\n    const results = Array.from(hotelMap.values())\n    return results\n  }\n}\n\nexport const mediciApi = new MediciApiClient()\n\n// =====================\n// HELPER FUNCTIONS\n// =====================\n\nfunction buildFullImageUrl(imagePath: string | undefined): string {\n  if (!imagePath) return \"\"\n  if (imagePath.startsWith(\"http://\") || imagePath.startsWith(\"https://\")) {\n    return imagePath\n  }\n  return `${MEDICI_IMAGES_BASE}${imagePath}`\n}\n\nfunction getHotelMainImage(item: any): string {\n  if (item.imageUrl) return buildFullImageUrl(item.imageUrl)\n  if (item.image) return buildFullImageUrl(item.image)\n  if (item.mainImage) return buildFullImageUrl(item.mainImage)\n\n  if (item.images && Array.isArray(item.images) && item.images.length > 0) {\n    const firstImage = item.images[0]\n    if (typeof firstImage === \"string\") return buildFullImageUrl(firstImage)\n    if (firstImage?.url) return buildFullImageUrl(firstImage.url)\n    if (firstImage?.path) return buildFullImageUrl(firstImage.path)\n  }\n\n  if (item.items && item.items[0]?.images && item.items[0].images.length > 0) {\n    return buildFullImageUrl(item.items[0].images[0])\n  }\n\n  return \"\"\n}\n\nfunction buildImagesArray(item: any): string[] {\n  const images: string[] = []\n\n  if (item.images && Array.isArray(item.images)) {\n    for (const img of item.images) {\n      if (typeof img === \"string\") {\n        images.push(buildFullImageUrl(img))\n      } else if (img?.url) {\n        images.push(buildFullImageUrl(img.url))\n      } else if (img?.path) {\n        images.push(buildFullImageUrl(img.path))\n      }\n    }\n  }\n\n  if (item.items && item.items[0]?.images) {\n    for (const img of item.items[0].images) {\n      if (typeof img === \"string\") {\n        images.push(buildFullImageUrl(img))\n      }\n    }\n  }\n\n  return images.filter(Boolean)\n}\n\nfunction extractPriceFromRoom(room: any): number {\n  const priceLocations = [\n    // Medici API uses netPrice as primary price field\n    { name: \"netPrice.amount\", value: room.netPrice?.amount },\n    { name: \"price.amount\", value: room.price?.amount },\n    { name: \"price.value\", value: room.price?.value },\n    { name: \"price (direct)\", value: room.price },\n    { name: \"buyPrice\", value: room.buyPrice },\n    { name: \"sellPrice\", value: room.sellPrice },\n    { name: \"totalPrice\", value: room.totalPrice },\n    { name: \"amount\", value: room.amount },\n    { name: \"rate.amount\", value: room.rate?.amount },\n    { name: \"rate.value\", value: room.rate?.value },\n    { name: \"rate (direct)\", value: room.rate },\n    { name: \"cost\", value: room.cost },\n    { name: \"netPrice\", value: room.netPrice },\n    { name: \"grossPrice\", value: room.grossPrice },\n    { name: \"Price\", value: room.Price },\n    { name: \"BuyPrice\", value: room.BuyPrice },\n    { name: \"SellPrice\", value: room.SellPrice },\n    { name: \"TotalPrice\", value: room.TotalPrice },\n  ]\n\n  for (const { name, value } of priceLocations) {\n    if (typeof value === \"number\" && value > 0) {\n      return value\n    }\n    if (typeof value === \"string\") {\n      const parsed = Number.parseFloat(value)\n      if (!isNaN(parsed) && parsed > 0) {\n        return parsed\n      }\n    }\n  }\n\n  return 0\n}\n\nfunction getRoomMainImage(room: any): string {\n  if (room.imageUrl) return buildFullImageUrl(room.imageUrl)\n  if (room.image) return buildFullImageUrl(room.image)\n  if (room.mainImage) return buildFullImageUrl(room.mainImage)\n\n  if (room.images && Array.isArray(room.images) && room.images.length > 0) {\n    const firstImage = room.images[0]\n    if (typeof firstImage === \"string\") return buildFullImageUrl(firstImage)\n    if (firstImage?.url) return buildFullImageUrl(firstImage.url)\n    if (firstImage?.path) return buildFullImageUrl(firstImage.path)\n  }\n\n  return \"\"\n}\n\nfunction buildRoomImagesArray(room: any): string[] {\n  const images: string[] = []\n\n  if (room.images && Array.isArray(room.images)) {\n    for (const img of room.images) {\n      if (typeof img === \"string\") {\n        images.push(buildFullImageUrl(img))\n      } else if (img?.url) {\n        images.push(buildFullImageUrl(img.url))\n      } else if (img?.path) {\n        images.push(buildFullImageUrl(img.path))\n      }\n    }\n  }\n\n  return images.filter(Boolean)\n}\n\nfunction getBoardIdFromCode(boardCode: string): number {\n  for (const [id, board] of Object.entries(BOARD_TYPES)) {\n    if (board.code === boardCode) {\n      return Number.parseInt(id, 10)\n    }\n  }\n  return 0\n}\n\n// Extract city from destinations array (new Medici format)\nfunction extractCityFromDestinations(item: any): string {\n  if (item.destinations && Array.isArray(item.destinations)) {\n    const cityDest = item.destinations.find((d: any) => d.type === \"city\")\n    if (cityDest?.destinationId) {\n      return `City-${cityDest.destinationId}` // Will be resolved by enrichment\n    }\n  }\n  if (item.surroundings && Array.isArray(item.surroundings)) {\n    const citySurr = item.surroundings.find((s: any) => s.type === \"city\")\n    if (citySurr?.destinationId) {\n      return `City-${citySurr.destinationId}`\n    }\n  }\n  return \"\"\n}\n\n// Format cancellation policy from new Medici format\nfunction formatCancellationPolicy(cancellation: any): string {\n  if (!cancellation) return \"free\"\n  \n  if (cancellation.type === \"fully-refundable\") {\n    return \"free\"\n  } else if (cancellation.type === \"non-refundable\") {\n    return \"non-refundable\"\n  } else if (cancellation.type === \"partially-refundable\") {\n    return \"partial\"\n  }\n  \n  // Check frames for deadline\n  if (cancellation.frames && Array.isArray(cancellation.frames)) {\n    const freeFrame = cancellation.frames.find((f: any) => \n      f.penalty?.amount === 0\n    )\n    if (freeFrame) {\n      const deadline = new Date(freeFrame.to)\n      return `Free cancellation until ${deadline.toLocaleDateString()}`\n    }\n  }\n  \n  return cancellation.type || \"free\"\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1093, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/v0-bookinengine/lib/demo/demo-mode.ts"],"sourcesContent":["import type { PreBookResponse, BookResponse } from \"@/lib/api/medici-types\"\n\nexport const DEMO_MODE = process.env.NEXT_PUBLIC_DEMO_MODE === \"true\"\n\nexport async function mockPreBook(): Promise<PreBookResponse> {\n  await new Promise((resolve) => setTimeout(resolve, 1000))\n\n  return {\n    success: true,\n    preBookId: Math.floor(Math.random() * 100000),\n    token: `DEMO_TOKEN_${Date.now()}`,\n    status: \"done\",\n    priceConfirmed: 1200,\n    currency: \"ILS\",\n    requestJson: '{\"demo\":\"prebook\"}',\n    responseJson: '{\"status\":\"success\"}',\n  }\n}\n\nexport async function mockBook(): Promise<BookResponse> {\n  await new Promise((resolve) => setTimeout(resolve, 1500))\n\n  return {\n    success: true,\n    bookingId: `DEMO${Date.now()}`,\n    supplierReference: `REF${Math.floor(Math.random() * 1000000)}`,\n    status: \"confirmed\",\n  }\n}\n"],"names":[],"mappings":";;;;;;;;AAEO,MAAM,YAAY,8CAAsC;AAExD,eAAe;IACpB,MAAM,IAAI,QAAQ,CAAC,UAAY,WAAW,SAAS;IAEnD,OAAO;QACL,SAAS;QACT,WAAW,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK;QACtC,OAAO,CAAC,WAAW,EAAE,KAAK,GAAG,IAAI;QACjC,QAAQ;QACR,gBAAgB;QAChB,UAAU;QACV,aAAa;QACb,cAAc;IAChB;AACF;AAEO,eAAe;IACpB,MAAM,IAAI,QAAQ,CAAC,UAAY,WAAW,SAAS;IAEnD,OAAO;QACL,SAAS;QACT,WAAW,CAAC,IAAI,EAAE,KAAK,GAAG,IAAI;QAC9B,mBAAmB,CAAC,GAAG,EAAE,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,UAAU;QAC9D,QAAQ;IACV;AACF"}},
    {"offset": {"line": 1160, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/v0-bookinengine/emails/booking-confirmation.tsx"],"sourcesContent":["import {\n  Body,\n  Button,\n  Container,\n  Head,\n  Heading,\n  Hr,\n  Html,\n  Img,\n  Link,\n  Preview,\n  Section,\n  Text,\n} from \"@react-email/components\"\n\ninterface BookingConfirmationEmailProps {\n  customerName: string\n  bookingId: string\n  supplierReference: string\n  hotelName: string\n  roomType: string\n  checkIn: string\n  checkOut: string\n  nights: number\n  adults: number\n  children: number\n  totalPrice: number\n  currency: string\n  hotelAddress?: string\n  hotelPhone?: string\n  cancellationPolicy?: string\n  language?: \"he\" | \"en\"\n}\n\nexport const BookingConfirmationEmail = ({\n  customerName = \"John Doe\",\n  bookingId = \"BK123456\",\n  supplierReference = \"HTL789\",\n  hotelName = \"Grand Hotel\",\n  roomType = \"Deluxe Room\",\n  checkIn = \"2024-12-25\",\n  checkOut = \"2024-12-28\",\n  nights = 3,\n  adults = 2,\n  children = 0,\n  totalPrice = 450,\n  currency = \"USD\",\n  hotelAddress = \"123 Main St, City\",\n  hotelPhone = \"+1-555-0123\",\n  cancellationPolicy = \"Free cancellation until 24 hours before check-in\",\n  language = \"en\",\n}: BookingConfirmationEmailProps) => {\n  const isHebrew = language === \"he\"\n\n  const content = {\n    en: {\n      subject: \"Booking Confirmation\",\n      greeting: `Dear ${customerName},`,\n      confirmed: \"Your booking has been confirmed! \",\n      details: \"Booking Details\",\n      bookingNumber: \"Booking Number\",\n      confirmationNumber: \"Confirmation Number\",\n      hotel: \"Hotel\",\n      room: \"Room Type\",\n      dates: \"Check-in / Check-out\",\n      duration: \"Duration\",\n      guests: \"Guests\",\n      total: \"Total Price\",\n      policy: \"Cancellation Policy\",\n      contact: \"Hotel Contact\",\n      address: \"Address\",\n      phone: \"Phone\",\n      viewBooking: \"View Booking\",\n      questions: \"Questions?\",\n      support: \"Contact our support team\",\n      footer: \"Thank you for choosing our booking service!\",\n      night: \"night\",\n      nights: \"nights\",\n      adult: \"adult\",\n      adults: \"adults\",\n      child: \"child\",\n      children: \"children\",\n    },\n    he: {\n      subject: \"砖专 \",\n      greeting: `${customerName} 砖,`,\n      confirmed: \"! 砖 砖专 \",\n      details: \"驻专 \",\n      bookingNumber: \"住驻专 \",\n      confirmationNumber: \"住驻专 砖专\",\n      hotel: \"\",\n      room: \"住 专\",\n      dates: \"爪'拽- / 爪'拽-\",\n      duration: \"砖 砖\",\n      guests: \"专\",\n      total: \"专 \",\n      policy: \"转 \",\n      contact: \"驻专 转拽砖专转 \",\n      address: \"转转\",\n      phone: \"驻\",\n      viewBooking: \"爪驻 \",\n      questions: \"砖 砖转?\",\n      support: \"爪专 拽砖专 注 转\",\n      footer: \"转 砖专转 砖专转 转 砖!\",\n      night: \"\",\n      nights: \"转\",\n      adult: \"专\",\n      adults: \"专\",\n      child: \"\",\n      children: \"\",\n    },\n  }\n\n  const t = content[language]\n\n  const formatDate = (dateStr: string) => {\n    const date = new Date(dateStr)\n    return isHebrew\n      ? date.toLocaleDateString(\"he-IL\", { year: \"numeric\", month: \"long\", day: \"numeric\" })\n      : date.toLocaleDateString(\"en-US\", { year: \"numeric\", month: \"long\", day: \"numeric\" })\n  }\n\n  const guestsText = `${adults} ${adults === 1 ? t.adult : t.adults}${children > 0 ? `, ${children} ${children === 1 ? t.child : t.children}` : \"\"}`\n\n  return (\n    <Html dir={isHebrew ? \"rtl\" : \"ltr\"}>\n      <Head />\n      <Preview>\n        {t.confirmed} {bookingId}\n      </Preview>\n      <Body style={main}>\n        <Container style={container}>\n          {/* Header */}\n          <Section style={header}>\n            <Heading style={h1}>{t.confirmed}</Heading>\n          </Section>\n\n          {/* Greeting */}\n          <Text style={text}>{t.greeting}</Text>\n          <Text style={text}>\n            {isHebrew\n              ? \" 砖 爪注 爪.  驻专 :\"\n              : \"Your booking has been successfully completed. Here are your booking details:\"}\n          </Text>\n\n          <Hr style={hr} />\n\n          {/* Booking Details Box */}\n          <Section style={detailsBox}>\n            <Heading as=\"h2\" style={h2}>\n              {t.details}\n            </Heading>\n\n            <table style={table}>\n              <tbody>\n                <tr>\n                  <td style={labelCell}>{t.bookingNumber}:</td>\n                  <td style={valueCell}>\n                    <strong>{bookingId}</strong>\n                  </td>\n                </tr>\n                <tr>\n                  <td style={labelCell}>{t.confirmationNumber}:</td>\n                  <td style={valueCell}>\n                    <strong>{supplierReference}</strong>\n                  </td>\n                </tr>\n                <tr>\n                  <td style={labelCell}>{t.hotel}:</td>\n                  <td style={valueCell}>{hotelName}</td>\n                </tr>\n                <tr>\n                  <td style={labelCell}>{t.room}:</td>\n                  <td style={valueCell}>{roomType}</td>\n                </tr>\n                <tr>\n                  <td style={labelCell}>{t.dates}:</td>\n                  <td style={valueCell}>\n                    {formatDate(checkIn)} - {formatDate(checkOut)}\n                  </td>\n                </tr>\n                <tr>\n                  <td style={labelCell}>{t.duration}:</td>\n                  <td style={valueCell}>\n                    {nights} {nights === 1 ? t.night : t.nights}\n                  </td>\n                </tr>\n                <tr>\n                  <td style={labelCell}>{t.guests}:</td>\n                  <td style={valueCell}>{guestsText}</td>\n                </tr>\n                <tr>\n                  <td style={labelCell}>{t.total}:</td>\n                  <td style={valueCell}>\n                    <strong style={price}>\n                      {currency} {totalPrice.toFixed(2)}\n                    </strong>\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n          </Section>\n\n          <Hr style={hr} />\n\n          {/* Hotel Contact */}\n          <Section>\n            <Heading as=\"h3\" style={h3}>\n              {t.contact}\n            </Heading>\n            <Text style={contactText}>\n              <strong>{hotelName}</strong>\n            </Text>\n            {hotelAddress && (\n              <Text style={contactText}>\n                {t.address}: {hotelAddress}\n              </Text>\n            )}\n            {hotelPhone && (\n              <Text style={contactText}>\n                {t.phone}: {hotelPhone}\n              </Text>\n            )}\n          </Section>\n\n          {/* Cancellation Policy */}\n          {cancellationPolicy && (\n            <>\n              <Hr style={hr} />\n              <Section>\n                <Heading as=\"h3\" style={h3}>\n                  {t.policy}\n                </Heading>\n                <Text style={policyText}>{cancellationPolicy}</Text>\n              </Section>\n            </>\n          )}\n\n          {/* CTA Button */}\n          <Section style={buttonContainer}>\n            <Button style={button} href={`${process.env.NEXT_PUBLIC_APP_URL}/my-bookings`}>\n              {t.viewBooking}\n            </Button>\n          </Section>\n\n          <Hr style={hr} />\n\n          {/* Footer */}\n          <Section>\n            <Text style={footer}>\n              {t.questions} <Link href=\"mailto:support@example.com\">{t.support}</Link>\n            </Text>\n            <Text style={footer}>{t.footer}</Text>\n          </Section>\n        </Container>\n      </Body>\n    </Html>\n  )\n}\n\nexport default BookingConfirmationEmail\n\n// Styles\nconst main = {\n  backgroundColor: \"#f6f9fc\",\n  fontFamily: '-apple-system,BlinkMacSystemFont,\"Segoe UI\",Roboto,\"Helvetica Neue\",Ubuntu,sans-serif',\n}\n\nconst container = {\n  backgroundColor: \"#ffffff\",\n  margin: \"0 auto\",\n  padding: \"20px 0 48px\",\n  marginBottom: \"64px\",\n  maxWidth: \"600px\",\n  borderRadius: \"8px\",\n}\n\nconst header = {\n  padding: \"32px 20px\",\n  backgroundColor: \"#4F46E5\",\n  borderRadius: \"8px 8px 0 0\",\n}\n\nconst h1 = {\n  color: \"#ffffff\",\n  fontSize: \"32px\",\n  fontWeight: \"700\",\n  margin: \"0\",\n  padding: \"0\",\n  textAlign: \"center\" as const,\n}\n\nconst h2 = {\n  color: \"#1f2937\",\n  fontSize: \"24px\",\n  fontWeight: \"600\",\n  margin: \"0 0 20px\",\n}\n\nconst h3 = {\n  color: \"#1f2937\",\n  fontSize: \"18px\",\n  fontWeight: \"600\",\n  margin: \"0 0 12px\",\n}\n\nconst text = {\n  color: \"#374151\",\n  fontSize: \"16px\",\n  lineHeight: \"24px\",\n  margin: \"16px 20px\",\n}\n\nconst detailsBox = {\n  backgroundColor: \"#f9fafb\",\n  border: \"1px solid #e5e7eb\",\n  borderRadius: \"8px\",\n  padding: \"24px\",\n  margin: \"20px\",\n}\n\nconst table = {\n  width: \"100%\",\n  borderCollapse: \"collapse\" as const,\n}\n\nconst labelCell = {\n  color: \"#6b7280\",\n  fontSize: \"14px\",\n  paddingBottom: \"12px\",\n  paddingRight: \"16px\",\n  verticalAlign: \"top\" as const,\n  width: \"40%\",\n}\n\nconst valueCell = {\n  color: \"#1f2937\",\n  fontSize: \"14px\",\n  paddingBottom: \"12px\",\n  fontWeight: \"500\",\n}\n\nconst price = {\n  color: \"#4F46E5\",\n  fontSize: \"18px\",\n  fontWeight: \"700\",\n}\n\nconst contactText = {\n  color: \"#374151\",\n  fontSize: \"14px\",\n  lineHeight: \"20px\",\n  margin: \"4px 20px\",\n}\n\nconst policyText = {\n  color: \"#6b7280\",\n  fontSize: \"14px\",\n  lineHeight: \"20px\",\n  margin: \"0 20px\",\n  fontStyle: \"italic\" as const,\n}\n\nconst hr = {\n  borderColor: \"#e5e7eb\",\n  margin: \"20px 0\",\n}\n\nconst buttonContainer = {\n  textAlign: \"center\" as const,\n  margin: \"32px 0\",\n}\n\nconst button = {\n  backgroundColor: \"#4F46E5\",\n  borderRadius: \"6px\",\n  color: \"#ffffff\",\n  fontSize: \"16px\",\n  fontWeight: \"600\",\n  textDecoration: \"none\",\n  textAlign: \"center\" as const,\n  display: \"inline-block\",\n  padding: \"12px 32px\",\n}\n\nconst footer = {\n  color: \"#6b7280\",\n  fontSize: \"12px\",\n  lineHeight: \"16px\",\n  textAlign: \"center\" as const,\n  margin: \"8px 20px\",\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1888, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/v0-bookinengine/emails/cancellation-confirmation.tsx"],"sourcesContent":["import {\n  Body,\n  Container,\n  Head,\n  Heading,\n  Hr,\n  Html,\n  Preview,\n  Section,\n  Text,\n} from \"@react-email/components\"\n\ninterface CancellationConfirmationEmailProps {\n  customerName: string\n  bookingId: string\n  hotelName: string\n  checkIn: string\n  checkOut: string\n  totalPrice: number\n  currency: string\n  refundAmount?: number\n  refundDate?: string\n  cancellationReason?: string\n  language?: \"he\" | \"en\"\n}\n\nexport const CancellationConfirmationEmail = ({\n  customerName = \"John Doe\",\n  bookingId = \"BK123456\",\n  hotelName = \"Grand Hotel\",\n  checkIn = \"2024-12-25\",\n  checkOut = \"2024-12-28\",\n  totalPrice = 450,\n  currency = \"USD\",\n  refundAmount,\n  refundDate,\n  cancellationReason,\n  language = \"en\",\n}: CancellationConfirmationEmailProps) => {\n  const isHebrew = language === \"he\"\n\n  const content = {\n    en: {\n      subject: \"Booking Cancellation Confirmed\",\n      greeting: `Dear ${customerName},`,\n      cancelled: \"Your booking has been cancelled\",\n      message: \"We confirm that your booking has been successfully cancelled.\",\n      details: \"Cancelled Booking Details\",\n      bookingNumber: \"Booking Number\",\n      hotel: \"Hotel\",\n      dates: \"Original Dates\",\n      originalPrice: \"Original Price\",\n      refund: \"Refund Information\",\n      refundAmount: \"Refund Amount\",\n      refundDate: \"Expected Refund Date\",\n      noRefund: \"This booking was non-refundable. No refund will be issued.\",\n      reason: \"Cancellation Reason\",\n      sorry: \"We're sorry to see you go!\",\n      future: \"We hope to serve you again in the future.\",\n      questions: \"Questions about your cancellation?\",\n      support: \"Contact our support team at support@example.com\",\n    },\n    he: {\n      subject: \"砖专  \",\n      greeting: `${customerName} 砖,`,\n      cancelled: \" 砖 \",\n      message: \" 砖专 砖 砖  爪.\",\n      details: \"驻专  转\",\n      bookingNumber: \"住驻专 \",\n      hotel: \"\",\n      dates: \"转专 拽专\",\n      originalPrice: \"专 拽专\",\n      refund: \"注 注 专 住驻\",\n      refundAmount: \"住 专\",\n      refundDate: \"转专 专 砖注专\",\n      noRefund: \"  转  驻砖专转 专.  转 专 住驻.\",\n      reason: \"住转 \",\n      sorry: \"! 爪注专 专转 注\",\n      future: \"砖 专 转 砖 注转.\",\n      questions: \"砖 砖转  ?\",\n      support: \"support@example.com 爪专 拽砖专 注 转 转转\",\n    },\n  }\n\n  const t = content[language]\n\n  const formatDate = (dateStr: string) => {\n    const date = new Date(dateStr)\n    return isHebrew\n      ? date.toLocaleDateString(\"he-IL\", { year: \"numeric\", month: \"long\", day: \"numeric\" })\n      : date.toLocaleDateString(\"en-US\", { year: \"numeric\", month: \"long\", day: \"numeric\" })\n  }\n\n  return (\n    <Html dir={isHebrew ? \"rtl\" : \"ltr\"}>\n      <Head />\n      <Preview>\n        {t.cancelled} - {bookingId}\n      </Preview>\n      <Body style={main}>\n        <Container style={container}>\n          {/* Header */}\n          <Section style={header}>\n            <Heading style={h1}>{t.cancelled}</Heading>\n          </Section>\n\n          {/* Greeting */}\n          <Text style={text}>{t.greeting}</Text>\n          <Text style={text}>{t.message}</Text>\n\n          <Hr style={hr} />\n\n          {/* Booking Details */}\n          <Section style={detailsBox}>\n            <Heading as=\"h2\" style={h2}>\n              {t.details}\n            </Heading>\n\n            <table style={table}>\n              <tbody>\n                <tr>\n                  <td style={labelCell}>{t.bookingNumber}:</td>\n                  <td style={valueCell}>\n                    <strong>{bookingId}</strong>\n                  </td>\n                </tr>\n                <tr>\n                  <td style={labelCell}>{t.hotel}:</td>\n                  <td style={valueCell}>{hotelName}</td>\n                </tr>\n                <tr>\n                  <td style={labelCell}>{t.dates}:</td>\n                  <td style={valueCell}>\n                    {formatDate(checkIn)} - {formatDate(checkOut)}\n                  </td>\n                </tr>\n                <tr>\n                  <td style={labelCell}>{t.originalPrice}:</td>\n                  <td style={valueCell}>\n                    {currency} {totalPrice.toFixed(2)}\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n          </Section>\n\n          {/* Cancellation Reason */}\n          {cancellationReason && (\n            <Section style={reasonBox}>\n              <Heading as=\"h3\" style={h3}>\n                {t.reason}\n              </Heading>\n              <Text style={reasonText}>{cancellationReason}</Text>\n            </Section>\n          )}\n\n          {/* Refund Information */}\n          <Hr style={hr} />\n          <Section style={refundBox}>\n            <Heading as=\"h2\" style={h2}>\n              {t.refund}\n            </Heading>\n\n            {refundAmount && refundAmount > 0 ? (\n              <table style={table}>\n                <tbody>\n                  <tr>\n                    <td style={labelCell}>{t.refundAmount}:</td>\n                    <td style={valueCell}>\n                      <strong style={refundPrice}>\n                        {currency} {refundAmount.toFixed(2)}\n                      </strong>\n                    </td>\n                  </tr>\n                  {refundDate && (\n                    <tr>\n                      <td style={labelCell}>{t.refundDate}:</td>\n                      <td style={valueCell}>{formatDate(refundDate)}</td>\n                    </tr>\n                  )}\n                </tbody>\n              </table>\n            ) : (\n              <Text style={noRefundText}>{t.noRefund}</Text>\n            )}\n          </Section>\n\n          <Hr style={hr} />\n\n          {/* Footer */}\n          <Section>\n            <Text style={sorryText}>{t.sorry}</Text>\n            <Text style={text}>{t.future}</Text>\n            <Text style={footer}>{t.questions}</Text>\n            <Text style={footer}>{t.support}</Text>\n          </Section>\n        </Container>\n      </Body>\n    </Html>\n  )\n}\n\nexport default CancellationConfirmationEmail\n\n// Styles\nconst main = {\n  backgroundColor: \"#f6f9fc\",\n  fontFamily: '-apple-system,BlinkMacSystemFont,\"Segoe UI\",Roboto,\"Helvetica Neue\",Ubuntu,sans-serif',\n}\n\nconst container = {\n  backgroundColor: \"#ffffff\",\n  margin: \"0 auto\",\n  padding: \"20px 0 48px\",\n  marginBottom: \"64px\",\n  maxWidth: \"600px\",\n  borderRadius: \"8px\",\n}\n\nconst header = {\n  padding: \"32px 20px\",\n  backgroundColor: \"#DC2626\",\n  borderRadius: \"8px 8px 0 0\",\n}\n\nconst h1 = {\n  color: \"#ffffff\",\n  fontSize: \"32px\",\n  fontWeight: \"700\",\n  margin: \"0\",\n  padding: \"0\",\n  textAlign: \"center\" as const,\n}\n\nconst h2 = {\n  color: \"#1f2937\",\n  fontSize: \"24px\",\n  fontWeight: \"600\",\n  margin: \"0 0 20px\",\n}\n\nconst h3 = {\n  color: \"#1f2937\",\n  fontSize: \"18px\",\n  fontWeight: \"600\",\n  margin: \"0 0 12px\",\n}\n\nconst text = {\n  color: \"#374151\",\n  fontSize: \"16px\",\n  lineHeight: \"24px\",\n  margin: \"16px 20px\",\n}\n\nconst detailsBox = {\n  backgroundColor: \"#f9fafb\",\n  border: \"1px solid #e5e7eb\",\n  borderRadius: \"8px\",\n  padding: \"24px\",\n  margin: \"20px\",\n}\n\nconst reasonBox = {\n  margin: \"20px\",\n}\n\nconst reasonText = {\n  color: \"#6b7280\",\n  fontSize: \"14px\",\n  lineHeight: \"20px\",\n  margin: \"0\",\n  fontStyle: \"italic\" as const,\n}\n\nconst refundBox = {\n  backgroundColor: \"#fef3c7\",\n  border: \"1px solid #fbbf24\",\n  borderRadius: \"8px\",\n  padding: \"24px\",\n  margin: \"20px\",\n}\n\nconst table = {\n  width: \"100%\",\n  borderCollapse: \"collapse\" as const,\n}\n\nconst labelCell = {\n  color: \"#6b7280\",\n  fontSize: \"14px\",\n  paddingBottom: \"12px\",\n  paddingRight: \"16px\",\n  verticalAlign: \"top\" as const,\n  width: \"40%\",\n}\n\nconst valueCell = {\n  color: \"#1f2937\",\n  fontSize: \"14px\",\n  paddingBottom: \"12px\",\n  fontWeight: \"500\",\n}\n\nconst refundPrice = {\n  color: \"#059669\",\n  fontSize: \"18px\",\n  fontWeight: \"700\",\n}\n\nconst noRefundText = {\n  color: \"#DC2626\",\n  fontSize: \"14px\",\n  lineHeight: \"20px\",\n  margin: \"0\",\n  fontWeight: \"500\",\n}\n\nconst hr = {\n  borderColor: \"#e5e7eb\",\n  margin: \"20px 0\",\n}\n\nconst sorryText = {\n  color: \"#1f2937\",\n  fontSize: \"18px\",\n  fontWeight: \"600\",\n  textAlign: \"center\" as const,\n  margin: \"20px\",\n}\n\nconst footer = {\n  color: \"#6b7280\",\n  fontSize: \"12px\",\n  lineHeight: \"16px\",\n  textAlign: \"center\" as const,\n  margin: \"8px 20px\",\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2506, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/v0-bookinengine/lib/email/email-service.ts"],"sourcesContent":["/**\n * Email Service - Simplified version for sending emails via Resend\n * Renders React Email templates and sends them directly\n * No database queue - simple and safe\n */\n\nimport { Resend } from 'resend'\nimport { render } from '@react-email/render'\nimport BookingConfirmationEmail from '@/emails/booking-confirmation'\nimport CancellationConfirmationEmail from '@/emails/cancellation-confirmation'\n\nconst RESEND_API_KEY = process.env.RESEND_API_KEY\nconst FROM_EMAIL = process.env.FROM_EMAIL || 'bookings@youraitravelagent.com'\nconst FROM_NAME = process.env.FROM_NAME || 'Booking Engine'\n\nclass EmailService {\n  private resend: Resend | null = null\n  private enabled: boolean = false\n\n  constructor() {\n    if (RESEND_API_KEY) {\n      this.resend = new Resend(RESEND_API_KEY)\n      this.enabled = true\n      console.log('[Email] Service initialized with Resend')\n    } else {\n      console.warn('[Email] RESEND_API_KEY not configured - emails disabled')\n    }\n  }\n\n  isEnabled(): boolean {\n    return this.enabled\n  }\n\n  /**\n   * Send booking confirmation email\n   */\n  async sendBookingConfirmation(params: {\n    to: string\n    customerName: string\n    bookingId: string\n    supplierReference: string\n    hotelName: string\n    roomType: string\n    checkIn: string\n    checkOut: string\n    nights: number\n    adults: number\n    children: number\n    totalPrice: number\n    currency: string\n    hotelAddress?: string\n    hotelPhone?: string\n    cancellationPolicy?: string\n    language?: 'he' | 'en'\n  }) {\n    if (!this.enabled || !this.resend) {\n      console.warn('[Email] Cannot send email - service not configured')\n      return { success: false, error: 'Email service not configured' }\n    }\n\n    try {\n      const isHebrew = params.language === 'he'\n      const subject = isHebrew\n        ? `砖专  ${params.bookingId}`\n        : `Booking Confirmation ${params.bookingId}`\n\n      const html = render(BookingConfirmationEmail(params))\n\n      console.log('[Email] Sending booking confirmation', {\n        to: params.to,\n        bookingId: params.bookingId,\n      })\n\n      const result = await this.resend.emails.send({\n        from: `${FROM_NAME} <${FROM_EMAIL}>`,\n        to: params.to,\n        subject,\n        html,\n      })\n\n      console.log('[Email]  Booking confirmation sent', {\n        to: params.to,\n        emailId: result.data?.id,\n      })\n\n      return { success: true, emailId: result.data?.id }\n    } catch (error: any) {\n      console.error('[Email]  Failed to send booking confirmation', {\n        to: params.to,\n        error: error.message,\n      })\n      return { success: false, error: error.message }\n    }\n  }\n\n  /**\n   * Send cancellation confirmation email\n   */\n  async sendCancellationConfirmation(params: {\n    to: string\n    customerName: string\n    bookingId: string\n    hotelName: string\n    checkIn: string\n    checkOut: string\n    totalPrice: number\n    currency: string\n    refundAmount?: number\n    refundDate?: string\n    cancellationReason?: string\n    language?: 'he' | 'en'\n  }) {\n    if (!this.enabled || !this.resend) {\n      console.warn('[Email] Cannot send email - service not configured')\n      return { success: false, error: 'Email service not configured' }\n    }\n\n    try {\n      const isHebrew = params.language === 'he'\n      const subject = isHebrew\n        ? `砖专   ${params.bookingId}`\n        : `Booking Cancellation ${params.bookingId}`\n\n      const html = render(CancellationConfirmationEmail(params))\n\n      console.log('[Email] Sending cancellation confirmation', {\n        to: params.to,\n        bookingId: params.bookingId,\n      })\n\n      const result = await this.resend.emails.send({\n        from: `${FROM_NAME} <${FROM_EMAIL}>`,\n        to: params.to,\n        subject,\n        html,\n      })\n\n      console.log('[Email]  Cancellation confirmation sent', {\n        to: params.to,\n        emailId: result.data?.id,\n      })\n\n      return { success: true, emailId: result.data?.id }\n    } catch (error: any) {\n      console.error('[Email]  Failed to send cancellation confirmation', {\n        to: params.to,\n        error: error.message,\n      })\n      return { success: false, error: error.message }\n    }\n  }\n}\n\n// Export singleton instance\nexport const emailService = new EmailService()\n\n// Export class for testing\nexport { EmailService }\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2642, "column": 0}, "map": {"version":3,"sources":["file:///workspaces/v0-bookinengine/app/api/booking/book/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\nimport { mediciApi } from \"@/lib/api/medici-client\"\nimport { DEMO_MODE, mockBook } from \"@/lib/demo/demo-mode\"\nimport { emailService } from \"@/lib/email/email-service\"\nimport { format } from \"date-fns\"\n\nexport async function POST(request: NextRequest) {\n  try {\n    if (DEMO_MODE) {\n      const mockResult = await mockBook()\n      return NextResponse.json(mockResult)\n    }\n\n    const body = await request.json()\n    const { jsonRequest } = body\n\n    if (!jsonRequest || typeof jsonRequest !== \"string\") {\n      return NextResponse.json(\n        {\n          error: \"jsonRequest is required - must be from PreBook response\",\n          received: { jsonRequest: typeof jsonRequest },\n        },\n        { status: 400 },\n      )\n    }\n\n    const result = await mediciApi.book({\n      jsonRequest,\n    })\n\n    if (!result.success) {\n      return NextResponse.json({ error: result.error || \"Booking failed\" }, { status: 400 })\n    }\n\n    // Parse the jsonRequest to extract booking details for email\n    let bookingDetails: any = {}\n    try {\n      bookingDetails = JSON.parse(jsonRequest)\n    } catch (e) {\n      console.warn(\"[Book API] Could not parse jsonRequest for email\", e)\n    }\n\n    // Send confirmation email (non-blocking)\n    if (result.bookingId && result.supplierReference && emailService.isEnabled()) {\n      const customer = bookingDetails.customer\n      const service = bookingDetails.services?.[0]\n      const searchRequest = service?.searchRequest\n      const bookingRequest = service?.bookingRequest?.[0]\n\n      if (customer && searchRequest && bookingRequest) {\n        const checkInDate = searchRequest.dates?.from || new Date().toISOString()\n        const checkOutDate = searchRequest.dates?.to || new Date().toISOString()\n        const nights = Math.ceil(\n          (new Date(checkOutDate).getTime() - new Date(checkInDate).getTime()) / (1000 * 60 * 60 * 24)\n        )\n\n        // Send email asynchronously (don't wait for it)\n        emailService\n          .sendBookingConfirmation({\n            to: customer.contact?.email || bookingDetails.reference?.voucherEmail,\n            customerName: `${customer.name?.first} ${customer.name?.last}`,\n            bookingId: result.bookingId,\n            supplierReference: result.supplierReference,\n            hotelName: \"Hotel Name\", // TODO: Get from search results\n            roomType: bookingRequest.code || \"Room\",\n            checkIn: format(new Date(checkInDate), \"MMM dd, yyyy\"),\n            checkOut: format(new Date(checkOutDate), \"MMM dd, yyyy\"),\n            nights,\n            adults: searchRequest.pax?.[0]?.adults || 1,\n            children: searchRequest.pax?.[0]?.children?.length || 0,\n            totalPrice: result.totalPrice || 0,\n            currency: searchRequest.currencies?.[0] || \"USD\",\n            language: \"en\",\n          })\n          .then((emailResult) => {\n            if (emailResult.success) {\n              console.log(\"[Book API]  Confirmation email sent\", {\n                bookingId: result.bookingId,\n                emailId: emailResult.emailId,\n              })\n            } else {\n              console.warn(\"[Book API] 锔 Email failed (non-critical)\", emailResult.error)\n            }\n          })\n          .catch((error) => {\n            console.error(\"[Book API] Email error (non-critical):\", error)\n          })\n      } else {\n        console.warn(\"[Book API] Missing email data, skipping email\")\n      }\n    }\n\n    return NextResponse.json({\n      success: true,\n      bookingId: result.bookingId,\n      supplierReference: result.supplierReference,\n      status: result.status,\n    })\n  } catch (error: any) {\n    console.error(\"Book API Error:\", error.message)\n    return NextResponse.json({ error: error.message || \"Booking failed\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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"}}]
}