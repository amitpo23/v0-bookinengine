module.exports=[918622,(e,t,n)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,t,n)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,t,n)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},324725,(e,t,n)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},193695,(e,t,n)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},442315,(e,t,n)=>{"use strict";t.exports=e.r(918622)},347540,(e,t,n)=>{"use strict";t.exports=e.r(442315).vendored["react-rsc"].React},224361,(e,t,n)=>{t.exports=e.x("util",()=>require("util"))},814747,(e,t,n)=>{t.exports=e.x("path",()=>require("path"))},81111,(e,t,n)=>{t.exports=e.x("node:stream",()=>require("node:stream"))},792509,(e,t,n)=>{t.exports=e.x("url",()=>require("url"))},406461,(e,t,n)=>{t.exports=e.x("zlib",()=>require("zlib"))},427699,(e,t,n)=>{t.exports=e.x("events",()=>require("events"))},921517,(e,t,n)=>{t.exports=e.x("http",()=>require("http"))},524836,(e,t,n)=>{t.exports=e.x("https",()=>require("https"))},254799,(e,t,n)=>{t.exports=e.x("crypto",()=>require("crypto"))},688947,(e,t,n)=>{t.exports=e.x("stream",()=>require("stream"))},522734,(e,t,n)=>{t.exports=e.x("fs",()=>require("fs"))},37702,(e,t,n)=>{t.exports=e.x("worker_threads",()=>require("worker_threads"))},639802,(e,t,n)=>{if(!globalThis.DOMException)try{let{MessageChannel:t}=e.r(37702),n=new t().port1,a=new ArrayBuffer;n.postMessage(a,[a,a])}catch(e){"DOMException"===e.constructor.name&&(globalThis.DOMException=e.constructor)}t.exports=globalThis.DOMException},910914,e=>{"use strict";let t=new(e.i(822880)).default(process.env.STRIPE_SECRET_KEY||"",{apiVersion:"2025-11-17.clover"});async function n(e,n){console.log("[Payment] Creating payment intent",{bookingId:e.bookingId,amount:e.amount});try{let n,a=await t.customers.list({email:e.customerEmail,limit:1});n=a.data.length>0?a.data[0].id:(await t.customers.create({email:e.customerEmail,name:e.customerName,metadata:{source:"booking-engine",bookingId:e.bookingId}})).id;let r=await t.paymentIntents.create({amount:e.amount,currency:e.currency.toLowerCase(),customer:n,description:e.description||`Booking ${e.bookingId}`,metadata:{bookingId:e.bookingId,customerEmail:e.customerEmail,...e.metadata},automatic_payment_methods:{enabled:!0},payment_method_options:{card:{request_three_d_secure:"automatic"}}});return console.log("[Payment] Payment intent created",{id:r.id,status:r.status}),{id:r.id,clientSecret:r.client_secret||"",amount:r.amount,currency:r.currency,status:r.status,bookingId:e.bookingId,customerId:n}}catch(e){throw console.error("[Payment] Failed to create payment intent",e.message),Error(`Payment intent creation failed: ${e.message}`)}}async function a(e,n){console.log("[Payment] Processing payment",{paymentIntentId:e.paymentIntentId});try{let n=await t.paymentIntents.confirm(e.paymentIntentId,{payment_method:e.paymentMethodId,return_url:e.returnUrl||`${process.env.NEXT_PUBLIC_APP_URL||"https://v0-bookinengine.vercel.app"}/booking/complete`}),a={success:"succeeded"===n.status,paymentId:n.id,status:n.status};return"requires_action"===n.status&&n.next_action?.type==="redirect_to_url"&&(a.requiresAction=!0,a.actionUrl=n.next_action.redirect_to_url?.url||void 0),console.log("[Payment] Payment processed",{id:n.id,status:n.status}),a}catch(t){return console.error("[Payment] Payment processing failed",t.message),{success:!1,paymentId:e.paymentIntentId,error:t.message}}}async function r(e,n){try{let n=await t.paymentIntents.retrieve(e.paymentIntentId);return{verified:"succeeded"===n.status,status:n.status,amount:n.amount,currency:n.currency,bookingId:n.metadata.bookingId}}catch(e){return console.error("[Payment] Payment verification failed",e.message),{verified:!1,status:"error",error:e.message}}}async function o(e,n){try{let n=await t.paymentIntents.retrieve(e.paymentIntentId,{expand:["latest_charge"]}),a=n.latest_charge;return{id:n.id,status:n.status,amount:n.amount,currency:n.currency,created:new Date(1e3*n.created),paymentMethod:"string"==typeof n.payment_method?n.payment_method:n.payment_method?.id,receiptUrl:a?.receipt_url||void 0,bookingId:n.metadata.bookingId}}catch(e){throw console.error("[Payment] Failed to get payment status",e.message),e}}async function i(e,n){try{return await t.paymentIntents.cancel(e.paymentIntentId,{cancellation_reason:"requested_by_customer"}),console.log("[Payment] Payment cancelled",{id:e.paymentIntentId,reason:e.reason}),{success:!0}}catch(e){return console.error("[Payment] Failed to cancel payment",e.message),{success:!1,error:e.message}}}async function s(e,n){try{return(await t.paymentIntents.search({query:`metadata["bookingId"]:"${e.bookingId}"`,limit:10})).data.map(t=>({id:t.id,clientSecret:t.client_secret||"",amount:t.amount,currency:t.currency,status:t.status,bookingId:e.bookingId,customerId:"string"==typeof t.customer?t.customer:t.customer?.id}))}catch(e){return console.error("[Payment] Failed to get booking payments",e.message),[]}}e.s(["cancelPayment",()=>i,"createPaymentIntent",()=>n,"getBookingPayments",()=>s,"getPaymentStatus",()=>o,"paymentHandlers",0,{createPaymentIntent:n,processPayment:a,verifyPayment:r,getPaymentStatus:o,cancelPayment:i,getBookingPayments:s},"processPayment",()=>a,"verifyPayment",()=>r])},650847,e=>{"use strict";async function t(e,t){console.log("[MonitoringHandler] Starting price tracking for:",e.hotelUrl);try{if(!e.hotelUrl.includes("booking.com"))throw Error("Currently only Booking.com URLs are supported");let a=n(e.hotelUrl),r=`track-${Date.now()}-${Math.random().toString(36).substr(2,8)}`,o=Math.floor(300*Math.random())+100,i={success:!0,trackingId:r,hotelName:a,currentPrice:o,currency:"USD",targetPrice:e.targetPrice,checkInterval:"Every 6 hours",notificationSettings:{email:e.notifyEmail,priceDropThreshold:10*!e.targetPrice},nextCheck:new Date(Date.now()+216e5)};return t&&(t.metadata={...t.metadata,priceTracking:[...t.metadata?.priceTracking||[],{trackingId:r,hotelUrl:e.hotelUrl,hotelName:a,startedAt:new Date}]}),i}catch(e){throw console.error("[MonitoringHandler] Track price error:",e),Error(`Failed to start price tracking: ${e.message}`)}}function n(e){try{let t=e.match(/hotel\/([^/]+)/);if(t)return t[1].replace(/-/g," ").replace(/\b\w/g,e=>e.toUpperCase())}catch{}return"Unknown Hotel"}async function a(e,t){console.log("[MonitoringHandler] Getting price history for hotel:",e.hotelId);try{let t=new Date(e.dateFrom),n=new Date(e.dateTo),a=Math.ceil((n.getTime()-t.getTime())/864e5),r=[];for(let e=0;e<=a;e++){let n=new Date(t);n.setDate(n.getDate()+e);let a=(Math.random()-.5)*40,o=5===n.getDay()||6===n.getDay()?1.2:1,i=Math.round((250+a)*o);r.push({date:n.toISOString().split("T")[0],price:i,currency:"USD",availability:i<300?"available":i<350?"limited":"sold_out",source:"booking.com"})}let o=r.map(e=>e.price),i=Math.min(...o),s=Math.max(...o),c=Math.round(o.reduce((e,t)=>e+t,0)/o.length),l=o[o.length-1],d=o[0];return{hotelId:e.hotelId,hotelName:"Sample Hotel Dubai",dateRange:{from:e.dateFrom,to:e.dateTo},history:r,statistics:{minPrice:i,maxPrice:s,avgPrice:c,currentPrice:l,priceChange:l-d,priceChangePercent:Math.round((l-d)/d*100)}}}catch(e){throw console.error("[MonitoringHandler] Price history error:",e),Error(`Failed to get price history: ${e.message}`)}}async function r(e,t){console.log("[MonitoringHandler] Analyzing price trends for:",e.hotelId);try{let t=new Date(e.travelDates.from);t.getTime(),Date.now();let n=["rising","falling","stable"][Math.floor(3*Math.random())],a=Math.floor(60*Math.random())+20,r=[],o=[];"falling"===n?(r.push("Prices have dropped 12% over the past 2 weeks"),r.push("Historically, prices for these dates bottom out 3 weeks before check-in"),o.push("Wait 1-2 more weeks before booking to catch the lowest price")):"rising"===n?(r.push("Prices have increased 8% in the last week"),r.push("There's an event in the area driving up demand"),o.push("Book soon to lock in current prices"),o.push("Consider flexible dates 1 week earlier for better rates")):(r.push("Prices have remained stable for the past month"),r.push("Current price is close to the 90-day average"),o.push("This is a good time to book - prices are fair"));let i=t.getDay();(5===i||6===i)&&(r.push("Weekend check-in typically costs 15-20% more"),o.push("Consider Thursday or Sunday check-in for savings"));let s=t.getMonth();return(s>=10||s<=2)&&r.push("This is high season in Dubai - expect premium pricing"),{hotelId:e.hotelId,hotelName:"Sample Hotel Dubai",travelDates:e.travelDates,currentTrend:n,trendStrength:a,prediction:{direction:"rising"===n?"up":"falling"===n?"down":"stable",confidence:a+20,expectedChange:"rising"===n?8:"falling"===n?-10:0,optimalBookingWindow:{from:new Date(Date.now()+6048e5).toISOString().split("T")[0],to:new Date(Date.now()+12096e5).toISOString().split("T")[0]}},insights:r,recommendations:o,competitorComparison:[{hotelName:"Similar Hotel A",priceDifference:-25,rating:8.7},{hotelName:"Similar Hotel B",priceDifference:40,rating:9.1},{hotelName:"Similar Hotel C",priceDifference:-10,rating:8.5}]}}catch(e){throw console.error("[MonitoringHandler] Trend analysis error:",e),Error(`Failed to analyze price trends: ${e.message}`)}}async function o(e,t,a,r){return console.log(`[MonitoringHandler] Scraping prices from: ${e}`),[{hotelName:n(e),roomType:"Deluxe Room",price:289,currency:"USD",originalPrice:340,discount:15,cancellationPolicy:"Free cancellation",boardType:"Breakfast included",scrapedAt:new Date},{hotelName:n(e),roomType:"Suite",price:489,currency:"USD",cancellationPolicy:"Non-refundable",boardType:"Room only",scrapedAt:new Date}]}e.s(["analyzePriceTrends",()=>r,"getPriceHistory",()=>a,"monitoringHandlers",0,{trackHotelPrice:t,getPriceHistory:a,analyzePriceTrends:r,scrapeBookingComPrices:o},"scrapeBookingComPrices",()=>o,"trackHotelPrice",()=>t])},469216,e=>{"use strict";process.env.ACS_CONNECTION_STRING;let t=process.env.ACS_PHONE_NUMBER||"";async function n(e,n){console.log(`[VoiceHandler] Initiating call to ${e.phoneNumber}`);try{if(!/^\+[1-9]\d{1,14}$/.test(e.phoneNumber))throw Error("Invalid phone number format. Use E.164 format (e.g., +972501234567)");let a=`call-${Date.now()}-${Math.random().toString(36).substr(2,8)}`;return n&&(n.metadata={...n.metadata,activeCall:{callId:a,phoneNumber:e.phoneNumber,purpose:e.purpose,language:e.language||"he-IL",startedAt:new Date}}),{success:!0,callId:a,status:"initiated",fromNumber:t||"+972-XX-XXXXXXX",toNumber:e.phoneNumber,startedAt:new Date}}catch(e){throw console.error("[VoiceHandler] Call initiation error:",e),Error(`Failed to initiate call: ${e.message}`)}}async function a(e,t){console.log("[VoiceHandler] Transferring to human agent:",e);try{let n,a=e.agentQueue||((n=e.reason.toLowerCase()).includes("billing")||n.includes("payment")||n.includes("refund")?"billing-support":n.includes("cancel")||n.includes("modify")||n.includes("change")?"booking-modifications":n.includes("complaint")||n.includes("problem")||n.includes("issue")?"customer-care":n.includes("group")||n.includes("corporate")||n.includes("business")?"corporate-sales":"general-support"),r=Math.floor(5*Math.random())+1,o=`xfer-${Date.now()}-${Math.random().toString(36).substr(2,6)}`;return t&&(t.metadata={...t.metadata,transferredToHuman:{transferId:o,reason:e.reason,queue:a,transferredAt:new Date}}),{success:!0,transferId:o,targetQueue:a,estimatedWaitTime:r,message:`Transferring you to our ${a} team. Estimated wait time: ${r} minutes.`}}catch(e){throw console.error("[VoiceHandler] Transfer error:",e),Error(`Transfer failed: ${e.message}`)}}async function r(e,t){console.log(`[VoiceHandler] Sending call summary SMS to ${e.phoneNumber}`);try{if(!/^\+[1-9]\d{1,14}$/.test(e.phoneNumber))throw Error("Invalid phone number format");e.summary.length>480?e.summary.substring(0,477):e.summary;let t=`sms-${Date.now()}-${Math.random().toString(36).substr(2,8)}`;return{success:!0,messageId:t,to:e.phoneNumber,status:"sent",sentAt:new Date}}catch(e){throw console.error("[VoiceHandler] SMS error:",e),Error(`Failed to send SMS: ${e.message}`)}}async function o(e,t){console.log("[VoiceHandler] Converting text to speech:",e.text.substring(0,50));try{e.voice,e.speed;let t=.4*e.text.split(" ").length;return{success:!0,audioUrl:`/api/tts/audio-${Date.now()}.mp3`,duration:t,format:"audio/mpeg"}}catch(e){throw console.error("[VoiceHandler] TTS error:",e),Error(`Text-to-speech failed: ${e.message}`)}}async function i(e,t){console.log("[VoiceHandler] Converting speech to text");try{let t=e.language||"he-IL";return{success:!0,text:"×× ×™ ×¨×•×¦×” ×œ×”×–××™×Ÿ ×—×“×¨ ×‘××œ×•×Ÿ ×‘×“×•×‘××™ ×œ×©×œ×•×©×” ×œ×™×œ×•×ª",confidence:.95,language:t,duration:3.2,alternatives:[{text:"×× ×™ ×¨×•×¦×” ×œ×”×–××™×Ÿ ×—×“×¨ ×‘××œ×•×Ÿ ×‘×“×•×‘××™ ×œ×©×œ×•×©×” ×œ×™×œ×•×ª",confidence:.95},{text:"×× ×™ ×¨×•×¦×” ×œ×”×–××™×Ÿ ×—×“×¨ ×‘××œ×•×Ÿ ×‘-×“×•×‘××™ ×œ-3 ×œ×™×œ×•×ª",confidence:.88}]}}catch(e){throw console.error("[VoiceHandler] STT error:",e),Error(`Speech-to-text failed: ${e.message}`)}}async function s(e,t){return{isSpeaking:Math.random()>(e.sensitivity||.5),confidence:.85+.15*Math.random()}}function c(e,t){let n=!1;return{async start(){console.log(`[VoiceHandler] Starting realtime audio stream for call ${e.callId}`),n=!0},async stop(){console.log("[VoiceHandler] Stopping realtime audio stream"),n=!1,t.onCallEnded("stream_stopped")},sendAudio(e){if(!n)return},async sendResponse(t){n&&(await o({text:t,voice:e.ttsVoice},{}),console.log(`[VoiceHandler] Playing TTS response: ${t.substring(0,50)}...`))}}}process.env.AZURE_SPEECH_KEY,process.env.AZURE_SPEECH_REGION,e.s(["createRealtimeAudioStream",()=>c,"detectVoiceActivity",()=>s,"initiateCall",()=>n,"sendCallSummarySms",()=>r,"speechToText",()=>i,"textToSpeech",()=>o,"transferToHuman",()=>a,"voiceHandlers",0,{initiateCall:n,transferToHuman:a,sendCallSummarySms:r,textToSpeech:o,speechToText:i,detectVoiceActivity:s,createRealtimeAudioStream:c}])},732682,e=>{"use strict";let t=new(e.i(822880)).default(process.env.STRIPE_SECRET_KEY||"",{apiVersion:"2025-11-17.clover"});async function n(e,n){console.log("[Refund] Calculating refund amount",{bookingId:e.bookingId});try{let n=await t.paymentIntents.retrieve(e.paymentIntentId),a=n.amount,r=n.currency,o=new Date(n.metadata.checkIn?n.metadata.checkIn:Date.now()+6048e5),i=e.cancellationDate||new Date,s=Math.floor((o.getTime()-i.getTime())/864e5),c=0,l="",d="";s>=7?(c=100,l="Full refund - cancelled more than 7 days before check-in",d="×”×—×–×¨ ××œ× - ×‘×™×˜×•×œ ×™×•×ª×¨ ×-7 ×™××™× ×œ×¤× ×™ ×”×¦'×§-××™×Ÿ"):s>=3?(c=50,l="50% refund - cancelled 3-7 days before check-in",d="×”×—×–×¨ ×©×œ 50% - ×‘×™×˜×•×œ 3-7 ×™××™× ×œ×¤× ×™ ×”×¦'×§-××™×Ÿ"):s>=1?(c=25,l="25% refund - cancelled 1-3 days before check-in",d="×”×—×–×¨ ×©×œ 25% - ×‘×™×˜×•×œ 1-3 ×™××™× ×œ×¤× ×™ ×”×¦'×§-××™×Ÿ"):(c=0,l="No refund - cancelled on or after check-in day",d="××™×Ÿ ×”×—×–×¨ - ×‘×™×˜×•×œ ×‘×™×•× ×”×¦'×§-××™×Ÿ ××• ××—×¨×™×•");let u=Math.floor(a*c/100);return{bookingId:e.bookingId,isRefundable:c>0,cancellationDeadline:new Date(o.getTime()-6048e5),refundPercentage:c,refundAmount:u,penaltyAmount:a-u,currency:r,policyDescription:l,policyDescriptionHe:d}}catch(e){throw console.error("[Refund] Failed to calculate refund",e.message),Error(`Failed to calculate refund: ${e.message}`)}}async function a(e,n){console.log("[Refund] Processing full refund",{paymentIntentId:e.paymentIntentId});try{let n=await t.paymentIntents.retrieve(e.paymentIntentId,{expand:["latest_charge"]});if("succeeded"!==n.status)return{success:!1,error:"Payment has not been completed, cannot refund"};let a=n.latest_charge;if(!a)return{success:!1,error:"No charge found for this payment"};let r=await t.refunds.create({charge:a.id,reason:"requested_by_customer",metadata:{bookingId:e.bookingId,originalPaymentIntent:e.paymentIntentId,reason:e.reason||"Customer requested cancellation"}});return console.log("[Refund] Refund processed",{refundId:r.id,amount:r.amount}),{success:"succeeded"===r.status||"pending"===r.status,refundId:r.id,amount:r.amount,currency:r.currency,status:r.status||"unknown"}}catch(e){return console.error("[Refund] Refund processing failed",e.message),{success:!1,error:e.message}}}async function r(e,n){console.log("[Refund] Processing partial refund",{paymentIntentId:e.paymentIntentId,amount:e.amount});try{let n=await t.paymentIntents.retrieve(e.paymentIntentId,{expand:["latest_charge"]});if("succeeded"!==n.status)return{success:!1,error:"Payment has not been completed, cannot refund"};let a=n.latest_charge;if(!a)return{success:!1,error:"No charge found for this payment"};if(e.amount>a.amount)return{success:!1,error:`Refund amount (${e.amount}) exceeds original charge (${a.amount})`};let r=await t.refunds.create({charge:a.id,amount:e.amount,reason:"requested_by_customer",metadata:{bookingId:e.bookingId,originalPaymentIntent:e.paymentIntentId,reason:e.reason||"Partial refund requested",isPartial:"true"}});return console.log("[Refund] Partial refund processed",{refundId:r.id,amount:r.amount}),{success:"succeeded"===r.status||"pending"===r.status,refundId:r.id,amount:r.amount,currency:r.currency,status:r.status||"unknown"}}catch(e){return console.error("[Refund] Partial refund failed",e.message),{success:!1,error:e.message}}}async function o(e,n){try{let n=await t.refunds.retrieve(e.refundId);return{id:n.id,status:n.status||"unknown",amount:n.amount,currency:n.currency,created:new Date(1e3*n.created),bookingId:n.metadata?.bookingId,reason:n.metadata?.reason}}catch(e){throw console.error("[Refund] Failed to get refund status",e.message),e}}async function i(e,n){try{return(await t.refunds.list({limit:100})).data.filter(t=>t.metadata?.bookingId===e.bookingId).map(e=>({success:"succeeded"===e.status,refundId:e.id,amount:e.amount,currency:e.currency,status:e.status||"unknown"}))}catch(e){return console.error("[Refund] Failed to get booking refunds",e.message),[]}}async function s(e,t){console.log("[Refund] Auto-refund with policy",{bookingId:e.bookingId});try{let a=await n({bookingId:e.bookingId,paymentIntentId:e.paymentIntentId},t);if(!a.isRefundable)return{success:!1,error:a.policyDescription,policy:a};return{...await r({paymentIntentId:e.paymentIntentId,bookingId:e.bookingId,amount:a.refundAmount,reason:e.reason||a.policyDescription},t),policy:a}}catch(e){throw console.error("[Refund] Auto-refund failed",e.message),e}}e.s(["autoRefundWithPolicy",()=>s,"calculateRefundAmount",()=>n,"getBookingRefunds",()=>i,"getRefundStatus",()=>o,"processPartialRefund",()=>r,"processRefund",()=>a,"refundHandlers",0,{calculateRefundAmount:n,processRefund:a,processPartialRefund:r,getRefundStatus:o,getBookingRefunds:i,autoRefundWithPolicy:s}])},118843,e=>{"use strict";let t=new Map;async function n(e,t){console.log("[WhatsApp] Sending message",{to:e.to,type:e.type});let n=e.to.replace(/\D/g,"");if(n.length<10)return{success:!1,error:"Invalid phone number"};let a={messageId:`msg_${Date.now()}_${Math.random().toString(36).substring(2,8)}`,from:process.env.WHATSAPP_PHONE_ID||"BUSINESS",to:n,type:e.type,content:e.content,timestamp:new Date,status:"sent"};return console.log("[WhatsApp] Message sent",{messageId:a.messageId}),{success:!0,messageId:a.messageId}}async function a(e,t){console.log("[WhatsApp] Sending booking confirmation",{bookingId:e.bookingId});let a=t?.locale||"en",r=new Date(e.checkIn),o=new Date(e.checkOut),i="he"===a?`×©×œ×•× ${e.customerName}! ğŸ‰

×”×”×–×× ×” ×©×œ×š ××•×©×¨×”!

ğŸ¨ ${e.hotelName}
ğŸ“… ×¦'×§-××™×Ÿ: ${r.toLocaleDateString("he-IL")}
ğŸ“… ×¦'×§-×××•×˜: ${o.toLocaleDateString("he-IL")}
ğŸ”¢ ××¡×¤×¨ ××™×©×•×¨: ${e.confirmationNumber}

×ª×•×“×” ×©×”×–×× ×ª ×“×¨×›× ×•!`:`Hello ${e.customerName}! ğŸ‰

Your booking is confirmed!

ğŸ¨ ${e.hotelName}
ğŸ“… Check-in: ${r.toLocaleDateString("en-US")}
ğŸ“… Check-out: ${o.toLocaleDateString("en-US")}
ğŸ”¢ Confirmation: ${e.confirmationNumber}

Thank you for booking with us!`;return n({to:e.phone,type:"text",content:i},t)}async function r(e,t){console.log("[WhatsApp] Sending check-in reminder");let a=t?.locale||"en",r=new Date(e.checkIn),o="he"===a?`×©×œ×•× ${e.customerName}! â°

×ª×–×›×•×¨×ª: ×”×¦'×§-××™×Ÿ ×©×œ×š ××—×¨!

ğŸ¨ ${e.hotelName}
ğŸ“ ${e.hotelAddress}
ğŸ“… ${r.toLocaleDateString("he-IL")}
ğŸ”¢ ××¡×¤×¨ ××™×©×•×¨: ${e.confirmationNumber}

× ×¡×™×¢×” ×˜×•×‘×”! ğŸš—`:`Hello ${e.customerName}! â°

Reminder: Your check-in is tomorrow!

ğŸ¨ ${e.hotelName}
ğŸ“ ${e.hotelAddress}
ğŸ“… ${r.toLocaleDateString("en-US")}
ğŸ”¢ Confirmation: ${e.confirmationNumber}

Safe travels! ğŸš—`;return n({to:e.phone,type:"text",content:o},t)}async function o(e,t){console.log("[WhatsApp] Sending booking options");let a=t?.locale||"en",r={type:"button",body:{text:"he"===a?`×©×œ×•× ${e.customerName}, ××™×š ××¤×©×¨ ×œ×¢×–×•×¨?`:`Hello ${e.customerName}, how can I help you?`},action:{buttons:[{type:"reply",reply:{id:`view_booking_${e.bookingId}`,title:"he"===a?"×¦×¤×” ×‘×”×–×× ×”":"View Booking"}},{type:"reply",reply:{id:`modify_booking_${e.bookingId}`,title:"he"===a?"×©× ×” ×”×–×× ×”":"Modify Booking"}},{type:"reply",reply:{id:"contact_support",title:"he"===a?"×“×‘×¨ ×¢× × ×¦×™×’":"Contact Support"}}]}};return n({to:e.phone,type:"interactive",content:r},t)}async function i(e,n){console.log("[WhatsApp] Handling incoming message",{from:e.from,type:e.type});let a=e.from.replace(/\D/g,""),r=Array.from(t.values()).find(e=>e.customerPhone===a&&"active"===e.status);if(r||(r={conversationId:`conv_${Date.now()}_${Math.random().toString(36).substring(2,8)}`,customerPhone:a,status:"active",messages:[],createdAt:new Date,updatedAt:new Date},t.set(r.conversationId,r)),e.buttonId){if(e.buttonId.startsWith("view_booking_")){let t=e.buttonId.replace("view_booking_","");return{response:`Here are the details for booking ${t}. I'll send you the full information shortly.`,action:"fetch_booking_details"}}if(e.buttonId.startsWith("modify_booking_"))return{response:"What would you like to change? You can modify dates, room type, or add special requests.",action:"start_modification"};if("contact_support"===e.buttonId)return r.status="pending_human",t.set(r.conversationId,r),{response:"I'm connecting you with a human agent. Please wait a moment.",action:"transfer_to_human",requiresHuman:!0}}let o=(e.text||"").toLowerCase();return o.includes("book")||o.includes("reserve")||o.includes("×”×–×")?{response:"I'd be happy to help you make a booking! Where would you like to stay and for what dates?",action:"start_booking"}:o.includes("cancel")||o.includes("×‘×™×˜×•×œ")?{response:"I can help you cancel your booking. Please provide your confirmation number.",action:"start_cancellation"}:o.includes("help")||o.includes("support")||o.includes("×¢×–×¨")?{response:"How can I assist you today? I can help with bookings, modifications, cancellations, or general questions.",action:"show_help"}:{response:"Thanks for your message! How can I help you today? Reply with 'help' to see available options.",action:"default"}}async function s(e,n){if(e.conversationId)return t.get(e.conversationId)||null;if(e.phone){let n=e.phone.replace(/\D/g,"");return Array.from(t.values()).find(e=>e.customerPhone===n)||null}return null}async function c(e,n){console.log("[WhatsApp] Transferring to human",{conversationId:e.conversationId});let a=t.get(e.conversationId);return a?(a.status="pending_human",t.set(a.conversationId,a),{success:!0,ticketId:`ticket_${Date.now()}`}):{success:!1}}async function l(e,t){console.log("[WhatsApp] Sending bulk notification",{count:e.phones.length,template:e.templateName});let a={sent:0,failed:0,errors:[]};for(let r of e.phones){let o=await n({to:r,type:"text",content:`Notification: ${e.templateName}`},t);o.success?a.sent++:(a.failed++,a.errors.push({phone:r,error:o.error||"Unknown error"}))}return a}async function d(e,n){let a=Array.from(t.values()),r=a.filter(e=>"active"===e.status),o=a.filter(e=>"pending_human"===e.status);return{totalConversations:a.length,activeConversations:r.length,messagesReceived:a.reduce((e,t)=>e+t.messages.length,0),messagesSent:a.reduce((e,t)=>e+t.messages.filter(e=>"BUSINESS"===e.from).length,0),averageResponseTime:30,humanTransferRate:a.length>0?o.length/a.length*100:0}}e.s(["getConversation",()=>s,"getWhatsAppStats",()=>d,"handleIncomingMessage",()=>i,"sendBookingConfirmation",()=>a,"sendBookingOptions",()=>o,"sendBulkNotification",()=>l,"sendCheckInReminder",()=>r,"sendWhatsAppMessage",()=>n,"transferToHuman",()=>c,"whatsappHandlers",0,{sendWhatsAppMessage:n,sendBookingConfirmation:a,sendCheckInReminder:r,sendBookingOptions:o,handleIncomingMessage:i,getConversation:s,transferToHuman:c,sendBulkNotification:l,getWhatsAppStats:d}])},18479,e=>{"use strict";async function t(e,t){console.log("[BookingHandler] Searching hotels:",e);try{e.destination,e.checkIn,e.checkOut,e.adults,e.children?.map(e=>({age:e})),e.stars,e.maxPrice,e.amenities;let n=[{hotelId:"htl-dubai-001",name:"Burj Al Arab Jumeirah",stars:5,address:"Jumeirah Beach Road, Dubai, UAE",imageUrl:"/hotels/burj-al-arab.jpg",rating:9.4,reviewCount:12543,amenities:["Spa","Pool","WiFi","Beach Access","Restaurant","Butler Service"],rooms:[{roomCode:"room-001",roomName:"Deluxe Suite",boardType:"Breakfast Included",price:2500,originalPrice:2800,currency:"USD",cancellationPolicy:"Free cancellation until 24h before",maxOccupancy:2,available:3},{roomCode:"room-002",roomName:"Panoramic Suite",boardType:"Half Board",price:3800,currency:"USD",cancellationPolicy:"Non-refundable",maxOccupancy:3,available:1}]},{hotelId:"htl-dubai-002",name:"Atlantis The Palm",stars:5,address:"Crescent Road, The Palm, Dubai, UAE",imageUrl:"/hotels/atlantis.jpg",rating:8.9,reviewCount:28912,amenities:["Waterpark","Pool","WiFi","Beach","Aquarium","Kids Club"],rooms:[{roomCode:"room-003",roomName:"Palm Beach Room",boardType:"Room Only",price:450,originalPrice:520,currency:"USD",cancellationPolicy:"Free cancellation until 48h before",maxOccupancy:2,available:8}]},{hotelId:"htl-dubai-003",name:"Four Seasons Resort Dubai",stars:5,address:"Jumeirah Beach, Dubai, UAE",imageUrl:"/hotels/four-seasons.jpg",rating:9.2,reviewCount:8234,amenities:["Spa","Pool","WiFi","Beach","Golf","Tennis"],rooms:[{roomCode:"room-004",roomName:"Premier Room",boardType:"Breakfast Included",price:680,currency:"USD",cancellationPolicy:"Free cancellation until 72h before",maxOccupancy:2,available:5}]}];return t&&(t.bookingData={...t.bookingData,lastSearch:{params:e,timestamp:new Date,results:n.map(e=>({hotelId:e.hotelId,name:e.name}))}}),{hotels:n,searchId:`search-${Date.now()}`,totalResults:n.length}}catch(e){throw console.error("[BookingHandler] Search error:",e),Error(`Hotel search failed: ${e.message}`)}}async function n(e,t){console.log("[BookingHandler] Pre-booking room:",e);try{let n=new Date(e.checkIn),a=new Date(e.checkOut),r=Math.ceil((a.getTime()-n.getTime())/864e5),o={success:!0,token:`prebook-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,expiresAt:new Date(Date.now()+18e5),pricing:{roomRate:680*r,taxes:68*r,fees:25,total:748*r+25,currency:"USD"},cancellationPolicy:{freeCancellationUntil:new Date(n.getTime()-2592e5),penalties:[{from:new Date(n.getTime()-2592e5),amount:680},{from:new Date(n.getTime()-864e5),amount:680*r}]},hotelDetails:{hotelId:e.hotelId,name:"Four Seasons Resort Dubai",roomName:"Premier Room",checkIn:e.checkIn,checkOut:e.checkOut,nights:r}};return t&&(t.bookingData={...t.bookingData,prebook:{token:o.token,expiresAt:o.expiresAt,hotelId:e.hotelId,roomCode:e.roomCode,pricing:o.pricing}}),o}catch(e){throw console.error("[BookingHandler] Prebook error:",e),Error(`Pre-booking failed: ${e.message}`)}}async function a(e,t){console.log("[BookingHandler] Completing booking:",e);try{if(!t?.bookingData?.prebook?.token||t.bookingData.prebook.token!==e.token)throw Error("Invalid or expired prebook token");if(new Date>new Date(t.bookingData.prebook.expiresAt))throw Error("Prebook token has expired. Please search again.");let n=`BK-${Date.now()}-${Math.random().toString(36).substr(2,6).toUpperCase()}`,a=`CNF-${Math.random().toString(36).substr(2,8).toUpperCase()}`,r={success:!0,bookingId:n,confirmationNumber:a,status:"confirmed",hotelConfirmation:`HC-${Math.random().toString(36).substr(2,6).toUpperCase()}`,totalPaid:t.bookingData.prebook.pricing.total,currency:t.bookingData.prebook.pricing.currency,bookingDetails:{hotelName:"Four Seasons Resort Dubai",roomName:"Premier Room",checkIn:t.bookingData.prebook.checkIn||"2024-03-15",checkOut:t.bookingData.prebook.checkOut||"2024-03-18",guests:e.guests.map(e=>`${e.firstName} ${e.lastName}`),specialRequests:e.specialRequests},paymentDetails:{method:e.paymentMethod||"card",last4:"4242",transactionId:`txn-${Date.now()}`},cancellationPolicy:"Free cancellation until 72 hours before check-in"};return t&&(t.bookingData={...t.bookingData,confirmedBooking:{bookingId:n,confirmationNumber:a,status:"confirmed",bookedAt:new Date}}),r}catch(e){throw console.error("[BookingHandler] Booking error:",e),Error(`Booking failed: ${e.message}`)}}async function r(e,t){console.log("[BookingHandler] Cancelling booking:",e);try{let e=Math.random()>.3,t=680*!e;return{success:!0,cancellationId:`CAN-${Date.now()}-${Math.random().toString(36).substr(2,6).toUpperCase()}`,refundAmount:2244-t,refundCurrency:"USD",penaltyApplied:t,refundMethod:"Original payment method",refundEta:"5-7 business days",message:e?"Your booking has been cancelled with a full refund.":`Your booking has been cancelled. A cancellation fee of $${t} was applied.`}}catch(e){throw console.error("[BookingHandler] Cancellation error:",e),Error(`Cancellation failed: ${e.message}`)}}async function o(e,t){console.log("[BookingHandler] Getting cancellation policy:",e);let n=new Date("2024-03-15"),a=new Date(n.getTime()-2592e5),r=new Date<a;return{bookingId:e.bookingId,hotelName:"Four Seasons Resort Dubai",checkIn:"2024-03-15",currentStatus:"confirmed",policy:{freeCancellationUntil:a.toISOString(),isWithinFreePeriod:r,penalties:[{fromDate:a.toISOString(),amount:680,currency:"USD",description:"First night penalty (72-24 hours before check-in)"},{fromDate:new Date(n.getTime()-864e5).toISOString(),amount:2244,currency:"USD",description:"Full booking amount (less than 24 hours)"}]},recommendation:r?"You can cancel now for a full refund!":"Cancellation will incur a penalty. Consider rescheduling instead."}}process.env.MEDICI_API_URL,process.env.MEDICI_API_KEY,e.s(["bookRoom",()=>a,"bookingHandlers",0,{searchHotels:t,prebookRoom:n,bookRoom:a,cancelBooking:r,getCancellationPolicy:o},"cancelBooking",()=>r,"getCancellationPolicy",()=>o,"prebookRoom",()=>n,"searchHotels",()=>t])},251557,e=>{"use strict";let t=new Map,n={initial:{subject:"You left something behind! ğŸ¨",subjectHe:"×©×›×—×ª ××©×”×•! ğŸ¨",delay:36e5},reminder:{subject:"Your room is still available - but not for long!",subjectHe:"×”×—×“×¨ ×©×œ×š ×¢×“×™×™×Ÿ ×–××™×Ÿ - ××‘×œ ×œ× ×œ××•×¨×š ×–××Ÿ!",delay:864e5},lastChance:{subject:"Last chance: 10% off your booking",subjectHe:"×”×–×“×× ×•×ª ××—×¨×•× ×”: 10% ×”× ×—×” ×œ×”×–×× ×” ×©×œ×š",delay:2592e5,discount:10}};async function a(e,n){console.log("[Cart] Tracking activity",{sessionId:e.sessionId,stage:e.stage});let a=Array.from(t.values()).find(t=>t.sessionId===e.sessionId),r=!a;return a?(a.stage=e.stage,a.updatedAt=new Date,a.customerEmail=e.customerEmail||a.customerEmail,a.customerName=e.customerName||a.customerName,a.roomCode=e.roomCode||a.roomCode,a.roomType=e.roomType||a.roomType,a.totalPrice=e.totalPrice):a={cartId:`cart_${Date.now()}_${Math.random().toString(36).substring(2,8)}`,sessionId:e.sessionId,userId:e.userId,customerEmail:e.customerEmail,customerName:e.customerName,hotelId:e.hotelId,hotelName:e.hotelName,roomCode:e.roomCode||"",roomType:e.roomType||"",checkIn:new Date(e.checkIn),checkOut:new Date(e.checkOut),guests:e.guests,totalPrice:e.totalPrice,currency:e.currency,stage:e.stage,createdAt:new Date,updatedAt:new Date,recoveryAttempts:[],recovered:!1,source:e.source,device:e.device},t.set(a.cartId,a),{cartId:a.cartId,isNew:r}}async function r(e,n){let a;return(e.cartId?a=t.get(e.cartId):e.sessionId&&(a=Array.from(t.values()).find(t=>t.sessionId===e.sessionId)),a)?(a.abandonedAt=new Date,t.set(a.cartId,a),console.log("[Cart] Marked as abandoned",{cartId:a.cartId,stage:a.stage}),{success:!0,cartId:a.cartId}):{success:!1}}async function o(e,n){console.log("[Cart] Getting abandoned carts",e);let a=Date.now(),r=60*(e.minAge||30)*1e3,o=60*(e.maxAge||72)*6e4,i=Array.from(t.values()).filter(t=>{if(!t.abandonedAt||t.recovered)return!1;let n=a-t.abandonedAt.getTime();return!(n<r)&&!(n>o)&&(!e.stage||t.stage===e.stage)&&(!e.hasEmail||!!t.customerEmail)});return i.sort((e,t)=>(t.abandonedAt?.getTime()||0)-(e.abandonedAt?.getTime()||0)),e.limit&&(i=i.slice(0,e.limit)),i}async function i(e,a){let r,o=t.get(e.cartId);if(!o)return{success:!1,error:"Cart not found"};if(!o.customerEmail)return{success:!1,error:"No customer email"};console.log("[Cart] Sending recovery email",{cartId:e.cartId,template:e.templateType,to:o.customerEmail});let i=n[e.templateType];a?.locale,"lastChance"===e.templateType&&"discount"in i&&(r={code:`COMEBACK${o.cartId.slice(-6).toUpperCase()}`,percentage:i.discount,expiresAt:new Date(Date.now()+1728e5)});let s={attemptId:`attempt_${Date.now()}_${Math.random().toString(36).substring(2,8)}`,type:"email",sentAt:new Date,discount:r};return o.recoveryAttempts.push(s),t.set(o.cartId,o),console.log("[Cart] Recovery email sent",{attemptId:s.attemptId}),{success:!0,attemptId:s.attemptId}}async function s(e,n){let a;if(e.cartId?a=t.get(e.cartId):e.sessionId&&(a=Array.from(t.values()).find(t=>t.sessionId===e.sessionId)),!a)return{success:!0,wasAbandoned:!1};let r=!!a.abandonedAt;return a.recovered=!0,a.recoveredAt=new Date,t.set(a.cartId,a),console.log("[Cart] Marked as recovered",{cartId:a.cartId,wasAbandoned:r}),{success:!0,wasAbandoned:r}}async function c(e,n){let a=t.get(e.cartId);if(!a)throw Error("Cart not found");let r=Buffer.from(JSON.stringify({cartId:a.cartId,exp:Date.now()+6048e5})).toString("base64url"),o=process.env.NEXT_PUBLIC_APP_URL||"https://v0-bookinengine.vercel.app";return{link:`${o}/recover?token=${r}`,expiresAt:new Date(Date.now()+6048e5)}}async function l(e,n){console.log("[Cart] Getting recovery stats");let a=Array.from(t.values()).filter(e=>e.abandonedAt),r=a.filter(e=>e.recovered),o=r.reduce((e,t)=>e+t.totalPrice,0),i=a.reduce((e,t)=>e+t.totalPrice,0),s={};a.forEach(e=>{s[e.stage]=(s[e.stage]||0)+1});let c={};return a.forEach(e=>{e.recoveryAttempts.forEach(t=>{c[t.type]||(c[t.type]={total:0,recovered:0}),c[t.type].total++,e.recovered&&c[t.type].recovered++})}),{totalAbandoned:a.length,totalRecovered:r.length,recoveryRate:a.length>0?r.length/a.length*100:0,revenueRecovered:o,averageCartValue:a.length>0?i/a.length:0,topAbandonmentStages:Object.entries(s).map(([e,t])=>({stage:e,count:t})).sort((e,t)=>t.count-e.count),recoveryByChannel:Object.entries(c).map(([e,t])=>({channel:e,recovered:t.recovered,rate:t.total>0?t.recovered/t.total*100:0}))}}async function d(e,t){console.log("[Cart] Running recovery campaign",{dryRun:e.dryRun});let n={cartsProcessed:0,emailsSent:0,errors:[]};for(let a of(await o({hasEmail:!0},t))){n.cartsProcessed++;let r=(Date.now()-(a.abandonedAt?.getTime()||0))/36e5,o=a.recoveryAttempts.filter(e=>"email"===e.type).length,s=null;if(0===o&&r>=1?s="initial":1===o&&r>=24?s="reminder":2===o&&r>=72&&(s="lastChance"),s&&!e.dryRun){let e=await i({cartId:a.cartId,templateType:s},t);e.success?n.emailsSent++:e.error&&n.errors.push(`${a.cartId}: ${e.error}`)}}return console.log("[Cart] Campaign complete",n),n}e.s(["abandonedCartHandlers",0,{trackCartActivity:a,markCartAbandoned:r,getAbandonedCarts:o,sendRecoveryEmail:i,markCartRecovered:s,getRecoveryLink:c,getRecoveryStats:l,runRecoveryCampaign:d},"getAbandonedCarts",()=>o,"getRecoveryLink",()=>c,"getRecoveryStats",()=>l,"markCartAbandoned",()=>r,"markCartRecovered",()=>s,"runRecoveryCampaign",()=>d,"sendRecoveryEmail",()=>i,"trackCartActivity",()=>a])},458870,e=>{"use strict";let t=new Map,n=new Map;async function a(e,t){console.log("[Reviews] Requesting review",{bookingId:e.bookingId});let a=new Date(e.checkOutDate),r=new Date(a.getTime()+864e5),o={requestId:`req_${Date.now()}_${Math.random().toString(36).substring(2,8)}`,bookingId:e.bookingId,hotelId:e.hotelId,customerId:e.customerId,customerEmail:e.customerEmail,customerName:e.customerName,checkOutDate:a,status:"pending"};return n.set(o.requestId,o),console.log("[Reviews] Review request created",{requestId:o.requestId}),{requestId:o.requestId,scheduledFor:r}}async function r(e,a){if(console.log("[Reviews] Submitting review",{bookingId:e.bookingId,rating:e.overallRating}),e.overallRating<1||e.overallRating>5)throw Error("Rating must be between 1 and 5");if(Array.from(t.values()).find(t=>t.bookingId===e.bookingId))throw Error("A review already exists for this booking");let r={reviewId:`review_${Date.now()}_${Math.random().toString(36).substring(2,8)}`,bookingId:e.bookingId,hotelId:e.hotelId,hotelName:"",customerId:e.customerId,customerName:e.customerName,customerEmail:e.customerEmail,isVerified:!0,overallRating:e.overallRating,ratings:e.ratings,title:e.title,content:e.content,pros:e.pros,cons:e.cons,tripType:e.tripType,stayDate:new Date,roomType:e.roomType,language:a?.locale||"en",photos:e.photos,helpfulVotes:0,status:"pending",createdAt:new Date,updatedAt:new Date};t.set(r.reviewId,r);let o=Array.from(n.values()).find(t=>t.bookingId===e.bookingId);return o&&(o.status="completed",o.completedAt=new Date,n.set(o.requestId,o)),console.log("[Reviews] Review submitted",{reviewId:r.reviewId}),{reviewId:r.reviewId,status:r.status}}async function o(e,n){console.log("[Reviews] Getting hotel reviews",{hotelId:e.hotelId});let a=Array.from(t.values()).filter(t=>t.hotelId===e.hotelId);switch(a=e.status?a.filter(t=>t.status===e.status):a.filter(e=>"approved"===e.status),e.minRating&&(a=a.filter(t=>t.overallRating>=e.minRating)),e.sortBy){case"rating":a.sort((e,t)=>t.overallRating-e.overallRating);break;case"helpful":a.sort((e,t)=>t.helpfulVotes-e.helpfulVotes);break;default:a.sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime())}let r=a.length;e.offset&&(a=a.slice(e.offset)),e.limit&&(a=a.slice(0,e.limit));let o=function(e){if(0===e.length)return{totalReviews:0,averageRating:0,ratingDistribution:[1,2,3,4,5].map(e=>({rating:e,count:0,percentage:0})),categoryAverages:{cleanliness:0,location:0,service:0,value:0,amenities:0,comfort:0},recentTrend:"stable",responseRate:0};let t=e.reduce((e,t)=>e+t.overallRating,0)/e.length,n={1:0,2:0,3:0,4:0,5:0};e.forEach(e=>{let t=Math.round(e.overallRating);n[t]++});let a=[1,2,3,4,5].map(t=>({rating:t,count:n[t],percentage:n[t]/e.length*100})),r={};["cleanliness","location","service","value","amenities","comfort"].forEach(t=>{r[t]=e.reduce((e,n)=>e+n.ratings[t],0)/e.length});let o=e.filter(e=>e.response).length/e.length*100,i=Date.now(),s=i-2592e6,c=i-5184e6,l=e.filter(e=>e.createdAt.getTime()>s),d=e.filter(e=>e.createdAt.getTime()>c&&e.createdAt.getTime()<=s),u="stable";if(l.length>0&&d.length>0){let e=l.reduce((e,t)=>e+t.overallRating,0)/l.length,t=d.reduce((e,t)=>e+t.overallRating,0)/d.length;e>t+.2?u="improving":e<t-.2&&(u="declining")}return{totalReviews:e.length,averageRating:Math.round(10*t)/10,ratingDistribution:a,categoryAverages:r,recentTrend:u,responseRate:Math.round(o)}}(a);return{reviews:a,total:r,stats:o}}async function i(e,n){console.log("[Reviews] Moderating review",{reviewId:e.reviewId,action:e.action});let a=t.get(e.reviewId);if(!a)throw Error("Review not found");return a.status="approve"===e.action?"approved":"reject"===e.action?"rejected":"flagged",a.updatedAt=new Date,t.set(e.reviewId,a),{success:!0,status:a.status}}async function s(e,n){console.log("[Reviews] Responding to review",{reviewId:e.reviewId});let a=t.get(e.reviewId);if(!a)throw Error("Review not found");return a.response={responseId:`resp_${Date.now()}_${Math.random().toString(36).substring(2,8)}`,responderId:e.responderId,responderName:e.responderName,content:e.content,createdAt:new Date},a.updatedAt=new Date,t.set(e.reviewId,a),console.log("[Reviews] Response added",{responseId:a.response.responseId}),{success:!0,responseId:a.response.responseId}}async function c(e,n){let a=t.get(e.reviewId);if(!a)throw Error("Review not found");return a.helpfulVotes++,t.set(e.reviewId,a),{helpfulVotes:a.helpfulVotes}}async function l(e,n){console.log("[Reviews] Generating review summary",{hotelId:e.hotelId});let a=Array.from(t.values()).filter(t=>t.hotelId===e.hotelId&&"approved"===t.status);if(0===a.length)return{summary:"No reviews yet.",summaryHe:"××™×Ÿ ×¢×“×™×™×Ÿ ×‘×™×§×•×¨×•×ª.",highlights:[],concerns:[]};let r=a.map(e=>e.pros).filter(Boolean).join(" "),o=a.map(e=>e.cons).filter(Boolean).join(" "),i=[],s=[];r.toLowerCase().includes("location")&&i.push("Great location"),(r.toLowerCase().includes("staff")||r.toLowerCase().includes("service"))&&i.push("Excellent service"),r.toLowerCase().includes("clean")&&i.push("Very clean"),o.toLowerCase().includes("breakfast")&&s.push("Breakfast could be improved"),(o.toLowerCase().includes("noise")||o.toLowerCase().includes("noisy"))&&s.push("Some noise issues reported");let c=a.reduce((e,t)=>e+t.overallRating,0)/a.length;return{summary:`Based on ${a.length} reviews, this hotel has an average rating of ${c.toFixed(1)}. Guests frequently praise ${i.join(", ")||"the overall experience"}.`,summaryHe:`×¢×œ ×‘×¡×™×¡ ${a.length} ×‘×™×§×•×¨×•×ª, ×œ××œ×•×Ÿ ×“×™×¨×•×’ ×××•×¦×¢ ×©×œ ${c.toFixed(1)}. ××•×¨×—×™× ××©×‘×—×™× ×œ×¢×™×ª×™× ×§×¨×•×‘×•×ª ××ª ${i.join(", ")||"×”×—×•×•×™×” ×”×›×œ×œ×™×ª"}.`,highlights:i,concerns:s}}async function d(e,t){console.log("[Reviews] Sending review requests",{dryRun:e.dryRun});let a=Date.now(),r=Array.from(n.values()).filter(e=>"pending"===e.status&&a>=e.checkOutDate.getTime()+864e5),o=0;for(let t of r)e.dryRun||(t.status="sent",t.sentAt=new Date,n.set(t.requestId,t)),o++;return console.log("[Reviews] Review requests sent",{sent:o}),{sent:o,errors:[]}}[{reviewId:"demo_1",bookingId:"booking_demo_1",hotelId:"hotel_1",hotelName:"Dizengoff Inn",customerId:"cust_1",customerName:"John D.",customerEmail:"john@example.com",isVerified:!0,overallRating:4.5,ratings:{cleanliness:5,location:5,service:4,value:4,amenities:4,comfort:5},title:"Great location, amazing staff!",content:"Loved our stay at this hotel. The location is perfect for exploring Tel Aviv. Staff was incredibly helpful with restaurant recommendations.",pros:"Location, friendly staff, clean rooms",cons:"Breakfast could be better",tripType:"couple",stayDate:new Date("2025-12-15"),roomType:"Deluxe Room",language:"en",helpfulVotes:12,status:"approved",createdAt:new Date("2025-12-20"),updatedAt:new Date("2025-12-20")}].forEach(e=>t.set(e.reviewId,e)),e.s(["generateReviewSummary",()=>l,"getHotelReviews",()=>o,"markReviewHelpful",()=>c,"moderateReview",()=>i,"requestReview",()=>a,"respondToReview",()=>s,"reviewHandlers",0,{requestReview:a,submitReview:r,getHotelReviews:o,moderateReview:i,respondToReview:s,markReviewHelpful:c,generateReviewSummary:l,sendReviewRequests:d},"sendReviewRequests",()=>d,"submitReview",()=>r])},842083,e=>{"use strict";let t=["tempmail.com","throwaway.email","guerrillamail.com","10minutemail.com","mailinator.com","yopmail.com","trashmail.com","fakeinbox.com"],n=3,a=1e6,r=new Map;async function o(e,n){var a,r,o,s,c,l,d,u;let m,p,g,h,y,f,v,b,k,w,I,D,$,x,S,P;console.log("[Fraud] Analyzing booking risk",{bookingId:e.bookingId});let M=[],R=0,A=0,T=(a=e.customerEmail,m=0,p=[],g=a.split("@")[1]?.toLowerCase(),t.includes(g)&&(m+=60,p.push("Disposable email domain")),h=a.split("@")[0],/^[a-z0-9]{10,}$/i.test(h)&&!/[aeiou]{2,}/i.test(h)&&(m+=20,p.push("Random-looking email address")),/\d{4,}@/.test(a)&&(m+=15,p.push("Many numbers in email")),{name:"Email Analysis",nameHe:"× ×™×ª×•×— ××™××™×™×œ",score:Math.min(m,100),weight:.2,description:p.length>0?p.join(", "):"Email looks legitimate",descriptionHe:p.length>0?"× ××¦××• ×¡×™×× ×™× ×—×©×•×“×™× ×‘××™××™×™×œ":"×”××™××™×™×œ × ×¨××” ×ª×§×™×Ÿ"});M.push(T),R+=T.score*T.weight,A+=T.weight;let C=await i(e.customerEmail,e.amount);M.push(C),R+=C.score*C.weight,A+=C.weight;let _=(r=e.amount,y=0,f=[],r>5e5?(y+=30,f.push("Very high booking amount")):r>2e5&&(y+=15,f.push("High booking amount")),r%1e4==0&&r>0&&(y+=10,f.push("Suspiciously round amount")),{name:"Amount Analysis",nameHe:"× ×™×ª×•×— ×¡×›×•×",score:Math.min(y,100),weight:.15,description:f.length>0?f.join(", "):"Amount is reasonable",descriptionHe:f.length>0?"×¡×›×•× ×—×¨×™×’":"×¡×›×•× ×¡×‘×™×¨"});M.push(_),R+=_.score*_.weight,A+=_.weight;let H=(o=e.customerName,s=e.customerEmail,v=0,b=[],k=o.toLowerCase().split(/\s+/),w=s.split("@")[0].toLowerCase(),!k.some(e=>e.length>2&&w.includes(e))&&k[0]?.length>3&&(v+=25,b.push("Name doesn't match email")),{name:"Name/Email Match",nameHe:"×”×ª×××ª ×©× ×•××™××™×™×œ",score:Math.min(v,100),weight:.1,description:b.length>0?b.join(", "):"Name and email appear consistent",descriptionHe:b.length>0?"×—×•×¡×¨ ×”×ª×××” ×‘×™×Ÿ ×©× ×•××™××™×™×œ":"×”×©× ×•×”××™××™×™×œ ×ª×•×××™×"});M.push(H),R+=H.score*H.weight,A+=H.weight;let N=(c=e.checkIn,l=e.checkOut,I=0,D=[],$=new Date(c),x=new Date(l),S=new Date,Math.floor(($.getTime()-S.getTime())/864e5)>180&&(I+=20,D.push("Booking very far in advance")),(P=Math.floor((x.getTime()-$.getTime())/864e5))>30&&(I+=25,D.push(`Very long stay (${P} nights)`)),$<S&&(I+=50,D.push("Check-in date is in the past")),{name:"Booking Pattern",nameHe:"×“×¤×•×¡ ×”×–×× ×”",score:Math.min(I,100),weight:.15,description:D.length>0?D.join(", "):"Normal booking pattern",descriptionHe:D.length>0?"×“×¤×•×¡ ×”×–×× ×” ×—×©×•×“":"×“×¤×•×¡ ×”×–×× ×” ×ª×§×™×Ÿ"});if(M.push(N),R+=N.score*N.weight,A+=N.weight,e.ipAddress||n?.ipAddress){let t,a,r=(d=e.ipAddress||n?.ipAddress||"",u=e.billingCountry,t=0,a=[],(d.startsWith("10.")||d.startsWith("192.168."))&&(t+=10,a.push("Private/local IP address")),{name:"Geolocation Check",nameHe:"×‘×“×™×§×ª ××™×§×•×",score:Math.min(t,100),weight:.15,description:a.length>0?a.join(", "):"Location appears normal",descriptionHe:a.length>0?"× ××¦××• ×‘×¢×™×•×ª ××™×§×•×":"××™×§×•× ×ª×§×™×Ÿ"});M.push(r),R+=r.score*r.weight,A+=r.weight}let E=Math.round(A>0?R/A:0),U="low";E>=90?U="critical":E>=75?U="high":E>=50&&(U="medium");let F="approve";"critical"===U?F="block":"high"===U&&(F="review");let B=function(e,t,n){let a=e.filter(e=>e.score>30);if(0===a.length)return`Low risk booking (score: ${n}). All checks passed.`;let r=a.map(e=>e.name).join(", ");return`${t.charAt(0).toUpperCase()+t.slice(1)} risk (score: ${n}). Concerns: ${r}`}(M,U,E);return console.log("[Fraud] Risk analysis complete",{bookingId:e.bookingId,score:E,level:U,recommendation:F}),{score:E,level:U,factors:M,recommendation:F,details:B}}async function i(e,t){let o=Date.now(),i=o-36e5,s=r.get(e);(!s||s.timestamp<i)&&(s={count:0,total:0,timestamp:o}),s.count++,s.total+=t,s.timestamp=o,r.set(e,s);let c=0,l=[];return s.count>n&&(c+=50,l.push(`${s.count} bookings in last hour`)),s.total>a&&(c+=40,l.push("High total booking value")),{name:"Velocity Check",nameHe:"×‘×“×™×§×ª ×§×¦×‘ ×”×–×× ×•×ª",score:Math.min(c,100),weight:.25,description:l.length>0?l.join(", "):"Normal booking frequency",descriptionHe:l.length>0?"×§×¦×‘ ×”×–×× ×•×ª ×—×¨×™×’":"×§×¦×‘ ×”×–×× ×•×ª ×ª×§×™×Ÿ"}}async function s(e,t){console.log("[Fraud] Flagging suspicious activity",{type:e.type,severity:e.severity});let n={id:`fraud_${Date.now()}_${Math.random().toString(36).substring(2,8)}`,type:e.type,severity:e.severity,description:e.description,bookingId:e.bookingId,customerId:e.customerId,data:e.data||{},createdAt:new Date};return console.log("[Fraud] Activity flagged",{id:n.id}),n}async function c(e,t){let n=await o({bookingId:e.bookingId,customerEmail:e.customerEmail,customerName:"",amount:e.amount,currency:"USD",hotelId:"",checkIn:new Date,checkOut:new Date(Date.now()+864e5)},t);return{score:n.score,level:n.level,recommendation:n.recommendation}}async function l(e,t){return console.log("[Fraud] Checking blacklist",{email:e.email}),{blacklisted:!1}}async function d(e,t){let n=[],a=await o({bookingId:e.bookingId,customerEmail:e.customerEmail,customerName:e.customerName,amount:e.amount,currency:e.currency,hotelId:"",checkIn:new Date,checkOut:new Date(Date.now()+864e5)},t);for(let e of a.factors)n.push({checkType:e.name,passed:e.score<50,details:e.description,score:e.score});let r=await l({email:e.customerEmail},t);return n.push({checkType:"Blacklist",passed:!r.blacklisted,details:r.blacklisted?r.reason||"Blacklisted":"Not blacklisted",score:100*!!r.blacklisted}),{passed:"block"!==a.recommendation,riskScore:a,checks:n}}e.s(["analyzeBookingRisk",()=>o,"checkBlacklist",()=>l,"flagSuspiciousActivity",()=>s,"fraudHandlers",0,{analyzeBookingRisk:o,flagSuspiciousActivity:s,getRiskScore:c,checkBlacklist:l,runFraudChecks:d},"getRiskScore",()=>c,"runFraudChecks",()=>d])},54005,e=>{"use strict";let t=[{id:"basic",name:"Basic Travel Protection",nameHe:"×”×’× ×” ×‘×¡×™×¡×™×ª ×œ× ×¡×™×¢×”",description:"Essential coverage for trip cancellation and medical emergencies",descriptionHe:"×›×™×¡×•×™ ×‘×¡×™×¡×™ ×œ×‘×™×˜×•×œ × ×¡×™×¢×” ×•××¦×‘×™ ×—×™×¨×•× ×¨×¤×•××™×™×",coverage:[{type:"Trip Cancellation",typeHe:"×‘×™×˜×•×œ × ×¡×™×¢×”",maxAmount:1e5,currency:"USD",description:"Reimbursement for prepaid, non-refundable trip costs",descriptionHe:"×”×—×–×¨ ×¢×‘×•×¨ ×¢×œ×•×™×•×ª × ×¡×™×¢×” ×©×©×•×œ××• ××¨××© ×•××™× ×Ÿ × ×™×ª× ×•×ª ×œ×”×—×–×¨"},{type:"Medical Emergency",typeHe:"×—×™×¨×•× ×¨×¤×•××™",maxAmount:5e4,currency:"USD",description:"Emergency medical treatment abroad",descriptionHe:'×˜×™×¤×•×œ ×¨×¤×•××™ ×—×™×¨×•× ×‘×—×•"×œ'},{type:"Baggage Loss",typeHe:"××•×‘×“×Ÿ ××–×•×•×“×•×ª",maxAmount:1e3,currency:"USD",description:"Coverage for lost or stolen baggage",descriptionHe:"×›×™×¡×•×™ ×œ××–×•×•×“×•×ª ×©××‘×“×• ××• × ×’× ×‘×•"}],pricePerDay:500,pricePerPerson:1e3,currency:"USD",provider:"TravelGuard",terms:"Coverage begins at trip start. Pre-existing conditions excluded.",termsHe:"×”×›×™×¡×•×™ ××ª×—×™×œ ×¢× ×ª×—×™×œ×ª ×”× ×¡×™×¢×”. ××¦×‘×™× ×¨×¤×•××™×™× ×§×™×™××™× ××™× × ××›×•×¡×™×."},{id:"premium",name:"Premium Travel Protection",nameHe:"×”×’× ×” ×¤×¨×™××™×•× ×œ× ×¡×™×¢×”",description:"Comprehensive coverage including adventure activities and electronics",descriptionHe:"×›×™×¡×•×™ ××§×™×£ ×›×•×œ×œ ×¤×¢×™×œ×•×™×•×ª ××ª×’×¨×™×•×ª ×•××›×©×™×¨×™× ××œ×§×˜×¨×•× ×™×™×",coverage:[{type:"Trip Cancellation",typeHe:"×‘×™×˜×•×œ × ×¡×™×¢×”",maxAmount:2e5,currency:"USD",description:"Full reimbursement for any reason cancellation",descriptionHe:"×”×—×–×¨ ××œ× ×œ×‘×™×˜×•×œ ××›×œ ×¡×™×‘×”"},{type:"Medical Emergency",typeHe:"×—×™×¨×•× ×¨×¤×•××™",maxAmount:25e4,currency:"USD",description:"Comprehensive medical coverage including evacuation",descriptionHe:"×›×™×¡×•×™ ×¨×¤×•××™ ××§×™×£ ×›×•×œ×œ ×¤×™× ×•×™"},{type:"Baggage & Electronics",typeHe:"××–×•×•×“×•×ª ×•××œ×§×˜×¨×•× ×™×§×”",maxAmount:3e3,currency:"USD",description:"Coverage for baggage, electronics, and valuables",descriptionHe:"×›×™×¡×•×™ ×œ××–×•×•×“×•×ª, ××œ×§×˜×¨×•× ×™×§×” ×•×—×¤×¦×™ ×¢×¨×š"},{type:"Adventure Sports",typeHe:"×¡×¤×•×¨×˜ ××ª×’×¨×™",maxAmount:5e4,currency:"USD",description:"Coverage for skiing, diving, hiking accidents",descriptionHe:"×›×™×¡×•×™ ×œ×ª××•× ×•×ª ×¡×§×™, ×¦×œ×™×œ×”, ×˜×™×•×œ×™×"},{type:"Trip Delay",typeHe:"×¢×™×›×•×‘ × ×¡×™×¢×”",maxAmount:500,currency:"USD",description:"Compensation for delays over 6 hours",descriptionHe:"×¤×™×¦×•×™ ×¢×œ ×¢×™×›×•×‘×™× ×©×œ ××¢×œ 6 ×©×¢×•×ª"}],pricePerDay:1200,pricePerPerson:2500,currency:"USD",provider:"TravelGuard",terms:"24/7 assistance hotline. Cancel for any reason up to 48h before.",termsHe:"×§×• ×—×™×¨×•× 24/7. ×‘×™×˜×•×œ ××›×œ ×¡×™×‘×” ×¢×“ 48 ×©×¢×•×ª ×œ×¤× ×™."},{id:"family",name:"Family Travel Protection",nameHe:"×”×’× ×ª ××©×¤×—×” ×œ× ×¡×™×¢×”",description:"Specially designed for families with children",descriptionHe:"××•×ª×× ×‘××™×•×—×“ ×œ××©×¤×—×•×ª ×¢× ×™×œ×“×™×",coverage:[{type:"Trip Cancellation",typeHe:"×‘×™×˜×•×œ × ×¡×™×¢×”",maxAmount:15e4,currency:"USD",description:"Family cancellation coverage",descriptionHe:"×›×™×¡×•×™ ×‘×™×˜×•×œ ×œ××©×¤×—×”"},{type:"Medical Emergency",typeHe:"×—×™×¨×•× ×¨×¤×•××™",maxAmount:15e4,currency:"USD",description:"Family medical coverage including pediatric care",descriptionHe:"×›×™×¡×•×™ ×¨×¤×•××™ ×œ××©×¤×—×” ×›×•×œ×œ ×˜×™×¤×•×œ ×™×œ×“×™×"},{type:"Child Care",typeHe:"×˜×™×¤×•×œ ×‘×™×œ×“×™×",maxAmount:5e3,currency:"USD",description:"Emergency child care if parent hospitalized",descriptionHe:"×˜×™×¤×•×œ ×—×™×¨×•× ×‘×™×œ×“×™× ×× ×”×”×•×¨×” ×××•×©×¤×–"},{type:"Baggage Loss",typeHe:"××•×‘×“×Ÿ ××–×•×•×“×•×ª",maxAmount:2e3,currency:"USD",description:"Family baggage coverage",descriptionHe:"×›×™×¡×•×™ ××–×•×•×“×•×ª ×œ××©×¤×—×”"}],pricePerDay:800,pricePerPerson:1500,currency:"USD",provider:"TravelGuard",terms:"Children under 18 included free. Max 2 adults, 4 children per policy.",termsHe:"×™×œ×“×™× ×¢×“ ×’×™×œ 18 ×œ×œ× ×ª×©×œ×•×. ××§×¡×™××•× 2 ××‘×•×’×¨×™×, 4 ×™×œ×“×™× ×œ×¤×•×œ×™×¡×”."}];async function n(e,n){return console.log("[Insurance] Getting available plans",e),t}async function a(e,n){console.log("[Insurance] Generating quote",{planId:e.planId,travelers:e.travelers});let a=t.find(t=>t.id===e.planId);if(!a)throw Error(`Insurance plan not found: ${e.planId}`);let r=new Date(e.checkIn),o=Math.ceil((new Date(e.checkOut).getTime()-r.getTime())/864e5),i=e.travelers;"family"===e.planId&&e.childrenUnder18&&(i=Math.max(0,i-e.childrenUnder18));let s=a.pricePerDay*o,c=a.pricePerPerson*i,l=s+c,d=Math.round(.05*l),u=l+d,m={quoteId:`quote_${Date.now()}_${Math.random().toString(36).substring(2,8)}`,planId:a.id,planName:a.name,totalPrice:u,priceBreakdown:{basePrice:l,perDayPrice:s,perPersonPrice:c,taxes:d},currency:a.currency,coverage:a.coverage,validUntil:new Date(Date.now()+864e5),bookingId:e.bookingId};return console.log("[Insurance] Quote generated",{quoteId:m.quoteId,totalPrice:u}),m}async function r(e,t){console.log("[Insurance] Purchasing policy",{quoteId:e.quoteId,bookingId:e.bookingId});let n={policyId:`policy_${Date.now()}_${Math.random().toString(36).substring(2,8)}`,quoteId:e.quoteId,planId:"premium",bookingId:e.bookingId,customerId:e.customerId,customerName:e.customerName,customerEmail:e.customerEmail,travelers:e.travelers,startDate:new Date,endDate:new Date(Date.now()+6048e5),totalPrice:5e3,currency:"USD",status:"active",policyNumber:`TG-${Date.now().toString().slice(-8)}`,createdAt:new Date};return console.log("[Insurance] Policy purchased",{policyId:n.policyId,policyNumber:n.policyNumber}),n}async function o(e,t){return console.log("[Insurance] Getting policy",e),null}async function i(e,t){return console.log("[Insurance] Cancelling policy",{policyId:e.policyId}),{success:!0,refundAmount:4500}}async function s(e,t){return console.log("[Insurance] Filing claim",{policyId:e.policyId,claimType:e.claimType}),{claimId:`claim_${Date.now()}_${Math.random().toString(36).substring(2,8)}`,status:"submitted",estimatedProcessingDays:5}}async function c(e,t){return console.log("[Insurance] Getting claim status",{claimId:e.claimId}),{claimId:e.claimId,status:"under_review",updatedAt:new Date}}e.s(["cancelInsurance",()=>i,"fileInsuranceClaim",()=>s,"getClaimStatus",()=>c,"getInsurancePlans",()=>n,"getInsurancePolicy",()=>o,"getInsuranceQuote",()=>a,"insuranceHandlers",0,{getInsurancePlans:n,getInsuranceQuote:a,purchaseInsurance:r,getInsurancePolicy:o,cancelInsurance:i,fileInsuranceClaim:s,getClaimStatus:c},"purchaseInsurance",()=>r])},429504,e=>{"use strict";let t={skillId:"revenue-dashboard",async execute(e,t,i){switch(e){case"get_revenue_summary":return n(t,i);case"get_revenue_breakdown":return a(t,i);case"get_kpi_dashboard":return r(t,i);case"generate_revenue_report":return o(t,i);default:return{success:!1,error:`Unknown tool: ${e}`}}}};async function n(e,t){let n=e.period||"month",a=e.startDate,r=e.endDate,o=!1!==e.compareWithPrevious;try{let e,t=new Date,c=new Date(r||t);if(a)e=new Date(a);else switch(e=new Date(t),n){case"day":e.setDate(e.getDate()-1);break;case"week":e.setDate(e.getDate()-7);break;case"month":e.setMonth(e.getMonth()-1);break;case"quarter":e.setMonth(e.getMonth()-3);break;case"year":e.setFullYear(e.getFullYear()-1)}let l=i(e,c),d=null;if(o){let t=c.getTime()-e.getTime(),n=new Date(e.getTime()-t),a=new Date(e.getTime()-1);d=i(n,a)}let u=s(l),m=d?s(d):null,p=m?{revenue:(u.revenue-m.revenue)/m.revenue*100,bookings:(u.bookings-m.bookings)/m.bookings*100,avgOrderValue:(u.avgOrderValue-m.avgOrderValue)/m.avgOrderValue*100,cancellationRate:u.cancellationRate-m.cancellationRate}:null;return{success:!0,data:{period:{start:e.toISOString().split("T")[0],end:c.toISOString().split("T")[0],label:n},summary:{totalRevenue:u.revenue,totalBookings:u.bookings,avgOrderValue:u.avgOrderValue,cancellationRate:u.cancellationRate,refundRate:u.refundRate,netRevenue:u.netRevenue},comparison:p?{revenueChange:p.revenue.toFixed(1)+"%",bookingsChange:p.bookings.toFixed(1)+"%",avgOrderValueChange:p.avgOrderValue.toFixed(1)+"%",trend:p.revenue>0?"up":p.revenue<0?"down":"stable"}:null,dailyData:l.slice(-7),topMetrics:{bestDay:l.reduce((e,t)=>e.revenue>t.revenue?e:t),worstDay:l.reduce((e,t)=>e.revenue<t.revenue?e:t),avgDailyRevenue:u.revenue/l.length}},message:`Revenue summary for ${n}: â‚¬${u.revenue.toLocaleString()} total revenue from ${u.bookings} bookings`}}catch(e){return{success:!1,error:`Failed to get revenue summary: ${e}`}}}async function a(e,t){let n=e.breakdownBy||"source",a=e.period||"month";try{var r,o;let e,t,i,s,c=[];switch(n){case"source":c=[{category:"Direct Website",amount:45e3,percentage:35,trend:"up",change:12},{category:"Booking.com",amount:32e3,percentage:25,trend:"stable",change:2},{category:"Expedia",amount:25e3,percentage:19,trend:"down",change:-5},{category:"AI Chat Widget",amount:18e3,percentage:14,trend:"up",change:45},{category:"Phone/Email",amount:9e3,percentage:7,trend:"down",change:-15}];break;case"hotel":c=[{category:"Scarlet Hotel Tel Aviv",amount:52e3,percentage:40,trend:"up",change:8},{category:"Grand Palace Jerusalem",amount:39e3,percentage:30,trend:"up",change:15},{category:"Beach Resort Eilat",amount:26e3,percentage:20,trend:"stable",change:1},{category:"Mountain Lodge Galilee",amount:13e3,percentage:10,trend:"down",change:-3}];break;case"room_type":c=[{category:"Deluxe Suite",amount:48e3,percentage:37,trend:"up",change:18},{category:"Standard Room",amount:35e3,percentage:27,trend:"stable",change:0},{category:"Family Room",amount:26e3,percentage:20,trend:"up",change:22},{category:"Executive Suite",amount:21e3,percentage:16,trend:"down",change:-8}];break;case"channel":c=[{category:"Online",amount:91e3,percentage:70,trend:"up",change:15},{category:"Mobile App",amount:26e3,percentage:20,trend:"up",change:35},{category:"Offline",amount:13e3,percentage:10,trend:"down",change:-20}]}let l=c.reduce((e,t)=>e+t.amount,0);return{success:!0,data:{breakdownBy:n,period:a,totalRevenue:l,breakdown:c,insights:(r=c,o=n,e=[],t=r[0],e.push(`${t.category} leads ${o} revenue with ${t.percentage}% share`),(i=r.filter(e=>"up"===e.trend&&e.change>10)).length>0&&e.push(`Fast growing: ${i.map(e=>e.category).join(", ")}`),(s=r.filter(e=>"down"===e.trend)).length>0&&e.push(`Declining: ${s.map(e=>e.category).join(", ")} - requires attention`),e),recommendations:["up"===c[0].trend?`${c[0].category} is performing well (+${c[0].change}%). Consider increasing investment.`:`Focus on improving ${c[0].category} performance.`,c.find(e=>"down"===e.trend)?`Attention needed: ${c.find(e=>"down"===e.trend)?.category} is declining.`:"All categories showing positive or stable trends."]},message:`Revenue breakdown by ${n}: Top performer is ${c[0].category} with â‚¬${c[0].amount.toLocaleString()} (${c[0].percentage}%)`}}catch(e){return{success:!1,error:`Failed to get revenue breakdown: ${e}`}}}async function r(e,t){let n=e.period||"month";try{let e=[{name:"Total Revenue",value:129e3,target:12e4,status:"excellent",trend:"up",change:12.5},{name:"Bookings",value:847,target:800,status:"excellent",trend:"up",change:8.2},{name:"Average Order Value",value:152.3,target:150,status:"good",trend:"up",change:3.5},{name:"Occupancy Rate",value:"78%",target:"75%",status:"good",trend:"up",change:4.1},{name:"Cancellation Rate",value:"8.2%",target:"10%",status:"excellent",trend:"down",change:-15.3},{name:"Customer Satisfaction",value:4.6,target:4.5,status:"good",trend:"stable",change:.5},{name:"Revenue per Available Room",value:145,target:140,status:"good",trend:"up",change:5.8},{name:"Direct Booking Rate",value:"49%",target:"50%",status:"warning",trend:"up",change:8}],t={excellent:e.filter(e=>"excellent"===e.status).length,good:e.filter(e=>"good"===e.status).length,warning:e.filter(e=>"warning"===e.status).length,critical:e.filter(e=>"critical"===e.status).length};return{success:!0,data:{period:n,kpis:e,statusSummary:t,overallHealth:0===t.critical&&t.warning<=1?"healthy":t.critical>0?"critical":"attention_needed",alerts:e.filter(e=>"warning"===e.status||"critical"===e.status).map(e=>({kpi:e.name,message:`${e.name} is ${e.status}: ${e.value} (target: ${e.target})`,priority:"critical"===e.status?"high":"medium"})),highlights:e.filter(e=>"excellent"===e.status).map(e=>`${e.name}: ${e.value} (${e.change>0?"+":""}${e.change}%)`)},message:`KPI Dashboard: ${t.excellent} excellent, ${t.good} good, ${t.warning} need attention`}}catch(e){return{success:!1,error:`Failed to get KPI dashboard: ${e}`}}}async function o(e,t){let o=e.reportType||"summary",i=e.period||"month",s=e.format||"json";try{var c;let e=await n({period:i},t),l=await a({period:i,breakdownBy:"source"},t),d=await r({period:i},t);if(!e.success||!l.success||!d.success)throw Error("Failed to gather report data");let u={generatedAt:new Date().toISOString(),period:i,reportType:o,summary:e.data,breakdown:l.data,kpis:d.data},m=u;return"html"===s&&(c=u,m=`
<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
  <meta charset="UTF-8">
  <title>×“×•×— ×”×›× ×¡×•×ª - ${c.period}</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; background: #f5f5f5; }
    .container { max-width: 1000px; margin: 0 auto; background: white; padding: 40px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    h1 { color: #1a1a2e; border-bottom: 3px solid #4a90a4; padding-bottom: 15px; }
    h2 { color: #4a90a4; margin-top: 30px; }
    .metric { display: inline-block; background: #f8f9fa; padding: 20px; margin: 10px; border-radius: 8px; min-width: 150px; text-align: center; }
    .metric-value { font-size: 28px; font-weight: bold; color: #1a1a2e; }
    .metric-label { font-size: 14px; color: #666; margin-top: 5px; }
    .metric-change { font-size: 12px; margin-top: 5px; }
    .up { color: #28a745; }
    .down { color: #dc3545; }
    table { width: 100%; border-collapse: collapse; margin: 20px 0; }
    th, td { padding: 12px; text-align: right; border-bottom: 1px solid #ddd; }
    th { background: #4a90a4; color: white; }
    .kpi-excellent { background: #d4edda; }
    .kpi-good { background: #fff3cd; }
    .kpi-warning { background: #f8d7da; }
    .footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; color: #666; font-size: 12px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“Š ×“×•×— ×”×›× ×¡×•×ª - ${c.period}</h1>
    <p>× ×•×¦×¨: ${new Date(c.generatedAt).toLocaleString("he-IL")}</p>
    
    <h2>×¡×™×›×•× ×›×œ×œ×™</h2>
    <div class="metrics">
      <div class="metric">
        <div class="metric-value">â‚¬${c.summary?.summary?.totalRevenue?.toLocaleString()||"N/A"}</div>
        <div class="metric-label">×”×›× ×¡×•×ª ×›×•×œ×œ×•×ª</div>
        <div class="metric-change up">${c.summary?.comparison?.revenueChange||""}</div>
      </div>
      <div class="metric">
        <div class="metric-value">${c.summary?.summary?.totalBookings||"N/A"}</div>
        <div class="metric-label">×”×–×× ×•×ª</div>
        <div class="metric-change up">${c.summary?.comparison?.bookingsChange||""}</div>
      </div>
      <div class="metric">
        <div class="metric-value">â‚¬${c.summary?.summary?.avgOrderValue||"N/A"}</div>
        <div class="metric-label">×××•×¦×¢ ×œ×”×–×× ×”</div>
      </div>
      <div class="metric">
        <div class="metric-value">${c.summary?.summary?.cancellationRate?.toFixed(1)||"N/A"}%</div>
        <div class="metric-label">×©×™×¢×•×¨ ×‘×™×˜×•×œ×™×</div>
      </div>
    </div>
    
    <h2>×¤×™×œ×•×— ×”×›× ×¡×•×ª</h2>
    <table>
      <tr><th>×§×˜×’×•×¨×™×”</th><th>×¡×›×•×</th><th>××—×•×–</th><th>××’××”</th></tr>
      ${c.breakdown?.breakdown?.map(e=>`
        <tr>
          <td>${e.category}</td>
          <td>â‚¬${e.amount.toLocaleString()}</td>
          <td>${e.percentage}%</td>
          <td class="${"up"===e.trend?"up":"down"===e.trend?"down":""}">${"up"===e.trend?"â†‘":"down"===e.trend?"â†“":"â†’"} ${e.change}%</td>
        </tr>
      `).join("")||""}
    </table>
    
    <h2>××“×“×™ ×‘×™×¦×•×¢ (KPIs)</h2>
    <table>
      <tr><th>××“×“</th><th>×¢×¨×š</th><th>×™×¢×“</th><th>×¡×˜×˜×•×¡</th></tr>
      ${c.kpis?.kpis?.slice(0,5).map(e=>`
        <tr class="kpi-${e.status}">
          <td>${e.name}</td>
          <td>${e.value}</td>
          <td>${e.target}</td>
          <td>${"excellent"===e.status?"âœ…":"good"===e.status?"ğŸ‘":"âš ï¸"}</td>
        </tr>
      `).join("")||""}
    </table>
    
    <div class="footer">
      <p>×“×•×— ×–×” × ×•×¦×¨ ××•×˜×•××˜×™×ª ×¢×œ ×™×“×™ ××¢×¨×›×ª Revenue Dashboard</p>
    </div>
  </div>
</body>
</html>
  `),{success:!0,data:{report:m,format:s,downloadUrl:"pdf"===s?`/api/reports/revenue/${Date.now()}.pdf`:null,metadata:{generatedAt:u.generatedAt,period:i,type:o,dataPoints:Object.keys(u).length}},message:`Revenue report generated successfully (${o} format, ${i} period)`}}catch(e){return{success:!1,error:`Failed to generate revenue report: ${e}`}}}function i(e,t){let n=[],a=new Date(e);for(;a<=t;){let e=a.getDay(),t=0===e||6===e?5500:3800,r=(Math.random()-.5)*1500;n.push({date:a.toISOString().split("T")[0],revenue:Math.round(t+r),bookings:Math.round(25+15*Math.random()),avgOrderValue:Math.round(140+30*Math.random()),cancellations:Math.round(5*Math.random()),refunds:Math.round(500*Math.random())}),a.setDate(a.getDate()+1)}return n}function s(e){let t=e.reduce((e,t)=>e+t.revenue,0),n=e.reduce((e,t)=>e+t.bookings,0),a=e.reduce((e,t)=>e+t.cancellations,0),r=e.reduce((e,t)=>e+t.refunds,0);return{revenue:t,bookings:n,avgOrderValue:Math.round(t/n),cancellationRate:a/n*100,refundRate:r/t*100,netRevenue:t-r}}e.s(["default",0,t,"revenueDashboardHandler",0,t])},717393,e=>{"use strict";function t(e,t){return new Intl.NumberFormat("en-US",{style:"currency",currency:t.toUpperCase()}).format(e/100)}function n(e,t="en"){return new Intl.DateTimeFormat("he"===t?"he-IL":"en-US",{year:"numeric",month:"long",day:"numeric"}).format(e)}async function a(e,a){var r,o;let i,s,c,l,d,u,m,p;console.log("[Invoice] Generating invoice",{bookingId:e.bookingId});let g=a?.locale||"en",h=new Date(e.checkIn),y=new Date(e.checkOut),f=Math.ceil((y.getTime()-h.getTime())/864e5),v=(e.bookingId,s=(i=new Date).getFullYear(),c=String(i.getMonth()+1).padStart(2,"0"),l=Math.random().toString(36).substring(2,6).toUpperCase(),`INV-${s}${c}-${l}`),b=e.taxRate||17,k=e.totalPrice,w=Math.round(k*b/100),I=e.discount||0,D=(r={invoiceNumber:v,bookingId:e.bookingId,date:new Date,seller:{name:"Booking Engine Ltd",address:"123 Tech Street, Tel Aviv, Israel",email:"billing@bookingengine.com",phone:"+972-3-1234567",vatNumber:"IL-123456789"},customer:{name:e.customerName,email:e.customerEmail,phone:e.customerPhone},booking:{hotelName:e.hotelName,roomType:e.roomType,checkIn:h,checkOut:y,nights:f,guests:e.guests,confirmationNumber:e.confirmationNumber},items:[{description:`${e.hotelName} - ${e.roomType}`,descriptionHe:`${e.hotelName} - ${e.roomType}`,quantity:f,unitPrice:Math.round(k/f),total:k}],subtotal:k,tax:w,taxRate:b,discount:I,discountCode:e.discountCode,total:k+w-I,currency:e.currency,paymentStatus:e.paymentStatus||"pending",notes:e.notes},m=({paid:(u=(d="he"===(o=g))?{invoice:"×—×©×‘×•× ×™×ª",invoiceNumber:"××¡×¤×¨ ×—×©×‘×•× ×™×ª",date:"×ª××¨×™×š",from:"×××ª",to:"××œ",bookingDetails:"×¤×¨×˜×™ ×”×–×× ×”",hotel:"××œ×•×Ÿ",roomType:"×¡×•×’ ×—×“×¨",checkIn:"×¦'×§-××™×Ÿ",checkOut:"×¦'×§-×××•×˜",nights:"×œ×™×œ×•×ª",guests:"××•×¨×—×™×",confirmation:"××¡×¤×¨ ××™×©×•×¨",description:"×ª×™××•×¨",quantity:"×›××•×ª",unitPrice:"××—×™×¨ ×œ×™×—×™×“×”",total:'×¡×”"×›',subtotal:"×¡×›×•× ×‘×™× ×™×™×",tax:'××¢"×',discount:"×”× ×—×”",grandTotal:'×¡×”"×› ×œ×ª×©×œ×•×',status:"×¡×˜×˜×•×¡ ×ª×©×œ×•×",paid:"×©×•×œ×",pending:"×××ª×™×Ÿ ×œ×ª×©×œ×•×",refunded:"×”×•×—×–×¨",partial:"×©×•×œ× ×—×œ×§×™×ª",notes:"×”×¢×¨×•×ª",thankYou:"×ª×•×“×” ×¢×œ ×”×–×× ×ª×š!"}:{invoice:"Invoice",invoiceNumber:"Invoice Number",date:"Date",from:"From",to:"To",bookingDetails:"Booking Details",hotel:"Hotel",roomType:"Room Type",checkIn:"Check-in",checkOut:"Check-out",nights:"Nights",guests:"Guests",confirmation:"Confirmation #",description:"Description",quantity:"Quantity",unitPrice:"Unit Price",total:"Total",subtotal:"Subtotal",tax:"Tax (VAT)",discount:"Discount",grandTotal:"Grand Total",status:"Payment Status",paid:"Paid",pending:"Pending",refunded:"Refunded",partial:"Partially Paid",notes:"Notes",thankYou:"Thank you for your booking!"}).paid,pending:u.pending,refunded:u.refunded,partial:u.partial})[r.paymentStatus],p=({paid:"#22c55e",pending:"#f59e0b",refunded:"#ef4444",partial:"#3b82f6"})[r.paymentStatus],`
<!DOCTYPE html>
<html dir="${d?"rtl":"ltr"}" lang="${d?"he":"en"}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>${u.invoice} ${r.invoiceNumber}</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: ${d?"'Heebo', 'Arial', sans-serif":"'Inter', 'Arial', sans-serif"};
      line-height: 1.6; 
      color: #1f2937;
      background: #f9fafb;
      padding: 20px;
    }
    .invoice-container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    .header {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      color: white;
      padding: 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .header h1 { font-size: 28px; font-weight: 700; }
    .invoice-number { 
      background: rgba(255,255,255,0.2);
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 14px;
    }
    .content { padding: 30px; }
    .parties {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-bottom: 30px;
    }
    .party h3 { 
      color: #6366f1; 
      margin-bottom: 10px;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .party p { color: #4b5563; font-size: 14px; }
    .booking-details {
      background: #f3f4f6;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 30px;
    }
    .booking-details h3 {
      color: #1f2937;
      margin-bottom: 15px;
      font-size: 16px;
    }
    .booking-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
    }
    .booking-item label {
      display: block;
      color: #6b7280;
      font-size: 12px;
      margin-bottom: 4px;
    }
    .booking-item span {
      font-weight: 600;
      color: #1f2937;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    th {
      text-align: ${d?"right":"left"};
      padding: 12px;
      background: #f9fafb;
      color: #6b7280;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border-bottom: 2px solid #e5e7eb;
    }
    td {
      padding: 12px;
      border-bottom: 1px solid #e5e7eb;
    }
    .totals {
      margin-top: 20px;
      border-top: 2px solid #e5e7eb;
      padding-top: 20px;
    }
    .total-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      font-size: 14px;
    }
    .total-row.grand {
      font-size: 18px;
      font-weight: 700;
      color: #6366f1;
      border-top: 2px solid #6366f1;
      margin-top: 10px;
      padding-top: 15px;
    }
    .status-badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      color: white;
      background: ${p};
    }
    .footer {
      text-align: center;
      padding: 20px;
      background: #f9fafb;
      color: #6b7280;
      font-size: 14px;
    }
    @media print {
      body { background: white; padding: 0; }
      .invoice-container { box-shadow: none; }
    }
  </style>
</head>
<body>
  <div class="invoice-container">
    <div class="header">
      <div>
        <h1>${u.invoice}</h1>
        <p>${u.date}: ${n(r.date,o)}</p>
      </div>
      <div class="invoice-number">
        ${u.invoiceNumber}: ${r.invoiceNumber}
      </div>
    </div>
    
    <div class="content">
      <div class="parties">
        <div class="party">
          <h3>${u.from}</h3>
          <p><strong>${r.seller.name}</strong></p>
          <p>${r.seller.address}</p>
          <p>${r.seller.email}</p>
          <p>${r.seller.phone}</p>
          ${r.seller.vatNumber?`<p>VAT: ${r.seller.vatNumber}</p>`:""}
        </div>
        <div class="party">
          <h3>${u.to}</h3>
          <p><strong>${r.customer.name}</strong></p>
          <p>${r.customer.email}</p>
          ${r.customer.phone?`<p>${r.customer.phone}</p>`:""}
          ${r.customer.address?`<p>${r.customer.address}</p>`:""}
        </div>
      </div>
      
      <div class="booking-details">
        <h3>${u.bookingDetails}</h3>
        <div class="booking-grid">
          <div class="booking-item">
            <label>${u.hotel}</label>
            <span>${r.booking.hotelName}</span>
          </div>
          <div class="booking-item">
            <label>${u.roomType}</label>
            <span>${r.booking.roomType}</span>
          </div>
          <div class="booking-item">
            <label>${u.confirmation}</label>
            <span>${r.booking.confirmationNumber}</span>
          </div>
          <div class="booking-item">
            <label>${u.checkIn}</label>
            <span>${n(r.booking.checkIn,o)}</span>
          </div>
          <div class="booking-item">
            <label>${u.checkOut}</label>
            <span>${n(r.booking.checkOut,o)}</span>
          </div>
          <div class="booking-item">
            <label>${u.nights} / ${u.guests}</label>
            <span>${r.booking.nights} / ${r.booking.guests}</span>
          </div>
        </div>
      </div>
      
      <table>
        <thead>
          <tr>
            <th>${u.description}</th>
            <th>${u.quantity}</th>
            <th>${u.unitPrice}</th>
            <th>${u.total}</th>
          </tr>
        </thead>
        <tbody>
          ${r.items.map(e=>`
            <tr>
              <td>${d&&e.descriptionHe?e.descriptionHe:e.description}</td>
              <td>${e.quantity}</td>
              <td>${t(e.unitPrice,r.currency)}</td>
              <td>${t(e.total,r.currency)}</td>
            </tr>
          `).join("")}
        </tbody>
      </table>
      
      <div class="totals">
        <div class="total-row">
          <span>${u.subtotal}</span>
          <span>${t(r.subtotal,r.currency)}</span>
        </div>
        <div class="total-row">
          <span>${u.tax} (${r.taxRate}%)</span>
          <span>${t(r.tax,r.currency)}</span>
        </div>
        ${r.discount?`
        <div class="total-row">
          <span>${u.discount}${r.discountCode?` (${r.discountCode})`:""}</span>
          <span>-${t(r.discount,r.currency)}</span>
        </div>
        `:""}
        <div class="total-row grand">
          <span>${u.grandTotal}</span>
          <span>${t(r.total,r.currency)}</span>
        </div>
      </div>
      
      <div style="margin-top: 20px;">
        <strong>${u.status}:</strong>
        <span class="status-badge">${m}</span>
      </div>
      
      ${r.notes?`
      <div style="margin-top: 20px; padding: 15px; background: #fef3c7; border-radius: 8px;">
        <strong>${u.notes}:</strong>
        <p>${r.notes}</p>
      </div>
      `:""}
    </div>
    
    <div class="footer">
      <p>${u.thankYou}</p>
    </div>
  </div>
</body>
</html>
`);return console.log("[Invoice] Invoice generated",{invoiceNumber:v}),{invoiceNumber:v,html:D,createdAt:new Date}}async function r(t,n){console.log("[Invoice] Sending invoice email",{to:t.to,invoiceNumber:t.invoiceNumber});try{let{Resend:n}=await e.A(36043),a=new n(process.env.RESEND_API_KEY||""),r=await a.emails.send({from:process.env.FROM_EMAIL||"bookings@youraitravelagent.com",to:t.to,subject:`Invoice ${t.invoiceNumber} - Your Booking Confirmation`,html:t.invoiceHtml});return console.log("[Invoice] Invoice email sent",{messageId:r.data?.id}),{success:!0,messageId:r.data?.id}}catch(e){return console.error("[Invoice] Failed to send invoice email",e.message),{success:!1,error:e.message}}}async function o(e,t){return console.log("[Invoice] Getting invoice for booking",{bookingId:e.bookingId}),null}async function i(e,t){return console.log("[Invoice] Generating receipt",{bookingId:e.bookingId}),a({bookingId:e.bookingId,hotelName:e.hotelName,roomType:"Standard Room",checkIn:new Date,checkOut:new Date(Date.now()+864e5),totalPrice:e.amount,currency:e.currency,customerName:e.customerName,customerEmail:e.customerEmail,confirmationNumber:e.confirmationNumber,guests:2,paymentStatus:"paid",notes:`Payment ID: ${e.paymentId}`},t)}e.s(["generateInvoice",()=>a,"generateReceipt",()=>i,"getInvoice",()=>o,"invoiceHandlers",0,{generateInvoice:a,sendInvoiceEmail:r,getInvoice:o,generateReceipt:i},"sendInvoiceEmail",()=>r])},611285,e=>{"use strict";let t={skillId:"demand-forecasting",async execute(e,t,i){switch(e){case"get_demand_forecast":return n(t,i);case"get_pricing_recommendations":return a(t,i);case"analyze_seasonality":return r(t,i);case"detect_demand_anomalies":return o(t,i);default:return{success:!1,error:`Unknown tool: ${e}`}}}};async function n(e,t){let n=e.hotelId,a=e.startDate||new Date().toISOString().split("T")[0],r=e.days||30,o=e.roomType;try{let e=[],t=new Date(a);for(let n=0;n<r;n++){let a=new Date(t);a.setDate(a.getDate()+n);let r=a.getDay(),o=a.getMonth(),l=5===r||6===r,d=s(a),u=[],m=65;l&&(m+=15,u.push("weekend"));let p=i(o);m*=p,p>1.1&&u.push("high_season"),p<.9&&u.push("low_season"),d&&(m*=1.3,u.push("holiday"));let g=c(a);g&&(m*=1+g.demandIncrease/100,u.push(`event:${g.name}`));let h=(Math.random()-.5)*10,y=Math.min(100,Math.max(20,m+h)),f=n,v=Math.max(.5,.95-.015*f),b=.5+y/100,k=Math.round(180*b);e.push({date:a.toISOString().split("T")[0],predictedDemand:Math.round(y),confidence:Math.round(100*v)/100,factors:u,recommendedPrice:k,expectedOccupancy:Math.round(y)})}let l=e.reduce((e,t)=>e+t.predictedDemand,0)/e.length,d=e.filter(e=>e.predictedDemand>80),u=e.filter(e=>e.predictedDemand<50);return{success:!0,data:{hotelId:n||"default",roomType:o||"all",forecastPeriod:{start:a,end:e[e.length-1].date,days:r},forecast:e,summary:{averageDemand:Math.round(l),peakDays:d.length,lowDays:u.length,peakDates:d.slice(0,5).map(e=>e.date),lowDates:u.slice(0,5).map(e=>e.date),averageRecommendedPrice:Math.round(e.reduce((e,t)=>e+t.recommendedPrice,0)/e.length)},alerts:[...d.length>7?[{type:"high_demand",message:`${d.length} days with high demand (>80%) in forecast period`,recommendation:"Consider increasing prices or staff"}]:[],...u.length>7?[{type:"low_demand",message:`${u.length} days with low demand (<50%) in forecast period`,recommendation:"Consider promotions or discounts"}]:[]]},message:`Demand forecast generated for ${r} days. Average expected occupancy: ${Math.round(l)}%`}}catch(e){return{success:!1,error:`Failed to generate demand forecast: ${e}`}}}async function a(e,t){let n=e.hotelId,a=e.date||new Date().toISOString().split("T")[0],r=e.roomTypes||["standard","deluxe","suite","family"],o=e.competitorPrices;try{let e=new Date(a),t=e.getDay(),l=e.getMonth(),d=5===t||6===t,u=s(e),m=c(e),p={standard:150,deluxe:220,suite:380,family:280},g=1;d&&(g*=1.15),u&&(g*=1.3),m&&(g*=1+m.demandIncrease/100),g*=i(l);let h=r.map(e=>{var t,n,a,r,i;let s,c=p[e]||180,l=Math.round(c*g),h=Math.round(.8*c),y=Math.round(1.5*c*g),f=o?.[e];return{roomType:e,currentBasePrice:c,recommendedPrice:l,priceRange:{min:h,max:y},demandFactor:Math.round(100*g)/100,competitorPrice:f||null,pricePosition:f?l<f?"below_market":l>f?"above_market":"at_market":"unknown",reasoning:(t=e,n=g,a=d,r=u,i=m,s=[],n>1.2?s.push("High demand conditions justify premium pricing"):n<.9&&s.push("Low demand suggests competitive pricing needed"),a&&s.push("Weekend premium applies (+15%)"),r&&s.push("Holiday period increases willingness to pay (+30%)"),i&&s.push(`${i.name} event drives additional demand (+${i.demandIncrease}%)`),"suite"===t&&s.push("Premium room type commands higher rates"),s),potentialRevenue:{atMinPrice:Math.round(.95*h),atOptimalPrice:Math.round(.75*l),atMaxPrice:Math.round(.5*y)}}});return{success:!0,data:{date:a,hotelId:n||"default",factors:{isWeekend:d,isHoliday:u,event:m?.name||null,seasonalMultiplier:i(l),overallDemandFactor:g},recommendations:h,strategy:g>1.2?"aggressive":g<.9?"promotional":"balanced",insights:[g>1.2?"High demand expected - maximize revenue with premium pricing":g<.9?"Low demand expected - consider promotions to boost occupancy":"Normal demand - maintain competitive pricing",d?"Weekend premium applies":"Weekday rates recommended",m?`Event "${m.name}" increases demand by ${m.demandIncrease}%`:null].filter(Boolean)},message:`Pricing recommendations for ${a}: Strategy "${g>1.2?"aggressive":g<.9?"promotional":"balanced"}" with demand factor ${g.toFixed(2)}`}}catch(e){return{success:!1,error:`Failed to generate pricing recommendations: ${e}`}}}async function r(e,t){let n=e.hotelId,a=e.year||new Date().getFullYear();try{let e=[{period:"January",demandMultiplier:.75,description:"Low season - post-holiday slump"},{period:"February",demandMultiplier:.8,description:"Low season - winter"},{period:"March",demandMultiplier:.95,description:"Spring begins - Purim/Passover prep"},{period:"April",demandMultiplier:1.25,description:"High season - Passover holidays"},{period:"May",demandMultiplier:1.1,description:"Pleasant weather - Independence Day"},{period:"June",demandMultiplier:1.15,description:"Early summer - school holidays begin"},{period:"July",demandMultiplier:1.35,description:"Peak season - summer vacation"},{period:"August",demandMultiplier:1.4,description:"Peak season - summer vacation"},{period:"September",demandMultiplier:1.3,description:"High holidays - Rosh Hashana/Yom Kippur"},{period:"October",demandMultiplier:1.2,description:"Sukkot holidays - pleasant weather"},{period:"November",demandMultiplier:.85,description:"Shoulder season - fall"},{period:"December",demandMultiplier:.9,description:"Hanukkah - moderate demand"}],t=e.reduce((e,t)=>e+t.demandMultiplier,0)/12,r=e.filter(e=>e.demandMultiplier>1.2).map(e=>e.period),o=e.filter(e=>e.demandMultiplier<.85).map(e=>e.period),i=[{name:"Purim",date:`${a}-03-14`,type:"holiday",impactLevel:"medium",demandIncrease:20},{name:"Passover",date:`${a}-04-13`,type:"holiday",impactLevel:"high",demandIncrease:40},{name:"Independence Day",date:`${a}-05-14`,type:"holiday",impactLevel:"high",demandIncrease:35},{name:"Shavuot",date:`${a}-06-02`,type:"holiday",impactLevel:"medium",demandIncrease:25},{name:"Rosh Hashana",date:`${a}-09-16`,type:"holiday",impactLevel:"high",demandIncrease:45},{name:"Yom Kippur",date:`${a}-09-25`,type:"holiday",impactLevel:"medium",demandIncrease:15},{name:"Sukkot",date:`${a}-09-30`,type:"holiday",impactLevel:"high",demandIncrease:40},{name:"Hanukkah",date:`${a}-12-26`,type:"holiday",impactLevel:"medium",demandIncrease:20},{name:"Tel Aviv Marathon",date:`${a}-02-28`,type:"sport",impactLevel:"medium",demandIncrease:25},{name:"DLD Conference",date:`${a}-09-04`,type:"conference",impactLevel:"high",demandIncrease:30}];return{success:!0,data:{year:a,hotelId:n||"default",monthlyPatterns:e,weeklyPatterns:[{day:"Sunday",demandMultiplier:.7,description:"Week start - business travel begins"},{day:"Monday",demandMultiplier:.75,description:"Business travel"},{day:"Tuesday",demandMultiplier:.8,description:"Business travel"},{day:"Wednesday",demandMultiplier:.85,description:"Mid-week peak"},{day:"Thursday",demandMultiplier:.95,description:"Pre-weekend arrivals"},{day:"Friday",demandMultiplier:1.3,description:"Weekend - Shabbat"},{day:"Saturday",demandMultiplier:1.35,description:"Weekend peak - Shabbat"}],statistics:{averageMultiplier:Math.round(100*t)/100,peakMonths:r,lowMonths:o,peakDays:["Friday","Saturday"],lowDays:["Sunday","Monday"],seasonalVariation:Math.round((Math.max(...e.map(e=>e.demandMultiplier))-Math.min(...e.map(e=>e.demandMultiplier)))*100)+"%"},upcomingEvents:i.filter(e=>new Date(e.date)>new Date),recommendations:[`Peak season (${r.join(", ")}): Maximize rates, minimum 3-night stays`,`Low season (${o.join(", ")}): Run promotions, partner with tour operators`,"Friday/Saturday: Premium weekend packages","Sunday-Thursday: Business traveler rates, corporate deals"]},message:`Seasonality analysis for ${a}: Peak months are ${r.join(", ")}, low months are ${o.join(", ")}`}}catch(e){return{success:!1,error:`Failed to analyze seasonality: ${e}`}}}async function o(e,t){let n=e.hotelId,a=e.period||"month",r=e.threshold||20;try{let e=[{date:"2026-01-10",actualDemand:92,expectedDemand:65,deviation:41.5,type:"surge",possibleCauses:["Unplanned event","Competitor outage","Viral social media"],recommendation:"Investigate cause for future planning; consider dynamic pricing"},{date:"2026-01-15",actualDemand:35,expectedDemand:60,deviation:-41.7,type:"drop",possibleCauses:["Bad weather","Negative review impact","Local emergency"],recommendation:"Review recent feedback; check for external factors"},{date:"2026-01-22",actualDemand:88,expectedDemand:70,deviation:25.7,type:"surge",possibleCauses:["Local conference","Sports event nearby"],recommendation:"Add to event calendar for next year"}];return{success:!0,data:{hotelId:n||"default",period:a,threshold:r+"%",anomaliesDetected:e.length,anomalies:e,patterns:{frequentSurges:{count:8,commonDays:["Friday","Saturday"],commonMonths:["July","August","September"]},frequentDrops:{count:5,commonDays:["Sunday","Monday"],commonMonths:["January","February"]}},summary:{totalAnomalies:e.length,surges:e.filter(e=>"surge"===e.type).length,drops:e.filter(e=>"drop"===e.type).length,averageDeviation:Math.round(e.reduce((e,t)=>e+Math.abs(t.deviation),0)/e.length)+"%"},alerts:e.filter(e=>Math.abs(e.deviation)>30).map(e=>({severity:"high",date:e.date,message:`${"surge"===e.type?"Unexpected surge":"Unexpected drop"}: ${e.deviation.toFixed(1)}% deviation`})),recommendations:[e.some(e=>"surge"===e.type)?"Monitor for recurring surge patterns - opportunity for dynamic pricing":null,e.some(e=>"drop"===e.type)?"Investigate drop causes - may indicate operational or marketing issues":null,"Set up automated alerts for deviations > 25%","Review anomaly causes quarterly for forecasting improvement"].filter(Boolean)},message:`Detected ${e.length} demand anomalies in ${a}: ${e.filter(e=>"surge"===e.type).length} surges, ${e.filter(e=>"drop"===e.type).length} drops`}}catch(e){return{success:!1,error:`Failed to detect demand anomalies: ${e}`}}}function i(e){return[.75,.8,.95,1.25,1.1,1.15,1.35,1.4,1.3,1.2,.85,.9][e]}function s(e){return["2026-03-14","2026-04-13","2026-04-14","2026-04-19","2026-04-20","2026-05-14","2026-06-02","2026-09-16","2026-09-17","2026-09-25","2026-09-30","2026-10-01","2026-10-07"].includes(e.toISOString().split("T")[0])}function c(e){return e.toISOString().split("T")[0],[{name:"DLD Tel Aviv",date:"2026-09-04",type:"conference",impactLevel:"high",demandIncrease:30},{name:"Tel Aviv Marathon",date:"2026-02-28",type:"sport",impactLevel:"medium",demandIncrease:25},{name:"Pride Parade",date:"2026-06-12",type:"festival",impactLevel:"high",demandIncrease:40}].find(t=>{let n=new Date(t.date),a=new Date(n);a.setDate(a.getDate()-2);let r=new Date(n);return r.setDate(r.getDate()+1),e>=a&&e<=r})||null}e.s(["default",0,t,"demandForecastingHandler",0,t])},36043,e=>{e.v(t=>Promise.all(["server/chunks/node_modules_@react-email_render_dist_node_index_mjs_46e06865._.js","server/chunks/[root-of-the-server]__7470d4a8._.js"].map(t=>e.l(t))).then(()=>t(246245)))},634873,e=>{e.v(e=>Promise.resolve().then(()=>e(18479)))},85447,e=>{e.v(e=>Promise.resolve().then(()=>e(469216)))},531343,e=>{e.v(e=>Promise.resolve().then(()=>e(650847)))},66192,e=>{e.v(e=>Promise.resolve().then(()=>e(910914)))},183739,e=>{e.v(e=>Promise.resolve().then(()=>e(732682)))},944196,e=>{e.v(e=>Promise.resolve().then(()=>e(717393)))},644577,e=>{e.v(e=>Promise.resolve().then(()=>e(842083)))},33393,e=>{e.v(e=>Promise.resolve().then(()=>e(54005)))},63051,e=>{e.v(e=>Promise.resolve().then(()=>e(251557)))},559426,e=>{e.v(e=>Promise.resolve().then(()=>e(118843)))},170048,e=>{e.v(e=>Promise.resolve().then(()=>e(458870)))},890975,e=>{e.v(e=>Promise.resolve().then(()=>e(429504)))},512780,e=>{e.v(e=>Promise.resolve().then(()=>e(611285)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__1e9fe6f5._.js.map