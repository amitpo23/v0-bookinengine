{"version":3,"sources":["../../../lib/ai-engines/skills.ts","../../../lib/ai-engines/templates.ts","../../../lib/ai-engines/engine-manager.ts"],"sourcesContent":["/**\n * AI Skills Library\n * Collection of skills for AI Booking Engines\n * Based on capabilities from: skills, openai-agents-python, ai-travel-agent-platform\n */\n\nimport type { AISkill, AITool } from './types';\n\n// ========================================\n// BOOKING SKILLS\n// ========================================\n\nexport const hotelSearchSkill: AISkill = {\n  id: 'hotel-search',\n  name: 'Hotel Search',\n  nameHe: '驻砖 转',\n  description: 'Search for available hotels with real-time pricing and availability',\n  descriptionHe: '驻砖 转  注 转专 转  转',\n  category: 'booking',\n  capabilities: ['search'],\n  isEnabled: true,\n  priority: 1,\n  requiredPermissions: ['booking:read'],\n  tools: [\n    {\n      name: 'search_hotels',\n      description: 'Search for available hotel rooms with pricing. Use when user asks about hotel availability, prices, or wants to find accommodation.',\n      parameters: [\n        { name: 'destination', type: 'string', description: 'City or destination name', required: true },\n        { name: 'checkIn', type: 'date', description: 'Check-in date (YYYY-MM-DD)', required: true },\n        { name: 'checkOut', type: 'date', description: 'Check-out date (YYYY-MM-DD)', required: true },\n        { name: 'adults', type: 'number', description: 'Number of adults', required: true, default: 2 },\n        { name: 'children', type: 'array', description: 'Array of children ages', required: false, default: [] },\n        { name: 'stars', type: 'array', description: 'Filter by star rating (1-5)', required: false },\n        { name: 'maxPrice', type: 'number', description: 'Maximum price per night', required: false },\n        { name: 'amenities', type: 'array', description: 'Required amenities', required: false }\n      ],\n      handler: 'lib/ai-engines/handlers/booking.searchHotels',\n      isAsync: true,\n      timeout: 30000,\n      retryConfig: { maxRetries: 3, delayMs: 1000, exponentialBackoff: true }\n    }\n  ]\n};\n\nexport const hotelPrebookSkill: AISkill = {\n  id: 'hotel-prebook',\n  name: 'Hotel Pre-booking',\n  nameHe: ' 拽转',\n  description: 'Pre-book a room to confirm availability and lock the price',\n  descriptionHe: ' 拽转 专 砖专 转 注转 专',\n  category: 'booking',\n  capabilities: ['prebook'],\n  isEnabled: true,\n  priority: 2,\n  requiredPermissions: ['booking:write'],\n  tools: [\n    {\n      name: 'prebook_room',\n      description: 'Pre-book a room to confirm availability before final booking. Use after user selects a specific room.',\n      parameters: [\n        { name: 'roomCode', type: 'string', description: 'Room code from search results', required: true },\n        { name: 'hotelId', type: 'string', description: 'Hotel ID from search results', required: true },\n        { name: 'checkIn', type: 'date', description: 'Check-in date', required: true },\n        { name: 'checkOut', type: 'date', description: 'Check-out date', required: true },\n        { name: 'guests', type: 'object', description: 'Guest configuration { adults, children }', required: true }\n      ],\n      handler: 'lib/ai-engines/handlers/booking.prebookRoom',\n      isAsync: true,\n      timeout: 30000\n    }\n  ]\n};\n\nexport const hotelBookingSkill: AISkill = {\n  id: 'hotel-booking',\n  name: 'Hotel Booking',\n  nameHe: '转 ',\n  description: 'Complete hotel booking with customer details and payment',\n  descriptionHe: '砖转 转  注 驻专 拽 转砖',\n  category: 'booking',\n  capabilities: ['booking'],\n  isEnabled: true,\n  priority: 3,\n  requiredPermissions: ['booking:write', 'payment:process'],\n  tools: [\n    {\n      name: 'book_room',\n      description: 'Complete the booking with customer details. Use only after pre-booking and when you have all customer information.',\n      parameters: [\n        { name: 'token', type: 'string', description: 'Token from pre-book response', required: true },\n        { name: 'roomCode', type: 'string', description: 'Room code', required: true },\n        { name: 'customer', type: 'object', description: 'Customer details { firstName, lastName, email, phone, address }', required: true },\n        { name: 'guests', type: 'array', description: 'Guest list with names', required: true },\n        { name: 'specialRequests', type: 'string', description: 'Special requests', required: false }\n      ],\n      handler: 'lib/ai-engines/handlers/booking.bookRoom',\n      isAsync: true,\n      timeout: 60000\n    }\n  ]\n};\n\nexport const bookingCancellationSkill: AISkill = {\n  id: 'booking-cancellation',\n  name: 'Booking Cancellation',\n  nameHe: ' ',\n  description: 'Cancel existing bookings with policy information',\n  descriptionHe: ' 转 拽转 注 注 注 转 ',\n  category: 'booking',\n  capabilities: ['cancellation'],\n  isEnabled: true,\n  priority: 4,\n  requiredPermissions: ['booking:cancel'],\n  tools: [\n    {\n      name: 'cancel_booking',\n      description: 'Cancel an existing booking. Requires confirmation from customer.',\n      parameters: [\n        { name: 'bookingId', type: 'string', description: 'Booking confirmation number', required: true },\n        { name: 'reason', type: 'string', description: 'Cancellation reason', required: false },\n        { name: 'force', type: 'boolean', description: 'Force cancellation even with penalties', required: false, default: false }\n      ],\n      handler: 'lib/ai-engines/handlers/booking.cancelBooking',\n      isAsync: true,\n      timeout: 30000\n    },\n    {\n      name: 'get_cancellation_policy',\n      description: 'Get cancellation policy and potential penalties for a booking.',\n      parameters: [\n        { name: 'bookingId', type: 'string', description: 'Booking confirmation number', required: true }\n      ],\n      handler: 'lib/ai-engines/handlers/booking.getCancellationPolicy',\n      isAsync: true\n    }\n  ]\n};\n\n// ========================================\n// PRICE MONITORING SKILLS\n// ========================================\n\nexport const priceMonitoringSkill: AISkill = {\n  id: 'price-monitoring',\n  name: 'Price Monitoring',\n  nameHe: '注拽 专',\n  description: 'Monitor and track hotel prices over time, detect price drops',\n  descriptionHe: '注拽 专 专 转 专 ,  专转 专',\n  category: 'analysis',\n  capabilities: ['price-monitoring', 'analytics'],\n  isEnabled: true,\n  priority: 5,\n  requiredPermissions: ['monitoring:read', 'monitoring:write'],\n  tools: [\n    {\n      name: 'track_hotel_price',\n      description: 'Start tracking price for a specific hotel and date range.',\n      parameters: [\n        { name: 'hotelUrl', type: 'string', description: 'Hotel URL (Booking.com)', required: true },\n        { name: 'checkIn', type: 'date', description: 'Check-in date', required: true },\n        { name: 'checkOut', type: 'date', description: 'Check-out date', required: true },\n        { name: 'targetPrice', type: 'number', description: 'Alert when price drops below', required: false },\n        { name: 'notifyEmail', type: 'string', description: 'Email for price alerts', required: false }\n      ],\n      handler: 'lib/ai-engines/handlers/monitoring.trackHotelPrice',\n      isAsync: true\n    },\n    {\n      name: 'get_price_history',\n      description: 'Get historical price data for a hotel.',\n      parameters: [\n        { name: 'hotelId', type: 'string', description: 'Hotel ID', required: true },\n        { name: 'dateFrom', type: 'date', description: 'Start date for history', required: true },\n        { name: 'dateTo', type: 'date', description: 'End date for history', required: true }\n      ],\n      handler: 'lib/ai-engines/handlers/monitoring.getPriceHistory',\n      isAsync: true\n    },\n    {\n      name: 'analyze_price_trends',\n      description: 'Analyze price trends and predict best booking time.',\n      parameters: [\n        { name: 'hotelId', type: 'string', description: 'Hotel ID', required: true },\n        { name: 'travelDates', type: 'object', description: 'Travel date range { from, to }', required: true }\n      ],\n      handler: 'lib/ai-engines/handlers/monitoring.analyzePriceTrends',\n      isAsync: true\n    }\n  ]\n};\n\n// ========================================\n// COMMUNICATION SKILLS\n// ========================================\n\nexport const voiceInteractionSkill: AISkill = {\n  id: 'voice-interaction',\n  name: 'Voice Interaction',\n  nameHe: '专拽爪 拽转',\n  description: 'Handle voice calls with speech-to-text and text-to-speech',\n  descriptionHe: '驻 砖转 拽转 注 专转 专 拽住 拽住 专',\n  category: 'communication',\n  capabilities: ['voice-interaction', 'real-time-streaming'],\n  isEnabled: true,\n  priority: 1,\n  requiredPermissions: ['voice:read', 'voice:write'],\n  tools: [\n    {\n      name: 'initiate_call',\n      description: 'Initiate an outbound phone call to customer.',\n      parameters: [\n        { name: 'phoneNumber', type: 'string', description: 'Phone number to call (E.164 format)', required: true },\n        { name: 'purpose', type: 'string', description: 'Call purpose/script', required: true },\n        { name: 'language', type: 'string', description: 'Call language', required: false, default: 'he-IL' }\n      ],\n      handler: 'lib/ai-engines/handlers/voice.initiateCall',\n      isAsync: true,\n      timeout: 120000\n    },\n    {\n      name: 'transfer_to_human',\n      description: 'Transfer the call to a human agent.',\n      parameters: [\n        { name: 'reason', type: 'string', description: 'Transfer reason', required: true },\n        { name: 'agentQueue', type: 'string', description: 'Target agent queue', required: false }\n      ],\n      handler: 'lib/ai-engines/handlers/voice.transferToHuman',\n      isAsync: true\n    },\n    {\n      name: 'send_call_summary_sms',\n      description: 'Send SMS summary after call ends.',\n      parameters: [\n        { name: 'phoneNumber', type: 'string', description: 'Phone number', required: true },\n        { name: 'summary', type: 'string', description: 'Call summary text', required: true }\n      ],\n      handler: 'lib/ai-engines/handlers/voice.sendCallSummarySms',\n      isAsync: true\n    }\n  ]\n};\n\nexport const smsIntegrationSkill: AISkill = {\n  id: 'sms-integration',\n  name: 'SMS Integration',\n  nameHe: '专爪转 SMS',\n  description: 'Send and receive SMS messages for booking confirmations and updates',\n  descriptionHe: '砖 拽转 注转 SMS 砖专 转 注',\n  category: 'communication',\n  capabilities: ['sms-integration'],\n  isEnabled: true,\n  priority: 2,\n  requiredPermissions: ['sms:send'],\n  tools: [\n    {\n      name: 'send_sms',\n      description: 'Send SMS message to customer.',\n      parameters: [\n        { name: 'phoneNumber', type: 'string', description: 'Phone number (E.164)', required: true },\n        { name: 'message', type: 'string', description: 'Message content', required: true },\n        { name: 'template', type: 'string', description: 'Template ID', required: false }\n      ],\n      handler: 'lib/ai-engines/handlers/sms.sendSms',\n      isAsync: true\n    },\n    {\n      name: 'send_booking_confirmation_sms',\n      description: 'Send booking confirmation SMS with details.',\n      parameters: [\n        { name: 'bookingId', type: 'string', description: 'Booking ID', required: true },\n        { name: 'phoneNumber', type: 'string', description: 'Phone number', required: true }\n      ],\n      handler: 'lib/ai-engines/handlers/sms.sendBookingConfirmation',\n      isAsync: true\n    }\n  ]\n};\n\nexport const emailIntegrationSkill: AISkill = {\n  id: 'email-integration',\n  name: 'Email Integration',\n  nameHe: '专爪转 ',\n  description: 'Send booking confirmations and marketing emails',\n  descriptionHe: '砖转 砖专 转  砖拽',\n  category: 'communication',\n  capabilities: ['email-integration'],\n  isEnabled: true,\n  priority: 3,\n  requiredPermissions: ['email:send'],\n  tools: [\n    {\n      name: 'send_booking_email',\n      description: 'Send booking confirmation email.',\n      parameters: [\n        { name: 'bookingId', type: 'string', description: 'Booking ID', required: true },\n        { name: 'recipientEmail', type: 'string', description: 'Recipient email', required: true }\n      ],\n      handler: 'lib/ai-engines/handlers/email.sendBookingEmail',\n      isAsync: true\n    },\n    {\n      name: 'send_cancellation_email',\n      description: 'Send cancellation confirmation email.',\n      parameters: [\n        { name: 'bookingId', type: 'string', description: 'Booking ID', required: true },\n        { name: 'recipientEmail', type: 'string', description: 'Recipient email', required: true }\n      ],\n      handler: 'lib/ai-engines/handlers/email.sendCancellationEmail',\n      isAsync: true\n    }\n  ]\n};\n\n// ========================================\n// RESEARCH & ANALYSIS SKILLS\n// ========================================\n\nexport const webSearchSkill: AISkill = {\n  id: 'web-search',\n  name: 'Web Search',\n  nameHe: '驻砖 专',\n  description: 'Search the web for travel information, reviews, and recommendations',\n  descriptionHe: '驻砖 专 注 注 住注转, 拽专转 爪转',\n  category: 'research',\n  capabilities: ['web-search'],\n  isEnabled: true,\n  priority: 1,\n  requiredPermissions: ['search:web'],\n  tools: [\n    {\n      name: 'search_web',\n      description: 'Search the web for travel-related information.',\n      parameters: [\n        { name: 'query', type: 'string', description: 'Search query', required: true },\n        { name: 'type', type: 'string', description: 'Search type: general, news, reviews', required: false, default: 'general' },\n        { name: 'limit', type: 'number', description: 'Number of results', required: false, default: 5 }\n      ],\n      handler: 'lib/ai-engines/handlers/research.searchWeb',\n      isAsync: true\n    },\n    {\n      name: 'get_destination_info',\n      description: 'Get comprehensive information about a travel destination.',\n      parameters: [\n        { name: 'destination', type: 'string', description: 'Destination name', required: true },\n        { name: 'topics', type: 'array', description: 'Topics: weather, attractions, safety, cuisine', required: false }\n      ],\n      handler: 'lib/ai-engines/handlers/research.getDestinationInfo',\n      isAsync: true\n    }\n  ]\n};\n\nexport const knowledgeBaseSkill: AISkill = {\n  id: 'knowledge-base',\n  name: 'Knowledge Base',\n  nameHe: '住住 注',\n  description: 'Retrieve information from internal knowledge base using RAG',\n  descriptionHe: '专 注 住住 注 驻 爪注转 RAG',\n  category: 'research',\n  capabilities: ['rag-retrieval', 'knowledge-base'],\n  isEnabled: true,\n  priority: 2,\n  requiredPermissions: ['knowledge:read'],\n  tools: [\n    {\n      name: 'search_knowledge_base',\n      description: 'Search internal knowledge base for relevant information.',\n      parameters: [\n        { name: 'query', type: 'string', description: 'Search query', required: true },\n        { name: 'category', type: 'string', description: 'Knowledge category', required: false },\n        { name: 'topK', type: 'number', description: 'Number of results', required: false, default: 5 }\n      ],\n      handler: 'lib/ai-engines/handlers/knowledge.searchKnowledgeBase',\n      isAsync: true\n    },\n    {\n      name: 'get_faq_answer',\n      description: 'Get answer to frequently asked question.',\n      parameters: [\n        { name: 'question', type: 'string', description: 'The question', required: true }\n      ],\n      handler: 'lib/ai-engines/handlers/knowledge.getFaqAnswer',\n      isAsync: true\n    }\n  ]\n};\n\nexport const marketAnalysisSkill: AISkill = {\n  id: 'market-analysis',\n  name: 'Market Analysis',\n  nameHe: '转 砖拽',\n  description: 'Analyze hotel market, competition, and pricing trends',\n  descriptionHe: '转 砖拽 转, 转专转 转 转专',\n  category: 'analysis',\n  capabilities: ['analytics'],\n  isEnabled: true,\n  priority: 3,\n  requiredPermissions: ['analytics:read'],\n  tools: [\n    {\n      name: 'analyze_competition',\n      description: 'Analyze competitor hotels and their pricing.',\n      parameters: [\n        { name: 'hotelId', type: 'string', description: 'Target hotel ID', required: true },\n        { name: 'radius', type: 'number', description: 'Radius in km', required: false, default: 5 }\n      ],\n      handler: 'lib/ai-engines/handlers/analysis.analyzeCompetition',\n      isAsync: true\n    },\n    {\n      name: 'get_seasonality_insights',\n      description: 'Get seasonality and demand insights for a destination.',\n      parameters: [\n        { name: 'destination', type: 'string', description: 'Destination', required: true },\n        { name: 'year', type: 'number', description: 'Year', required: false }\n      ],\n      handler: 'lib/ai-engines/handlers/analysis.getSeasonalityInsights',\n      isAsync: true\n    },\n    {\n      name: 'get_upcoming_events',\n      description: 'Get upcoming events that may affect hotel demand.',\n      parameters: [\n        { name: 'destination', type: 'string', description: 'Destination', required: true },\n        { name: 'dateRange', type: 'object', description: 'Date range { from, to }', required: true }\n      ],\n      handler: 'lib/ai-engines/handlers/analysis.getUpcomingEvents',\n      isAsync: true\n    }\n  ]\n};\n\n// ========================================\n// PERSONALIZATION SKILLS\n// ========================================\n\nexport const userPreferencesSkill: AISkill = {\n  id: 'user-preferences',\n  name: 'User Preferences',\n  nameHe: '注驻转 砖转砖',\n  description: 'Learn and apply user preferences for personalized recommendations',\n  descriptionHe: ' 砖 注驻转 砖转砖 爪转 转转 砖转',\n  category: 'personalization',\n  capabilities: ['analytics'],\n  isEnabled: true,\n  priority: 1,\n  requiredPermissions: ['user:read', 'user:write'],\n  tools: [\n    {\n      name: 'get_user_preferences',\n      description: 'Get stored user preferences.',\n      parameters: [\n        { name: 'userId', type: 'string', description: 'User ID', required: true }\n      ],\n      handler: 'lib/ai-engines/handlers/personalization.getUserPreferences',\n      isAsync: true\n    },\n    {\n      name: 'update_user_preferences',\n      description: 'Update user preferences based on interactions.',\n      parameters: [\n        { name: 'userId', type: 'string', description: 'User ID', required: true },\n        { name: 'preferences', type: 'object', description: 'Preferences to update', required: true }\n      ],\n      handler: 'lib/ai-engines/handlers/personalization.updateUserPreferences',\n      isAsync: true\n    },\n    {\n      name: 'get_personalized_recommendations',\n      description: 'Get hotel recommendations based on user preferences and history.',\n      parameters: [\n        { name: 'userId', type: 'string', description: 'User ID', required: true },\n        { name: 'destination', type: 'string', description: 'Destination', required: true },\n        { name: 'dates', type: 'object', description: 'Travel dates', required: true }\n      ],\n      handler: 'lib/ai-engines/handlers/personalization.getRecommendations',\n      isAsync: true\n    }\n  ]\n};\n\nexport const loyaltyProgramSkill: AISkill = {\n  id: 'loyalty-program',\n  name: 'Loyalty Program',\n  nameHe: '转转 转',\n  description: 'Manage loyalty points, rewards, and member benefits',\n  descriptionHe: ' 拽转 转, 转 转 专',\n  category: 'personalization',\n  capabilities: ['analytics'],\n  isEnabled: true,\n  priority: 2,\n  requiredPermissions: ['loyalty:read', 'loyalty:write'],\n  tools: [\n    {\n      name: 'get_loyalty_balance',\n      description: 'Get loyalty points balance and tier status.',\n      parameters: [\n        { name: 'userId', type: 'string', description: 'User ID', required: true }\n      ],\n      handler: 'lib/ai-engines/handlers/loyalty.getLoyaltyBalance',\n      isAsync: true\n    },\n    {\n      name: 'redeem_points',\n      description: 'Redeem loyalty points for rewards.',\n      parameters: [\n        { name: 'userId', type: 'string', description: 'User ID', required: true },\n        { name: 'points', type: 'number', description: 'Points to redeem', required: true },\n        { name: 'rewardType', type: 'string', description: 'Reward type', required: true }\n      ],\n      handler: 'lib/ai-engines/handlers/loyalty.redeemPoints',\n      isAsync: true\n    },\n    {\n      name: 'apply_member_discount',\n      description: 'Apply member discount to booking.',\n      parameters: [\n        { name: 'bookingId', type: 'string', description: 'Booking ID', required: true },\n        { name: 'userId', type: 'string', description: 'User ID', required: true }\n      ],\n      handler: 'lib/ai-engines/handlers/loyalty.applyMemberDiscount',\n      isAsync: true\n    }\n  ]\n};\n\n// ========================================\n// EXPORT ALL SKILLS\n// ========================================\n\nexport const allSkills: AISkill[] = [\n  // Booking\n  hotelSearchSkill,\n  hotelPrebookSkill,\n  hotelBookingSkill,\n  bookingCancellationSkill,\n  // Price Monitoring\n  priceMonitoringSkill,\n  // Communication\n  voiceInteractionSkill,\n  smsIntegrationSkill,\n  emailIntegrationSkill,\n  // Research & Analysis\n  webSearchSkill,\n  knowledgeBaseSkill,\n  marketAnalysisSkill,\n  // Personalization\n  userPreferencesSkill,\n  loyaltyProgramSkill\n];\n\nexport const getSkillById = (id: string): AISkill | undefined => {\n  return allSkills.find(skill => skill.id === id);\n};\n\nexport const getSkillsByCategory = (category: string): AISkill[] => {\n  return allSkills.filter(skill => skill.category === category);\n};\n\nexport const getEnabledSkills = (): AISkill[] => {\n  return allSkills.filter(skill => skill.isEnabled);\n};\n","/**\n * AI Engine Templates\n * Pre-configured engine templates for different booking scenarios\n */\n\nimport type { AIEngineTemplate, AIEngineType } from './types';\nimport {\n  hotelSearchSkill,\n  hotelPrebookSkill,\n  hotelBookingSkill,\n  bookingCancellationSkill,\n  priceMonitoringSkill,\n  voiceInteractionSkill,\n  smsIntegrationSkill,\n  emailIntegrationSkill,\n  webSearchSkill,\n  knowledgeBaseSkill,\n  marketAnalysisSkill,\n  userPreferencesSkill,\n  loyaltyProgramSkill\n} from './skills';\n\n// ========================================\n// HOTEL BOOKING ENGINE\n// Full-featured hotel booking agent\n// ========================================\n\nexport const hotelBookingEngineTemplate: AIEngineTemplate = {\n  id: 'hotel-booking-engine',\n  type: 'hotel-booking',\n  name: 'Hotel Booking Engine',\n  nameHe: '注 转 ',\n  description: 'Complete hotel booking agent with search, prebook, and booking capabilities',\n  descriptionHe: '住 转   注 转 驻砖,  拽转 ',\n  version: '1.0.0',\n  skills: [hotelSearchSkill, hotelPrebookSkill, hotelBookingSkill, bookingCancellationSkill, emailIntegrationSkill],\n  capabilities: ['search', 'prebook', 'booking', 'cancellation', 'email-integration'],\n  modelConfig: {\n    provider: 'groq',\n    model: 'llama-3.3-70b-versatile',\n    temperature: 0.7,\n    maxTokens: 4096,\n    topP: 0.9\n  },\n  persona: {\n    name: 'Alex',\n    nameHe: '住',\n    role: 'Senior Booking Agent',\n    roleHe: '住 转 专',\n    personality: ['professional', 'helpful', 'efficient', 'knowledgeable'],\n    communicationStyle: 'friendly-professional',\n    expertise: ['hotel bookings', 'travel planning', 'customer service', 'negotiation'],\n    languages: ['en', 'he', 'ar']\n  },\n  prompts: {\n    systemPrompt: `You are Alex, a senior hotel booking agent. Your role is to help customers find and book the perfect hotel accommodations.\n\nCORE RESPONSIBILITIES:\n1. Search for hotels based on customer requirements\n2. Present options clearly with pricing and key features\n3. Guide customers through the booking process\n4. Handle special requests and preferences\n5. Provide cancellation and modification assistance\n\nBOOKING FLOW:\n1. Gather requirements: destination, dates, guests, preferences\n2. Search for available hotels using search_hotels\n3. Present top 3-5 options with key details\n4. When customer selects, use prebook_room to confirm availability\n5. Collect customer details and complete booking with book_room\n6. Send confirmation email\n\nGUIDELINES:\n- Always confirm dates and guest count before searching\n- Present prices clearly in the customer's preferred currency\n- Highlight included amenities and cancellation policies\n- Be proactive about loyalty discounts and promotions\n- Escalate complex issues to human agents\n\nLANGUAGE: Respond in the same language the customer uses.`,\n    systemPromptHe: `转 住, 住 转  专. 转驻拽 注专 拽转 爪  转  砖.\n\n转 专转:\n1. 驻砖 转 驻 专砖转 拽\n2. 爪转 驻砖专转 专专 注 专 转转\n3.  拽转 转 \n4. 驻 拽砖转 转\n5. 住注  砖\n\n转:\n- 转 砖专 转专 住驻专 专 驻 驻砖\n- 爪 专 专专\n- 砖 转 \n- 爪注 转 转 爪注`,\n    greetingMessage: `Hello! I'm Alex, your booking assistant. How can I help you find the perfect hotel today?`,\n    greetingMessageHe: `砖!  住, 注专 转 砖.   注专  爪 转  砖?`,\n    errorMessages: {\n      noResults: 'I couldn\\'t find any hotels matching your criteria. Would you like to adjust your dates or try a different destination?',\n      bookingFailed: 'There was an issue completing your booking. Let me try again or connect you with a specialist.',\n      timeout: 'The search is taking longer than expected. Please wait a moment.',\n      general: 'Something went wrong. Let me help you with that.'\n    }\n  },\n  config: {\n    maxConversationTurns: 50,\n    contextWindowSize: 20,\n    enableMemory: true,\n    enableLogging: true,\n    logLevel: 'info',\n    enableAnalytics: true,\n    responseTimeout: 30000,\n    autoSave: true\n  },\n  integrations: {\n    crm: {\n      enabled: true,\n      provider: 'supabase',\n      syncCustomers: true,\n      syncBookings: true\n    },\n    payment: {\n      enabled: true,\n      provider: 'stripe',\n      supportedMethods: ['card', 'apple_pay', 'google_pay']\n    },\n    analytics: {\n      enabled: true,\n      provider: 'custom',\n      trackConversations: true,\n      trackBookings: true\n    }\n  }\n};\n\n// ========================================\n// TRAVEL AGENT ENGINE\n// Full-service travel planning agent\n// ========================================\n\nexport const travelAgentEngineTemplate: AIEngineTemplate = {\n  id: 'travel-agent-engine',\n  type: 'travel-agent',\n  name: 'Travel Agent Engine',\n  nameHe: '注 住 住注转',\n  description: 'Comprehensive travel planning with destination expertise and personalized recommendations',\n  descriptionHe: '转 住注转 拽祝 注 转 注 爪转 转转 砖转',\n  version: '1.0.0',\n  skills: [\n    hotelSearchSkill,\n    hotelPrebookSkill,\n    hotelBookingSkill,\n    webSearchSkill,\n    knowledgeBaseSkill,\n    userPreferencesSkill,\n    loyaltyProgramSkill,\n    emailIntegrationSkill\n  ],\n  capabilities: ['search', 'prebook', 'booking', 'web-search', 'rag-retrieval', 'analytics'],\n  modelConfig: {\n    provider: 'groq',\n    model: 'llama-3.3-70b-versatile',\n    temperature: 0.8,\n    maxTokens: 4096,\n    topP: 0.95\n  },\n  persona: {\n    name: 'Maya',\n    nameHe: '',\n    role: 'Travel Expert',\n    roleHe: '转 住注转',\n    personality: ['enthusiastic', 'knowledgeable', 'creative', 'adventurous'],\n    communicationStyle: 'warm-engaging',\n    expertise: ['destination planning', 'local experiences', 'cultural insights', 'travel tips'],\n    languages: ['en', 'he', 'es', 'fr']\n  },\n  prompts: {\n    systemPrompt: `You are Maya, an experienced travel expert with deep knowledge of destinations worldwide.\n\nYOUR MISSION:\nHelp travelers create unforgettable experiences by providing personalized recommendations, insider tips, and seamless booking assistance.\n\nEXPERTISE AREAS:\n- Destination knowledge: local customs, best seasons, hidden gems\n- Accommodation matching: finding the perfect hotel for each traveler\n- Experience planning: activities, restaurants, cultural events\n- Budget optimization: getting the most value for every trip\n\nCONVERSATION APPROACH:\n1. Understand the traveler's style (adventure, relaxation, culture, family)\n2. Learn about their preferences and past experiences\n3. Provide tailored destination recommendations\n4. Share insider tips and local knowledge\n5. Help book accommodations that match their style\n6. Create a personalized trip overview\n\nPERSONALITY:\n- Share personal travel stories when relevant\n- Be enthusiastic about destinations\n- Offer creative and unique suggestions\n- Consider sustainability and responsible travel\n\nRemember to use web search for current events, weather, and local happenings.`,\n    greetingMessage: `Hi there! I'm Maya, your travel expert. I absolutely love helping people discover amazing destinations. Whether you're dreaming of pristine beaches, mountain adventures, or vibrant city escapes - I'm here to make it happen! \n\nWhat kind of travel experience are you looking for?`,\n    greetingMessageHe: `!  , 转 住注转 砖.  驻砖 转 注专 砖 转 注 .   转  注 驻, 专驻转拽转 专  专 注专 转住住转 -   专  拽专转! \n\n 住 转  注 转?`\n  },\n  config: {\n    maxConversationTurns: 100,\n    contextWindowSize: 30,\n    enableMemory: true,\n    enableLogging: true,\n    logLevel: 'info',\n    enableAnalytics: true\n  }\n};\n\n// ========================================\n// CONCIERGE ENGINE\n// Hotel concierge for in-stay assistance\n// ========================================\n\nexport const conciergeEngineTemplate: AIEngineTemplate = {\n  id: 'concierge-engine',\n  type: 'concierge',\n  name: 'Hotel Concierge Engine',\n  nameHe: '注 拽住专\\'',\n  description: 'In-stay hotel concierge for guest services and local recommendations',\n  descriptionHe: '拽住专\\'  砖专转 专 爪转 拽转',\n  version: '1.0.0',\n  skills: [webSearchSkill, knowledgeBaseSkill, smsIntegrationSkill, userPreferencesSkill],\n  capabilities: ['web-search', 'rag-retrieval', 'sms-integration'],\n  modelConfig: {\n    provider: 'groq',\n    model: 'llama-3.3-70b-versatile',\n    temperature: 0.6,\n    maxTokens: 2048\n  },\n  persona: {\n    name: 'James',\n    nameHe: '\\'住',\n    role: 'Head Concierge',\n    roleHe: '专砖 拽住专\\'',\n    personality: ['sophisticated', 'attentive', 'resourceful', 'discrete'],\n    communicationStyle: 'formal-elegant',\n    expertise: ['local dining', 'entertainment', 'transportation', 'special requests'],\n    languages: ['en', 'he', 'fr', 'it', 'de']\n  },\n  prompts: {\n    systemPrompt: `You are James, the head concierge at a luxury hotel. You provide impeccable service and have extensive local knowledge.\n\nSERVICES YOU PROVIDE:\n- Restaurant reservations and recommendations\n- Transportation arrangements\n- Entertainment and event tickets\n- Local tours and experiences\n- Special occasion arrangements\n- Room service coordination\n- Guest requests and amenities\n\nSTANDARDS:\n- Maintain the highest level of professionalism\n- Anticipate guest needs before they ask\n- Know the best local establishments personally\n- Handle all requests with discretion\n- Provide multiple options when possible\n\nCOMMUNICATION STYLE:\n- Formal yet warm\n- Never say \"no\" - always offer alternatives\n- Confirm all arrangements in detail\n- Follow up on guest satisfaction`,\n    greetingMessage: `Good day. I'm James, your concierge. It's my pleasure to assist you during your stay. How may I be of service?`,\n    greetingMessageHe: ` .  '住, 拽住专' 砖.  砖转 住注   砖.   注专?`\n  }\n};\n\n// ========================================\n// VOICE AGENT ENGINE\n// Voice-enabled booking agent\n// ========================================\n\nexport const voiceAgentEngineTemplate: AIEngineTemplate = {\n  id: 'voice-agent-engine',\n  type: 'voice-agent',\n  name: 'Voice Booking Agent',\n  nameHe: '住 转 拽',\n  description: 'Voice-enabled agent for phone-based hotel bookings',\n  descriptionHe: '住 拽 转  驻转',\n  version: '1.0.0',\n  skills: [hotelSearchSkill, hotelPrebookSkill, hotelBookingSkill, voiceInteractionSkill, smsIntegrationSkill],\n  capabilities: ['search', 'prebook', 'booking', 'voice-interaction', 'sms-integration'],\n  modelConfig: {\n    provider: 'openai',\n    model: 'gpt-4o-realtime',\n    temperature: 0.7,\n    maxTokens: 1024\n  },\n  persona: {\n    name: 'Sam',\n    nameHe: '住',\n    role: 'Voice Booking Specialist',\n    roleHe: ' 转 拽',\n    personality: ['clear', 'patient', 'efficient', 'friendly'],\n    communicationStyle: 'conversational-clear',\n    expertise: ['phone bookings', 'audio clarity', 'efficient communication'],\n    languages: ['en', 'he']\n  },\n  prompts: {\n    systemPrompt: `You are Sam, a voice booking specialist. You handle phone calls for hotel reservations.\n\nVOICE INTERACTION GUIDELINES:\n1. Speak clearly and at a moderate pace\n2. Confirm information by repeating back key details\n3. Use phonetic spelling for names and confirmation numbers\n4. Break down complex information into digestible parts\n5. Allow pauses for customer responses\n\nCALL FLOW:\n1. Greet warmly and identify yourself\n2. Determine if new booking, modification, or cancellation\n3. Gather requirements step by step\n4. Confirm all details before proceeding\n5. Provide confirmation number clearly\n6. Offer to send SMS summary\n\nAUDIO CONSIDERATIONS:\n- Keep sentences short\n- Avoid jargon\n- Spell out important codes: \"That's B as in Bravo, O as in Oscar...\"\n- Always confirm numbers: \"That's 972-50-1234567, correct?\"\n\nEnd calls with clear next steps and gratitude.`,\n    greetingMessage: `Thank you for calling! This is Sam, your booking assistant. How can I help you today?`,\n    greetingMessageHe: `转 砖转拽砖专转!  住, 注专 转 砖.   注专  ?`\n  },\n  voice: {\n    enabled: true,\n    provider: 'azure',\n    sttLanguage: 'he-IL',\n    ttsVoice: 'he-IL-HilaNeural',\n    interimResults: true,\n    vadSensitivity: 0.5,\n    silenceTimeout: 2000\n  }\n};\n\n// ========================================\n// PRICE MONITOR ENGINE\n// Automated price tracking agent\n// ========================================\n\nexport const priceMonitorEngineTemplate: AIEngineTemplate = {\n  id: 'price-monitor-engine',\n  type: 'price-monitor',\n  name: 'Price Monitor Engine',\n  nameHe: '注 注拽 专',\n  description: 'Automated price monitoring with alerts and trend analysis',\n  descriptionHe: '注拽 专  注 转专转 转 转',\n  version: '1.0.0',\n  skills: [priceMonitoringSkill, marketAnalysisSkill, emailIntegrationSkill, smsIntegrationSkill],\n  capabilities: ['price-monitoring', 'analytics', 'email-integration', 'sms-integration'],\n  modelConfig: {\n    provider: 'groq',\n    model: 'llama-3.1-8b-instant',\n    temperature: 0.3,\n    maxTokens: 2048\n  },\n  persona: {\n    name: 'Atlas',\n    nameHe: '住',\n    role: 'Price Analyst',\n    roleHe: '住 专',\n    personality: ['analytical', 'precise', 'data-driven', 'proactive'],\n    communicationStyle: 'informative-concise',\n    expertise: ['price analysis', 'market trends', 'deal detection', 'timing optimization']\n  },\n  prompts: {\n    systemPrompt: `You are Atlas, a price monitoring specialist. You track hotel prices and help users book at the best time.\n\nCAPABILITIES:\n1. Track prices for specific hotels and dates\n2. Analyze historical pricing patterns\n3. Predict optimal booking windows\n4. Alert users to significant price drops\n5. Compare prices across multiple properties\n\nDATA-DRIVEN INSIGHTS:\n- Present data clearly with percentages and comparisons\n- Identify patterns: weekday vs weekend, seasonal trends\n- Factor in events that affect pricing\n- Consider cancellation policy value in pricing\n\nALERTS:\n- Immediate alert for drops > 15%\n- Daily summary for tracked hotels\n- Weekly trend reports\n- Expiring deal notifications\n\nBe concise and factual. Present numbers clearly.`,\n    greetingMessage: `Hello! I'm Atlas, your price monitoring assistant. I can help you track hotel prices and find the best deals. What would you like to monitor?`,\n    greetingMessageHe: `砖!  住, 注专 注拽 专 砖.   注专  注拽 专 专 转 爪 转 注住拽转 转 转专.  转专爪 注拽?`\n  }\n};\n\n// ========================================\n// SUPPORT AGENT ENGINE\n// Customer support and issue resolution\n// ========================================\n\nexport const supportAgentEngineTemplate: AIEngineTemplate = {\n  id: 'support-agent-engine',\n  type: 'support-agent',\n  name: 'Customer Support Engine',\n  nameHe: '注 转转 拽转',\n  description: 'Customer support agent for booking issues, complaints, and inquiries',\n  descriptionHe: '住 转转 拽转 注转 , 转转 专专',\n  version: '1.0.0',\n  skills: [bookingCancellationSkill, knowledgeBaseSkill, emailIntegrationSkill, smsIntegrationSkill],\n  capabilities: ['cancellation', 'rag-retrieval', 'email-integration', 'sms-integration'],\n  modelConfig: {\n    provider: 'groq',\n    model: 'llama-3.3-70b-versatile',\n    temperature: 0.5,\n    maxTokens: 2048\n  },\n  persona: {\n    name: 'Sophie',\n    nameHe: '住驻',\n    role: 'Customer Support Specialist',\n    roleHe: '转 转转 拽转',\n    personality: ['empathetic', 'patient', 'solution-oriented', 'calm'],\n    communicationStyle: 'understanding-helpful',\n    expertise: ['issue resolution', 'policy expertise', 'de-escalation', 'customer advocacy'],\n    languages: ['en', 'he', 'ar', 'ru']\n  },\n  prompts: {\n    systemPrompt: `You are Sophie, a customer support specialist. You handle booking issues with empathy and efficiency.\n\nISSUE HANDLING PRIORITIES:\n1. Acknowledge the customer's concern immediately\n2. Apologize sincerely when appropriate\n3. Take ownership of the issue\n4. Find the best possible solution\n5. Follow up to ensure satisfaction\n\nCOMMON ISSUES:\n- Booking modifications and cancellations\n- Refund requests and processing\n- Complaint resolution\n- Policy clarification\n- Escalation to hotel/management\n\nCOMMUNICATION APPROACH:\n- Always validate the customer's feelings\n- Never be defensive\n- Offer solutions, not excuses\n- Be transparent about limitations\n- Under-promise and over-deliver\n\nESCALATION CRITERIA:\n- Unresolved after 3 attempts\n- Customer explicitly requests supervisor\n- Legal/safety concerns\n- High-value customer at risk\n\nDocument all issues and resolutions carefully.`,\n    greetingMessage: `Hello, I'm Sophie from customer support. I'm here to help you with any concerns about your booking. What can I assist you with today?`,\n    greetingMessageHe: `砖,  住驻 转转 拽转.   注专  注  砖  注 注  砖.   住注?`\n  },\n  handoff: {\n    enableHandoff: true,\n    handoffTriggers: ['speak to human', 'supervisor', 'manager', 'escalate', '专 注 ', ''],\n    targetEngines: ['voice-agent-engine'],\n    handoffMessage: 'I\\'ll connect you with a specialist who can help further. Please hold.',\n    handoffMessageHe: '专 转  砖 注专 转专.  转.'\n  }\n};\n\n// ========================================\n// GROUP BOOKING ENGINE\n// Corporate and group bookings\n// ========================================\n\nexport const groupBookingEngineTemplate: AIEngineTemplate = {\n  id: 'group-booking-engine',\n  type: 'group-booking',\n  name: 'Group Booking Engine',\n  nameHe: '注 转 拽爪转转',\n  description: 'Specialized agent for corporate and group hotel bookings',\n  descriptionHe: '住 转 转  专转 拽爪转',\n  version: '1.0.0',\n  skills: [hotelSearchSkill, hotelPrebookSkill, hotelBookingSkill, marketAnalysisSkill, emailIntegrationSkill],\n  capabilities: ['search', 'prebook', 'booking', 'analytics', 'email-integration'],\n  modelConfig: {\n    provider: 'groq',\n    model: 'llama-3.3-70b-versatile',\n    temperature: 0.6,\n    maxTokens: 4096\n  },\n  persona: {\n    name: 'David',\n    nameHe: '',\n    role: 'Corporate Sales Manager',\n    roleHe: ' 专转 注住拽',\n    personality: ['professional', 'negotiator', 'strategic', 'relationship-focused'],\n    communicationStyle: 'business-professional',\n    expertise: ['corporate travel', 'group rates', 'contract negotiation', 'event planning'],\n    languages: ['en', 'he']\n  },\n  prompts: {\n    systemPrompt: `You are David, a corporate sales manager specializing in group and business travel.\n\nGROUP BOOKING EXPERTISE:\n1. Conference and event accommodations\n2. Corporate rate negotiations\n3. Multiple room blocks\n4. Meeting room requirements\n5. Group amenities and services\n\nDISCOVERY PROCESS:\n- Company/Organization name\n- Event type and purpose\n- Number of rooms needed\n- Date flexibility\n- Budget constraints\n- Meeting room requirements\n- Special requests (dietary, accessibility)\n\nNEGOTIATION POINTS:\n- Volume discounts (typically 10+ rooms)\n- Complimentary upgrades\n- Meeting room rates\n- Breakfast inclusions\n- Cancellation flexibility\n- Payment terms\n\nProvide itemized quotes and comparison options.`,\n    greetingMessage: `Hello, I'm David from our corporate booking team. I specialize in group and business travel arrangements. Whether you're planning a conference, corporate retreat, or team event, I'm here to find the perfect solution. What brings you to us today?`,\n    greetingMessageHe: `砖,   爪转 转 注住拽.  转 转 拽爪转转 住注转 注住拽.   转 转 住,  砖  专注 爪转 -   爪 转 驻转专 砖.   转 ?`\n  }\n};\n\n// ========================================\n// MULTI-AGENT ORCHESTRATOR\n// Coordinates between multiple specialized agents\n// ========================================\n\nexport const orchestratorEngineTemplate: AIEngineTemplate = {\n  id: 'orchestrator-engine',\n  type: 'multi-agent',\n  name: 'Multi-Agent Orchestrator',\n  nameHe: '转专 专-住',\n  description: 'Orchestrates conversations across multiple specialized agents',\n  descriptionHe: '转专 砖转  住 转 砖',\n  version: '1.0.0',\n  skills: [knowledgeBaseSkill],\n  capabilities: ['multi-agent', 'rag-retrieval'],\n  modelConfig: {\n    provider: 'groq',\n    model: 'llama-3.3-70b-versatile',\n    temperature: 0.3,\n    maxTokens: 1024\n  },\n  persona: {\n    name: 'Nexus',\n    nameHe: '拽住住',\n    role: 'Conversation Director',\n    roleHe: ' 砖转',\n    personality: ['efficient', 'organized', 'adaptive'],\n    communicationStyle: 'adaptive'\n  },\n  prompts: {\n    systemPrompt: `You are Nexus, the conversation orchestrator. Your role is to analyze user requests and route them to the appropriate specialist agent.\n\nAVAILABLE AGENTS:\n1. Alex (hotel-booking) - New bookings and reservations\n2. Maya (travel-agent) - Travel planning and recommendations\n3. James (concierge) - In-stay services and local recommendations\n4. Sam (voice-agent) - Phone-based interactions\n5. Atlas (price-monitor) - Price tracking and deal alerts\n6. Sophie (support-agent) - Issues and complaints\n7. David (group-booking) - Corporate and group bookings\n\nROUTING LOGIC:\n- Analyze the user's intent\n- Select the most appropriate agent\n- Provide context to the receiving agent\n- Monitor for handoff needs during conversation\n\nHANDOFF TRIGGERS:\n- Topic change requiring different expertise\n- Explicit user request\n- Escalation from specialized agent\n- Multi-domain queries (coordinate agents)\n\nKeep the conversation seamless - users shouldn't feel the agent change unless necessary.`,\n    greetingMessage: `Welcome! I'm here to connect you with the right specialist. Are you looking to book a hotel, plan a trip, get help with an existing reservation, or something else?`,\n    greetingMessageHe: `专 !   专 转  .  转 驻砖  , 转 , 拽 注专 注  拽转,  砖 专?`\n  },\n  handoff: {\n    enableHandoff: true,\n    handoffTriggers: ['new booking', 'plan trip', 'existing booking', 'issue', 'group', 'price alert'],\n    targetEngines: [\n      'hotel-booking-engine',\n      'travel-agent-engine',\n      'concierge-engine',\n      'support-agent-engine',\n      'group-booking-engine',\n      'price-monitor-engine'\n    ]\n  }\n};\n\n// ========================================\n// EXPORT ALL TEMPLATES\n// ========================================\n\nexport const allTemplates: AIEngineTemplate[] = [\n  hotelBookingEngineTemplate,\n  travelAgentEngineTemplate,\n  conciergeEngineTemplate,\n  voiceAgentEngineTemplate,\n  priceMonitorEngineTemplate,\n  supportAgentEngineTemplate,\n  groupBookingEngineTemplate,\n  orchestratorEngineTemplate\n];\n\nexport const getTemplateById = (id: string): AIEngineTemplate | undefined => {\n  return allTemplates.find(template => template.id === id);\n};\n\nexport const getTemplateByType = (type: AIEngineType): AIEngineTemplate | undefined => {\n  return allTemplates.find(template => template.type === type);\n};\n\nexport const getTemplatesByCapability = (capability: string): AIEngineTemplate[] => {\n  return allTemplates.filter(template =>\n    template.capabilities.includes(capability as any)\n  );\n};\n\nexport const getAllTemplateTypes = (): AIEngineType[] => {\n  return allTemplates.map(template => template.type);\n};\n","/**\n * AI Engine Manager\n * Core orchestration layer for AI booking engines\n */\n\nimport type {\n  AIEngineType,\n  AIEngineTemplate,\n  AIEngineInstance,\n  ConversationContext,\n  AISkill,\n  AITool,\n  HandoffConfig\n} from './types';\nimport { allTemplates, getTemplateById, getTemplateByType } from './templates';\nimport { allSkills, getSkillById } from './skills';\n\n// ========================================\n// ENGINE INSTANCE MANAGEMENT\n// ========================================\n\nexport class AIEngineManager {\n  private engines: Map<string, AIEngineInstance> = new Map();\n  private activeConversations: Map<string, ConversationContext> = new Map();\n  private toolHandlers: Map<string, Function> = new Map();\n\n  constructor() {\n    this.initializeDefaultEngines();\n  }\n\n  /**\n   * Initialize default engine instances from templates\n   */\n  private initializeDefaultEngines(): void {\n    allTemplates.forEach(template => {\n      const instance = this.createEngineInstance(template);\n      this.engines.set(instance.instanceId, instance);\n    });\n    console.log(`[AIEngineManager] Initialized ${this.engines.size} engine instances`);\n  }\n\n  /**\n   * Create an engine instance from a template\n   */\n  createEngineInstance(template: AIEngineTemplate, customConfig?: Partial<AIEngineTemplate>): AIEngineInstance {\n    const mergedTemplate = { ...template, ...customConfig };\n    \n    // Collect all tools from skills\n    const tools: AITool[] = [];\n    mergedTemplate.skills.forEach(skill => {\n      if (skill.isEnabled) {\n        tools.push(...skill.tools);\n      }\n    });\n\n    const instance: AIEngineInstance = {\n      instanceId: `${mergedTemplate.id}-${Date.now()}`,\n      template: mergedTemplate,\n      status: 'active',\n      createdAt: new Date(),\n      activeConversations: 0,\n      totalConversations: 0,\n      tools,\n      metadata: {\n        version: mergedTemplate.version,\n        templateId: mergedTemplate.id\n      }\n    };\n\n    return instance;\n  }\n\n  /**\n   * Get an engine instance by ID\n   */\n  getEngine(instanceId: string): AIEngineInstance | undefined {\n    return this.engines.get(instanceId);\n  }\n\n  /**\n   * Get all engine instances\n   */\n  getAllEngines(): AIEngineInstance[] {\n    return Array.from(this.engines.values());\n  }\n\n  /**\n   * Get engines by type\n   */\n  getEnginesByType(type: AIEngineType): AIEngineInstance[] {\n    return Array.from(this.engines.values()).filter(\n      engine => engine.template.type === type\n    );\n  }\n\n  /**\n   * Get active engines\n   */\n  getActiveEngines(): AIEngineInstance[] {\n    return Array.from(this.engines.values()).filter(\n      engine => engine.status === 'active'\n    );\n  }\n\n  // ========================================\n  // CONVERSATION MANAGEMENT\n  // ========================================\n\n  /**\n   * Start a new conversation with an engine\n   */\n  startConversation(\n    engineInstanceId: string,\n    userId?: string,\n    sessionId?: string,\n    initialContext?: Record<string, any>\n  ): ConversationContext | null {\n    const engine = this.engines.get(engineInstanceId);\n    if (!engine) {\n      console.error(`[AIEngineManager] Engine not found: ${engineInstanceId}`);\n      return null;\n    }\n\n    const conversationId = `conv-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n    \n    const context: ConversationContext = {\n      conversationId,\n      engineInstanceId,\n      userId,\n      sessionId: sessionId || conversationId,\n      startedAt: new Date(),\n      lastActivityAt: new Date(),\n      messageCount: 0,\n      currentIntent: undefined,\n      extractedEntities: {},\n      bookingData: {},\n      preferences: {},\n      metadata: initialContext || {}\n    };\n\n    this.activeConversations.set(conversationId, context);\n    engine.activeConversations++;\n    engine.totalConversations++;\n\n    console.log(`[AIEngineManager] Started conversation ${conversationId} with engine ${engine.template.name}`);\n    return context;\n  }\n\n  /**\n   * Get conversation context\n   */\n  getConversation(conversationId: string): ConversationContext | undefined {\n    return this.activeConversations.get(conversationId);\n  }\n\n  /**\n   * Update conversation context\n   */\n  updateConversation(\n    conversationId: string,\n    updates: Partial<ConversationContext>\n  ): ConversationContext | null {\n    const context = this.activeConversations.get(conversationId);\n    if (!context) return null;\n\n    const updated: ConversationContext = {\n      ...context,\n      ...updates,\n      lastActivityAt: new Date()\n    };\n\n    this.activeConversations.set(conversationId, updated);\n    return updated;\n  }\n\n  /**\n   * End a conversation\n   */\n  endConversation(conversationId: string): void {\n    const context = this.activeConversations.get(conversationId);\n    if (!context) return;\n\n    const engine = this.engines.get(context.engineInstanceId);\n    if (engine) {\n      engine.activeConversations = Math.max(0, engine.activeConversations - 1);\n    }\n\n    this.activeConversations.delete(conversationId);\n    console.log(`[AIEngineManager] Ended conversation ${conversationId}`);\n  }\n\n  // ========================================\n  // TOOL EXECUTION\n  // ========================================\n\n  /**\n   * Register a tool handler\n   */\n  registerToolHandler(handlerPath: string, handler: Function): void {\n    this.toolHandlers.set(handlerPath, handler);\n  }\n\n  /**\n   * Execute a tool\n   */\n  async executeTool(\n    toolName: string,\n    parameters: Record<string, any>,\n    context: ConversationContext\n  ): Promise<{\n    success: boolean;\n    result?: any;\n    error?: string;\n  }> {\n    // Find the tool across all skills\n    let tool: AITool | undefined;\n    for (const skill of allSkills) {\n      tool = skill.tools.find(t => t.name === toolName);\n      if (tool) break;\n    }\n\n    if (!tool) {\n      return { success: false, error: `Tool not found: ${toolName}` };\n    }\n\n    // Get handler\n    const handler = this.toolHandlers.get(tool.handler);\n    if (!handler) {\n      console.warn(`[AIEngineManager] Handler not registered: ${tool.handler}`);\n      // Return mock for now\n      return {\n        success: true,\n        result: { message: `[Mock] Tool ${toolName} executed with params`, parameters }\n      };\n    }\n\n    try {\n      const result = await handler(parameters, context);\n      return { success: true, result };\n    } catch (error: any) {\n      console.error(`[AIEngineManager] Tool execution error:`, error);\n      return { success: false, error: error.message };\n    }\n  }\n\n  /**\n   * Get all available tools for an engine\n   */\n  getEngineTools(engineInstanceId: string): AITool[] {\n    const engine = this.engines.get(engineInstanceId);\n    if (!engine) return [];\n\n    const tools: AITool[] = [];\n    engine.template.skills.forEach(skill => {\n      if (skill.isEnabled) {\n        tools.push(...skill.tools);\n      }\n    });\n\n    return tools;\n  }\n\n  /**\n   * Format tools for LLM consumption (OpenAI function format)\n   */\n  formatToolsForLLM(engineInstanceId: string): any[] {\n    const tools = this.getEngineTools(engineInstanceId);\n    \n    return tools.map(tool => ({\n      type: 'function',\n      function: {\n        name: tool.name,\n        description: tool.description,\n        parameters: {\n          type: 'object',\n          properties: tool.parameters.reduce((acc, param) => {\n            acc[param.name] = {\n              type: param.type === 'date' ? 'string' : param.type,\n              description: param.description\n            };\n            if (param.enum) {\n              acc[param.name].enum = param.enum;\n            }\n            return acc;\n          }, {} as Record<string, any>),\n          required: tool.parameters\n            .filter(p => p.required)\n            .map(p => p.name)\n        }\n      }\n    }));\n  }\n\n  // ========================================\n  // HANDOFF MANAGEMENT\n  // ========================================\n\n  /**\n   * Check if handoff should be triggered\n   */\n  shouldTriggerHandoff(\n    message: string,\n    context: ConversationContext\n  ): { shouldHandoff: boolean; targetEngine?: string; reason?: string } {\n    const engine = this.engines.get(context.engineInstanceId);\n    if (!engine?.template.handoff?.enableHandoff) {\n      return { shouldHandoff: false };\n    }\n\n    const handoff = engine.template.handoff;\n    const lowerMessage = message.toLowerCase();\n\n    // Check trigger phrases\n    for (const trigger of handoff.handoffTriggers || []) {\n      if (lowerMessage.includes(trigger.toLowerCase())) {\n        // Determine target engine based on trigger\n        const targetEngine = this.determineHandoffTarget(trigger, handoff);\n        return {\n          shouldHandoff: true,\n          targetEngine,\n          reason: `Triggered by phrase: \"${trigger}\"`\n        };\n      }\n    }\n\n    return { shouldHandoff: false };\n  }\n\n  /**\n   * Determine which engine to hand off to\n   */\n  private determineHandoffTarget(trigger: string, handoff: HandoffConfig): string | undefined {\n    const targetEngines = handoff.targetEngines || [];\n    if (targetEngines.length === 0) return undefined;\n\n    // Simple keyword matching for now\n    const triggerLower = trigger.toLowerCase();\n    \n    if (triggerLower.includes('book') || triggerLower.includes('')) {\n      return targetEngines.find(e => e.includes('booking'));\n    }\n    if (triggerLower.includes('support') || triggerLower.includes('issue') || triggerLower.includes('problem')) {\n      return targetEngines.find(e => e.includes('support'));\n    }\n    if (triggerLower.includes('group') || triggerLower.includes('corporate') || triggerLower.includes('拽爪')) {\n      return targetEngines.find(e => e.includes('group'));\n    }\n    if (triggerLower.includes('price') || triggerLower.includes('专')) {\n      return targetEngines.find(e => e.includes('price'));\n    }\n\n    return targetEngines[0];\n  }\n\n  /**\n   * Execute handoff to another engine\n   */\n  async executeHandoff(\n    conversationId: string,\n    targetEngineId: string\n  ): Promise<{\n    success: boolean;\n    newContext?: ConversationContext;\n    handoffMessage?: string;\n    error?: string;\n  }> {\n    const currentContext = this.activeConversations.get(conversationId);\n    if (!currentContext) {\n      return { success: false, error: 'Conversation not found' };\n    }\n\n    // Find target engine\n    let targetEngine: AIEngineInstance | undefined;\n    for (const engine of this.engines.values()) {\n      if (engine.template.id === targetEngineId || engine.instanceId === targetEngineId) {\n        targetEngine = engine;\n        break;\n      }\n    }\n\n    if (!targetEngine) {\n      return { success: false, error: `Target engine not found: ${targetEngineId}` };\n    }\n\n    // Create new conversation with target engine, preserving context\n    const newContext = this.startConversation(\n      targetEngine.instanceId,\n      currentContext.userId,\n      currentContext.sessionId,\n      {\n        ...currentContext.metadata,\n        handoffFrom: currentContext.engineInstanceId,\n        previousContext: {\n          extractedEntities: currentContext.extractedEntities,\n          bookingData: currentContext.bookingData,\n          preferences: currentContext.preferences\n        }\n      }\n    );\n\n    if (!newContext) {\n      return { success: false, error: 'Failed to create new conversation' };\n    }\n\n    // Preserve extracted data\n    newContext.extractedEntities = { ...currentContext.extractedEntities };\n    newContext.bookingData = { ...currentContext.bookingData };\n    newContext.preferences = { ...currentContext.preferences };\n\n    // End old conversation\n    this.endConversation(conversationId);\n\n    const handoffMessage = targetEngine.template.handoff?.handoffMessage || \n      `I'm connecting you with our ${targetEngine.template.persona?.role || 'specialist'} who can better assist you.`;\n\n    console.log(`[AIEngineManager] Handoff executed: ${currentContext.engineInstanceId} -> ${targetEngine.instanceId}`);\n\n    return {\n      success: true,\n      newContext,\n      handoffMessage\n    };\n  }\n\n  // ========================================\n  // ENGINE CONFIGURATION\n  // ========================================\n\n  /**\n   * Update engine configuration\n   */\n  updateEngineConfig(\n    instanceId: string,\n    config: Partial<AIEngineTemplate>\n  ): AIEngineInstance | null {\n    const engine = this.engines.get(instanceId);\n    if (!engine) return null;\n\n    engine.template = { ...engine.template, ...config };\n    engine.lastModified = new Date();\n\n    return engine;\n  }\n\n  /**\n   * Enable/disable a skill for an engine\n   */\n  toggleEngineSkill(instanceId: string, skillId: string, enabled: boolean): boolean {\n    const engine = this.engines.get(instanceId);\n    if (!engine) return false;\n\n    const skill = engine.template.skills.find(s => s.id === skillId);\n    if (!skill) return false;\n\n    skill.isEnabled = enabled;\n    engine.lastModified = new Date();\n\n    return true;\n  }\n\n  /**\n   * Add a skill to an engine\n   */\n  addSkillToEngine(instanceId: string, skillId: string): boolean {\n    const engine = this.engines.get(instanceId);\n    if (!engine) return false;\n\n    const skill = getSkillById(skillId);\n    if (!skill) return false;\n\n    // Check if skill already exists\n    if (engine.template.skills.some(s => s.id === skillId)) {\n      return false;\n    }\n\n    engine.template.skills.push({ ...skill });\n    engine.lastModified = new Date();\n\n    return true;\n  }\n\n  /**\n   * Set engine status\n   */\n  setEngineStatus(instanceId: string, status: 'active' | 'paused' | 'maintenance'): boolean {\n    const engine = this.engines.get(instanceId);\n    if (!engine) return false;\n\n    engine.status = status;\n    engine.lastModified = new Date();\n\n    return true;\n  }\n\n  // ========================================\n  // ANALYTICS & REPORTING\n  // ========================================\n\n  /**\n   * Get engine statistics\n   */\n  getEngineStats(instanceId?: string): Record<string, any> {\n    if (instanceId) {\n      const engine = this.engines.get(instanceId);\n      if (!engine) return {};\n\n      return {\n        instanceId: engine.instanceId,\n        name: engine.template.name,\n        type: engine.template.type,\n        status: engine.status,\n        activeConversations: engine.activeConversations,\n        totalConversations: engine.totalConversations,\n        skillCount: engine.template.skills.length,\n        toolCount: engine.tools.length,\n        createdAt: engine.createdAt,\n        lastModified: engine.lastModified\n      };\n    }\n\n    // Aggregate stats for all engines\n    const engines = Array.from(this.engines.values());\n    return {\n      totalEngines: engines.length,\n      activeEngines: engines.filter(e => e.status === 'active').length,\n      totalActiveConversations: engines.reduce((sum, e) => sum + e.activeConversations, 0),\n      totalConversations: engines.reduce((sum, e) => sum + e.totalConversations, 0),\n      enginesByType: engines.reduce((acc, e) => {\n        acc[e.template.type] = (acc[e.template.type] || 0) + 1;\n        return acc;\n      }, {} as Record<string, number>)\n    };\n  }\n\n  /**\n   * Get conversation analytics\n   */\n  getConversationAnalytics(timeRange?: { from: Date; to: Date }): Record<string, any> {\n    const conversations = Array.from(this.activeConversations.values());\n\n    // Filter by time range if provided\n    let filtered = conversations;\n    if (timeRange) {\n      filtered = conversations.filter(c => \n        c.startedAt >= timeRange.from && c.startedAt <= timeRange.to\n      );\n    }\n\n    return {\n      activeConversations: filtered.length,\n      averageMessageCount: filtered.reduce((sum, c) => sum + c.messageCount, 0) / filtered.length || 0,\n      conversationsByEngine: filtered.reduce((acc, c) => {\n        acc[c.engineInstanceId] = (acc[c.engineInstanceId] || 0) + 1;\n        return acc;\n      }, {} as Record<string, number>),\n      intents: filtered.reduce((acc, c) => {\n        if (c.currentIntent) {\n          acc[c.currentIntent] = (acc[c.currentIntent] || 0) + 1;\n        }\n        return acc;\n      }, {} as Record<string, number>)\n    };\n  }\n}\n\n// ========================================\n// SINGLETON EXPORT\n// ========================================\n\nlet managerInstance: AIEngineManager | null = null;\n\nexport function getAIEngineManager(): AIEngineManager {\n  if (!managerInstance) {\n    managerInstance = new AIEngineManager();\n  }\n  return managerInstance;\n}\n\nexport function resetAIEngineManager(): void {\n  managerInstance = null;\n}\n"],"names":[],"mappings":"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"}